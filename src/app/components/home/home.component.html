<div class="root">
  <ng-content></ng-content>
  <webmapp-search
    *ngIf="showSearch"
    #searchCmp
    [initSearch]="''"
    (isTypings)="isTyping$.next($event)"
    (words)="currentSearch$.next($event)"
    [currentLayer]="currentLayer$|async"
  >
    <webmapp-filter
      #filterCmp
      *ngIf="poiCards$|async"
      [filters]="confPOISFilter$|async"
      (selectedFilters)="setCurrentFilters($event)"
    ></webmapp-filter>
  </webmapp-search>
  <ion-grid *ngIf="showResult$|async">
    <ion-row>
      <ion-col>Filtri Attivi</ion-col>
      <ion-col></ion-col>
      <ion-col size="auto">
        <ion-chip [outline]="true" (click)="goToHome()">Torna alla home</ion-chip>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col class="chip-list">
        <ion-chip outline="true" *ngIf="(currentLayer$|async) as currentLayer">
          <ion-label> {{currentLayer.title|wmtrans}}</ion-label>
          <ion-icon name="close" (click)="removeLayer(currentLayer)"></ion-icon>
        </ion-chip>
        <ng-container *ngIf="(filterShowed$|async) as filters">
          <ion-chip outline="true" *ngFor="let filter of filters">
            <ng-container *ngIf="filter.identifier != null;else title">
              <ng-container *ngIf="filter.icon != null;else imgT">
                <div appBuildSvg style="height:55%" [svg]="filter.icon"></div>
              </ng-container>
              <ng-template #imgT>
                <img [src]="filter.identifier|getFilterIcn:(filterShowed$|async)" />
              </ng-template>
              <ion-label> {{filter.name|wmtrans}}</ion-label>
              <ion-icon name="close" (click)="removeFilter(filter.identifier)"></ion-icon>
            </ng-container>
            <ng-template #title>
              <ion-label> {{filter|wmtrans}}</ion-label>
              <ion-icon name="close" (click)="removeFilter(filter)"></ion-icon>
            </ng-template>
          </ion-chip>
        </ng-container>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-segment
    [value]="showResultType$|async"
    (ionChange)="changeResultType($event)"
    *ngIf="showResult$|async"
  >
    <ion-segment-button value="tracks">
      <ion-label>Sentieri</ion-label>
    </ion-segment-button>
    <ion-segment-button value="pois">
      <ion-label>Punti di interesse</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ion-content style="--offset-top:56px; --offset-bottom:56px;" class="wm-home-cardcontainer">
    <ng-container *ngIf="showResult$|async as showResult;else layers">
      <ng-container *ngIf="showResultType$|async as showResulType;">
        <ng-container *ngIf="showResulType === 'tracks'|| showResulType == null">
          <ng-container *ngIf="this.elasticSeachLoading$|async">
            <ion-list *ngFor="let idx of [1,1,1,1,1,1,1]">
              <ion-list-header>
                <ion-skeleton-text [animated]="true" style="width: 80px"></ion-skeleton-text>
              </ion-list-header>
              <ion-item>
                <ion-thumbnail slot="start">
                  <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                </ion-thumbnail>
                <ion-label>
                  <h3>
                    <ion-skeleton-text [animated]="true" style="width: 80%;"></ion-skeleton-text>
                  </h3>
                  <p>
                    <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
                  </p>
                  <p>
                    <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
                  </p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ng-container>

          <wm-search-box
            *ngFor="let card of elasticSearch$|async"
            [data]="card"
            (clickEVT)="searchCard(card.id)"
          >
          </wm-search-box>
        </ng-container>
        <div class="pois" *ngIf="showResulType === 'pois'|| showResulType === 'all'">
          <wm-poi-box *ngFor="let c of poiCards$|async" [data]="c" (clickEVT)="setPoi(c)">
          </wm-poi-box>
        </div>
      </ng-container>
    </ng-container>

    <ng-template #layers>
      <webmapp-tracks-box [data]="sardegnaActivities" (trackIdEVT)="setActivities([$event])">
      </webmapp-tracks-box>
      <ng-container *ngFor="let box of confHOME$|async;let idx = index">
        <webmapp-title *ngIf="box.box_type === 'title'">
          {{box.title|wmtrans}}
        </webmapp-title>
        <wm-poi-type-filter-box
          *ngIf="box.box_type === 'poi_type_filter'"
          [data]="box"
          (clickEVT)="toggleFilter(box.identifier, idx)"
        >
        </wm-poi-type-filter-box>
        <wm-slug-box
          *ngIf="box.box_type === 'slug'"
          [data]="box"
          (clickEVT)="openSlug(box.slug,idx)"
        >
        </wm-slug-box>
        <webmapp-box
          *ngIf="box.box_type === 'external_url'"
          [data]="box"
          (clickEVT)="openExternalUrl(box.url)"
        >
        </webmapp-box>

        <webmapp-tracks-box
          *ngIf="box.box_type === 'base'"
          [data]="box"
          (trackIdEVT)="searchCard($event)"
        >
        </webmapp-tracks-box>
        <wm-layer-box
          *ngIf="box.box_type === 'layer'"
          [data]="box"
          (clickEVT)="setLayer(box.layer,idx)"
        >
        </wm-layer-box>
      </ng-container>
    </ng-template>
  </ion-content>
</div>
