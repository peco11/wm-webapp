<div class="root">
  <ng-content></ng-content>
  <ng-container *ngIf="(confAPP$|async) as confAPP">
    <ion-item lines="none" *ngIf="confAPP.welcome as welcome">
      <ion-label [innerHTML]="sanitizer.bypassSecurityTrustHtml(welcome | wmtrans)"></ion-label>
    </ion-item>
  </ng-container>

  <webmapp-search
    #searchCmp
    [initSearch]="''"
    (isTypings)="isTyping$.next($event)"
    (words)="setSearch($event)"
  >
  </webmapp-search>
  <ion-grid *ngIf="showResultz$|async">
    <ion-row>
      <ion-col>{{'Filtri Attivi'|wmtrans}}</ion-col>
      <ion-col></ion-col>
      <ion-col size="auto">
        <ion-chip [outline]="true" (click)="goToHome()">Torna alla home</ion-chip>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col class="chip-list">
        <ion-chip outline="true" *ngIf="(currentLayer$|async) as currentLayer">
          <ion-label> {{currentLayer.title|wmtrans}}</ion-label>
          <ion-icon name="close" (click)="removeLayer(currentLayer)"></ion-icon>
        </ion-chip>
        <ng-container *ngIf="(filterShowed$|async) as filters">
          <ion-chip outline="true" *ngFor="let filter of filters">
            <ng-container *ngIf="filter.identifier != null;else title">
              <ng-container *ngIf="filter.icon != null;else imgT">
                <div appBuildSvg style="height:55%" [svg]="filter.icon"></div>
              </ng-container>
              <ng-template #imgT>
                <img [src]="filter.identifier|getFilterIcn:(filterShowed$|async)" />
              </ng-template>
              <ion-label> {{filter.name|wmtrans}}</ion-label>
              <ion-icon name="close" (click)="removeFilter(filter.identifier)"></ion-icon>
            </ng-container>
            <ng-template #title>
              <ion-label> {{filter|wmtrans}}</ion-label>
              <ion-icon name="close" (click)="removeFilter(filter)"></ion-icon>
            </ng-template>
          </ion-chip>
        </ng-container>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-segment
    [value]="showResultType$|async"
    (ionChange)="changeResultType($event)"
    *ngIf="showResultz$|async"
  >
    <ion-segment-button value="tracks" [disabled]="(elasticSearch$|async).length === 0">
      <ion-label
        >{{'Sentieri'|wmtrans}}
        <ng-container
          *ngIf="(elasticSearch$|async) as elasticSearch"
          >{{elasticSearch.length>0?elasticSearch.length:''}}</ng-container
        ></ion-label
      >
    </ion-segment-button>
    <ion-segment-button value="pois">
      <ion-label
        >{{'Punti di interesse'|wmtrans}}
        <ng-container
          *ngIf="featureCollectionCount$|async as count"
          >{{count}}</ng-container
        ></ion-label
      >
    </ion-segment-button>
  </ion-segment>

  <ion-content style="--offset-top:56px; --offset-bottom:56px;" class="wm-home-cardcontainer">
    <ng-container *ngIf="(showResultz$|async);else layers">
      <ng-container *ngIf="showResultType$|async as showResulType;">
        <ng-container
          *ngIf="(showResultz$|async) && showResulType === 'tracks'|| showResulType == null"
        >
          <ng-container *ngIf="this.elasticSeachLoading$|async">
            <ion-list *ngFor="let idx of [1,1,1,1,1,1,1]">
              <ion-list-header>
                <ion-skeleton-text [animated]="true" style="width: 80px"></ion-skeleton-text>
              </ion-list-header>
              <ion-item>
                <ion-thumbnail slot="start">
                  <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                </ion-thumbnail>
                <ion-label>
                  <h3>
                    <ion-skeleton-text [animated]="true" style="width: 80%;"></ion-skeleton-text>
                  </h3>
                  <p>
                    <ion-skeleton-text [animated]="true" style="width: 60%;"></ion-skeleton-text>
                  </p>
                  <p>
                    <ion-skeleton-text [animated]="true" style="width: 30%;"></ion-skeleton-text>
                  </p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ng-container>
          <ng-container *ngIf="elasticSearch$|async as elasticSearch">
            <ng-container *ngIf="elasticSearch.length > 0; else noResult">
              <wm-search-box
                *ngFor="let card of elasticSearch"
                [data]="card"
                (clickEVT)="searchCard(card.id)"
              >
              </wm-search-box>
            </ng-container>
          </ng-container>
        </ng-container>
        <div class="pois" *ngIf="showResulType === 'pois'|| showResulType === 'all'">
          <wm-poi-box *ngFor="let c of poiCards$|async" [data]="c" (clickEVT)="setPoi(c)">
          </wm-poi-box>
        </div>
      </ng-container>
    </ng-container>

    <ng-template #layers>
      <ng-container *ngFor="let box of confHOME$|async;let idx = index">
        <webmapp-title *ngIf="box.box_type === 'title'">
          {{box.title|wmtrans}}
        </webmapp-title>
        <wm-horizontal-scroll-box
          *ngIf="box.box_type === 'horizontal_scroll'"
          [data]="box"
          (clickEVT)="setActivities([$event])"
        >
        </wm-horizontal-scroll-box>
        <wm-poi-type-filter-box
          *ngIf="box.box_type === 'poi_type_filter'"
          [data]="box"
          (clickEVT)="toggleFilter(box, idx)"
        >
        </wm-poi-type-filter-box>
        <wm-slug-box
          *ngIf="box.box_type === 'slug'"
          [data]="box"
          (clickEVT)="openSlug(box.slug,idx)"
        >
        </wm-slug-box>
        <webmapp-box
          *ngIf="box.box_type === 'external_url'"
          [data]="box"
          (clickEVT)="openExternalUrl(box.url)"
        >
        </webmapp-box>

        <webmapp-tracks-box
          *ngIf="box.box_type === 'base'"
          [data]="box"
          (trackIdEVT)="searchCard($event)"
        >
        </webmapp-tracks-box>
        <wm-layer-box
          *ngIf="box.box_type === 'layer'"
          [data]="box"
          (clickEVT)="setLayer(box.layer,idx)"
        >
        </wm-layer-box>
      </ng-container>
    </ng-template>
    <ng-template #noResult>
      <ion-item lines="none">
        <h5>{{'Spiacenti non ci sono risultati con questi criteri di ricarca.'|wmtrans}}</h5>
      </ion-item>
    </ng-template>
  </ion-content>
</div>
