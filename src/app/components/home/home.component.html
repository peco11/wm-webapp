<div class="root">
  <webmapp-search
    *ngIf="showSearch &&(currentLayer$|async) === null"
    [initSearch]="title"
    (words)="isTyping$.next($event)"
  ></webmapp-search>
  <ng-container *ngIf="(currentLayer$|async) as currentLayer">
    <ng-container *ngIf="(isTyping$|async)===false && currentLayer!=null">
      <div class="reset-layer" (click)="setLayer(null)">
        <ion-icon name="caret-back-outline"></ion-icon>
        <div>{{currentLayer.title}}</div>
      </div>
    </ng-container>
  </ng-container>

  <ion-content style="--offset-top:56px; --offset-bottom:56px;" class="wm-home-cardcontainer">
    <ng-container *ngIf="(isTyping$|async)||(layerCards$|async)!=null; else layers">
      <webmapp-search-box
        *ngFor="let card of cards$|async"
        [data]="card"
        (clickEVT)="searchCard(card.id)"
      >
      </webmapp-search-box>
    </ng-container>

    <ng-template #layers>
      <ng-container *ngFor="let box of confHOME$|async">
        <webmapp-title *ngIf="box.box_type === 'title'">
          {{box.title}}
        </webmapp-title>
        <webmapp-box *ngIf="box.box_type === 'slug'" [data]="box" (clickEVT)="openSlug(box.slug)">
        </webmapp-box>
        <webmapp-box
          *ngIf="box.box_type === 'external_url'"
          [data]="box"
          (clickEVT)="openExternalUrl(box.url)"
        >
        </webmapp-box>
        <webmapp-tracks-box
          *ngIf="box.box_type === 'base'"
          [data]="box"
          (trackIdEVT)="searchCard($event)"
        >
        </webmapp-tracks-box>
        <webmapp-layer-box
          *ngIf="box.box_type === 'layer'"
          [data]="box.layer"
          (clickEVT)="setLayer(box.layer)"
        >
        </webmapp-layer-box>
      </ng-container>
    </ng-template>
  </ion-content>
</div>
