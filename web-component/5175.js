(self.webpackChunkwm_webapp=self.webpackChunkwm_webapp||[]).push([[5175],{6812:function(t,e){var i,n,r;n=[],void 0===(r="function"==typeof(i=function(t,e){var i,n={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:!1,trueIsEmpty:!1,autoDate:!1,ignorePrefixedNodes:!1,parseValues:!1},r=[],o=/^\s*$/,s=/^(?:true|false)$/i;return new function(){function e(t){return n.parseValues?o.test(t)?null:s.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):n.autoDate&&isFinite(Date.parse(t))?new Date(t):t:t}function a(){}function l(t,i,o,s){var c,h,u=r.length,d=t.hasChildNodes(),p=t.nodeType===t.ELEMENT_NODE&&t.hasAttributes(),f=Boolean(2&i),g=0,m="",_=f?{}:!!n.trueIsEmpty||"";if(d)for(var v,y=0;y<t.childNodes.length;y++)4===(v=t.childNodes.item(y)).nodeType?m+=v.nodeValue:3===v.nodeType?m+=v.nodeValue.trim():1!==v.nodeType||n.ignorePrefixedNodes&&v.prefix||r.push(v);var w,x=r.length,b=e(m);f||!d&&!p||(_=0===i?null===(w=b)?new a:w instanceof Object?w:new w.constructor(w):{});for(var C=u;C<x;C++)c=r[C].nodeName,n.lowerCaseTags&&(c=c.toLowerCase()),h=l(r[C],i,o,s),_.hasOwnProperty(c)?(_[c].constructor!==Array&&(_[c]=[_[c]]),_[c].push(h)):(_[c]=h,g++);if(p){for(var T,S,k=t.attributes.length,E=s?"":n.attrPrefix,P=s?{}:_,M=0;M<k;g++,M++)S=(T=t.attributes.item(M)).name,n.lowerCaseTags&&(S=S.toLowerCase()),P[E+S]=e(T.value.trim());s&&(o&&Object.freeze(P),_[n.attrKey]=P,g-=k-1)}return 3===i||(2===i||1===i&&g>0)&&m?_[n.valueKey]=b:!f&&0===g&&m&&(_=b),o&&(f||g>0)&&Object.freeze(_),r.length=u,_}function c(t,e,i){var r,o,s;if(i.constructor===String||i.constructor===Number||i.constructor===Boolean){if(e.appendChild(t.createTextNode(i.toString())),i===i.valueOf())return}else i.constructor===Date&&e.appendChild(t.createTextNode(i.toISOString()));for(var a in i)if(void 0!==(r=i[a])&&(null===r&&(r={}),!(isFinite(a)||r instanceof Function)))if(a===n.valueKey)null!==r&&!0!==r&&e.appendChild(t.createTextNode(r.constructor===Date?r.toISOString():String(r)));else if(a===n.attrKey)for(var l in r)e.setAttribute(l,r[l]);else if(a===n.attrPrefix+"xmlns");else if(a.charAt(0)===n.attrPrefix)e.setAttribute(a.slice(1),r);else if(r.constructor===Array)for(var h in r)r.hasOwnProperty(h)&&(o=(s=r[h]&&r[h][n.attrPrefix+"xmlns"]||e.namespaceURI)?t.createElementNS(s,a):t.createElement(a),c(t,o,r[h]||{}),e.appendChild(o));else o=(s=(r||{})[n.attrPrefix+"xmlns"]||e.namespaceURI)?t.createElementNS(s,a):t.createElement(a),r instanceof Object?c(t,o,r):null===r||!0===r&&n.trueIsEmpty||o.appendChild(t.createTextNode(r.toString())),e.appendChild(o)}this.config=function(e){for(var r in e)n[r]=e[r];n.parserErrorHandler&&(i=new t.DOMParser({errorHandler:n.parserErrorHandler,locator:{}}))},a.prototype.toString=function(){return"null"},a.prototype.valueOf=function(){return null},this.xmlToJs=this.build=function(t,e,i,n){var r=arguments.length>1&&"number"==typeof e?3&e:1;return l(t,r,i||!1,arguments.length>3?n:3===r)},this.jsToXml=this.unbuild=function(e,i,n,r){var o=(t.document&&t.document.implementation||new t.DOMImplementation).createDocument(i||null,n||"",r||null);return c(o,o.documentElement||o,e),o},this.stringToXml=function(e){return i||(i=new t.DOMParser),i.parseFromString(e,"application/xml")},this.xmlToString=function(e){return void 0!==e.xml?e.xml:(new t.XMLSerializer).serializeToString(e)},this.stringToJs=function(t){var e=this.stringToXml(t);return this.xmlToJs(e)},this.jsToString=this.stringify=function(t,e,i,n){return this.xmlToString(this.jsToXml(t,e,i,n))},this.each=function(t,e,i){t instanceof Array?t.forEach(e,i):[t].forEach(e,i)}}}(window))?i.apply(e,n):i)||(t.exports=r)},9696:(t,e,i)=>{var n=i(6812);n.config({attrPrefix:"@"}),t.exports=function(t,e){if("string"==typeof(e=function(t,e){for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({creator:"togpx",metadata:void 0,featureTitle:function t(e){if(!e)return"";if("object"==typeof e.tags){var i=t(e.tags);if(""!==i)return i}return e.name?e.name:e.ref?e.ref:e.id?e.id:""},featureDescription:function t(e){if(!e)return"";if("object"==typeof e.tags)return t(e.tags);var i="";for(var n in e)"object"!=typeof e[n]&&(i+=n+"="+e[n]+"\n");return i.substr(0,i.length-1)},featureLink:void 0,featureCoordTimes:function(t){return t.properties&&(t.properties.times||t.properties.coordTimes)||null}},e||{})).featureCoordTimes){var i=e.featureCoordTimes;e.featureCoordTimes=function(t){return t.properties[i]}}function r(t,i){e.featureLink&&(t.link={"@href":e.featureLink(i.properties)})}var s={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};return e.creator&&(s.gpx["@creator"]=e.creator),e.metadata?s.gpx.metadata=e.metadata:delete e.metadata,("FeatureCollection"===t.type?t.features:"Feature"===t.type?[t]:[{type:"Feature",properties:{},geometry:t}]).forEach(function t(i){switch(i.geometry.type){case"Point":case"MultiPoint":var n=i.geometry.coordinates;"Point"==i.geometry.type&&(n=[n]),n.forEach(function(t){o={"@lat":t[1],"@lon":t[0],name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},void 0!==t[2]&&(o.ele=t[2]),r(o,i),s.gpx.wpt.push(o)});break;case"LineString":case"MultiLineString":n=i.geometry.coordinates;var a=e.featureCoordTimes(i);"LineString"==i.geometry.type&&(n=[n]),o={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},r(o,i),o.trkseg=[],n.forEach(function(t){var e={trkpt:[]};t.forEach(function(t,i){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),a&&a[i]&&(n.time=a[i]),e.trkpt.push(n)}),o.trkseg.push(e)}),s.gpx.trk.push(o);break;case"Polygon":case"MultiPolygon":o={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},r(o,i),o.trkseg=[],n=i.geometry.coordinates,a=e.featureCoordTimes(i),"Polygon"==i.geometry.type&&(n=[n]),n.forEach(function(t){t.forEach(function(t){var e={trkpt:[]},i=0;t.forEach(function(t){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),a&&a[i]&&(n.time=a[i]),i++,e.trkpt.push(n)}),o.trkseg.push(e)})}),s.gpx.trk.push(o);break;case"GeometryCollection":i.geometry.geometries.forEach(function(e){t({properties:i.properties,geometry:e})});break;default:console.log("warning: unsupported geometry type: "+i.geometry.type)}}),gpx_str=n.stringify(s),gpx_str}},5175:(t,e,i)=>{"use strict";i.r(e),i.d(e,{MapPageModule:()=>T_});var n=i(8706),r=i(8583),o=i(3679),s=i(5214),a=i(8902),l=i(7716);let c=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,a.x],a.x]}),t})();function h(t){return null!==t&&"object"==typeof t&&"constructor"in t&&t.constructor===Object}function u(t={},e={}){Object.keys(e).forEach(i=>{void 0===t[i]?t[i]=e[i]:h(e[i])&&h(t[i])&&Object.keys(e[i]).length>0&&u(t[i],e[i])})}const d={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function p(){const t="undefined"!=typeof document?document:{};return u(t,d),t}const f={document:d,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:t=>"undefined"==typeof setTimeout?(t(),null):setTimeout(t,0),cancelAnimationFrame(t){"undefined"!=typeof setTimeout&&clearTimeout(t)}};function g(){const t="undefined"!=typeof window?window:{};return u(t,f),t}class m extends Array{constructor(t){super(...t||[]),function(t){const e=t.__proto__;Object.defineProperty(t,"__proto__",{get:()=>e,set(t){e.__proto__=t}})}(this)}}function _(t=[]){const e=[];return t.forEach(t=>{Array.isArray(t)?e.push(..._(t)):e.push(t)}),e}function v(t,e){return Array.prototype.filter.call(t,e)}function y(t,e){const i=g(),n=p();let r=[];if(!e&&t instanceof m)return t;if(!t)return new m(r);if("string"==typeof t){const i=t.trim();if(i.indexOf("<")>=0&&i.indexOf(">")>=0){let t="div";0===i.indexOf("<li")&&(t="ul"),0===i.indexOf("<tr")&&(t="tbody"),0!==i.indexOf("<td")&&0!==i.indexOf("<th")||(t="tr"),0===i.indexOf("<tbody")&&(t="table"),0===i.indexOf("<option")&&(t="select");const e=n.createElement(t);e.innerHTML=i;for(let i=0;i<e.childNodes.length;i+=1)r.push(e.childNodes[i])}else r=function(t,e){if("string"!=typeof t)return[t];const i=[],n=e.querySelectorAll(t);for(let r=0;r<n.length;r+=1)i.push(n[r]);return i}(t.trim(),e||n)}else if(t.nodeType||t===i||t===n)r.push(t);else if(Array.isArray(t)){if(t instanceof m)return t;r=t}return new m(function(t){const e=[];for(let i=0;i<t.length;i+=1)-1===e.indexOf(t[i])&&e.push(t[i]);return e}(r))}y.fn=m.prototype;const w="resize scroll".split(" ");function x(t){return function(...e){if(void 0===e[0]){for(let e=0;e<this.length;e+=1)w.indexOf(t)<0&&(t in this[e]?this[e][t]():y(this[e]).trigger(t));return this}return this.on(t,...e)}}x("click"),x("blur"),x("focus"),x("focusin"),x("focusout"),x("keyup"),x("keydown"),x("keypress"),x("submit"),x("change"),x("mousedown"),x("mousemove"),x("mouseup"),x("mouseenter"),x("mouseleave"),x("mouseout"),x("mouseover"),x("touchstart"),x("touchend"),x("touchmove"),x("resize"),x("scroll");const b={addClass:function(...t){const e=_(t.map(t=>t.split(" ")));return this.forEach(t=>{t.classList.add(...e)}),this},removeClass:function(...t){const e=_(t.map(t=>t.split(" ")));return this.forEach(t=>{t.classList.remove(...e)}),this},hasClass:function(...t){const e=_(t.map(t=>t.split(" ")));return v(this,t=>e.filter(e=>t.classList.contains(e)).length>0).length>0},toggleClass:function(...t){const e=_(t.map(t=>t.split(" ")));this.forEach(t=>{e.forEach(e=>{t.classList.toggle(e)})})},attr:function(t,e){if(1===arguments.length&&"string"==typeof t)return this[0]?this[0].getAttribute(t):void 0;for(let i=0;i<this.length;i+=1)if(2===arguments.length)this[i].setAttribute(t,e);else for(const e in t)this[i][e]=t[e],this[i].setAttribute(e,t[e]);return this},removeAttr:function(t){for(let e=0;e<this.length;e+=1)this[e].removeAttribute(t);return this},transform:function(t){for(let e=0;e<this.length;e+=1)this[e].style.transform=t;return this},transition:function(t){for(let e=0;e<this.length;e+=1)this[e].style.transitionDuration="string"!=typeof t?`${t}ms`:t;return this},on:function(...t){let[e,i,n,r]=t;function o(t){const e=t.target;if(!e)return;const r=t.target.dom7EventData||[];if(r.indexOf(t)<0&&r.unshift(t),y(e).is(i))n.apply(e,r);else{const t=y(e).parents();for(let e=0;e<t.length;e+=1)y(t[e]).is(i)&&n.apply(t[e],r)}}function s(t){const e=t&&t.target&&t.target.dom7EventData||[];e.indexOf(t)<0&&e.unshift(t),n.apply(this,e)}"function"==typeof t[1]&&([e,n,r]=t,i=void 0),r||(r=!1);const a=e.split(" ");let l;for(let c=0;c<this.length;c+=1){const t=this[c];if(i)for(l=0;l<a.length;l+=1){const e=a[l];t.dom7LiveListeners||(t.dom7LiveListeners={}),t.dom7LiveListeners[e]||(t.dom7LiveListeners[e]=[]),t.dom7LiveListeners[e].push({listener:n,proxyListener:o}),t.addEventListener(e,o,r)}else for(l=0;l<a.length;l+=1){const e=a[l];t.dom7Listeners||(t.dom7Listeners={}),t.dom7Listeners[e]||(t.dom7Listeners[e]=[]),t.dom7Listeners[e].push({listener:n,proxyListener:s}),t.addEventListener(e,s,r)}}return this},off:function(...t){let[e,i,n,r]=t;"function"==typeof t[1]&&([e,n,r]=t,i=void 0),r||(r=!1);const o=e.split(" ");for(let s=0;s<o.length;s+=1){const t=o[s];for(let e=0;e<this.length;e+=1){const o=this[e];let s;if(!i&&o.dom7Listeners?s=o.dom7Listeners[t]:i&&o.dom7LiveListeners&&(s=o.dom7LiveListeners[t]),s&&s.length)for(let e=s.length-1;e>=0;e-=1){const i=s[e];n&&i.listener===n||n&&i.listener&&i.listener.dom7proxy&&i.listener.dom7proxy===n?(o.removeEventListener(t,i.proxyListener,r),s.splice(e,1)):n||(o.removeEventListener(t,i.proxyListener,r),s.splice(e,1))}}}return this},trigger:function(...t){const e=g(),i=t[0].split(" "),n=t[1];for(let r=0;r<i.length;r+=1){const o=i[r];for(let i=0;i<this.length;i+=1){const r=this[i];if(e.CustomEvent){const i=new e.CustomEvent(o,{detail:n,bubbles:!0,cancelable:!0});r.dom7EventData=t.filter((t,e)=>e>0),r.dispatchEvent(i),r.dom7EventData=[],delete r.dom7EventData}}}return this},transitionEnd:function(t){const e=this;return t&&e.on("transitionend",function i(n){n.target===this&&(t.call(this,n),e.off("transitionend",i))}),this},outerWidth:function(t){if(this.length>0){if(t){const t=this.styles();return this[0].offsetWidth+parseFloat(t.getPropertyValue("margin-right"))+parseFloat(t.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null},outerHeight:function(t){if(this.length>0){if(t){const t=this.styles();return this[0].offsetHeight+parseFloat(t.getPropertyValue("margin-top"))+parseFloat(t.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null},styles:function(){const t=g();return this[0]?t.getComputedStyle(this[0],null):{}},offset:function(){if(this.length>0){const t=g(),e=p(),i=this[0],n=i.getBoundingClientRect(),r=e.body;return{top:n.top+(i===t?t.scrollY:i.scrollTop)-(i.clientTop||r.clientTop||0),left:n.left+(i===t?t.scrollX:i.scrollLeft)-(i.clientLeft||r.clientLeft||0)}}return null},css:function(t,e){const i=g();let n;if(1===arguments.length){if("string"!=typeof t){for(n=0;n<this.length;n+=1)for(const e in t)this[n].style[e]=t[e];return this}if(this[0])return i.getComputedStyle(this[0],null).getPropertyValue(t)}if(2===arguments.length&&"string"==typeof t){for(n=0;n<this.length;n+=1)this[n].style[t]=e;return this}return this},each:function(t){return t?(this.forEach((e,i)=>{t.apply(e,[e,i])}),this):this},html:function(t){if(void 0===t)return this[0]?this[0].innerHTML:null;for(let e=0;e<this.length;e+=1)this[e].innerHTML=t;return this},text:function(t){if(void 0===t)return this[0]?this[0].textContent.trim():null;for(let e=0;e<this.length;e+=1)this[e].textContent=t;return this},is:function(t){const e=g(),i=p(),n=this[0];let r,o;if(!n||void 0===t)return!1;if("string"==typeof t){if(n.matches)return n.matches(t);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(n.msMatchesSelector)return n.msMatchesSelector(t);for(r=y(t),o=0;o<r.length;o+=1)if(r[o]===n)return!0;return!1}if(t===i)return n===i;if(t===e)return n===e;if(t.nodeType||t instanceof m){for(r=t.nodeType?[t]:t,o=0;o<r.length;o+=1)if(r[o]===n)return!0;return!1}return!1},index:function(){let t,e=this[0];if(e){for(t=0;null!==(e=e.previousSibling);)1===e.nodeType&&(t+=1);return t}},eq:function(t){if(void 0===t)return this;const e=this.length;if(t>e-1)return y([]);if(t<0){const i=e+t;return y(i<0?[]:[this[i]])}return y([this[t]])},append:function(...t){let e;const i=p();for(let n=0;n<t.length;n+=1){e=t[n];for(let t=0;t<this.length;t+=1)if("string"==typeof e){const n=i.createElement("div");for(n.innerHTML=e;n.firstChild;)this[t].appendChild(n.firstChild)}else if(e instanceof m)for(let i=0;i<e.length;i+=1)this[t].appendChild(e[i]);else this[t].appendChild(e)}return this},prepend:function(t){const e=p();let i,n;for(i=0;i<this.length;i+=1)if("string"==typeof t){const r=e.createElement("div");for(r.innerHTML=t,n=r.childNodes.length-1;n>=0;n-=1)this[i].insertBefore(r.childNodes[n],this[i].childNodes[0])}else if(t instanceof m)for(n=0;n<t.length;n+=1)this[i].insertBefore(t[n],this[i].childNodes[0]);else this[i].insertBefore(t,this[i].childNodes[0]);return this},next:function(t){return this.length>0?t?this[0].nextElementSibling&&y(this[0].nextElementSibling).is(t)?y([this[0].nextElementSibling]):y([]):y(this[0].nextElementSibling?[this[0].nextElementSibling]:[]):y([])},nextAll:function(t){const e=[];let i=this[0];if(!i)return y([]);for(;i.nextElementSibling;){const n=i.nextElementSibling;t?y(n).is(t)&&e.push(n):e.push(n),i=n}return y(e)},prev:function(t){if(this.length>0){const e=this[0];return t?e.previousElementSibling&&y(e.previousElementSibling).is(t)?y([e.previousElementSibling]):y([]):y(e.previousElementSibling?[e.previousElementSibling]:[])}return y([])},prevAll:function(t){const e=[];let i=this[0];if(!i)return y([]);for(;i.previousElementSibling;){const n=i.previousElementSibling;t?y(n).is(t)&&e.push(n):e.push(n),i=n}return y(e)},parent:function(t){const e=[];for(let i=0;i<this.length;i+=1)null!==this[i].parentNode&&(t?y(this[i].parentNode).is(t)&&e.push(this[i].parentNode):e.push(this[i].parentNode));return y(e)},parents:function(t){const e=[];for(let i=0;i<this.length;i+=1){let n=this[i].parentNode;for(;n;)t?y(n).is(t)&&e.push(n):e.push(n),n=n.parentNode}return y(e)},closest:function(t){let e=this;return void 0===t?y([]):(e.is(t)||(e=e.parents(t).eq(0)),e)},find:function(t){const e=[];for(let i=0;i<this.length;i+=1){const n=this[i].querySelectorAll(t);for(let t=0;t<n.length;t+=1)e.push(n[t])}return y(e)},children:function(t){const e=[];for(let i=0;i<this.length;i+=1){const n=this[i].children;for(let i=0;i<n.length;i+=1)t&&!y(n[i]).is(t)||e.push(n[i])}return y(e)},filter:function(t){return y(v(this,t))},remove:function(){for(let t=0;t<this.length;t+=1)this[t].parentNode&&this[t].parentNode.removeChild(this[t]);return this}};Object.keys(b).forEach(t=>{Object.defineProperty(y.fn,t,{value:b[t],writable:!0})});const C=y;function T(t,e=0){return setTimeout(t,e)}function S(){return Date.now()}function k(t){return"object"==typeof t&&null!==t&&t.constructor&&"Object"===Object.prototype.toString.call(t).slice(8,-1)}function E(...t){const e=Object(t[0]),i=["__proto__","constructor","prototype"];for(let r=1;r<t.length;r+=1){const o=t[r];if(null!=o&&(n=o,!("undefined"!=typeof window&&void 0!==window.HTMLElement?n instanceof HTMLElement:n&&(1===n.nodeType||11===n.nodeType)))){const t=Object.keys(Object(o)).filter(t=>i.indexOf(t)<0);for(let i=0,n=t.length;i<n;i+=1){const n=t[i],r=Object.getOwnPropertyDescriptor(o,n);void 0!==r&&r.enumerable&&(k(e[n])&&k(o[n])?o[n].__swiper__?e[n]=o[n]:E(e[n],o[n]):!k(e[n])&&k(o[n])?(e[n]={},o[n].__swiper__?e[n]=o[n]:E(e[n],o[n])):e[n]=o[n])}}}var n;return e}function P(t,e,i){t.style.setProperty(e,i)}function M({swiper:t,targetPosition:e,side:i}){const n=g(),r=-t.translate;let o,s=null;const a=t.params.speed;t.wrapperEl.style.scrollSnapType="none",n.cancelAnimationFrame(t.cssModeFrameID);const l=e>r?"next":"prev",c=(t,e)=>"next"===l&&t>=e||"prev"===l&&t<=e,h=()=>{o=(new Date).getTime(),null===s&&(s=o);const l=Math.max(Math.min((o-s)/a,1),0),u=.5-Math.cos(l*Math.PI)/2;let d=r+u*(e-r);if(c(d,e)&&(d=e),t.wrapperEl.scrollTo({[i]:d}),c(d,e))return t.wrapperEl.style.overflow="hidden",t.wrapperEl.style.scrollSnapType="",setTimeout(()=>{t.wrapperEl.style.overflow="",t.wrapperEl.scrollTo({[i]:d})}),void n.cancelAnimationFrame(t.cssModeFrameID);t.cssModeFrameID=n.requestAnimationFrame(h)};h()}let I,L,A;function R(){return I||(I=function(){const t=g(),e=p();return{smoothScroll:e.documentElement&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch),passiveListener:function(){let e=!1;try{const i=Object.defineProperty({},"passive",{get(){e=!0}});t.addEventListener("testPassiveListener",null,i)}catch(wm){}return e}(),gestures:"ongesturestart"in t}}()),I}const O={on(t,e,i){const n=this;if("function"!=typeof e)return n;const r=i?"unshift":"push";return t.split(" ").forEach(t=>{n.eventsListeners[t]||(n.eventsListeners[t]=[]),n.eventsListeners[t][r](e)}),n},once(t,e,i){const n=this;if("function"!=typeof e)return n;function r(...i){n.off(t,r),r.__emitterProxy&&delete r.__emitterProxy,e.apply(n,i)}return r.__emitterProxy=e,n.on(t,r,i)},onAny(t,e){const i=this;if("function"!=typeof t)return i;const n=e?"unshift":"push";return i.eventsAnyListeners.indexOf(t)<0&&i.eventsAnyListeners[n](t),i},offAny(t){const e=this;if(!e.eventsAnyListeners)return e;const i=e.eventsAnyListeners.indexOf(t);return i>=0&&e.eventsAnyListeners.splice(i,1),e},off(t,e){const i=this;return i.eventsListeners?(t.split(" ").forEach(t=>{void 0===e?i.eventsListeners[t]=[]:i.eventsListeners[t]&&i.eventsListeners[t].forEach((n,r)=>{(n===e||n.__emitterProxy&&n.__emitterProxy===e)&&i.eventsListeners[t].splice(r,1)})}),i):i},emit(...t){const e=this;if(!e.eventsListeners)return e;let i,n,r;return"string"==typeof t[0]||Array.isArray(t[0])?(i=t[0],n=t.slice(1,t.length),r=e):(i=t[0].events,n=t[0].data,r=t[0].context||e),n.unshift(r),(Array.isArray(i)?i:i.split(" ")).forEach(t=>{e.eventsAnyListeners&&e.eventsAnyListeners.length&&e.eventsAnyListeners.forEach(e=>{e.apply(r,[t,...n])}),e.eventsListeners&&e.eventsListeners[t]&&e.eventsListeners[t].forEach(t=>{t.apply(r,n)})}),e}};function F({swiper:t,runCallbacks:e,direction:i,step:n}){const{activeIndex:r,previousIndex:o}=t;let s=i;if(s||(s=r>o?"next":r<o?"prev":"reset"),t.emit(`transition${n}`),e&&r!==o){if("reset"===s)return void t.emit(`slideResetTransition${n}`);t.emit(`slideChangeTransition${n}`),t.emit("next"===s?`slideNextTransition${n}`:`slidePrevTransition${n}`)}}function D(t){const e=this,i=p(),n=g(),r=e.touchEventsData,{params:o,touches:s,enabled:a}=e;if(!a)return;if(e.animating&&o.preventInteractionOnTransition)return;!e.animating&&o.cssMode&&o.loop&&e.loopFix();let l=t;l.originalEvent&&(l=l.originalEvent);let c=C(l.target);if("wrapper"===o.touchEventsTarget&&!c.closest(e.wrapperEl).length)return;if(r.isTouchEvent="touchstart"===l.type,!r.isTouchEvent&&"which"in l&&3===l.which)return;if(!r.isTouchEvent&&"button"in l&&l.button>0)return;if(r.isTouched&&r.isMoved)return;o.noSwipingClass&&""!==o.noSwipingClass&&l.target&&l.target.shadowRoot&&t.path&&t.path[0]&&(c=C(t.path[0]));const h=o.noSwipingSelector?o.noSwipingSelector:`.${o.noSwipingClass}`;if(o.noSwiping&&(l.target&&l.target.shadowRoot?function(t,e=this){return function e(i){return i&&i!==p()&&i!==g()?(i.assignedSlot&&(i=i.assignedSlot),i.closest(t)||e(i.getRootNode().host)):null}(e)}(h,l.target):c.closest(h)[0]))return void(e.allowClick=!0);if(o.swipeHandler&&!c.closest(o.swipeHandler)[0])return;s.currentX="touchstart"===l.type?l.targetTouches[0].pageX:l.pageX,s.currentY="touchstart"===l.type?l.targetTouches[0].pageY:l.pageY;const u=s.currentX,d=s.currentY,f=o.edgeSwipeDetection||o.iOSEdgeSwipeDetection,m=o.edgeSwipeThreshold||o.iOSEdgeSwipeThreshold;if(f&&(u<=m||u>=n.innerWidth-m)){if("prevent"!==f)return;t.preventDefault()}if(Object.assign(r,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),s.startX=u,s.startY=d,r.touchStartTime=S(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,o.threshold>0&&(r.allowThresholdMove=!1),"touchstart"!==l.type){let t=!0;c.is(r.focusableElements)&&(t=!1),i.activeElement&&C(i.activeElement).is(r.focusableElements)&&i.activeElement!==c[0]&&i.activeElement.blur();const n=t&&e.allowTouchMove&&o.touchStartPreventDefault;!o.touchStartForcePreventDefault&&!n||c[0].isContentEditable||l.preventDefault()}e.emit("touchStart",l)}function Z(t){const e=p(),i=this,n=i.touchEventsData,{params:r,touches:o,rtlTranslate:s,enabled:a}=i;if(!a)return;let l=t;if(l.originalEvent&&(l=l.originalEvent),!n.isTouched)return void(n.startMoving&&n.isScrolling&&i.emit("touchMoveOpposite",l));if(n.isTouchEvent&&"touchmove"!==l.type)return;const c="touchmove"===l.type&&l.targetTouches&&(l.targetTouches[0]||l.changedTouches[0]),h="touchmove"===l.type?c.pageX:l.pageX,u="touchmove"===l.type?c.pageY:l.pageY;if(l.preventedByNestedSwiper)return o.startX=h,void(o.startY=u);if(!i.allowTouchMove)return i.allowClick=!1,void(n.isTouched&&(Object.assign(o,{startX:h,startY:u,currentX:h,currentY:u}),n.touchStartTime=S()));if(n.isTouchEvent&&r.touchReleaseOnEdges&&!r.loop)if(i.isVertical()){if(u<o.startY&&i.translate<=i.maxTranslate()||u>o.startY&&i.translate>=i.minTranslate())return n.isTouched=!1,void(n.isMoved=!1)}else if(h<o.startX&&i.translate<=i.maxTranslate()||h>o.startX&&i.translate>=i.minTranslate())return;if(n.isTouchEvent&&e.activeElement&&l.target===e.activeElement&&C(l.target).is(n.focusableElements))return n.isMoved=!0,void(i.allowClick=!1);if(n.allowTouchCallbacks&&i.emit("touchMove",l),l.targetTouches&&l.targetTouches.length>1)return;o.currentX=h,o.currentY=u;const d=o.currentX-o.startX,f=o.currentY-o.startY;if(i.params.threshold&&Math.sqrt(d**2+f**2)<i.params.threshold)return;if(void 0===n.isScrolling){let t;i.isHorizontal()&&o.currentY===o.startY||i.isVertical()&&o.currentX===o.startX?n.isScrolling=!1:d*d+f*f>=25&&(t=180*Math.atan2(Math.abs(f),Math.abs(d))/Math.PI,n.isScrolling=i.isHorizontal()?t>r.touchAngle:90-t>r.touchAngle)}if(n.isScrolling&&i.emit("touchMoveOpposite",l),void 0===n.startMoving&&(o.currentX===o.startX&&o.currentY===o.startY||(n.startMoving=!0)),n.isScrolling)return void(n.isTouched=!1);if(!n.startMoving)return;i.allowClick=!1,!r.cssMode&&l.cancelable&&l.preventDefault(),r.touchMoveStopPropagation&&!r.nested&&l.stopPropagation(),n.isMoved||(r.loop&&!r.cssMode&&i.loopFix(),n.startTranslate=i.getTranslate(),i.setTransition(0),i.animating&&i.$wrapperEl.trigger("webkitTransitionEnd transitionend"),n.allowMomentumBounce=!1,!r.grabCursor||!0!==i.allowSlideNext&&!0!==i.allowSlidePrev||i.setGrabCursor(!0),i.emit("sliderFirstMove",l)),i.emit("sliderMove",l),n.isMoved=!0;let g=i.isHorizontal()?d:f;o.diff=g,g*=r.touchRatio,s&&(g=-g),i.swipeDirection=g>0?"prev":"next",n.currentTranslate=g+n.startTranslate;let m=!0,_=r.resistanceRatio;if(r.touchReleaseOnEdges&&(_=0),g>0&&n.currentTranslate>i.minTranslate()?(m=!1,r.resistance&&(n.currentTranslate=i.minTranslate()-1+(-i.minTranslate()+n.startTranslate+g)**_)):g<0&&n.currentTranslate<i.maxTranslate()&&(m=!1,r.resistance&&(n.currentTranslate=i.maxTranslate()+1-(i.maxTranslate()-n.startTranslate-g)**_)),m&&(l.preventedByNestedSwiper=!0),!i.allowSlideNext&&"next"===i.swipeDirection&&n.currentTranslate<n.startTranslate&&(n.currentTranslate=n.startTranslate),!i.allowSlidePrev&&"prev"===i.swipeDirection&&n.currentTranslate>n.startTranslate&&(n.currentTranslate=n.startTranslate),i.allowSlidePrev||i.allowSlideNext||(n.currentTranslate=n.startTranslate),r.threshold>0){if(!(Math.abs(g)>r.threshold||n.allowThresholdMove))return void(n.currentTranslate=n.startTranslate);if(!n.allowThresholdMove)return n.allowThresholdMove=!0,o.startX=o.currentX,o.startY=o.currentY,n.currentTranslate=n.startTranslate,void(o.diff=i.isHorizontal()?o.currentX-o.startX:o.currentY-o.startY)}r.followFinger&&!r.cssMode&&((r.freeMode&&r.freeMode.enabled&&i.freeMode||r.watchSlidesProgress)&&(i.updateActiveIndex(),i.updateSlidesClasses()),i.params.freeMode&&r.freeMode.enabled&&i.freeMode&&i.freeMode.onTouchMove(),i.updateProgress(n.currentTranslate),i.setTranslate(n.currentTranslate))}function N(t){const e=this,i=e.touchEventsData,{params:n,touches:r,rtlTranslate:o,slidesGrid:s,enabled:a}=e;if(!a)return;let l=t;if(l.originalEvent&&(l=l.originalEvent),i.allowTouchCallbacks&&e.emit("touchEnd",l),i.allowTouchCallbacks=!1,!i.isTouched)return i.isMoved&&n.grabCursor&&e.setGrabCursor(!1),i.isMoved=!1,void(i.startMoving=!1);n.grabCursor&&i.isMoved&&i.isTouched&&(!0===e.allowSlideNext||!0===e.allowSlidePrev)&&e.setGrabCursor(!1);const c=S(),h=c-i.touchStartTime;if(e.allowClick){const t=l.path||l.composedPath&&l.composedPath();e.updateClickedSlide(t&&t[0]||l.target),e.emit("tap click",l),h<300&&c-i.lastClickTime<300&&e.emit("doubleTap doubleClick",l)}if(i.lastClickTime=S(),T(()=>{e.destroyed||(e.allowClick=!0)}),!i.isTouched||!i.isMoved||!e.swipeDirection||0===r.diff||i.currentTranslate===i.startTranslate)return i.isTouched=!1,i.isMoved=!1,void(i.startMoving=!1);let u;if(i.isTouched=!1,i.isMoved=!1,i.startMoving=!1,u=n.followFinger?o?e.translate:-e.translate:-i.currentTranslate,n.cssMode)return;if(e.params.freeMode&&n.freeMode.enabled)return void e.freeMode.onTouchEnd({currentPos:u});let d=0,p=e.slidesSizesGrid[0];for(let m=0;m<s.length;m+=m<n.slidesPerGroupSkip?1:n.slidesPerGroup){const t=m<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;void 0!==s[m+t]?u>=s[m]&&u<s[m+t]&&(d=m,p=s[m+t]-s[m]):u>=s[m]&&(d=m,p=s[s.length-1]-s[s.length-2])}const f=(u-s[d])/p,g=d<n.slidesPerGroupSkip-1?1:n.slidesPerGroup;if(h>n.longSwipesMs){if(!n.longSwipes)return void e.slideTo(e.activeIndex);"next"===e.swipeDirection&&e.slideTo(f>=n.longSwipesRatio?d+g:d),"prev"===e.swipeDirection&&e.slideTo(f>1-n.longSwipesRatio?d+g:d)}else{if(!n.shortSwipes)return void e.slideTo(e.activeIndex);!e.navigation||l.target!==e.navigation.nextEl&&l.target!==e.navigation.prevEl?("next"===e.swipeDirection&&e.slideTo(d+g),"prev"===e.swipeDirection&&e.slideTo(d)):e.slideTo(l.target===e.navigation.nextEl?d+g:d)}}function j(){const t=this,{params:e,el:i}=t;if(i&&0===i.offsetWidth)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:n,allowSlidePrev:r,snapGrid:o}=t;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses(),t.slideTo(("auto"===e.slidesPerView||e.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides?t.slides.length-1:t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.run(),t.allowSlidePrev=r,t.allowSlideNext=n,t.params.watchOverflow&&o!==t.snapGrid&&t.checkOverflow()}function G(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function z(){const t=this,{wrapperEl:e,rtlTranslate:i,enabled:n}=t;if(!n)return;let r;t.previousTranslate=t.translate,t.translate=t.isHorizontal()?-e.scrollLeft:-e.scrollTop,-0===t.translate&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();const o=t.maxTranslate()-t.minTranslate();r=0===o?0:(t.translate-t.minTranslate())/o,r!==t.progress&&t.updateProgress(i?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}let V=!1;function B(){}const q=(t,e)=>{const i=p(),{params:n,touchEvents:r,el:o,wrapperEl:s,device:a,support:l}=t,c=!!n.nested,h="on"===e?"addEventListener":"removeEventListener",u=e;if(l.touch){const e=!("touchstart"!==r.start||!l.passiveListener||!n.passiveListeners)&&{passive:!0,capture:!1};o[h](r.start,t.onTouchStart,e),o[h](r.move,t.onTouchMove,l.passiveListener?{passive:!1,capture:c}:c),o[h](r.end,t.onTouchEnd,e),r.cancel&&o[h](r.cancel,t.onTouchEnd,e)}else o[h](r.start,t.onTouchStart,!1),i[h](r.move,t.onTouchMove,c),i[h](r.end,t.onTouchEnd,!1);(n.preventClicks||n.preventClicksPropagation)&&o[h]("click",t.onClick,!0),n.cssMode&&s[h]("scroll",t.onScroll),t[u](n.updateOnWindowResize?a.ios||a.android?"resize orientationchange observerUpdate":"resize observerUpdate":"observerUpdate",j,!0)},U=(t,e)=>t.grid&&e.grid&&e.grid.rows>1,$={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function Y(t,e){return function(i={}){const n=Object.keys(i)[0],r=i[n];"object"==typeof r&&null!==r?(["navigation","pagination","scrollbar"].indexOf(n)>=0&&!0===t[n]&&(t[n]={auto:!0}),n in t&&"enabled"in r?(!0===t[n]&&(t[n]={enabled:!0}),"object"!=typeof t[n]||"enabled"in t[n]||(t[n].enabled=!0),t[n]||(t[n]={enabled:!1}),E(e,i)):E(e,i)):E(e,i)}}const X={eventsEmitter:O,update:{updateSize:function(){const t=this;let e,i;const n=t.$el;e=null!=t.params.width?t.params.width:n[0].clientWidth,i=null!=t.params.height?t.params.height:n[0].clientHeight,0===e&&t.isHorizontal()||0===i&&t.isVertical()||(e=e-parseInt(n.css("padding-left")||0,10)-parseInt(n.css("padding-right")||0,10),i=i-parseInt(n.css("padding-top")||0,10)-parseInt(n.css("padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(i)&&(i=0),Object.assign(t,{width:e,height:i,size:t.isHorizontal()?e:i}))},updateSlides:function(){const t=this;function e(e){return t.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}function i(t,i){return parseFloat(t.getPropertyValue(e(i))||0)}const n=t.params,{$wrapperEl:r,size:o,rtlTranslate:s,wrongRTL:a}=t,l=t.virtual&&n.virtual.enabled,c=l?t.virtual.slides.length:t.slides.length,h=r.children(`.${t.params.slideClass}`),u=l?t.virtual.slides.length:h.length;let d=[];const p=[],f=[];let g=n.slidesOffsetBefore;"function"==typeof g&&(g=n.slidesOffsetBefore.call(t));let m=n.slidesOffsetAfter;"function"==typeof m&&(m=n.slidesOffsetAfter.call(t));const _=t.snapGrid.length,v=t.slidesGrid.length;let y=n.spaceBetween,w=-g,x=0,b=0;if(void 0===o)return;"string"==typeof y&&y.indexOf("%")>=0&&(y=parseFloat(y.replace("%",""))/100*o),t.virtualSize=-y,h.css(s?{marginLeft:"",marginBottom:"",marginTop:""}:{marginRight:"",marginBottom:"",marginTop:""}),n.centeredSlides&&n.cssMode&&(P(t.wrapperEl,"--swiper-centered-offset-before",""),P(t.wrapperEl,"--swiper-centered-offset-after",""));const C=n.grid&&n.grid.rows>1&&t.grid;let T;C&&t.grid.initSlides(u);const S="auto"===n.slidesPerView&&n.breakpoints&&Object.keys(n.breakpoints).filter(t=>void 0!==n.breakpoints[t].slidesPerView).length>0;for(let k=0;k<u;k+=1){T=0;const r=h.eq(k);if(C&&t.grid.updateSlide(k,r,u,e),"none"!==r.css("display")){if("auto"===n.slidesPerView){S&&(h[k].style[e("width")]="");const o=getComputedStyle(r[0]),s=r[0].style.transform,a=r[0].style.webkitTransform;if(s&&(r[0].style.transform="none"),a&&(r[0].style.webkitTransform="none"),n.roundLengths)T=t.isHorizontal()?r.outerWidth(!0):r.outerHeight(!0);else{const t=i(o,"width"),e=i(o,"padding-left"),n=i(o,"padding-right"),s=i(o,"margin-left"),a=i(o,"margin-right"),l=o.getPropertyValue("box-sizing");if(l&&"border-box"===l)T=t+s+a;else{const{clientWidth:i,offsetWidth:o}=r[0];T=t+e+n+s+a+(o-i)}}s&&(r[0].style.transform=s),a&&(r[0].style.webkitTransform=a),n.roundLengths&&(T=Math.floor(T))}else T=(o-(n.slidesPerView-1)*y)/n.slidesPerView,n.roundLengths&&(T=Math.floor(T)),h[k]&&(h[k].style[e("width")]=`${T}px`);h[k]&&(h[k].swiperSlideSize=T),f.push(T),n.centeredSlides?(w=w+T/2+x/2+y,0===x&&0!==k&&(w=w-o/2-y),0===k&&(w=w-o/2-y),Math.abs(w)<.001&&(w=0),n.roundLengths&&(w=Math.floor(w)),b%n.slidesPerGroup==0&&d.push(w),p.push(w)):(n.roundLengths&&(w=Math.floor(w)),(b-Math.min(t.params.slidesPerGroupSkip,b))%t.params.slidesPerGroup==0&&d.push(w),p.push(w),w=w+T+y),t.virtualSize+=T+y,x=T,b+=1}}if(t.virtualSize=Math.max(t.virtualSize,o)+m,s&&a&&("slide"===n.effect||"coverflow"===n.effect)&&r.css({width:`${t.virtualSize+n.spaceBetween}px`}),n.setWrapperSize&&r.css({[e("width")]:`${t.virtualSize+n.spaceBetween}px`}),C&&t.grid.updateWrapperSize(T,d,e),!n.centeredSlides){const e=[];for(let i=0;i<d.length;i+=1){let r=d[i];n.roundLengths&&(r=Math.floor(r)),d[i]<=t.virtualSize-o&&e.push(r)}d=e,Math.floor(t.virtualSize-o)-Math.floor(d[d.length-1])>1&&d.push(t.virtualSize-o)}if(0===d.length&&(d=[0]),0!==n.spaceBetween){const i=t.isHorizontal()&&s?"marginLeft":e("marginRight");h.filter((t,e)=>!n.cssMode||e!==h.length-1).css({[i]:`${y}px`})}if(n.centeredSlides&&n.centeredSlidesBounds){let t=0;f.forEach(e=>{t+=e+(n.spaceBetween?n.spaceBetween:0)}),t-=n.spaceBetween;const e=t-o;d=d.map(t=>t<0?-g:t>e?e+m:t)}if(n.centerInsufficientSlides){let t=0;if(f.forEach(e=>{t+=e+(n.spaceBetween?n.spaceBetween:0)}),t-=n.spaceBetween,t<o){const e=(o-t)/2;d.forEach((t,i)=>{d[i]=t-e}),p.forEach((t,i)=>{p[i]=t+e})}}if(Object.assign(t,{slides:h,snapGrid:d,slidesGrid:p,slidesSizesGrid:f}),n.centeredSlides&&n.cssMode&&!n.centeredSlidesBounds){P(t.wrapperEl,"--swiper-centered-offset-before",-d[0]+"px"),P(t.wrapperEl,"--swiper-centered-offset-after",t.size/2-f[f.length-1]/2+"px");const e=-t.snapGrid[0],i=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(t=>t+e),t.slidesGrid=t.slidesGrid.map(t=>t+i)}u!==c&&t.emit("slidesLengthChange"),d.length!==_&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),p.length!==v&&t.emit("slidesGridLengthChange"),n.watchSlidesProgress&&t.updateSlidesOffset()},updateAutoHeight:function(t){const e=this,i=[],n=e.virtual&&e.params.virtual.enabled;let r,o=0;"number"==typeof t?e.setTransition(t):!0===t&&e.setTransition(e.params.speed);const s=t=>n?e.slides.filter(e=>parseInt(e.getAttribute("data-swiper-slide-index"),10)===t)[0]:e.slides.eq(t)[0];if("auto"!==e.params.slidesPerView&&e.params.slidesPerView>1)if(e.params.centeredSlides)e.visibleSlides.each(t=>{i.push(t)});else for(r=0;r<Math.ceil(e.params.slidesPerView);r+=1){const t=e.activeIndex+r;if(t>e.slides.length&&!n)break;i.push(s(t))}else i.push(s(e.activeIndex));for(r=0;r<i.length;r+=1)if(void 0!==i[r]){const t=i[r].offsetHeight;o=t>o?t:o}o&&e.$wrapperEl.css("height",`${o}px`)},updateSlidesOffset:function(){const t=this,e=t.slides;for(let i=0;i<e.length;i+=1)e[i].swiperSlideOffset=t.isHorizontal()?e[i].offsetLeft:e[i].offsetTop},updateSlidesProgress:function(t=this&&this.translate||0){const e=this,i=e.params,{slides:n,rtlTranslate:r,snapGrid:o}=e;if(0===n.length)return;void 0===n[0].swiperSlideOffset&&e.updateSlidesOffset();let s=-t;r&&(s=t),n.removeClass(i.slideVisibleClass),e.visibleSlidesIndexes=[],e.visibleSlides=[];for(let a=0;a<n.length;a+=1){const t=n[a];let l=t.swiperSlideOffset;i.cssMode&&i.centeredSlides&&(l-=n[0].swiperSlideOffset);const c=(s+(i.centeredSlides?e.minTranslate():0)-l)/(t.swiperSlideSize+i.spaceBetween),h=(s-o[0]+(i.centeredSlides?e.minTranslate():0)-l)/(t.swiperSlideSize+i.spaceBetween),u=-(s-l),d=u+e.slidesSizesGrid[a];(u>=0&&u<e.size-1||d>1&&d<=e.size||u<=0&&d>=e.size)&&(e.visibleSlides.push(t),e.visibleSlidesIndexes.push(a),n.eq(a).addClass(i.slideVisibleClass)),t.progress=r?-c:c,t.originalProgress=r?-h:h}e.visibleSlides=C(e.visibleSlides)},updateProgress:function(t){const e=this;if(void 0===t){const i=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*i||0}const i=e.params,n=e.maxTranslate()-e.minTranslate();let{progress:r,isBeginning:o,isEnd:s}=e;const a=o,l=s;0===n?(r=0,o=!0,s=!0):(r=(t-e.minTranslate())/n,o=r<=0,s=r>=1),Object.assign(e,{progress:r,isBeginning:o,isEnd:s}),(i.watchSlidesProgress||i.centeredSlides&&i.autoHeight)&&e.updateSlidesProgress(t),o&&!a&&e.emit("reachBeginning toEdge"),s&&!l&&e.emit("reachEnd toEdge"),(a&&!o||l&&!s)&&e.emit("fromEdge"),e.emit("progress",r)},updateSlidesClasses:function(){const t=this,{slides:e,params:i,$wrapperEl:n,activeIndex:r,realIndex:o}=t,s=t.virtual&&i.virtual.enabled;let a;e.removeClass(`${i.slideActiveClass} ${i.slideNextClass} ${i.slidePrevClass} ${i.slideDuplicateActiveClass} ${i.slideDuplicateNextClass} ${i.slideDuplicatePrevClass}`),a=s?t.$wrapperEl.find(`.${i.slideClass}[data-swiper-slide-index="${r}"]`):e.eq(r),a.addClass(i.slideActiveClass),i.loop&&(a.hasClass(i.slideDuplicateClass)?n.children(`.${i.slideClass}:not(.${i.slideDuplicateClass})[data-swiper-slide-index="${o}"]`).addClass(i.slideDuplicateActiveClass):n.children(`.${i.slideClass}.${i.slideDuplicateClass}[data-swiper-slide-index="${o}"]`).addClass(i.slideDuplicateActiveClass));let l=a.nextAll(`.${i.slideClass}`).eq(0).addClass(i.slideNextClass);i.loop&&0===l.length&&(l=e.eq(0),l.addClass(i.slideNextClass));let c=a.prevAll(`.${i.slideClass}`).eq(0).addClass(i.slidePrevClass);i.loop&&0===c.length&&(c=e.eq(-1),c.addClass(i.slidePrevClass)),i.loop&&(l.hasClass(i.slideDuplicateClass)?n.children(`.${i.slideClass}:not(.${i.slideDuplicateClass})[data-swiper-slide-index="${l.attr("data-swiper-slide-index")}"]`).addClass(i.slideDuplicateNextClass):n.children(`.${i.slideClass}.${i.slideDuplicateClass}[data-swiper-slide-index="${l.attr("data-swiper-slide-index")}"]`).addClass(i.slideDuplicateNextClass),c.hasClass(i.slideDuplicateClass)?n.children(`.${i.slideClass}:not(.${i.slideDuplicateClass})[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(i.slideDuplicatePrevClass):n.children(`.${i.slideClass}.${i.slideDuplicateClass}[data-swiper-slide-index="${c.attr("data-swiper-slide-index")}"]`).addClass(i.slideDuplicatePrevClass)),t.emitSlidesClasses()},updateActiveIndex:function(t){const e=this,i=e.rtlTranslate?e.translate:-e.translate,{slidesGrid:n,snapGrid:r,params:o,activeIndex:s,realIndex:a,snapIndex:l}=e;let c,h=t;if(void 0===h){for(let t=0;t<n.length;t+=1)void 0!==n[t+1]?i>=n[t]&&i<n[t+1]-(n[t+1]-n[t])/2?h=t:i>=n[t]&&i<n[t+1]&&(h=t+1):i>=n[t]&&(h=t);o.normalizeSlideIndex&&(h<0||void 0===h)&&(h=0)}if(r.indexOf(i)>=0)c=r.indexOf(i);else{const t=Math.min(o.slidesPerGroupSkip,h);c=t+Math.floor((h-t)/o.slidesPerGroup)}if(c>=r.length&&(c=r.length-1),h===s)return void(c!==l&&(e.snapIndex=c,e.emit("snapIndexChange")));const u=parseInt(e.slides.eq(h).attr("data-swiper-slide-index")||h,10);Object.assign(e,{snapIndex:c,realIndex:u,previousIndex:s,activeIndex:h}),e.emit("activeIndexChange"),e.emit("snapIndexChange"),a!==u&&e.emit("realIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&e.emit("slideChange")},updateClickedSlide:function(t){const e=this,i=e.params,n=C(t).closest(`.${i.slideClass}`)[0];let r,o=!1;if(n)for(let s=0;s<e.slides.length;s+=1)if(e.slides[s]===n){o=!0,r=s;break}if(!n||!o)return e.clickedSlide=void 0,void(e.clickedIndex=void 0);e.clickedSlide=n,e.clickedIndex=e.virtual&&e.params.virtual.enabled?parseInt(C(n).attr("data-swiper-slide-index"),10):r,i.slideToClickedSlide&&void 0!==e.clickedIndex&&e.clickedIndex!==e.activeIndex&&e.slideToClickedSlide()}},translate:{getTranslate:function(t=(this.isHorizontal()?"x":"y")){const{params:e,rtlTranslate:i,translate:n,$wrapperEl:r}=this;if(e.virtualTranslate)return i?-n:n;if(e.cssMode)return n;let o=function(t,e="x"){const i=g();let n,r,o;const s=function(t){const e=g();let i;return e.getComputedStyle&&(i=e.getComputedStyle(t,null)),!i&&t.currentStyle&&(i=t.currentStyle),i||(i=t.style),i}(t);return i.WebKitCSSMatrix?(r=s.transform||s.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(t=>t.replace(",",".")).join(", ")),o=new i.WebKitCSSMatrix("none"===r?"":r)):(o=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=o.toString().split(",")),"x"===e&&(r=i.WebKitCSSMatrix?o.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===e&&(r=i.WebKitCSSMatrix?o.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),r||0}(r[0],t);return i&&(o=-o),o||0},setTranslate:function(t,e){const i=this,{rtlTranslate:n,params:r,$wrapperEl:o,wrapperEl:s,progress:a}=i;let l,c=0,h=0;i.isHorizontal()?c=n?-t:t:h=t,r.roundLengths&&(c=Math.floor(c),h=Math.floor(h)),r.cssMode?s[i.isHorizontal()?"scrollLeft":"scrollTop"]=i.isHorizontal()?-c:-h:r.virtualTranslate||o.transform(`translate3d(${c}px, ${h}px, 0px)`),i.previousTranslate=i.translate,i.translate=i.isHorizontal()?c:h;const u=i.maxTranslate()-i.minTranslate();l=0===u?0:(t-i.minTranslate())/u,l!==a&&i.updateProgress(t),i.emit("setTranslate",i.translate,e)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(t=0,e=this.params.speed,i=!0,n=!0,r){const o=this,{params:s,wrapperEl:a}=o;if(o.animating&&s.preventInteractionOnTransition)return!1;const l=o.minTranslate(),c=o.maxTranslate();let h;if(h=n&&t>l?l:n&&t<c?c:t,o.updateProgress(h),s.cssMode){const t=o.isHorizontal();if(0===e)a[t?"scrollLeft":"scrollTop"]=-h;else{if(!o.support.smoothScroll)return M({swiper:o,targetPosition:-h,side:t?"left":"top"}),!0;a.scrollTo({[t?"left":"top"]:-h,behavior:"smooth"})}return!0}return 0===e?(o.setTransition(0),o.setTranslate(h),i&&(o.emit("beforeTransitionStart",e,r),o.emit("transitionEnd"))):(o.setTransition(e),o.setTranslate(h),i&&(o.emit("beforeTransitionStart",e,r),o.emit("transitionStart")),o.animating||(o.animating=!0,o.onTranslateToWrapperTransitionEnd||(o.onTranslateToWrapperTransitionEnd=function(t){o&&!o.destroyed&&t.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd),o.onTranslateToWrapperTransitionEnd=null,delete o.onTranslateToWrapperTransitionEnd,i&&o.emit("transitionEnd"))}),o.$wrapperEl[0].addEventListener("transitionend",o.onTranslateToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onTranslateToWrapperTransitionEnd))),!0}},transition:{setTransition:function(t,e){const i=this;i.params.cssMode||i.$wrapperEl.transition(t),i.emit("setTransition",t,e)},transitionStart:function(t=!0,e){const i=this,{params:n}=i;n.cssMode||(n.autoHeight&&i.updateAutoHeight(),F({swiper:i,runCallbacks:t,direction:e,step:"Start"}))},transitionEnd:function(t=!0,e){const i=this,{params:n}=i;i.animating=!1,n.cssMode||(i.setTransition(0),F({swiper:i,runCallbacks:t,direction:e,step:"End"}))}},slide:{slideTo:function(t=0,e=this.params.speed,i=!0,n,r){if("number"!=typeof t&&"string"!=typeof t)throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof t}] given.`);if("string"==typeof t){const e=parseInt(t,10);if(!isFinite(e))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${t}] given.`);t=e}const o=this;let s=t;s<0&&(s=0);const{params:a,snapGrid:l,slidesGrid:c,previousIndex:h,activeIndex:u,rtlTranslate:d,wrapperEl:p,enabled:f}=o;if(o.animating&&a.preventInteractionOnTransition||!f&&!n&&!r)return!1;const g=Math.min(o.params.slidesPerGroupSkip,s);let m=g+Math.floor((s-g)/o.params.slidesPerGroup);m>=l.length&&(m=l.length-1),(u||a.initialSlide||0)===(h||0)&&i&&o.emit("beforeSlideChangeStart");const _=-l[m];if(o.updateProgress(_),a.normalizeSlideIndex)for(let y=0;y<c.length;y+=1){const t=-Math.floor(100*_),e=Math.floor(100*c[y]),i=Math.floor(100*c[y+1]);void 0!==c[y+1]?t>=e&&t<i-(i-e)/2?s=y:t>=e&&t<i&&(s=y+1):t>=e&&(s=y)}if(o.initialized&&s!==u){if(!o.allowSlideNext&&_<o.translate&&_<o.minTranslate())return!1;if(!o.allowSlidePrev&&_>o.translate&&_>o.maxTranslate()&&(u||0)!==s)return!1}let v;if(v=s>u?"next":s<u?"prev":"reset",d&&-_===o.translate||!d&&_===o.translate)return o.updateActiveIndex(s),a.autoHeight&&o.updateAutoHeight(),o.updateSlidesClasses(),"slide"!==a.effect&&o.setTranslate(_),"reset"!==v&&(o.transitionStart(i,v),o.transitionEnd(i,v)),!1;if(a.cssMode){const t=o.isHorizontal(),i=d?_:-_;if(0===e){const e=o.virtual&&o.params.virtual.enabled;e&&(o.wrapperEl.style.scrollSnapType="none",o._immediateVirtual=!0),p[t?"scrollLeft":"scrollTop"]=i,e&&requestAnimationFrame(()=>{o.wrapperEl.style.scrollSnapType="",o._swiperImmediateVirtual=!1})}else{if(!o.support.smoothScroll)return M({swiper:o,targetPosition:i,side:t?"left":"top"}),!0;p.scrollTo({[t?"left":"top"]:i,behavior:"smooth"})}return!0}return 0===e?(o.setTransition(0),o.setTranslate(_),o.updateActiveIndex(s),o.updateSlidesClasses(),o.emit("beforeTransitionStart",e,n),o.transitionStart(i,v),o.transitionEnd(i,v)):(o.setTransition(e),o.setTranslate(_),o.updateActiveIndex(s),o.updateSlidesClasses(),o.emit("beforeTransitionStart",e,n),o.transitionStart(i,v),o.animating||(o.animating=!0,o.onSlideToWrapperTransitionEnd||(o.onSlideToWrapperTransitionEnd=function(t){o&&!o.destroyed&&t.target===this&&(o.$wrapperEl[0].removeEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].removeEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd),o.onSlideToWrapperTransitionEnd=null,delete o.onSlideToWrapperTransitionEnd,o.transitionEnd(i,v))}),o.$wrapperEl[0].addEventListener("transitionend",o.onSlideToWrapperTransitionEnd),o.$wrapperEl[0].addEventListener("webkitTransitionEnd",o.onSlideToWrapperTransitionEnd))),!0},slideToLoop:function(t=0,e=this.params.speed,i=!0,n){const r=this;let o=t;return r.params.loop&&(o+=r.loopedSlides),r.slideTo(o,e,i,n)},slideNext:function(t=this.params.speed,e=!0,i){const n=this,{animating:r,enabled:o,params:s}=n;if(!o)return n;let a=s.slidesPerGroup;"auto"===s.slidesPerView&&1===s.slidesPerGroup&&s.slidesPerGroupAuto&&(a=Math.max(n.slidesPerViewDynamic("current",!0),1));const l=n.activeIndex<s.slidesPerGroupSkip?1:a;if(s.loop){if(r&&s.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}return n.slideTo(n.activeIndex+l,t,e,i)},slidePrev:function(t=this.params.speed,e=!0,i){const n=this,{params:r,animating:o,snapGrid:s,slidesGrid:a,rtlTranslate:l,enabled:c}=n;if(!c)return n;if(r.loop){if(o&&r.loopPreventsSlide)return!1;n.loopFix(),n._clientLeft=n.$wrapperEl[0].clientLeft}function h(t){return t<0?-Math.floor(Math.abs(t)):Math.floor(t)}const u=h(l?n.translate:-n.translate),d=s.map(t=>h(t));let p=s[d.indexOf(u)-1];if(void 0===p&&r.cssMode){let t;s.forEach((e,i)=>{u>=e&&(t=i)}),void 0!==t&&(p=s[t>0?t-1:t])}let f=0;return void 0!==p&&(f=a.indexOf(p),f<0&&(f=n.activeIndex-1),"auto"===r.slidesPerView&&1===r.slidesPerGroup&&r.slidesPerGroupAuto&&(f=f-n.slidesPerViewDynamic("previous",!0)+1,f=Math.max(f,0))),n.slideTo(f,t,e,i)},slideReset:function(t=this.params.speed,e=!0,i){return this.slideTo(this.activeIndex,t,e,i)},slideToClosest:function(t=this.params.speed,e=!0,i,n=.5){const r=this;let o=r.activeIndex;const s=Math.min(r.params.slidesPerGroupSkip,o),a=s+Math.floor((o-s)/r.params.slidesPerGroup),l=r.rtlTranslate?r.translate:-r.translate;if(l>=r.snapGrid[a]){const t=r.snapGrid[a];l-t>(r.snapGrid[a+1]-t)*n&&(o+=r.params.slidesPerGroup)}else{const t=r.snapGrid[a-1];l-t<=(r.snapGrid[a]-t)*n&&(o-=r.params.slidesPerGroup)}return o=Math.max(o,0),o=Math.min(o,r.slidesGrid.length-1),r.slideTo(o,t,e,i)},slideToClickedSlide:function(){const t=this,{params:e,$wrapperEl:i}=t,n="auto"===e.slidesPerView?t.slidesPerViewDynamic():e.slidesPerView;let r,o=t.clickedIndex;if(e.loop){if(t.animating)return;r=parseInt(C(t.clickedSlide).attr("data-swiper-slide-index"),10),e.centeredSlides?o<t.loopedSlides-n/2||o>t.slides.length-t.loopedSlides+n/2?(t.loopFix(),o=i.children(`.${e.slideClass}[data-swiper-slide-index="${r}"]:not(.${e.slideDuplicateClass})`).eq(0).index(),T(()=>{t.slideTo(o)})):t.slideTo(o):o>t.slides.length-n?(t.loopFix(),o=i.children(`.${e.slideClass}[data-swiper-slide-index="${r}"]:not(.${e.slideDuplicateClass})`).eq(0).index(),T(()=>{t.slideTo(o)})):t.slideTo(o)}else t.slideTo(o)}},loop:{loopCreate:function(){const t=this,e=p(),{params:i,$wrapperEl:n}=t,r=n.children().length>0?C(n.children()[0].parentNode):n;r.children(`.${i.slideClass}.${i.slideDuplicateClass}`).remove();let o=r.children(`.${i.slideClass}`);if(i.loopFillGroupWithBlank){const t=i.slidesPerGroup-o.length%i.slidesPerGroup;if(t!==i.slidesPerGroup){for(let n=0;n<t;n+=1){const t=C(e.createElement("div")).addClass(`${i.slideClass} ${i.slideBlankClass}`);r.append(t)}o=r.children(`.${i.slideClass}`)}}"auto"!==i.slidesPerView||i.loopedSlides||(i.loopedSlides=o.length),t.loopedSlides=Math.ceil(parseFloat(i.loopedSlides||i.slidesPerView,10)),t.loopedSlides+=i.loopAdditionalSlides,t.loopedSlides>o.length&&(t.loopedSlides=o.length);const s=[],a=[];o.each((e,i)=>{const n=C(e);i<t.loopedSlides&&a.push(e),i<o.length&&i>=o.length-t.loopedSlides&&s.push(e),n.attr("data-swiper-slide-index",i)});for(let l=0;l<a.length;l+=1)r.append(C(a[l].cloneNode(!0)).addClass(i.slideDuplicateClass));for(let l=s.length-1;l>=0;l-=1)r.prepend(C(s[l].cloneNode(!0)).addClass(i.slideDuplicateClass))},loopFix:function(){const t=this;t.emit("beforeLoopFix");const{activeIndex:e,slides:i,loopedSlides:n,allowSlidePrev:r,allowSlideNext:o,snapGrid:s,rtlTranslate:a}=t;let l;t.allowSlidePrev=!0,t.allowSlideNext=!0;const c=-s[e]-t.getTranslate();e<n?(l=i.length-3*n+e,l+=n,t.slideTo(l,0,!1,!0)&&0!==c&&t.setTranslate((a?-t.translate:t.translate)-c)):e>=i.length-n&&(l=-i.length+e+n,l+=n,t.slideTo(l,0,!1,!0)&&0!==c&&t.setTranslate((a?-t.translate:t.translate)-c)),t.allowSlidePrev=r,t.allowSlideNext=o,t.emit("loopFix")},loopDestroy:function(){const{$wrapperEl:t,params:e,slides:i}=this;t.children(`.${e.slideClass}.${e.slideDuplicateClass},.${e.slideClass}.${e.slideBlankClass}`).remove(),i.removeAttr("data-swiper-slide-index")}},grabCursor:{setGrabCursor:function(t){const e=this;if(e.support.touch||!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const i="container"===e.params.touchEventsTarget?e.el:e.wrapperEl;i.style.cursor="move",i.style.cursor=t?"-webkit-grabbing":"-webkit-grab",i.style.cursor=t?"-moz-grabbin":"-moz-grab",i.style.cursor=t?"grabbing":"grab"},unsetGrabCursor:function(){const t=this;t.support.touch||t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t["container"===t.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="")}},events:{attachEvents:function(){const t=this,e=p(),{params:i,support:n}=t;t.onTouchStart=D.bind(t),t.onTouchMove=Z.bind(t),t.onTouchEnd=N.bind(t),i.cssMode&&(t.onScroll=z.bind(t)),t.onClick=G.bind(t),n.touch&&!V&&(e.addEventListener("touchstart",B),V=!0),q(t,"on")},detachEvents:function(){q(this,"off")}},breakpoints:{setBreakpoint:function(){const t=this,{activeIndex:e,initialized:i,loopedSlides:n=0,params:r,$el:o}=t,s=r.breakpoints;if(!s||s&&0===Object.keys(s).length)return;const a=t.getBreakpoint(s,t.params.breakpointsBase,t.el);if(!a||t.currentBreakpoint===a)return;const l=(a in s?s[a]:void 0)||t.originalParams,c=U(t,r),h=U(t,l),u=r.enabled;c&&!h?(o.removeClass(`${r.containerModifierClass}grid ${r.containerModifierClass}grid-column`),t.emitContainerClasses()):!c&&h&&(o.addClass(`${r.containerModifierClass}grid`),(l.grid.fill&&"column"===l.grid.fill||!l.grid.fill&&"column"===r.grid.fill)&&o.addClass(`${r.containerModifierClass}grid-column`),t.emitContainerClasses());const d=l.direction&&l.direction!==r.direction,p=r.loop&&(l.slidesPerView!==r.slidesPerView||d);d&&i&&t.changeDirection(),E(t.params,l);const f=t.params.enabled;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),u&&!f?t.disable():!u&&f&&t.enable(),t.currentBreakpoint=a,t.emit("_beforeBreakpoint",l),p&&i&&(t.loopDestroy(),t.loopCreate(),t.updateSlides(),t.slideTo(e-n+t.loopedSlides,0,!1)),t.emit("breakpoint",l)},getBreakpoint:function(t,e="window",i){if(!t||"container"===e&&!i)return;let n=!1;const r=g(),o="window"===e?r.innerHeight:i.clientHeight,s=Object.keys(t).map(t=>{if("string"==typeof t&&0===t.indexOf("@")){const e=parseFloat(t.substr(1));return{value:o*e,point:t}}return{value:t,point:t}});s.sort((t,e)=>parseInt(t.value,10)-parseInt(e.value,10));for(let a=0;a<s.length;a+=1){const{point:t,value:o}=s[a];"window"===e?r.matchMedia(`(min-width: ${o}px)`).matches&&(n=t):o<=i.clientWidth&&(n=t)}return n||"max"}},checkOverflow:{checkOverflow:function(){const t=this,{isLocked:e,params:i}=t,{slidesOffsetBefore:n}=i;if(n){const e=t.slides.length-1;t.isLocked=t.size>t.slidesGrid[e]+t.slidesSizesGrid[e]+2*n}else t.isLocked=1===t.snapGrid.length;!0===i.allowSlideNext&&(t.allowSlideNext=!t.isLocked),!0===i.allowSlidePrev&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}},classes:{addClasses:function(){const t=this,{classNames:e,params:i,rtl:n,$el:r,device:o,support:s}=t,a=function(t,e){const i=[];return t.forEach(t=>{"object"==typeof t?Object.keys(t).forEach(n=>{t[n]&&i.push(e+n)}):"string"==typeof t&&i.push(e+t)}),i}(["initialized",i.direction,{"pointer-events":!s.touch},{"free-mode":t.params.freeMode&&i.freeMode.enabled},{autoheight:i.autoHeight},{rtl:n},{grid:i.grid&&i.grid.rows>1},{"grid-column":i.grid&&i.grid.rows>1&&"column"===i.grid.fill},{android:o.android},{ios:o.ios},{"css-mode":i.cssMode},{centered:i.cssMode&&i.centeredSlides}],i.containerModifierClass);e.push(...a),r.addClass([...e].join(" ")),t.emitContainerClasses()},removeClasses:function(){const{$el:t,classNames:e}=this;t.removeClass(e.join(" ")),this.emitContainerClasses()}},images:{loadImage:function(t,e,i,n,r,o){const s=g();let a;function l(){o&&o()}C(t).parent("picture")[0]||t.complete&&r?l():e?(a=new s.Image,a.onload=l,a.onerror=l,n&&(a.sizes=n),i&&(a.srcset=i),e&&(a.src=e)):l()},preloadImages:function(){const t=this;function e(){null!=t&&t&&!t.destroyed&&(void 0!==t.imagesLoaded&&(t.imagesLoaded+=1),t.imagesLoaded===t.imagesToLoad.length&&(t.params.updateOnImagesReady&&t.update(),t.emit("imagesReady")))}t.imagesToLoad=t.$el.find("img");for(let i=0;i<t.imagesToLoad.length;i+=1){const n=t.imagesToLoad[i];t.loadImage(n,n.currentSrc||n.getAttribute("src"),n.srcset||n.getAttribute("srcset"),n.sizes||n.getAttribute("sizes"),!0,e)}}}},W={};class H{constructor(...t){let e,i;if(1===t.length&&t[0].constructor&&"Object"===Object.prototype.toString.call(t[0]).slice(8,-1)?i=t[0]:[e,i]=t,i||(i={}),i=E({},i),e&&!i.el&&(i.el=e),i.el&&C(i.el).length>1){const t=[];return C(i.el).each(e=>{const n=E({},i,{el:e});t.push(new H(n))}),t}const n=this;n.__swiper__=!0,n.support=R(),n.device=function(t={}){return L||(L=function({userAgent:t}={}){const e=R(),i=g(),n=i.navigator.platform,r=t||i.navigator.userAgent,o={ios:!1,android:!1},s=i.screen.width,a=i.screen.height,l=r.match(/(Android);?[\s\/]+([\d.]+)?/);let c=r.match(/(iPad).*OS\s([\d_]+)/);const h=r.match(/(iPod)(.*OS\s([\d_]+))?/),u=!c&&r.match(/(iPhone\sOS|iOS)\s([\d_]+)/),d="Win32"===n;let p="MacIntel"===n;return!c&&p&&e.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${s}x${a}`)>=0&&(c=r.match(/(Version)\/([\d.]+)/),c||(c=[0,1,"13_0_0"]),p=!1),l&&!d&&(o.os="android",o.android=!0),(c||u||h)&&(o.os="ios",o.ios=!0),o}(t)),L}({userAgent:i.userAgent}),n.browser=(A||(A=function(){const t=g();return{isSafari:function(){const e=t.navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}()),A),n.eventsListeners={},n.eventsAnyListeners=[],n.modules=[...n.__modules__],i.modules&&Array.isArray(i.modules)&&n.modules.push(...i.modules);const r={};n.modules.forEach(t=>{t({swiper:n,extendParams:Y(i,r),on:n.on.bind(n),once:n.once.bind(n),off:n.off.bind(n),emit:n.emit.bind(n)})});const o=E({},$,r);return n.params=E({},o,W,i),n.originalParams=E({},n.params),n.passedParams=E({},i),n.params&&n.params.on&&Object.keys(n.params.on).forEach(t=>{n.on(t,n.params.on[t])}),n.params&&n.params.onAny&&n.onAny(n.params.onAny),n.$=C,Object.assign(n,{enabled:n.params.enabled,el:e,classNames:[],slides:C(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===n.params.direction,isVertical:()=>"vertical"===n.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:n.params.allowSlideNext,allowSlidePrev:n.params.allowSlidePrev,touchEvents:function(){const t=["touchstart","touchmove","touchend","touchcancel"],e=["pointerdown","pointermove","pointerup"];return n.touchEventsTouch={start:t[0],move:t[1],end:t[2],cancel:t[3]},n.touchEventsDesktop={start:e[0],move:e[1],end:e[2]},n.support.touch||!n.params.simulateTouch?n.touchEventsTouch:n.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:n.params.focusableElements,lastClickTime:S(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:n.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),n.emit("_swiper"),n.params.init&&n.init(),n}enable(){const t=this;t.enabled||(t.enabled=!0,t.params.grabCursor&&t.setGrabCursor(),t.emit("enable"))}disable(){const t=this;t.enabled&&(t.enabled=!1,t.params.grabCursor&&t.unsetGrabCursor(),t.emit("disable"))}setProgress(t,e){const i=this;t=Math.min(Math.max(t,0),1);const n=i.minTranslate(),r=i.maxTranslate();i.translateTo((r-n)*t+n,void 0===e?0:e),i.updateActiveIndex(),i.updateSlidesClasses()}emitContainerClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=t.el.className.split(" ").filter(e=>0===e.indexOf("swiper")||0===e.indexOf(t.params.containerModifierClass));t.emit("_containerClasses",e.join(" "))}getSlideClasses(t){const e=this;return t.className.split(" ").filter(t=>0===t.indexOf("swiper-slide")||0===t.indexOf(e.params.slideClass)).join(" ")}emitSlidesClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=[];t.slides.each(i=>{const n=t.getSlideClasses(i);e.push({slideEl:i,classNames:n}),t.emit("_slideClass",i,n)}),t.emit("_slideClasses",e)}slidesPerViewDynamic(t="current",e=!1){const{params:i,slides:n,slidesGrid:r,slidesSizesGrid:o,size:s,activeIndex:a}=this;let l=1;if(i.centeredSlides){let t,e=n[a].swiperSlideSize;for(let i=a+1;i<n.length;i+=1)n[i]&&!t&&(e+=n[i].swiperSlideSize,l+=1,e>s&&(t=!0));for(let i=a-1;i>=0;i-=1)n[i]&&!t&&(e+=n[i].swiperSlideSize,l+=1,e>s&&(t=!0))}else if("current"===t)for(let c=a+1;c<n.length;c+=1)(e?r[c]+o[c]-r[a]<s:r[c]-r[a]<s)&&(l+=1);else for(let c=a-1;c>=0;c-=1)r[a]-r[c]<s&&(l+=1);return l}update(){const t=this;if(!t||t.destroyed)return;const{snapGrid:e,params:i}=t;function n(){const e=Math.min(Math.max(t.rtlTranslate?-1*t.translate:t.translate,t.maxTranslate()),t.minTranslate());t.setTranslate(e),t.updateActiveIndex(),t.updateSlidesClasses()}let r;i.breakpoints&&t.setBreakpoint(),t.updateSize(),t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.params.freeMode&&t.params.freeMode.enabled?(n(),t.params.autoHeight&&t.updateAutoHeight()):(r=t.slideTo(("auto"===t.params.slidesPerView||t.params.slidesPerView>1)&&t.isEnd&&!t.params.centeredSlides?t.slides.length-1:t.activeIndex,0,!1,!0),r||n()),i.watchOverflow&&e!==t.snapGrid&&t.checkOverflow(),t.emit("update")}changeDirection(t,e=!0){const i=this,n=i.params.direction;return t||(t="horizontal"===n?"vertical":"horizontal"),t===n||"horizontal"!==t&&"vertical"!==t||(i.$el.removeClass(`${i.params.containerModifierClass}${n}`).addClass(`${i.params.containerModifierClass}${t}`),i.emitContainerClasses(),i.params.direction=t,i.slides.each(e=>{"vertical"===t?e.style.width="":e.style.height=""}),i.emit("changeDirection"),e&&i.update()),i}mount(t){const e=this;if(e.mounted)return!0;const i=C(t||e.params.el);if(!(t=i[0]))return!1;t.swiper=e;const n=()=>`.${(e.params.wrapperClass||"").trim().split(" ").join(".")}`;let r=(()=>{if(t&&t.shadowRoot&&t.shadowRoot.querySelector){const e=C(t.shadowRoot.querySelector(n()));return e.children=t=>i.children(t),e}return i.children(n())})();if(0===r.length&&e.params.createElements){const t=p().createElement("div");r=C(t),t.className=e.params.wrapperClass,i.append(t),i.children(`.${e.params.slideClass}`).each(t=>{r.append(t)})}return Object.assign(e,{$el:i,el:t,$wrapperEl:r,wrapperEl:r[0],mounted:!0,rtl:"rtl"===t.dir.toLowerCase()||"rtl"===i.css("direction"),rtlTranslate:"horizontal"===e.params.direction&&("rtl"===t.dir.toLowerCase()||"rtl"===i.css("direction")),wrongRTL:"-webkit-box"===r.css("display")}),!0}init(t){const e=this;return e.initialized||!1===e.mount(t)||(e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.params.loop&&e.loopCreate(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.enabled&&e.setGrabCursor(),e.params.preloadImages&&e.preloadImages(),e.slideTo(e.params.loop?e.params.initialSlide+e.loopedSlides:e.params.initialSlide,0,e.params.runCallbacksOnInit,!1,!0),e.attachEvents(),e.initialized=!0,e.emit("init"),e.emit("afterInit")),e}destroy(t=!0,e=!0){const i=this,{params:n,$el:r,$wrapperEl:o,slides:s}=i;return void 0===i.params||i.destroyed||(i.emit("beforeDestroy"),i.initialized=!1,i.detachEvents(),n.loop&&i.loopDestroy(),e&&(i.removeClasses(),r.removeAttr("style"),o.removeAttr("style"),s&&s.length&&s.removeClass([n.slideVisibleClass,n.slideActiveClass,n.slideNextClass,n.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),i.emit("destroy"),Object.keys(i.eventsListeners).forEach(t=>{i.off(t)}),!1!==t&&(i.$el[0].swiper=null,function(t){const e=t;Object.keys(e).forEach(t=>{try{e[t]=null}catch(wm){}try{delete e[t]}catch(wm){}})}(i)),i.destroyed=!0),null}static extendDefaults(t){E(W,t)}static get extendedDefaults(){return W}static get defaults(){return $}static installModule(t){H.prototype.__modules__||(H.prototype.__modules__=[]);const e=H.prototype.__modules__;"function"==typeof t&&e.indexOf(t)<0&&e.push(t)}static use(t){return Array.isArray(t)?(t.forEach(t=>H.installModule(t)),H):(H.installModule(t),H)}}Object.keys(X).forEach(t=>{Object.keys(X[t]).forEach(e=>{H.prototype[e]=X[t][e]})}),H.use([function({swiper:t,on:e,emit:i}){const n=g();let r=null;const o=()=>{t&&!t.destroyed&&t.initialized&&(i("beforeResize"),i("resize"))},s=()=>{t&&!t.destroyed&&t.initialized&&i("orientationchange")};e("init",()=>{t.params.resizeObserver&&void 0!==n.ResizeObserver?t&&!t.destroyed&&t.initialized&&(r=new ResizeObserver(e=>{const{width:i,height:n}=t;let r=i,s=n;e.forEach(({contentBoxSize:e,contentRect:i,target:n})=>{n&&n!==t.el||(r=i?i.width:(e[0]||e).inlineSize,s=i?i.height:(e[0]||e).blockSize)}),r===i&&s===n||o()}),r.observe(t.el)):(n.addEventListener("resize",o),n.addEventListener("orientationchange",s))}),e("destroy",()=>{r&&r.unobserve&&t.el&&(r.unobserve(t.el),r=null),n.removeEventListener("resize",o),n.removeEventListener("orientationchange",s)})},function({swiper:t,extendParams:e,on:i,emit:n}){const r=[],o=g(),s=(t,e={})=>{const i=new(o.MutationObserver||o.WebkitMutationObserver)(t=>{if(1===t.length)return void n("observerUpdate",t[0]);const e=function(){n("observerUpdate",t[0])};o.requestAnimationFrame?o.requestAnimationFrame(e):o.setTimeout(e,0)});i.observe(t,{attributes:void 0===e.attributes||e.attributes,childList:void 0===e.childList||e.childList,characterData:void 0===e.characterData||e.characterData}),r.push(i)};e({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",()=>{if(t.params.observer){if(t.params.observeParents){const e=t.$el.parents();for(let t=0;t<e.length;t+=1)s(e[t])}s(t.$el[0],{childList:t.params.observeSlideChildren}),s(t.$wrapperEl[0],{attributes:!1})}}),i("destroy",()=>{r.forEach(t=>{t.disconnect()}),r.splice(0,r.length)})}]),["init","enabled","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","_grid","_slidesPerGroup","_slidesPerGroupSkip","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopFillGroupWithBlank","loopPreventsSlide","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","on"].map(t=>t.replace(/_/,""));let J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez]]}),t})();var K=i(2326);function Q(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"span",5),l.TgZ(1,"button",6),l.NdJ("click",function(){return l.CHM(t),l.oxw().prevEVT.emit()}),l._UZ(2,"i",7),l.qZA(),l.TgZ(3,"button",8),l.NdJ("click",function(){return l.CHM(t),l.oxw().nextEVT.emit()}),l._UZ(4,"i",9),l.qZA(),l.qZA()}}let tt=(()=>{class t{constructor(){this.showArrow=!1,this.closeEVT=new l.vpe,this.nextEVT=new l.vpe,this.prevEVT=new l.vpe,this.defaultPhotoPath="/assets/icon/no-photo.svg",this.imagePath=this.defaultPhotoPath}set mapPadding(t){this.imagePath=t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-image-modal"]],inputs:{showArrow:["showArrows","showArrow"],caption:"caption",mapPadding:["image","mapPadding"]},outputs:{closeEVT:"closeEVT",nextEVT:"nextEVT",prevEVT:"prevEVT"},decls:6,vars:5,consts:[[3,"src"],[3,"innerHTML"],[1,"webmapp-image-modal-close",3,"click"],[1,"icon-outline-close"],["class","webmapp-image-modal-header",4,"ngIf"],[1,"webmapp-image-modal-header"],[1,"webmapp-image-modal-left",3,"click"],[1,"icon-outline-arrow-left"],[1,"webmapp-image-modal-right",3,"click"],[1,"icon-outline-arrow-right"]],template:function(t,e){1&t&&(l._UZ(0,"img",0),l._UZ(1,"div",1),l.ALo(2,"wmtrans"),l.TgZ(3,"button",2),l.NdJ("click",function(){return e.closeEVT.emit()}),l._UZ(4,"i",3),l.qZA(),l.YNc(5,Q,5,0,"span",4)),2&t&&(l.Q6J("src",e.imagePath,l.LSH),l.xp6(1),l.Q6J("innerHTML",l.lcZ(2,3,e.caption),l.oJD),l.xp6(4),l.Q6J("ngIf",e.showArrow))},directives:[r.O5],pipes:[K.a],styles:["webmapp-image-modal{position:fixed;border-radius:15px;margin:auto;top:0;left:0;bottom:0;right:0;background-color:#fff;z-index:999999;height:-moz-fit-content;height:fit-content;width:50%;padding:10px;max-width:-moz-fit-content;max-width:fit-content;max-height:-moz-fit-content;max-height:fit-content}webmapp-image-modal img{border-radius:15px;max-height:89vh}webmapp-image-modal .webmapp-image-modal-close,webmapp-image-modal .webmapp-image-modal-left,webmapp-image-modal .webmapp-image-modal-right{position:absolute;padding:10px;margin:5px;border-radius:15px}webmapp-image-modal .webmapp-image-modal-close{top:0;right:0}webmapp-image-modal .webmapp-image-modal-left,webmapp-image-modal .webmapp-image-modal-right{font-size:30px;border-radius:25px}webmapp-image-modal .webmapp-image-modal-left{top:45%;left:-20px}webmapp-image-modal .webmapp-image-modal-right{top:45%;right:-20px}"],encapsulation:2,changeDetection:0}),t})();function et(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"a",2),l._uU(2),l.qZA(),l.BQk()),2&t){const t=e.$implicit;l.xp6(1),l.Q6J("href",t.value,l.LSH),l.xp6(1),l.Oqu(t.key)}}function it(t,e){if(1&t&&(l.TgZ(0,"div"),l.YNc(1,et,3,2,"ng-container",1),l.ALo(2,"keyvalue"),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.Q6J("ngForOf",l.lcZ(2,1,t.relatedUrls))}}i(8026);let nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-related-urls"]],inputs:{relatedUrls:"relatedUrls"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["target","_blank",2,"display","block",3,"href"]],template:function(t,e){1&t&&l.YNc(0,it,3,3,"div",0),2&t&&l.Q6J("ngIf",null!==e.relatedUrls)},directives:[r.O5,r.sg],pipes:[r.Nd],encapsulation:2,changeDetection:0}),t})();var rt=i(6215),ot=i(8002);const st=["player"];function at(t,e){if(1&t&&(l.TgZ(0,"ion-segment-button",5),l.TgZ(1,"ion-label"),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=e.$implicit;l.Q6J("value",t),l.xp6(2),l.Oqu(l.lcZ(3,2,t))}}let lt=(()=>{class t{constructor(){this.langs$=new rt.X(["it"]),this.currentLang$=new rt.X("it"),this._audio$=new rt.X({it:""}),this.audio$=this.currentLang$.pipe((0,ot.U)(t=>this._audio$.value[t]||null))}set audio(t){const e=Object.keys(t);this.langs$.next(e),this._audio$.next(t)}changeLang(t){const e=this.player.nativeElement;this.currentLang$.next(t.detail.value),e.src=this._audio$.value[t.detail.value],e.load(),e.play()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-audio"]],viewQuery:function(t,e){if(1&t&&l.Gf(st,5),2&t){let t;l.iGM(t=l.CRH())&&(e.player=t.first)}},inputs:{audio:"audio"},decls:9,vars:9,consts:[["value","it",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["controls",""],["player",""],["type","audio/mpeg",3,"src"],[3,"value"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-segment",0),l.NdJ("ionChange",function(t){return e.changeLang(t)}),l.YNc(1,at,4,4,"ion-segment-button",1),l.ALo(2,"async"),l.qZA(),l.TgZ(3,"audio",2,3),l._UZ(5,"source",4),l.ALo(6,"async"),l._uU(7),l.ALo(8,"wmtrans"),l.qZA()),2&t&&(l.xp6(1),l.Q6J("ngForOf",l.lcZ(2,3,e.langs$)),l.xp6(4),l.s9C("src",l.lcZ(6,5,e.audio$),l.LSH),l.xp6(2),l.hij(" ",l.lcZ(8,7,"il tuo browser non supporta gli elementi audio."),"\n"))},directives:[s.cJ,s.QI,r.sg,s.GO,s.Q$],pipes:[r.Ov,K.a],styles:["webmapp-track-audio audio{width:-webkit-fill-available}"],encapsulation:2,changeDetection:0}),t})();const ct=["slider"];function ht(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-slide",5),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().currentImage$.next(e)}),l.TgZ(1,"img",6),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().currentImage$.next(e)}),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit;l.xp6(1),l.Q6J("src",t.url,l.LSH)}}function ut(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"button",7),l.NdJ("click",function(){return l.CHM(t),l.oxw().prev()}),l._UZ(2,"ion-icon",8),l.qZA(),l.TgZ(3,"button",9),l.NdJ("click",function(){return l.CHM(t),l.oxw().next()}),l._UZ(4,"ion-icon",10),l.qZA(),l.BQk()}}function dt(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"webmapp-image-modal",11),l.NdJ("closeEVT",function(){return l.CHM(t),l.oxw().close()})("nextEVT",function(){return l.CHM(t),l.oxw().next()})("prevEVT",function(){return l.CHM(t),l.oxw().prev()}),l.qZA()}if(2&t){const t=e.ngIf,i=l.oxw();l.Q6J("image",null!=t.url?t.url:i.defaultPhotoPath)("showArrows",i.gallery&&i.gallery.length>1)("caption",t.caption)}}let pt=(()=>{class t{constructor(){this.currentImage$=new rt.X(null),this.defaultPhotoPath="/assets/icon/no-photo.svg",this.gallery=[],this.slideOptions={slidesPerView:1,allowTouchMove:!1,slidesPerColumn:1,slidesPerGroup:1,centeredSlides:!0,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!1,parallax:!1,on:{beforeInit(){const t=this;t.classNames.push(`${t.params.containerModifierClass}fade`);const e={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,centeredSlides:!0,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!1,allowTouchMove:!1,parallax:!1};t.params=Object.assign(t.params,e),t.params=Object.assign(t.originalParams,e)},setTranslate(){const t=this,{slides:e}=t;for(let i=0;i<e.length;i+=1){const e=t.slides.eq(i);let n=-e[0].swiperSlideOffset;t.params.virtualTranslate||(n-=t.translate);let r=0;t.isHorizontal()||(r=n,n=0);const o=t.params.fadeEffect.crossFade?Math.max(1-Math.abs(e[0].progress),0):1+Math.min(Math.max(e[0].progress,-1),0);e.css({opacity:o}).transform(`translate3d(${n}px, ${r}px, 0px)`)}},setTransition(t){const e=this,{slides:i,$wrapperEl:n}=e;if(i.transition(t),e.params.virtualTranslate&&0!==t){let t=!1;i.transitionEnd(()=>{if(t)return;if(!e||e.destroyed)return;t=!0,e.animating=!1;const i=["webkitTransitionEnd","transitionend"];for(let t=0;t<i.length;t+=1)n.trigger(i[t])})}}}}}set imageGallery(t){this.gallery=t}close(){this.currentImage$.next(null)}next(){const t=((null==this.currentImage$.value?0:this.gallery.indexOf(this.currentImage$.value))+1)%this.gallery.length;this.currentImage$.next(this.gallery[t]),this.slider.slideTo(t)}prev(){const t=null==this.currentImage$.value?0:this.gallery.indexOf(this.currentImage$.value),e=t<=0?this.gallery.length-1:(t-1)%this.gallery.length;this.currentImage$.next(this.gallery[e]),this.slider.slideTo(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-gallery"]],viewQuery:function(t,e){if(1&t&&l.Gf(ct,5),2&t){let t;l.iGM(t=l.CRH())&&(e.slider=t.first)}},hostBindings:function(t,e){1&t&&l.NdJ("keydown.Escape",function(t){return e.close(t)},!1,l.evT)("keydown.ArrowRight",function(t){return e.next(t)})("keydown.ArrowLeft",function(t){return e.prev(t)})},inputs:{imageGallery:["gallery","imageGallery"]},decls:6,vars:6,consts:[[3,"options"],["slider",""],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"image","showArrows","caption","closeEVT","nextEVT","prevEVT",4,"ngIf"],[3,"click"],[3,"src","click"],["type","submit","ion-button","",1,"left","circle",3,"click"],["name","caret-back-outline"],["type","submit","ion-button","",1,"right","circle",3,"click"],["name","caret-forward-outline"],[3,"image","showArrows","caption","closeEVT","nextEVT","prevEVT"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-slides",0,1),l.YNc(2,ht,2,1,"ion-slide",2),l.qZA(),l.YNc(3,ut,5,0,"ng-container",3),l.YNc(4,dt,1,3,"webmapp-image-modal",4),l.ALo(5,"async")),2&t&&(l.Q6J("options",e.slideOptions),l.xp6(2),l.Q6J("ngForOf",e.gallery),l.xp6(1),l.Q6J("ngIf",e.gallery&&e.gallery.length>1),l.xp6(1),l.Q6J("ngIf",l.lcZ(5,4,e.currentImage$)))},directives:[s.Hr,r.sg,r.O5,s.A$,s.gu,tt],pipes:[r.Ov],styles:["wm-gallery{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-around;align-content:flex-start;align-items:flex-start;position:relative}wm-gallery>img{flex:0 0 auto;align-self:auto;padding:10px;object-fit:cover;height:150px;width:50%;border-radius:15px;cursor:pointer}wm-gallery webmapp-image-modal{width:50%;padding:10px;max-width:-moz-fit-content;max-width:fit-content;left:70px}wm-gallery ion-slides{width:-webkit-fill-available!important;max-height:220px;position:relative;background-color:#fff!important}wm-gallery ion-slide{max-height:300px}wm-gallery .circle{width:33px;height:33px;margin:auto;border-radius:25px}wm-gallery .left{left:0}wm-gallery .left,wm-gallery .right{margin-right:5px;order:0;flex:0 1 auto;align-self:auto;position:absolute;top:40%;z-index:99999;margin-left:5px}wm-gallery .right{right:0}@media only screen and (max-width: 600px){wm-gallery webmapp-image-modal{width:100%;max-width:-moz-fit-content;max-width:fit-content}}"],encapsulation:2,changeDetection:0}),t})(),ft=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,c,s.Pc]]}),t})(),gt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,ft,o.u5,s.Pc,c,J]]}),t})(),mt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,o.u5,gt,s.Pc,c]]}),t})();var _t=i(1221);let vt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,s.Pc,o.u5,o.UX,c,ft,_t.z,n.L]]}),t})();var yt=i(8007),wt=i(3463),xt=i(9257),bt=i(5319),Ct=i(5917),Tt=i(6682),St=i(4402),kt=i(3342),Et=i(7519),Pt=i(5435),Mt=i(3190),It=i(4395),Lt=i(9761),At=i(8819),Rt=i(3653),Ot=i(7057);function Ft(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{l(n.next(t))}catch(wm){o(wm)}}function a(t){try{l(n.throw(t))}catch(wm){o(wm)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,a)}l((n=n.apply(t,e||[])).next())})}function Dt(t){t.stopPropagation()}const Zt=class{constructor(t){this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},Nt="propertychange",jt=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function Gt(t,e){return t>e?1:t<e?-1:0}function zt(t,e,i){const n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;{let r;if(i>0){for(r=1;r<n;++r)if(t[r]<e)return r-1}else if(i<0){for(r=1;r<n;++r)if(t[r]<=e)return r}else for(r=1;r<n;++r){if(t[r]==e)return r;if(t[r]<e)return"function"==typeof i?i(e,t[r-1],t[r])>0?r-1:r:t[r-1]-e<e-t[r]?r-1:r}return n-1}}function Vt(t,e,i){for(;e<i;){const n=t[e];t[e]=t[i],t[i]=n,++e,--i}}function Bt(t,e){const i=Array.isArray(e)?e:[e],n=i.length;for(let r=0;r<n;r++)t[t.length]=i[r]}function qt(t,e){const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ut(){return!0}function $t(){return!1}function Yt(){}function Xt(t){for(const e in t)delete t[e]}function Wt(t){let e;for(e in t)return!1;return!e}const Ht=class extends jt{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e="string"==typeof t,i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=e?new Zt(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});let a;i in o||(o[i]=0,s[i]=0),++o[i];for(let l=0,c=n.length;l<c;++l)if(a="handleEvent"in n[l]?n[l].handleEvent(r):n[l].call(this,r),!1===a||r.propagationStopped){a=!1;break}if(0==--o[i]){let t=s[i];for(delete s[i];t--;)this.removeEventListener(i,Yt);delete o[i]}return a}disposeInternal(){this.listeners_&&Xt(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=Yt,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}}},Jt="change",Kt="contextmenu",Qt="click",te="keydown",ee="keypress",ie="touchmove",ne="wheel";function re(t,e,i,n,r){if(n&&n!==t&&(i=i.bind(n)),r){const n=i;i=function(){t.removeEventListener(e,i),n.apply(this,arguments)}}const o={target:t,type:e,listener:i};return t.addEventListener(e,i),o}function oe(t,e,i,n){return re(t,e,i,n,!0)}function se(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),Xt(t))}function ae(t){if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)se(t[e]);else se(t)}const le=class extends Ht{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Jt)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=re(this,t[r],e);return n}return re(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=oe(this,t[r],e)}else i=oe(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)ae(i);else if(Array.isArray(t))for(let n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}};function ce(){throw new Error("Unimplemented abstract method.")}let he=0;function ue(t){return t.ol_uid||(t.ol_uid=String(++he))}class de extends Zt{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const pe=class extends le{constructor(t){super(),ue(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new de(i,t,e)),i=Nt,this.hasListener(i)&&this.dispatchEvent(new de(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const i=n[t];n[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Wt(this.values_)&&(this.values_=null),e||this.notify(t,i)}}},fe={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class ge extends Error{constructor(t){const e=fe[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const me=ge;function _e(t,e){if(!t)throw new me(e)}class ve extends pe{constructor(t){super(),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t&&("function"==typeof t.getSimplifiedGeometry?this.setGeometry(t):this.setProperties(t))}clone(){const t=new ve(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(se(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=re(t,Jt,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;{let e;return Array.isArray(t)?e=t:(_e("function"==typeof t.getZIndex,41),e=[t]),function(){return e}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const ye=ve,we="add",xe="remove",be="length";class Ce extends Zt{constructor(t,e,i){super(t),this.element=e,this.index=i}}const Te=class extends pe{constructor(t,e){if(super(),this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(be)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ce(we,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ce(xe,e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ce(xe,i,t)),this.dispatchEvent(new Ce(we,e,t))}updateLength_(){this.set(be,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new me(58)}},Se="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",ke=Se.includes("firefox"),Ee=(Se.includes("safari")&&!Se.includes("chrom")&&(Se.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Se)),Se.includes("webkit")&&!Se.includes("edge")),Pe=Se.includes("macintosh"),Me="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,Ie="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,Le="undefined"!=typeof Image&&Image.prototype.decode,Ae=function(){let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(e){}return t}(),Re=new Array(6);function Oe(t){return De(t,1,0,0,1,0,0)}function Fe(t,e){const i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=e[0],c=e[1],h=e[2],u=e[3],d=e[4],p=e[5];return t[0]=i*l+r*c,t[1]=n*l+o*c,t[2]=i*h+r*u,t[3]=n*h+o*u,t[4]=i*d+r*p+s,t[5]=n*d+o*p+a,t}function De(t,e,i,n,r,o,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t}function Ze(t,e){const i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function Ne(t,e,i){return Fe(t,De(Re,e,0,0,i,0,0))}function je(t,e,i,n,r,o,s,a){const l=Math.sin(o),c=Math.cos(o);return t[0]=n*c,t[1]=r*l,t[2]=-n*l,t[3]=r*c,t[4]=s*n*c-a*n*l+e,t[5]=s*r*l+a*r*c+i,t}function Ge(t,e){const i=(n=e)[0]*n[3]-n[1]*n[2];var n;_e(0!==i,32);const r=e[0],o=e[1],s=e[2],a=e[3],l=e[4],c=e[5];return t[0]=a/i,t[1]=-o/i,t[2]=-s/i,t[3]=r/i,t[4]=(s*c-a*l)/i,t[5]=-(r*c-o*l)/i,t}let ze;function Ve(t){const e="matrix("+t.join(", ")+")";if(Ie)return e;const i=ze||(ze=document.createElement("div"));return i.style.transform=e,i.style.transform}function Be(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0,n=t.length;i<n;++i)ni(e,t[i]);return e}function qe(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Ue(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function $e(t,e,i){let n,r;return n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,r=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0,n*n+r*r}function Ye(t,e){return We(t,e[0],e[1])}function Xe(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function We(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function He(t,e){const i=e[0],n=e[1];let r=0;return i<t[0]?r|=16:i>t[2]&&(r|=4),n<t[1]?r|=8:n>t[3]&&(r|=2),0===r&&(r=1),r}function Je(t,e,i,n,r){return r?(r[0]=t,r[1]=e,r[2]=i,r[3]=n,r):[t,e,i,n]}function Ke(t){return Je(1/0,1/0,-1/0,-1/0,t)}function Qe(t,e){const i=t[0],n=t[1];return Je(i,n,i,n,e)}function ti(t,e,i,n,r){return ri(Ke(r),t,e,i,n)}function ei(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function ii(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function ni(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ri(t,e,i,n,r){for(;i<n;i+=r)oi(t,e[i],e[i+1]);return t}function oi(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function si(t,e){let i;return i=e(li(t)),i||(i=e(ci(t)),i||(i=e(_i(t)),i||(i=e(mi(t)),i||!1)))}function ai(t){let e=0;return wi(t)||(e=vi(t)*fi(t)),e}function li(t){return[t[0],t[1]]}function ci(t){return[t[2],t[1]]}function hi(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function ui(t,e){let i;return"bottom-left"===e?i=li(t):"bottom-right"===e?i=ci(t):"top-left"===e?i=mi(t):"top-right"===e?i=_i(t):_e(!1,13),i}function di(t,e,i,n,r){const[o,s,a,l,c,h,u,d]=pi(t,e,i,n);return Je(Math.min(o,a,c,u),Math.min(s,l,h,d),Math.max(o,a,c,u),Math.max(s,l,h,d),r)}function pi(t,e,i,n){const r=e*n[0]/2,o=e*n[1]/2,s=Math.cos(i),a=Math.sin(i),l=r*s,c=r*a,h=o*s,u=o*a,d=t[0],p=t[1];return[d-l+u,p-c-h,d-l-u,p-c+h,d+l-u,p+c+h,d+l+u,p+c-h,d-l+u,p-c-h]}function fi(t){return t[3]-t[1]}function gi(t,e,i){const n=i||[1/0,1/0,-1/0,-1/0];return yi(t,e)?(n[0]=t[0]>e[0]?t[0]:e[0],n[1]=t[1]>e[1]?t[1]:e[1],n[2]=t[2]<e[2]?t[2]:e[2],n[3]=t[3]<e[3]?t[3]:e[3]):Ke(n),n}function mi(t){return[t[0],t[3]]}function _i(t){return[t[2],t[3]]}function vi(t){return t[2]-t[0]}function yi(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function wi(t){return t[2]<t[0]||t[3]<t[1]}function xi(t,e){const i=e.getExtent(),n=hi(t);if(e.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const e=vi(i),r=Math.floor((n[0]-i[0])/e)*e;t[0]-=r,t[2]-=r}return t}function bi(t,e,i){return Math.min(Math.max(t,e),i)}function Ci(t,e,i,n,r,o){const s=r-i,a=o-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return Ti(t,e,i,n)}function Ti(t,e,i,n){const r=i-t,o=n-e;return r*r+o*o}function Si(t){return t*Math.PI/180}function ki(t,e){const i=t%e;return i*e<0?i+e:i}function Ei(t,e,i){return t+i*(e-t)}function Pi(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}function Mi(t,e){return Math.floor(Pi(t,e))}function Ii(t,e){return Math.ceil(Pi(t,e))}const Li=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ai=/^([a-z]*)$|^hsla?\(.*\)$/i;function Ri(t){return"string"==typeof t?t:Zi(t)}const Oi=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let i=0;for(const n in t)0==(3&i++)&&(delete t[n],--e)}n=function(t){let e,i,n,r,o;if(Ai.exec(t)&&(t=function(t){const e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}(t)),Li.exec(t)){const s=t.length-1;let a;a=s<=4?1:2;const l=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),r=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,l&&(r=(r<<4)+r)),o=[e,i,n,r/255]}else t.startsWith("rgba(")?(o=t.slice(5,-1).split(",").map(Number),Di(o)):t.startsWith("rgb(")?(o=t.slice(4,-1).split(",").map(Number),o.push(1),Di(o)):_e(!1,14);return o}(i),t[i]=n,++e}return n}}();function Fi(t){return Array.isArray(t)?t:Oi(t)}function Di(t){return t[0]=bi(t[0]+.5|0,0,255),t[1]=bi(t[1]+.5|0,0,255),t[2]=bi(t[2]+.5|0,0,255),t[3]=bi(t[3],0,1),t}function Zi(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function Ni(t,e,i){return e+":"+t+":"+(i?Ri(i):"null")}const ji=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=Ni(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const r=Ni(t,e,i);this.cache_[r]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}},Gi="opacity",zi="visible",Vi="extent",Bi="zIndex",qi="maxResolution",Ui="minResolution",$i="maxZoom",Yi="minZoom",Xi="source",Wi=class extends pe{constructor(t){super(),this.background_=t.background;const e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,_e("number"==typeof e.opacity,64),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=bi(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ce()}getLayerStatesArray(t){return ce()}getExtent(){return this.get(Vi)}getMaxResolution(){return this.get(qi)}getMinResolution(){return this.get(Ui)}getMinZoom(){return this.get(Yi)}getMaxZoom(){return this.get($i)}getOpacity(){return this.get(Gi)}getSourceState(){return ce()}getVisible(){return this.get(zi)}getZIndex(){return this.get(Bi)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Vi,t)}setMaxResolution(t){this.set(qi,t)}setMinResolution(t){this.set(Ui,t)}setMaxZoom(t){this.set($i,t)}setMinZoom(t){this.set(Yi,t)}setOpacity(t){_e("number"==typeof t,64),this.set(Gi,t)}setVisible(t){this.set(zi,t)}setZIndex(t){this.set(Bi,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},Hi="precompose",Ji="rendercomplete";function Ki(t,e){if(!t.visible)return!1;const i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;const n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}const Qi=class extends Wi{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Xi,this.handleSourcePropertyChange_),this.setSource(t.source?t.source:null)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(Xi)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(se(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=re(t,Jt,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(t=>t([]))}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(se(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(se(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=re(t,Hi,function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);_e(!e.some(function(t){return t.layer===i.layer}),67),e.push(i)},this),this.mapRenderKey_=re(this,Jt,t.render,t),this.changed())}setSource(t){this.set(Xi,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function tn(t,e){return t[0]+=+e[0],t[1]+=+e[1],t}function en(t,e){let i=!0;for(let n=t.length-1;n>=0;--n)if(t[n]!=e[n]){i=!1;break}return i}function nn(t,e){const i=Math.cos(e),n=Math.sin(e),r=t[1]*i+t[0]*n;return t[0]=t[0]*i-t[1]*n,t[1]=r,t}function rn(t,e){return t[0]*=e,t[1]*=e,t}function on(t,e){if(e.canWrapX()){const i=vi(e.getExtent()),n=function(t,e,i){const n=e.getExtent();let r=0;return e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])&&(i=i||vi(n),r=Math.floor((t[0]-n[0])/i)),r}(t,e,i);n&&(t[0]-=n*i)}return t}function sn(t,e){ji.expire()}const an=class extends jt{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ce()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;je(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Ge(n,i)}forEachFeatureAtCoordinate(t,e,i,n,r,o,s,a){let l;const c=e.viewState;function h(t,e,i,n){return r.call(o,e,t?i:null,n)}const u=c.projection,d=on(t.slice(),u),p=[[0,0]];if(u.canWrapX()&&n){const t=vi(u.getExtent());p.push([-t,0],[t,0])}const f=e.layerStatesArray,g=f.length,m=[],_=[];for(let y=0;y<p.length;y++)for(let n=g-1;n>=0;--n){const r=f[n],o=r.layer;if(o.hasRenderer()&&Ki(r,c)&&s.call(a,o)){const n=o.getRenderer(),s=o.getSource();if(n&&s){const o=s.getWrapX()?d:t,a=h.bind(null,r.managed);_[0]=o[0]+p[y][0],_[1]=o[1]+p[y][1],l=n.forEachFeatureAtCoordinate(_,e,i,a,m)}if(l)return l}}if(0===m.length)return;const v=1/m.length;return m.forEach((t,e)=>t.distanceSq+=e*v),m.sort((t,e)=>t.distanceSq-e.distanceSq),m.some(t=>l=t.callback(t.feature,t.layer,t.geometry)),l}hasFeatureAtCoordinate(t,e,i,n,r,o){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,Ut,this,r,o)}getMap(){return this.map_}renderFrame(t){ce()}scheduleExpireIconCache(t){ji.canExpireCache()&&t.postRenderFunctions.push(sn)}},ln=class extends Zt{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}},cn="ol-hidden",hn="ol-control",un=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),dn=["style","variant","weight","size","lineHeight","family"],pn=function(t){const e=t.match(un);if(!e)return null;const i={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,r=dn.length;n<r;++n){const t=e[n+1];void 0!==t&&(i[dn[n]]=t)}return i.families=i.family.split(/,\s?/),i};function fn(t,e,i,n){let r;return r=i&&i.length?i.shift():Ie?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(r.width=t),e&&(r.height=e),r.getContext("2d",n)}function gn(t){const e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function mn(t){let e=t.offsetWidth;const i=getComputedStyle(t);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10),e}function _n(t){let e=t.offsetHeight;const i=getComputedStyle(t);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10),e}function vn(t,e){const i=e.parentNode;i&&i.replaceChild(t,e)}function yn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function wn(t){for(;t.lastChild;)t.removeChild(t.lastChild)}const xn="10px sans-serif",bn="#000",Cn="round",Tn=[],Sn="round",kn="#000",En="center",Pn="middle",Mn=[0,0,0,0],In=new pe;let Ln,An=null;const Rn={},On=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10\uf013";let r,o;function s(r,s,a){let l=!0;for(let c=0;c<i;++c){const i=e[c];if(o=Zn(r+" "+s+" "+t+i,n),a!=i){const e=Zn(r+" "+s+" "+t+a+","+i,n);l=l&&e!=o}}return!!l}function a(){let t=!0;const e=In.getKeys();for(let i=0,n=e.length;i<n;++i){const n=e[i];In.get(n)<100&&(s.apply(this,n.split("\n"))?(Xt(Rn),An=null,Ln=void 0,In.set(n,100)):(In.set(n,In.get(n)+1,!0),t=!1))}t&&(clearInterval(r),r=void 0)}return function(t){const e=pn(t);if(!e)return;const i=e.families;for(let n=0,o=i.length;n<o;++n){const t=i[n],o=e.style+"\n"+e.weight+"\n"+t;void 0===In.get(o)&&(In.set(o,100,!0),s(e.style,e.weight,t)||(In.set(o,0,!0),void 0===r&&(r=setInterval(a,32))))}}}(),Fn=function(){let t;return function(e){let i=Rn[e];if(null==i){if(Ie){const t=pn(e),n=Dn(e,"\u017dg");i=(isNaN(Number(t.lineHeight))?1.2:Number(t.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else t||(t=document.createElement("div"),t.innerHTML="M",t.style.minHeight="0",t.style.maxHeight="none",t.style.height="auto",t.style.padding="0",t.style.border="none",t.style.position="absolute",t.style.display="block",t.style.left="-99999px"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);Rn[e]=i}return i}}();function Dn(t,e){return An||(An=fn(1,1)),t!=Ln&&(An.font=t,Ln=An.font),An.measureText(e)}function Zn(t,e){return Dn(t,e).width}function Nn(t,e,i){if(e in i)return i[e];const n=e.split("\n").reduce((e,i)=>Math.max(e,Zn(t,i)),0);return i[e]=n,n}const jn=class extends an{constructor(t){super(t),this.fontChangeListenerKey_=re(In,Nt,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className="ol-unselectable ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new ln(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){se(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(Hi,t);const e=t.layerStatesArray.sort(function(t,e){return t.zIndex-e.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let r=null;for(let o=0,s=e.length;o<s;++o){const s=e[o];t.layerIndex=o;const a=s.layer,l=a.getSourceState();if(!Ki(s,i)||"ready"!=l&&"undefined"!=l){a.unrender();continue}const c=a.render(t,r);c&&(c!==r&&(this.children_.push(c),r=c),"getDeclutter"in a&&n.push(a))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);!function(t,e){const i=t.childNodes;for(let n=0;;++n){const r=i[n],o=e[n];if(!r&&!o)break;r!==o&&(r?o?t.insertBefore(o,r):(t.removeChild(r),--n):t.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class Gn extends Zt{constructor(t,e){super(t),this.layer=e}}const zn="layers";class Vn extends Wi{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(zn,this.handleLayersChanged_),i?Array.isArray(i)?i=new Te(i.slice(),{unique:!0}):_e("function"==typeof i.getArray,43):i=new Te(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(se),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(re(t,we,this.handleLayersAdd_,this),re(t,xe,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(se);Xt(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const t=e[i];this.registerLayerListeners_(t),this.dispatchEvent(new Gn("addlayer",t))}this.changed()}registerLayerListeners_(t){const e=[re(t,Nt,this.handleLayerChange_,this),re(t,Jt,this.handleLayerChange_,this)];t instanceof Vn&&e.push(re(t,"addlayer",this.handleLayerGroupAdd_,this),re(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ue(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Gn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Gn("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Gn("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=ue(e);this.listenerKeys_[i].forEach(se),delete this.listenerKeys_[i],this.dispatchEvent(new Gn("removelayer",e)),this.changed()}getLayers(){return this.get(zn)}setLayers(t){const e=this.getLayers();if(e){const t=e.getArray();for(let e=0,i=t.length;e<i;++e)this.dispatchEvent(new Gn("removelayer",t[e]))}this.set(zn,t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});const n=this.getLayerState();let r=n.zIndex;t||void 0!==n.zIndex||(r=0);for(let o=i,s=e.length;o<s;o++){const t=e[o];t.opacity*=n.opacity,t.visible=t.visible&&n.visible,t.maxResolution=Math.min(t.maxResolution,n.maxResolution),t.minResolution=Math.max(t.minResolution,n.minResolution),t.minZoom=Math.max(t.minZoom,n.minZoom),t.maxZoom=Math.min(t.maxZoom,n.maxZoom),void 0!==n.extent&&(t.extent=void 0!==t.extent?gi(t.extent,n.extent):n.extent),void 0===t.zIndex&&(t.zIndex=r)}return e}getSourceState(){return"ready"}}const Bn=Vn,qn=class extends Zt{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},Un=class extends qn{constructor(t,e,i,n,r,o){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},$n={SINGLECLICK:"singleclick",CLICK:Qt,DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Yn="pointerdown",Xn=class extends Ht{constructor(t,e){super(t),this.map_=t,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=re(i,Yn,this.handlePointerDown_,this),this.relayedListenerKey_=re(i,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ie,this.boundHandleTouchMove_,!!Ae&&{passive:!1})}emulateClick_(t){let e=new Un($n.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Un($n.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;const e=new Un($n.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}).bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==$n.POINTERUP||e.type==$n.POINTERCANCEL){delete this.trackedTouches_[i];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else e.type!=$n.POINTERDOWN&&e.type!=$n.POINTERMOVE||(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Un($n.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(se),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new Un($n.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const e=t[i];this.down_[i]="function"==typeof e?Yt:e}if(0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(re(t,$n.POINTERMOVE,this.handlePointerMove_,this),re(t,$n.POINTERUP,this.handlePointerUp_,this),re(this.element_,$n.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(re(this.element_.getRootNode(),$n.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Un($n.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Un($n.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(se(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ie,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(se(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(se),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},Wn="postrender",Hn="loadstart",Jn="loadend",Kn="layergroup",Qn="size",tr="target",er="view",ir=1/0,nr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},rr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},or=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||rr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},sr=6378137,ar=Math.PI*sr,lr=[-ar,-ar,ar,ar],cr=[-180,-85,180,85],hr=sr*Math.log(Math.tan(Math.PI/2));class ur extends or{constructor(t){super({code:t,units:"m",extent:lr,global:!0,worldExtent:cr,getPointResolution:function(t,e){return t/Math.cosh(e[1]/sr)}})}}const dr=[new ur("EPSG:3857"),new ur("EPSG:102100"),new ur("EPSG:102113"),new ur("EPSG:900913"),new ur("http://www.opengis.net/def/crs/EPSG/0/3857"),new ur("http://www.opengis.net/gml/srs/epsg.xml#3857")],pr=[-180,-90,180,90],fr=6378137*Math.PI/180;class gr extends or{constructor(t,e){super({code:t,units:"degrees",extent:pr,axisOrientation:e,global:!0,metersPerUnit:fr,worldExtent:pr})}}const mr=[new gr("CRS:84"),new gr("EPSG:4326","neu"),new gr("urn:ogc:def:crs:OGC:1.3:CRS84"),new gr("urn:ogc:def:crs:OGC:2:84"),new gr("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new gr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new gr("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let _r={},vr={};function yr(t,e,i){const n=t.getCode(),r=e.getCode();n in vr||(vr[n]={}),vr[n][r]=i}function wr(t,e,i){i=i||6371008.8;const n=Si(t[1]),r=Si(e[1]),o=(r-n)/2,s=Si(e[0]-t[0])/2,a=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(r);return 2*i*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}let xr=!0;function br(t){xr=!(void 0===t||t)}function Cr(t,e,i){if(void 0!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];e=e}else e=t.slice();return e}function Tr(t,e,i){if(void 0!==e&&t!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];t=e}return t}function Sr(t){!function(t,e){_r[t]=e}(t.getCode(),t),yr(t,t,Cr)}function kr(t){return"string"==typeof t?_r[e=t]||_r[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Er(t,e,i,n){let r;const o=(t=kr(t)).getPointResolutionFunc();if(o){if(r=o(e,i),n&&n!==t.getUnits()){const e=t.getMetersPerUnit();e&&(r=r*e/rr[n])}}else{const o=t.getUnits();if("degrees"==o&&!n||"degrees"==n)r=e;else{const s=Rr(t,kr("EPSG:4326"));if(s===Tr&&"degrees"!==o)r=e*t.getMetersPerUnit();else{let t=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];t=s(t,t,2),r=(wr(t.slice(0,2),t.slice(2,4))+wr(t.slice(4,6),t.slice(6,8)))/2}const a=n?rr[n]:t.getMetersPerUnit();void 0!==a&&(r/=a)}}return r}function Pr(t){!function(t){t.forEach(Sr)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&yr(e,t,Cr)})})}function Mr(t,e){return t?"string"==typeof t?kr(t):t:kr(e)}function Ir(t,e){return br(),Fr(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function Lr(t,e){const i=Fr(t,void 0!==e?e:"EPSG:3857","EPSG:4326"),n=i[0];return(n<-180||n>180)&&(i[0]=ki(n+180,360)-180),i}function Ar(t,e){if(t===e)return!0;const i=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||Rr(t,e)===Cr)&&i}function Rr(t,e){let i=function(t,e){let i;return t in vr&&e in vr[t]&&(i=vr[t][e]),i}(t.getCode(),e.getCode());return i||(i=Tr),i}function Or(t,e){return Rr(kr(t),kr(e))}function Fr(t,e,i){return Or(e,i)(t,void 0,t.length)}function Dr(t,e){return t}function Zr(t,e){return xr&&!en(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(xr=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t}function Nr(t,e){return t}function jr(t,e){return t}var Gr,zr,Vr;function Br(t,e,i){return function(n,r,o,s,a){if(!n)return;if(!r&&!e)return n;const l=e?0:o[0]*r,c=e?0:o[1]*r,h=a?a[0]:0,u=a?a[1]:0;let d=t[0]+l/2+h,p=t[2]-l/2+h,f=t[1]+c/2+u,g=t[3]-c/2+u;d>p&&(d=(p+d)/2,p=d),f>g&&(f=(g+f)/2,g=f);let m=bi(n[0],d,p),_=bi(n[1],f,g);if(s&&i&&r){const t=30*r;m+=-t*Math.log(1+Math.max(0,d-n[0])/t)+t*Math.log(1+Math.max(0,n[0]-p)/t),_+=-t*Math.log(1+Math.max(0,f-n[1])/t)+t*Math.log(1+Math.max(0,n[1]-g)/t)}return[m,_]}}function qr(t){return t}function Ur(t,e,i,n){const r=vi(e)/i[0],o=fi(e)/i[1];return n?Math.min(t,Math.max(r,o)):Math.min(t,Math.min(r,o))}function $r(t,e,i){let n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),bi(n,i/2,2*e)}function Yr(t,e,i,n,r){return i=void 0===i||i,function(o,s,a,l){if(void 0!==o){const s=n?Ur(t,n,a,r):t;return i&&l?$r(o,s,e):bi(o,e,s)}}}function Xr(t){return void 0!==t?0:void 0}function Wr(t){return void 0!==t?t:void 0}function Hr(t){return Math.pow(t,3)}function Jr(t){return 1-Hr(1-t)}function Kr(t){return 3*t*t-2*t*t*t}function Qr(t){return t}function to(t,e,i,n,r,o){o=o||[];let s=0;for(let a=e;a<i;a+=n){const e=t[a],i=t[a+1];o[s++]=r[0]*e+r[2]*i+r[4],o[s++]=r[1]*e+r[3]*i+r[5]}return o&&o.length!=s&&(o.length=s),o}function eo(t,e,i,n,r,o,s){s=s||[];const a=Math.cos(r),l=Math.sin(r),c=o[0],h=o[1];let u=0;for(let d=e;d<i;d+=n){const e=t[d]-c,i=t[d+1]-h;s[u++]=c+e*a-i*l,s[u++]=h+e*l+i*a;for(let r=d+2;r<d+n;++r)s[u++]=t[r]}return s&&s.length!=u&&(s.length=u),s}function io(t,e,i,n,r,o,s){s=s||[];let a=0;for(let l=e;l<i;l+=n){s[a++]=t[l]+r,s[a++]=t[l+1]+o;for(let e=l+2;e<l+n;++e)s[a++]=t[e]}return s&&s.length!=a&&(s.length=a),s}Pr(dr),Pr(mr),Gr=dr,zr=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let r=0;r<n;r+=i){e[r]=ar*t[r]/180;let i=sr*Math.log(Math.tan(Math.PI*(+t[r+1]+90)/360));i>hr?i=hr:i<-hr&&(i=-hr),e[r+1]=i}return e},Vr=function(t,e,i){const n=t.length;i=i>1?i:2,void 0===e&&(e=i>2?t.slice():new Array(n));for(let r=0;r<n;r+=i)e[r]=180*t[r]/ar,e[r+1]=360*Math.atan(Math.exp(t[r+1]/sr))/Math.PI-90;return e},mr.forEach(function(t){Gr.forEach(function(e){yr(t,e,zr),yr(e,t,Vr)})});const no=[1,0,0,1,0,0],ro=class extends pe{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,i,n,r=!1;return function(){const o=Array.prototype.slice.call(arguments);return r&&this===n&&qt(o,i)||(r=!0,n=this,i=o,e=t.apply(this,arguments)),e}}(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ce()}closestPointXY(t,e,i,n){return ce()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ce()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Ke(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){ce()}scale(t,e,i){ce()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ce()}getType(){return ce()}applyTransform(t){ce()}intersectsExtent(t){return ce()}translate(t,e){ce()}transform(t,e){const i=kr(t),n="tile-pixels"==i.getUnits()?function(t,n,r){const o=i.getExtent(),s=i.getWorldExtent(),a=fi(s)/fi(o);return je(no,s[0],s[3],a,-a,0,0,0),to(t,0,t.length,r,no,n),Or(i,e)(t,n,r)}:Or(i,e);return this.applyTransform(n),this}};function oo(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}const so=class extends ro{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return ti(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ce()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=oo(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ce()}setLayout(t,e,i){let n;if(t)n=oo(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}n=e.length,t=function(t){let e;return 2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM"),e}(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();eo(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=hi(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();!function(t,e,i,n,r,o,s,a){a=a||[];const l=s[0],c=s[1];let h=0;for(let u=0;u<i;u+=n){const e=t[u+1]-c;a[h++]=l+r*(t[u]-l),a[h++]=c+o*e;for(let i=u+2;i<u+n;++i)a[h++]=t[i]}a&&a.length!=h&&(a.length=h)}(n,0,n.length,r,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();io(i,0,i.length,n,t,e,i),this.changed()}}};function ao(t,e,i,n,r,o,s){const a=t[e],l=t[e+1],c=t[i]-a,h=t[i+1]-l;let u;if(0===c&&0===h)u=e;else{const d=((r-a)*c+(o-l)*h)/(c*c+h*h);if(d>1)u=i;else{if(d>0){for(let r=0;r<n;++r)s[r]=Ei(t[e+r],t[i+r],d);return void(s.length=n)}u=e}}for(let d=0;d<n;++d)s[d]=t[u+d];s.length=n}function lo(t,e,i,n,r){let o=t[e],s=t[e+1];for(e+=n;e<i;e+=n){const i=t[e],n=t[e+1],a=Ti(o,s,i,n);a>r&&(r=a),o=i,s=n}return r}function co(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){const s=i[o];r=lo(t,e,s,n,r),e=s}return r}function ho(t,e,i,n,r,o,s,a,l,c,h){if(e==i)return c;let u,d;if(0===r){if(d=Ti(s,a,t[e],t[e+1]),d<c){for(u=0;u<n;++u)l[u]=t[e+u];return l.length=n,d}return c}h=h||[NaN,NaN];let p=e+n;for(;p<i;)if(ao(t,p-n,p,n,s,a,h),d=Ti(s,a,h[0],h[1]),d<c){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n,p+=n}else p+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/r|0,1);if(o&&(ao(t,i-n,e,n,s,a,h),d=Ti(s,a,h[0],h[1]),d<c)){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n}return c}function uo(t,e,i,n,r,o,s,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const d=i[u];c=ho(t,e,d,n,r,o,s,a,l,c,h),e=d}return c}function po(t,e,i,n){for(let r=0,o=i.length;r<o;++r)t[e++]=i[r];return e}function fo(t,e,i,n){for(let r=0,o=i.length;r<o;++r){const o=i[r];for(let i=0;i<n;++i)t[e++]=o[i]}return e}function go(t,e,i,n,r){r=r||[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=fo(t,e,i[s],n);r[o++]=a,e=a}return r.length=o,r}function mo(t,e,i,n,r,o,s){const a=(i-e)/n;if(a<3){for(;e<i;e+=n)o[s++]=t[e],o[s++]=t[e+1];return s}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[e,i-n];let h=0;for(;c.length>0;){const i=c.pop(),o=c.pop();let s=0;const a=t[o],u=t[o+1],d=t[i],p=t[i+1];for(let e=o+n;e<i;e+=n){const i=Ci(t[e],t[e+1],a,u,d,p);i>s&&(h=e,s=i)}s>r&&(l[(h-e)/n]=1,o+n<h&&c.push(o,h),h+n<i&&c.push(h,i))}for(let u=0;u<a;++u)l[u]&&(o[s++]=t[e+u*n],o[s++]=t[e+u*n+1]);return s}function _o(t,e){return e*Math.round(t/e)}function vo(t,e,i,n,r,o,s){if(e==i)return s;let a,l,c=_o(t[e],r),h=_o(t[e+1],r);e+=n,o[s++]=c,o[s++]=h;do{if(a=_o(t[e],r),l=_o(t[e+1],r),(e+=n)==i)return o[s++]=a,o[s++]=l,s}while(a==c&&l==h);for(;e<i;){const i=_o(t[e],r),u=_o(t[e+1],r);if(e+=n,i==a&&u==l)continue;const d=a-c,p=l-h,f=i-c,g=u-h;d*g==p*f&&(d<0&&f<d||d==f||d>0&&f>d)&&(p<0&&g<p||p==g||p>0&&g>p)?(a=i,l=u):(o[s++]=a,o[s++]=l,c=a,h=l,a=i,l=u)}return o[s++]=a,o[s++]=l,s}function yo(t,e,i,n,r,o,s,a){for(let l=0,c=i.length;l<c;++l){const c=i[l];s=vo(t,e,c,n,r,o,s),a.push(s),e=c}return s}function wo(t,e,i,n,r){r=void 0!==r?r:[];let o=0;for(let s=e;s<i;s+=n)r[o++]=t.slice(s,s+n);return r.length=o,r}function xo(t,e,i,n,r){r=void 0!==r?r:[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=i[s];r[o++]=wo(t,e,a,n,r[o]),e=a}return r.length=o,r}function bo(t,e,i,n,r){r=void 0!==r?r:[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=i[s];r[o++]=1===a.length&&a[0]===e?[]:xo(t,e,a,n,r[o]),e=a[a.length-1]}return r.length=o,r}function Co(t,e,i,n){let r=0,o=t[i-n],s=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];r+=s*i-o*n,o=i,s=n}return r/2}function To(t,e,i,n){let r=0;for(let o=0,s=i.length;o<s;++o){const s=i[o];r+=Co(t,e,s,n),e=s}return r}class So extends so{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new So(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<$e(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ho(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return Co(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new So(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fo(this.flatCoordinates,0,t,this.stride),this.changed()}}const ko=So;class Eo extends so{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Eo(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,o=Ti(t,e,r[0],r[1]);if(o<n){const t=this.stride;for(let e=0;e<t;++e)i[e]=r[e];return i.length=t,o}return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return Qe(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return We(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=po(this.flatCoordinates,0,t),this.changed()}}const Po=Eo;function Mo(t,e,i,n,r){return!si(r,function(r){return!Io(t,e,i,n,r[0],r[1])})}function Io(t,e,i,n,r,o){let s=0,a=t[i-n],l=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];l<=o?n>o&&(i-a)*(o-l)-(r-a)*(n-l)>0&&s++:n<=o&&(i-a)*(o-l)-(r-a)*(n-l)<0&&s--,a=i,l=n}return 0!==s}function Lo(t,e,i,n,r,o){if(0===i.length)return!1;if(!Io(t,e,i[0],n,r,o))return!1;for(let s=1,a=i.length;s<a;++s)if(Io(t,i[s-1],i[s],n,r,o))return!1;return!0}function Ao(t,e,i,n,r,o,s){let a,l,c,h,u,d,p;const f=r[o+1],g=[];for(let v=0,y=i.length;v<y;++v){const r=i[v];for(h=t[r-n],d=t[r-n+1],a=e;a<r;a+=n)u=t[a],p=t[a+1],(f<=d&&p<=f||d<=f&&f<=p)&&(c=(f-d)/(p-d)*(u-h)+h,g.push(c)),h=u,d=p}let m=NaN,_=-1/0;for(g.sort(Gt),h=g[0],a=1,l=g.length;a<l;++a){u=g[a];const r=Math.abs(u-h);r>_&&(c=(h+u)/2,Lo(t,e,i,n,c,f)&&(m=c,_=r)),h=u}return isNaN(m)&&(m=r[o]),s?(s.push(m,f,_),s):[m,f,_]}function Ro(t,e,i,n,r){let o=[];for(let s=0,a=i.length;s<a;++s){const a=i[s];o=Ao(t,e,a,n,r,2*s,o),e=a[a.length-1]}return o}function Oo(t,e,i,n,r){let o;for(e+=n;e<i;e+=n)if(o=r(t.slice(e-n,e),t.slice(e,e+n)),o)return o;return!1}function Fo(t,e,i,n,r){const o=ri([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!yi(r,o)&&(!!Xe(r,o)||o[0]>=r[0]&&o[2]<=r[2]||o[1]>=r[1]&&o[3]<=r[3]||Oo(t,e,i,n,function(t,e){return function(t,e,i){let n=!1;const r=He(t,e),o=He(t,i);if(1===r||1===o)n=!0;else{const s=t[0],a=t[1],l=t[2],c=t[3],h=i[0],u=i[1],d=(u-e[1])/(h-e[0]);let p,f;2&o&&!(2&r)&&(p=h-(u-c)/d,n=p>=s&&p<=l),n||!(4&o)||4&r||(f=u-(h-l)*d,n=f>=a&&f<=c),n||!(8&o)||8&r||(p=h-(u-a)/d,n=p>=s&&p<=l),n||!(16&o)||16&r||(f=u-(h-s)*d,n=f>=a&&f<=c)}return n}(r,t,e)}))}function Do(t,e,i,n,r){return!!(Fo(t,e,i,n,r)||Io(t,e,i,n,r[0],r[1])||Io(t,e,i,n,r[0],r[3])||Io(t,e,i,n,r[2],r[1])||Io(t,e,i,n,r[2],r[3]))}function Zo(t,e,i,n,r){if(!Do(t,e,i[0],n,r))return!1;if(1===i.length)return!0;for(let o=1,s=i.length;o<s;++o)if(Mo(t,i[o-1],i[o],n,r)&&!Fo(t,i[o-1],i[o],n,r))return!1;return!0}function No(t,e,i,n){for(;e<i-n;){for(let r=0;r<n;++r){const o=t[e+r];t[e+r]=t[i-n+r],t[i-n+r]=o}e+=n,i-=n}}function jo(t,e,i,n){let r=0,o=t[i-n],s=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];r+=(i-o)*(n+s),o=i,s=n}return 0===r?void 0:r>0}function Go(t,e,i,n,r){r=void 0!==r&&r;for(let o=0,s=i.length;o<s;++o){const s=i[o],a=jo(t,e,s,n);if(0===o){if(r&&a||!r&&!a)return!1}else if(r&&!a||!r&&a)return!1;e=s}return!0}function zo(t,e,i,n,r){r=void 0!==r&&r;for(let o=0,s=i.length;o<s;++o){const s=i[o],a=jo(t,e,s,n);(0===o?r&&a||!r&&!a:r&&!a||!r&&a)&&No(t,e,s,n),e=s}return e}function Vo(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o)e=zo(t,e,i[o],n,r);return e}class Bo extends so{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Bo(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<$e(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(co(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),uo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return Lo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return To(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),zo(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,xo(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=hi(this.getExtent());this.flatInteriorPoint_=Ao(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Po(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ko(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,s=i.length;o<s;++o){const s=i[o],a=new ko(e.slice(r,s),t);n.push(a),r=s}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Go(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=zo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=yo(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Bo(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return Zo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=go(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const qo=Bo;function Uo(t){const e=t[0],i=t[1],n=t[2],r=t[3],o=[e,i,e,r,n,r,n,i,e,i];return new Bo(o,"XY",[o.length])}function $o(t,e){setTimeout(function(){t(e)},0)}function Yo(t){return!(t.sourceCenter&&t.targetCenter&&!en(t.sourceCenter,t.targetCenter))&&t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}function Xo(t,e,i,n,r){const o=Math.cos(-r);let s=Math.sin(-r),a=t[0]*o-t[1]*s,l=t[1]*o+t[0]*s;return a+=(e[0]/2-i[0])*n,l+=(i[1]-e[1]/2)*n,s=-s,[a*o-l*s,l*o+a*s]}const Wo=class extends pe{constructor(t){super(),t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.projection_=Mr(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.nextCenter_=null,this.cancelAnchor_=void 0,t.projection&&br(),t.center&&(t.center=Zr(t.center)),t.extent&&(t.extent=jr(t.extent)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const s in nr)delete e[s];this.setProperties(e,!0);const i=function(t){let e,i,n,r=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28;const s=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,l=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,c=void 0!==t.showFullExtent&&t.showFullExtent,h=Mr(t.projection,"EPSG:3857"),u=h.getExtent();let d=t.constrainOnlyCenter,p=t.extent;if(a||p||!h.isGlobal()||(d=!1,p=u),void 0!==t.resolutions){const s=t.resolutions;i=s[r],n=void 0!==s[o]?s[o]:s[s.length-1],e=t.constrainResolution?function(t,e,i,n){return e=void 0===e||e,function(r,o,s,a){if(void 0!==r){const l=t[0],c=t[t.length-1],h=i?Ur(l,i,s,n):l;if(a)return e?$r(r,h,c):bi(r,c,h);const u=Math.min(h,r),d=Math.floor(zt(t,u,o));return t[d]>h&&d<t.length-1?t[d+1]:t[d]}}}(s,l,!d&&p,c):Yr(i,n,l,!d&&p,c)}else{const a=(u?Math.max(vi(u),fi(u)):360*rr.degrees/h.getMetersPerUnit())/256/Math.pow(2,0),f=a/Math.pow(2,28);i=t.maxResolution,void 0!==i?r=0:i=a/Math.pow(s,r),n=t.minResolution,void 0===n&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(s,o):a/Math.pow(s,o):f),o=r+Math.floor(Math.log(i/n)/Math.log(s)),n=i/Math.pow(s,o-r),e=t.constrainResolution?function(t,e,i,n,r,o){return n=void 0===n||n,i=void 0!==i?i:0,function(s,a,l,c){if(void 0!==s){const h=r?Ur(e,r,l,o):e;if(c)return n?$r(s,h,i):bi(s,i,h);const u=1e-9,d=Math.ceil(Math.log(e/h)/Math.log(t)-u),p=-a*(.5-u)+.5,f=Math.min(h,s),g=Math.floor(Math.log(e/f)/Math.log(t)+p),m=Math.max(d,g);return bi(e/Math.pow(t,m),i,h)}}}(s,i,n,l,!d&&p,c):Yr(i,n,l,!d&&p,c)}return{constraint:e,maxResolution:i,minResolution:n,minZoom:r,zoomFactor:s}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=function(t){if(void 0!==t.extent)return Br(t.extent,t.constrainOnlyCenter,void 0===t.smoothExtentConstraint||t.smoothExtentConstraint);const e=Mr(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Br(t,!1,!1)}return qr}(t),r=i.constraint,o=function(t){if(void 0===t.enableRotation||t.enableRotation){const i=t.constrainRotation;return void 0===i||!0===i?(e=e||Si(5),function(t,i){return i?t:void 0!==t?Math.abs(t)<=e?0:t:void 0}):!1===i?Wr:"number"==typeof i?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(i):Wr}return Xr;var e}(t);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution();this.setCenterInternal([i[0]+r/2*(n[3]-e[3]+e[1]-n[1]),i[1]-r/2*(n[0]-e[0]+e[2]-n[2])])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let t=arguments[i];t.center&&(t=Object.assign({},t),t.center=Zr(t.center,this.getProjection())),t.anchor&&(t=Object.assign({},t),t.anchor=Zr(t.anchor,this.getProjection())),e[i]=t}this.animateInternal.apply(this,e)}animateInternal(t){let e,i=arguments.length;i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i);let n=0;for(;n<i&&!this.isDef();++n){const t=arguments[n];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(n===i)return void(e&&$o(e,!0));let r=Date.now(),o=this.targetCenter_.slice(),s=this.targetResolution_,a=this.targetRotation_;const l=[];for(;n<i;++n){const t=arguments[n],i={start:r,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||Kr,callback:e};if(t.center&&(i.sourceCenter=o,i.targetCenter=t.center.slice(),o=i.targetCenter),void 0!==t.zoom?(i.sourceResolution=s,i.targetResolution=this.getResolutionForZoom(t.zoom),s=i.targetResolution):t.resolution&&(i.sourceResolution=s,i.targetResolution=t.resolution,s=i.targetResolution),void 0!==t.rotation){i.sourceRotation=a;const e=ki(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;i.targetRotation=a+e,a=i.targetRotation}Yo(i)?i.complete=!0:r+=i.duration,l.push(i)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const i=this.animations_[e];if(i[0].callback&&$o(i[0].callback,!1),!t)for(let e=0,n=i.length;e<n;++e){const n=i[e];if(!n.complete){t=n.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let i=0,o=n.length;i<o;++i){const o=n[i];if(o.complete)continue;const s=t-o.start;let a=o.duration>0?s/o.duration:1;a>=1?(o.complete=!0,a=1):r=!1;const l=o.easing(a);if(o.sourceCenter){const t=o.sourceCenter[0],e=o.sourceCenter[1],i=o.targetCenter[0],n=o.targetCenter[1];this.nextCenter_=o.targetCenter,this.targetCenter_=[t+l*(i-t),e+l*(n-e)]}if(o.sourceResolution&&o.targetResolution){const t=1===l?o.targetResolution:o.sourceResolution+l*(o.targetResolution-o.sourceResolution);if(o.anchor){const e=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,o.anchor)}this.nextResolution_=o.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==o.sourceRotation&&void 0!==o.targetRotation){const t=1===l?ki(o.targetRotation+Math.PI,2*Math.PI)-Math.PI:o.sourceRotation+l*(o.targetRotation-o.sourceRotation);if(o.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,o.anchor)}this.nextRotation_=o.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!o.complete)break}if(r){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=n[0].callback;t&&$o(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return void 0!==n&&(i=[n[0]-e[0],n[1]-e[1]],nn(i,t-this.getRotation()),tn(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),r=this.getResolution();return void 0!==n&&void 0!==r&&(i=[e[0]-t*(e[0]-n[0])/r,e[1]-t*(e[1]-n[1])/r]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t?Dr(t,this.getProjection()):t}getCenterInternal(){return this.get(nr.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return Nr(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();_e(e,1);const i=this.getResolution();_e(void 0!==i,2);const n=this.getRotation();return _e(void 0!==n,3),di(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(nr.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(jr(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=vi(t)/e[0],n=fi(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=Math.log(e/this.minResolution_)/Math.log(t);return function(n){return e/Math.pow(t,n*i)}}getRotation(){return this.get(nr.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=Math.log(i/this.minResolution_)/e;return function(t){return Math.log(i/t)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const t=this.getViewportSizeMinusPadding_();n=Xo(n,this.getViewportSize_(),[t[0]/2+r[3],t[1]/2+r[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,n=this.minZoom_||0;if(this.resolutions_){const r=zt(this.resolutions_,t,1);n=r,e=this.resolutions_[r],i=r==this.resolutions_.length-1?2:e/this.resolutions_[r+1]}else e=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=bi(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],bi(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(_e(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))_e(!wi(t),25),i=Uo(jr(t,this.getProjection()));else if("Circle"===t.getType()){const e=jr(t.getExtent(),this.getProjection());i=Uo(e),i.rotate(this.getRotation(),hi(e))}else{const e=null;i=e?t.clone().transform(e,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let s=1/0,a=1/0,l=-1/0,c=-1/0;for(let h=0,u=r.length;h<u;h+=o){const t=r[h]*i-r[h+1]*n,e=r[h]*n+r[h+1]*i;s=Math.min(s,t),a=Math.min(a,e),l=Math.max(l,t),c=Math.max(c,e)}return[s,a,l,c]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const n=void 0!==e.padding?e.padding:[0,0,0,0],r=void 0!==e.nearest&&e.nearest;let o;o=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const s=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(s,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);a=isNaN(a)?o:Math.max(a,o),a=this.getConstrainedResolution(a,r?0:1);const l=this.getRotation(),c=Math.sin(l),h=Math.cos(l),u=hi(s);u[0]+=(n[1]-n[3])/2*a,u[1]+=(n[0]-n[2])/2*a;const d=this.getConstrainedCenter([u[0]*h-u[1]*c,u[1]*h+u[0]*c],a),p=e.callback?e.callback:Yt;void 0!==e.duration?this.animateInternal({resolution:a,center:d,duration:e.duration,easing:e.easing},p):(this.targetResolution_=a,this.targetCenter_=d,this.applyTargetState_(!1,!0),$o(p,!0))}centerOn(t,e,i){this.centerOnInternal(Zr(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Xo(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let r;const o=this.padding_;if(o&&t){const s=this.getViewportSizeMinusPadding_(-i),a=Xo(t,n,[s[0]/2+o[3],s[1]/2+o[0]],e,i);r=[t[0]-a[0],t[1]-a[1]]}return r}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=Dr(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Zr(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Zr(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t?Zr(t,this.getProjection()):t)}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),s=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(nr.ROTATION)!==n&&this.set(nr.ROTATION,n),this.get(nr.RESOLUTION)!==o&&(this.set(nr.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),s&&this.get(nr.CENTER)&&en(this.get(nr.CENTER),s)||this.set(nr.CENTER,s),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const n=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),s=this.constraints_.resolution(this.targetResolution_,n,o),a=this.constraints_.center(this.targetCenter_,s,o,!1,this.calculateCenterShift(this.targetCenter_,s,r,o));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=s,this.targetRotation_=r,this.targetCenter_=a,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===r&&this.getCenterInternal()&&en(this.getCenterInternal(),a)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:a,resolution:s,duration:t,easing:Jr,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&Zr(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}},Ho=class extends pe{constructor(t){super();const e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){yn(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&yn(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)se(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Yt&&this.listenerKeys.push(re(t,Wn,this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},Jo=class extends Ho{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",n=void 0!==t.expandClassName?t.expandClassName:e+"-expand",r=void 0!==t.collapseLabel?t.collapseLabel:"\u203a",o=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse";"string"==typeof r?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const s=void 0!==t.label?t.label:"i";"string"==typeof s?(this.label_=document.createElement("span"),this.label_.textContent=s,this.label_.className=n):this.label_=s;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(Qt,this.handleClick_.bind(this),!1);const l=this.element;l.className=e+" ol-unselectable "+hn+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),l.appendChild(this.toggleButton_),l.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const r=t.layerStatesArray;for(let o=0,s=r.length;o<s;++o){const s=r[o];if(!Ki(s,t.viewState))continue;const a=s.layer.getSource();if(!a)continue;const l=a.getAttributions();if(!l)continue;const c=l(t);if(c)if(n=n&&!1!==a.getAttributionsCollapsible(),Array.isArray(c))for(let t=0,n=c.length;t<n;++t)c[t]in e||(i.push(c[t]),e[c[t]]=!0);else c in e||(i.push(c),e[c]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!qt(e,this.renderedAttributions_)){wn(this.ulElement_);for(let t=0,i=e.length;t<i;++t){const i=document.createElement("li");i.innerHTML=e[t],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?vn(this.collapseLabel_,this.label_):vn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},Ko=class extends Ho{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"\u21e7",n=void 0!==t.compassClassName?t.compassClassName:"ol-compass";this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(Qt,this.handleClick_.bind(this),!1);const s=this.element;s.className=e+" ol-unselectable "+hn,s.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(cn)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Jr}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const t="rotate("+i+"rad)";if(this.autoHide_){const t=this.element.classList.contains(cn);t||0!==i?t&&0!==i&&this.element.classList.remove(cn):this.element.classList.add(cn)}this.label_.style.transform=t}this.rotation_=i}},Qo=class extends Ho{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,n=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",r=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",o=void 0!==t.zoomInLabel?t.zoomInLabel:"+",s=void 0!==t.zoomOutLabel?t.zoomOutLabel:"\u2013",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",l=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=a,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener(Qt,this.handleClick_.bind(this,i),!1);const h=document.createElement("button");h.className=r,h.setAttribute("type","button"),h.title=l,h.appendChild("string"==typeof s?document.createTextNode(s):s),h.addEventListener(Qt,this.handleClick_.bind(this,-i),!1);const u=this.element;u.className=e+" ol-unselectable "+hn,u.appendChild(c),u.appendChild(h),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(void 0!==i){const n=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:Jr})):e.setZoom(n)}}};function ts(t){t=t||{};const e=new Te;return(void 0===t.zoom||t.zoom)&&e.push(new Qo(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new Ko(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new Jo(t.attributionOptions)),e}const es="active";function is(t,e,i,n){const r=t.getZoom();if(void 0===r)return;const o=t.getConstrainedZoom(r+e),s=t.getResolutionForZoom(o);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:s,anchor:i,duration:void 0!==n?n:250,easing:Jr})}const ns=class extends pe{constructor(t){super(),t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(es)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(es,t)}setMap(t){this.map_=t}},rs=class extends ns{constructor(t){super(),this.delta_=(t=t||{}).delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==$n.DBLCLICK){const i=t.originalEvent,n=t.coordinate,r=i.shiftKey?-this.delta_:this.delta_;is(t.map.getView(),r,n,this.duration_),i.preventDefault(),e=!0}return!e}};function os(t){const e=t.length;let i=0,n=0;for(let r=0;r<e;r++)i+=t[r].clientX,n+=t[r].clientY;return[i/e,n/e]}const ss=class extends ns{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==$n.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==$n.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==$n.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==$n.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function as(t){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),i);++n);return i}}const ls=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},cs=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){const e=t.map.getTargetElement(),i=t.map.getOwnerDocument().activeElement;return e.contains(i)}(t)},hs=Ut,us=function(t){const e=t.originalEvent;return 0==e.button&&!(Ee&&Pe&&e.ctrlKey)},ds=$t,ps=function(t){return"pointermove"==t.type},fs=function(t){return t.type==$n.SINGLECLICK},gs=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ms=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},_s=function(t){const e=t.originalEvent,i=e.target.tagName;return"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i&&!e.target.isContentEditable},vs=function(t){const e=t.originalEvent;return _e(void 0!==e,56),"mouse"==e.pointerType},ys=function(t){const e=t.originalEvent;return _e(void 0!==e,56),e.isPrimary&&0===e.button},ws=class extends ss{constructor(t){super({stopDown:$t}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.panning_=!1;const e=t.condition?t.condition:as(gs,ys);this.condition_=t.onFocusOnly?as(cs,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=os(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const e=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],n=t.map.getView();rn(e,n.getResolution()),nn(e,n.getRotation()),n.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),r=i.getCenterInternal(),o=e.getPixelFromCoordinateInternal(r),s=e.getCoordinateFromPixelInternal([o[0]-t*Math.cos(n),o[1]-t*Math.sin(n)]);i.animateInternal({center:i.getConstrainedCenter(s),duration:500,easing:Jr})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},xs=class extends ss{constructor(t){t=t||{},super({stopDown:$t}),this.condition_=t.condition?t.condition:ls,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!vs(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Xr)return;const n=e.getSize(),r=t.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(o-this.lastAngle_)),this.lastAngle_=o}handleUpEvent(t){return!vs(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!(!vs(t)||!us(t)||!this.condition_(t)||(t.map.getView().beginInteraction(),this.lastAngle_=void 0,0))}},bs=class extends jt{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new qo([i])}getGeometry(){return this.geometry_}};class Cs extends Zt{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Ts=class extends ss{constructor(t){super(),this.box_=new bs((t=t||{}).className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:us,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Cs("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Cs(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Cs("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Ss=class extends Ts{constructor(t){super({condition:(t=t||{}).condition?t.condition:ms,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(i),n=e.getResolutionForExtentInternal(t),r=e.getResolution()/n;i=i.clone(),i.scale(r*r)}e.fitInternal(i,{duration:this.duration_,easing:Jr})}},ks=class extends ns{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return gs(t)&&_s(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==te){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(40==n||37==n||39==n||38==n)){const r=t.map.getView(),o=r.getResolution()*this.pixelDelta_;let s=0,a=0;40==n?a=-o:37==n?s=-o:39==n?s=o:a=o;const l=[s,a];nn(l,r.getRotation()),function(t,e,i){const n=t.getCenterInternal();n&&t.animateInternal({duration:void 0!==i?i:250,easing:Qr,center:t.getConstrainedCenter([n[0]+e[0],n[1]+e[1]])})}(r,l,this.duration_),i.preventDefault(),e=!0}}return!e}},Es=class extends ns{constructor(t){super(),this.condition_=(t=t||{}).condition?t.condition:_s,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(t.type==te||t.type==ee){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n=="+".charCodeAt(0)||n=="-".charCodeAt(0))){const r=t.map,o=n=="+".charCodeAt(0)?this.delta_:-this.delta_;is(r.getView(),o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Ps=class extends ns{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:hs;this.condition_=t.onFocusOnly?as(cs,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;if(t.type!==ne)return!0;const e=t.map,i=t.originalEvent;let n;if(i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==ne&&(n=i.deltaY,ke&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(n/=Me),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),0===n)return!1;this.lastDelta_=n;const r=Date.now();void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?"trackpad":"wheel");const o=e.getView();if("trackpad"===this.mode_&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1;this.totalDelta_+=n;const s=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),s),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-bi(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),is(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Ms=class extends ss{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=$t),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=r-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=r;const o=t.map,s=o.getView();if(s.getConstraints().rotation===Xr)return;const a=o.getViewport().getBoundingClientRect(),l=os(this.targetPointers);l[0]-=a.left,l[1]-=a.top,this.anchor_=o.getCoordinateFromPixelInternal(l),this.rotating_&&(o.render(),s.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},Is=class extends ss{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=$t),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,s=Math.sqrt(r*r+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/s),this.lastDistance_=s;const a=t.map,l=a.getView();1!=e&&(this.lastScaleDelta_=e);const c=a.getViewport().getBoundingClientRect(),h=os(this.targetPointers);h[0]-=c.left,h[1]-=c.top,this.anchor_=a.getCoordinateFromPixelInternal(h),a.render(),l.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function Ls(t){t=t||{};const e=new Te,i=new class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new xs),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new rs({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new ws({onFocusOnly:t.onFocusOnly,kinetic:i})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new Ms),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new Is({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new ks),e.push(new Es({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new Ps({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new Ss({duration:t.zoomDuration})),e}function As(t){return t[0]>0&&t[1]>0}function Rs(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function Os(t){t instanceof Qi?t.setMapInternal(null):t instanceof Bn&&t.getLayers().forEach(Os)}function Fs(t,e){if(t instanceof Qi)t.setMapInternal(e);else if(t instanceof Bn){const i=t.getLayers().getArray();for(let t=0,n=i.length;t<n;++t)Fs(i[t],e)}}const Ds=class extends pe{constructor(t){super();const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const i={},n=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Bn({layers:t.layers});let r,o,s;return i.layergroup=n,i.target=t.target,i.view=t.view instanceof Wo?t.view:new Wo,void 0!==t.controls&&(Array.isArray(t.controls)?r=new Te(t.controls.slice()):(_e("function"==typeof t.controls.getArray,47),r=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?o=new Te(t.interactions.slice()):(_e("function"==typeof t.interactions.getArray,48),o=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?s=new Te(t.overlays.slice()):(_e("function"==typeof t.overlays.getArray,49),s=t.overlays):s=new Te,{controls:r,interactions:o,keyboardEventTarget:e,overlays:s,values:i}}(t=t||{});this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Me,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||ts(),this.interactions=e.interactions||Ls({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new class extends class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Xt(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){_e(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=ir&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,r=e[t],o=i[t],s=t;for(;t<n>>1;){const r=this.getLeftChildIndex_(t),o=this.getRightChildIndex_(t),s=o<n&&i[o]<i[r]?o:r;e[t]=e[s],i[t]=i[s],t=s}e[t]=r,i[t]=o,this.siftDown_(s,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,r=i[e],o=n[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(n[t]>o))break;i[e]=i[t],n[e]=n[t],e=t}i[e]=r,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const r=e.length;let o,s,a;for(s=0;s<r;++s)o=e[s],a=t(o),a==ir?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=a,e[n++]=o);e.length=n,i.length=n,this.heapify_()}}{constructor(t,e){super(function(e){return t.apply(null,e)},function(t){return t[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Jt,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener(Jt,this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,n,r,o=0;for(;this.tilesLoading_<t&&o<e&&this.getCount()>0;)n=this.dequeue()[0],r=n.getKey(),i=n.getState(),0!==i||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++o,n.load())}}(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Kn,this.handleLayerGroupChanged_),this.addChangeListener(er,this.handleViewChanged_),this.addChangeListener(Qn,this.handleSizeChanged_),this.addChangeListener(tr,this.handleTargetChanged_),this.setProperties(e.values);const i=this;!t.view||t.view instanceof Wo||t.view.then(function(t){i.setView(new Wo(t))}),this.controls.addEventListener(we,(function(t){t.element.setMap(this)}).bind(this)),this.controls.addEventListener(xe,(function(t){t.element.setMap(null)}).bind(this)),this.interactions.addEventListener(we,(function(t){t.element.setMap(this)}).bind(this)),this.interactions.addEventListener(xe,(function(t){t.element.setMap(null)}).bind(this)),this.overlays_.addEventListener(we,(function(t){this.addOverlayInternal_(t.element)}).bind(this)),this.overlays_.addEventListener(xe,(function(t){const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}).bind(this)),this.controls.forEach((function(t){t.setMap(this)}).bind(this)),this.interactions.forEach((function(t){t.setMap(this)}).bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Fs(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:Ut,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(t){i.push(t)},e),i}getAllLayers(){const t=[];return function e(i){i.forEach(function(i){i instanceof Bn?e(i.getLayers()):t.push(i)})}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:Ut,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(tr)}getTargetElement(){const t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null}getCoordinateFromPixel(t){return Dr(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Ze(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Kn)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Te)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e];if(!i.visible)continue;const n=i.layer.getRenderer();if(n&&!n.ready)return!0;const r=i.layer.getSource();if(r&&r.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Zr(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Ze(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Qn)}getView(){return this.get(er)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return function(t,e,i,n,r){if(!t||!(i in t.wantedTiles))return ir;if(!t.wantedTiles[i][e.getKey()])return ir;const o=t.viewState.center,s=n[0]-o[0],a=n[1]-o[1];return 65536*Math.log(r)+Math.sqrt(s*s+a*a)/r}(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){const i=new Un(e=e||t.type,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===Yn||i===ne||i===te){const t=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():t,n=e.target;if(this.overlayContainerStopEvent_.contains(n)||!(i===t?t.documentElement:i).contains(n))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const e=this.getInteractions().getArray().slice();for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.getMap()===this&&n.getActive()&&this.getTargetElement()&&(!n.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,n=i;if(t){const e=t.viewHints;if(e[0]||e[1]){const e=Date.now()-t.time>8;i=e?0:8,n=e?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,n))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(Ji)&&this.renderer_.dispatchRenderEvent(Ji,t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new qn(Jn,this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new qn(Hn,this,t))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)se(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Kt,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ne,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,yn(this.viewport_)}const t=this.getTargetElement();if(t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new jn(this)),this.mapBrowserEventHandler_=new Xn(this,this.moveTolerance_);for(const t in $n)this.mapBrowserEventHandler_.addEventListener($n[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Kt,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ne,this.boundHandleBrowserEvent_,!!Ae&&{passive:!1});const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[re(i,te,this.handleBrowserEvent,this),re(i,ee,this.handleBrowserEvent,this),re(e,"resize",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(se(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(se(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=re(t,Nt,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=re(t,Jt,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(se),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Gn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[re(t,Nt,this.render,this),re(t,Jt,this.render,this),re(t,"addlayer",this.handleLayerAdd_,this),re(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Os(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(void 0!==e&&As(e)&&i&&i.isDef()){const n=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:di(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:o,viewHints:n,wantedTiles:{},mapId:ue(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const t=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=di(o.nextCenter,o.nextResolution,t,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!wi(this.previousExtent_)&&!ei(r.extent,this.previousExtent_))&&(this.dispatchEvent(new qn("movestart",this,n)),this.previousExtent_=Ke(this.previousExtent_)),this.previousExtent_&&!r.viewHints[0]&&!r.viewHints[1]&&!ei(r.extent,this.previousExtent_)&&(this.dispatchEvent(new qn("moveend",this,r)),Ue(r.extent,this.previousExtent_))),this.dispatchEvent(new qn(Wn,this,r)),this.renderComplete_=this.hasListener(Hn)||this.hasListener(Jn)||this.hasListener(Ji)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Gn("removelayer",e)),this.set(Kn,t)}setSize(t){this.set(Qn,t)}setTarget(t){this.set(tr,t)}setView(t){if(!t||t instanceof Wo)return void this.set(er,t);this.set(er,new Wo);const e=this;t.then(function(t){e.setView(new Wo(t))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),r=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);isNaN(n)||isNaN(r)||(e=[n,r],!As(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}};var Zs=i(9657);class Ns{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Rs(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ns({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ce()}getImage(t){return ce()}getHitDetectionImage(){return ce()}getPixelRatio(t){return 1}getImageState(){return ce()}getImageSize(){return ce()}getOrigin(){return ce()}getSize(){return ce()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Rs(t)}listenImageChange(t){ce()}load(){ce()}unlistenImageChange(t){ce()}}const js=Ns;function Gs(t){return Array.isArray(t)?Zi(t):t}class zs extends js{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new zs({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=fn(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let n=this.radius_,r=void 0===this.radius2_?n:this.radius2_;if(n<r){const t=n;n=r,r=t}const o=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),s=r*Math.sin(o),a=n-Math.sqrt(r*r-s*s),l=Math.sqrt(s*s+a*a),c=l/s;if("miter"===t&&c<=i)return c*e;const h=e/2/c,u=e/2*(a/l),d=Math.sqrt((n+h)*(n+h)+u*u)-n;if(void 0===this.radius2_||"bevel"===t)return 2*d;const p=n*Math.sin(o),f=r-Math.sqrt(n*n-p*p),g=Math.sqrt(p*p+f*f)/p;return g<=i?2*Math.max(d,g*e/2-r-n):2*d}createRenderOptions(){let t,e=Sn,i=0,n=null,r=0,o=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t=kn),t=Gs(t),o=this.stroke_.getWidth(),void 0===o&&(o=1),n=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=Sn),i=this.stroke_.getMiterLimit(),void 0===i&&(i=10));const s=this.calculateLineJoinSize_(e,o,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:o,size:Math.ceil(2*a+s),lineDash:n,lineDashOffset:r,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=bn),e.fillStyle=Gs(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=Fi(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=fn(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let s=0;s<e;s++){const e=r+s*o,a=s%2==0?i:n;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=bn,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}const Vs=zs;class Bs extends Vs{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Bs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const qs=Bs;class Us{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){const t=this.getColor();return new Us({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const $s=Us;class Ys{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ys({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const Xs=Ys;class Ws{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Ks,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new Ws({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ks,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let Hs=null;function Js(t,e){if(!Hs){const t=new $s({color:"rgba(255,255,255,0.4)"}),e=new Xs({color:"#3399CC",width:1.25});Hs=[new Ws({image:new qs({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Hs}function Ks(t){return t.getGeometry()}const Qs=Ws;function ta(t,e,i){const n=t;let r=!0,o=!1,s=!1;const a=[oe(n,"load",function(){s=!0,o||e()})];return n.src&&Le?(o=!0,n.decode().then(function(){r&&e()}).catch(function(t){r&&(s?e():i())})):a.push(oe(n,"error",i)),function(){r=!1,a.forEach(se)}}let ea=null;class ia extends Ht{constructor(t,e,i,n,r,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=i,this.src_=e}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){ea||(ea=fn(1,1)),ea.drawImage(this.image_,0,0);try{ea.getImageData(0,0,1,1),this.tainted_=!1}catch(wm){ea=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(Jt)}handleImageError_(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=fn(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{this.image_.src=this.src_}catch(wm){this.handleImageError_()}this.unlisten_=ta(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||2!==this.imageState_)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Ri(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class na extends js{constructor(t){super({opacity:void 0!==(t=t||{}).opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const e=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let i=t.src;_e(!(void 0!==i&&e),4),_e(!e||e&&this.imgSize_,5),void 0!==i&&0!==i.length||!e||(i=e.src||ue(e)),_e(void 0!==i&&i.length>0,6);const n=void 0!==t.src?0:2;this.color_=void 0!==t.color?Fi(t.color):null,this.iconImage_=function(t,e,i,n,r,o){let s=ji.get(e,n,o);return s||(s=new ia(t,e,i,n,r,o),ji.set(e,n,o,s)),s}(e,i,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,n,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null}clone(){const t=this.getScale();return new na({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=e[0]),"fraction"==this.anchorYUnits_&&(t[1]*=e[1])}if("top-left"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+e[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if("top-left"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(Jt,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Jt,t)}}const ra=na;class oa{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Rs(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new $s({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new oa({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Rs(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const sa=oa;function aa(t){return new Qs({fill:la(t,""),stroke:ca(t,""),text:ha(t),image:ua(t)})}function la(t,e){const i=t[e+"fill-color"];if(i)return new $s({color:i})}function ca(t,e){const i=t[e+"stroke-width"],n=t[e+"stroke-color"];if(i||n)return new Xs({width:i,color:n,lineCap:t[e+"stroke-line-cap"],lineJoin:t[e+"stroke-line-join"],lineDash:t[e+"stroke-line-dash"],lineDashOffset:t[e+"stroke-line-dash-offset"],miterLimit:t[e+"stroke-miter-limit"]})}function ha(t){const e=t["text-value"];if(e)return new sa({text:e,font:t["text-font"],maxAngle:t["text-max-angle"],offsetX:t["text-offset-x"],offsetY:t["text-offset-y"],overflow:t["text-overflow"],placement:t["text-placement"],scale:t["text-scale"],rotateWithView:t["text-rotate-with-view"],rotation:t["text-rotation"],textAlign:t["text-align"],justify:t["text-justify"],textBaseline:t["text-baseline"],padding:t["text-padding"],fill:la(t,"text-"),backgroundFill:la(t,"text-background-"),stroke:ca(t,"text-"),backgroundStroke:ca(t,"text-background-")})}function ua(t){const e=t["icon-src"],i=t["icon-img"];if(e||i)return new ra({src:e,img:i,imgSize:t["icon-img-size"],anchor:t["icon-anchor"],anchorOrigin:t["icon-anchor-origin"],anchorXUnits:t["icon-anchor-x-units"],anchorYUnits:t["icon-anchor-y-units"],color:t["icon-color"],crossOrigin:t["icon-cross-origin"],offset:t["icon-offset"],displacement:t["icon-displacement"],opacity:t["icon-opacity"],scale:t["icon-scale"],rotation:t["icon-rotation"],rotateWithView:t["icon-rotate-with-view"],size:t["icon-size"],declutterMode:t["icon-declutter-mode"]});const n=t["shape-points"];if(n){const e="shape-";return new Vs({points:n,fill:la(t,e),stroke:ca(t,e),radius:t["shape-radius"],radius1:t["shape-radius1"],radius2:t["shape-radius2"],angle:t["shape-angle"],displacement:t["shape-displacement"],rotation:t["shape-rotation"],rotateWithView:t["shape-rotate-with-view"],scale:t["shape-scale"],declutterMode:t["shape-declutter-mode"]})}const r=t["circle-radius"];if(r){const e="circle-";return new qs({radius:r,fill:la(t,e),stroke:ca(t,e),displacement:t["circle-displacement"],scale:t["circle-scale"],rotation:t["circle-rotation"],rotateWithView:t["circle-rotate-with-view"],declutterMode:t["circle-declutter-mode"]})}}const da="renderOrder",pa=class extends Qi{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(da)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new Zs(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(da,t)}setStyle(t){let e;if(void 0===t)e=Js;else if(null===t)e=null;else if("function"==typeof t)e=t;else if(t instanceof Qs)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let e=0;e<i;++e){const i=t[e];n[e]=i instanceof Qs?i:aa(i)}e=n}else e=aa(t);this.style_=e,this.styleFunction_=null===t?void 0:function(t){let e;if("function"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(_e("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}},fa={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ga=[fa.FILL],ma=[fa.STROKE],_a=[fa.BEGIN_PATH],va=[fa.CLOSE_PATH],ya=fa,wa=class{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},xa=class extends wa{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let s=0,a=t.length;s<a;s+=e)n[0]=t[s],n[1]=t[s+1],Ye(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,r,o){const s=this.coordinates;let a=s.length;const l=this.getBufferedMaxExtent();o&&(e+=n);let c=t[e],h=t[e+1];const u=this.tmpCoordinate_;let d,p,f,g=!0;for(d=e+n;d<i;d+=n)u[0]=t[d],u[1]=t[d+1],f=He(l,u),f!==p?(g&&(s[a++]=c,s[a++]=h,g=!1),s[a++]=u[0],s[a++]=u[1]):1===f?(s[a++]=u[0],s[a++]=u[1],g=!1):g=!0,c=u[0],h=u[1],p=f;return(r&&g||d===e+n)&&(s[a++]=c,s[a++]=h),a}drawCustomCoordinates_(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){const s=i[o],a=this.appendFlatLineCoordinates(t,e,s,n,!1,!1);r.push(a),e=s}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const r=t.getType(),o=t.getStride(),s=this.coordinates.length;let a,l,c,h,u;switch(r){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),h=[];const e=t.getEndss();u=0;for(let t=0,i=e.length;t<i;++t){const i=[];u=this.drawCustomCoordinates_(a,u,e[t],o,i),h.push(i)}this.instructions.push([ya.CUSTOM,s,h,t,i,bo]),this.hitDetectionInstructions.push([ya.CUSTOM,s,h,t,n||i,bo]);break;case"Polygon":case"MultiLineString":c=[],a="Polygon"==r?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),o,c),this.instructions.push([ya.CUSTOM,s,c,t,i,xo]),this.hitDetectionInstructions.push([ya.CUSTOM,s,c,t,n||i,xo]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(a,0,a.length,o,!1,!1),this.instructions.push([ya.CUSTOM,s,l,t,i,wo]),this.hitDetectionInstructions.push([ya.CUSTOM,s,l,t,n||i,wo]);break;case"MultiPoint":a=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(a,o),l>s&&(this.instructions.push([ya.CUSTOM,s,l,t,i,wo]),this.hitDetectionInstructions.push([ya.CUSTOM,s,l,t,n||i,wo]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),l=this.coordinates.length,this.instructions.push([ya.CUSTOM,s,l,t,i]),this.hitDetectionInstructions.push([ya.CUSTOM,s,l,t,n||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[ya.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ya.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,r,o=-1;for(e=0;e<i;++e)n=t[e],r=n[0],r==ya.END_GEOMETRY?o=e:r==ya.BEGIN_GEOMETRY&&(n[2]=e,Vt(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillStyle=Gs(e||bn)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=Gs(t||kn);const n=e.getLineCap();i.lineCap=void 0!==n?n:Cn;const r=e.getLineDash();i.lineDash=r?r.slice():Tn;const o=e.getLineDashOffset();i.lineDashOffset=o||0;const s=e.getLineJoin();i.lineJoin=void 0!==s?s:Sn;const a=e.getWidth();i.lineWidth=void 0!==a?a:1;const l=e.getMiterLimit();i.miterLimit=void 0!==l?l:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[ya.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ya.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!qt(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ya.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ue(this.maxExtent),this.maxLineWidth>0)&&qe(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_}},ba=class extends xa{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const r=this.state,o=void 0!==r.fillStyle,s=void 0!==r.strokeStyle,a=i.length;this.instructions.push(_a),this.hitDetectionInstructions.push(_a);for(let l=0;l<a;++l){const r=i[l],o=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,r,n,!0,!s),c=[ya.MOVE_TO_LINE_TO,o,a];this.instructions.push(c),this.hitDetectionInstructions.push(c),s&&(this.instructions.push(va),this.hitDetectionInstructions.push(va)),e=r}return o&&(this.instructions.push(ga),this.hitDetectionInstructions.push(ga)),s&&(this.instructions.push(ma),this.hitDetectionInstructions.push(ma)),e}drawCircle(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([ya.SET_FILL_STYLE,bn]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([ya.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length;this.appendFlatLineCoordinates(n,0,n.length,r,!1,!1);const s=[ya.CIRCLE,o];this.instructions.push(_a,s),this.hitDetectionInstructions.push(_a,s),void 0!==i.fillStyle&&(this.instructions.push(ga),this.hitDetectionInstructions.push(ga)),void 0!==i.strokeStyle&&(this.instructions.push(ma),this.hitDetectionInstructions.push(ma)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([ya.SET_FILL_STYLE,bn]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([ya.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getEnds(),r=t.getOrientedFlatCoordinates(),o=t.getStride();this.drawFlatCoordinatess_(r,0,n,o),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([ya.SET_FILL_STYLE,bn]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([ya.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getEndss(),r=t.getOrientedFlatCoordinates(),o=t.getStride();let s=0;for(let a=0,l=n.length;a<l;++a)s=this.drawFlatCoordinatess_(r,s,n[a],o);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=_o(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function Ca(t,e,i,n,r){let o,s,a,l,c,h,u,d,p,f,g=i,m=i,_=0,v=0,y=i;for(s=i;s<n;s+=r){const i=e[s],n=e[s+1];void 0!==c&&(p=i-c,f=n-h,l=Math.sqrt(p*p+f*f),void 0!==u&&(v+=a,o=Math.acos((u*p+d*f)/(a*l)),o>t&&(v>_&&(_=v,g=y,m=s),v=0,y=s-r)),a=l,u=p,d=f),c=i,h=n}return v+=l,v>_?[y,s]:[g,m]}const Ta={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Sa={Circle:ba,Default:xa,Image:class extends xa{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([ya.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ya.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([ya.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ya.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends xa{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),s=[ya.MOVE_TO_LINE_TO,r,o];return this.instructions.push(s),this.hitDetectionInstructions.push(s),i}drawLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ya.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Tn,0],_a);const n=t.getFlatCoordinates(),r=t.getStride();this.drawFlatCoordinates_(n,0,n.length,r),this.hitDetectionInstructions.push(ma),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ya.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],_a);const n=t.getEnds(),r=t.getFlatCoordinates(),o=t.getStride();let s=0;for(let a=0,l=n.length;a<l;++a)s=this.drawFlatCoordinates_(r,s,n[a],o);this.hitDetectionInstructions.push(ma),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ma),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ma),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(_a)}},Polygon:ba,Text:class extends xa{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textState_;if(""===this.text_||!i||!this.textFillState_&&!this.textStrokeState_)return;const n=this.coordinates;let r=n.length;const o=t.getType();let s=null,a=t.getStride();if("line"!==i.placement||"LineString"!=o&&"MultiLineString"!=o&&"Polygon"!=o&&"MultiPolygon"!=o){let l=i.overflow?null:[];switch(o){case"Point":case"MultiPoint":s=t.getFlatCoordinates();break;case"LineString":s=t.getFlatMidpoint();break;case"Circle":s=t.getCenter();break;case"MultiLineString":s=t.getFlatMidpoints(),a=2;break;case"Polygon":s=t.getFlatInteriorPoint(),i.overflow||l.push(s[2]/this.resolution),a=3;break;case"MultiPolygon":const e=t.getFlatInteriorPoints();s=[];for(let t=0,n=e.length;t<n;t+=3)i.overflow||l.push(e[t+2]/this.resolution),s.push(e[t],e[t+1]);if(0===s.length)return;a=2}const c=this.appendFlatPointCoordinates(s,a);if(c===r)return;if(l&&(c-r)/2!=s.length/a){let t=r/2;l=l.filter((e,i)=>{const r=n[2*(t+i)]===s[i*a]&&n[2*(t+i)+1]===s[i*a+1];return r||--t,r})}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let h=i.padding;if(h!=Mn&&(i.scale[0]<0||i.scale[1]<0)){let t=i.padding[0],e=i.padding[1],n=i.padding[2],r=i.padding[3];i.scale[0]<0&&(e=-e,r=-r),i.scale[1]<0&&(t=-t,n=-n),h=[t,e,n,r]}const u=this.pixelRatio;this.instructions.push([ya.DRAW_IMAGE,r,c,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,h==Mn?Mn:h.map(function(t){return t*u}),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]);const d=1/u;this.hitDetectionInstructions.push([ya.DRAW_IMAGE,r,c,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[d,d],NaN,void 0,this.declutterImageWithText_,h,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]),this.endGeometry(e)}else{if(!yi(this.getBufferedMaxExtent(),t.getExtent()))return;let l;if(s=t.getFlatCoordinates(),"LineString"==o)l=[s.length];else if("MultiLineString"==o)l=t.getEnds();else if("Polygon"==o)l=t.getEnds().slice(0,1);else if("MultiPolygon"==o){const e=t.getEndss();l=[];for(let t=0,i=e.length;t<i;++t)l.push(e[t][0])}this.beginGeometry(t,e);const c=i.textAlign;let h,u=0;for(let t=0,e=l.length;t<e;++t){if(null==c){const e=Ca(i.maxAngle,s,u,l[t],a);u=e[0],h=e[1]}else h=l[t];for(let t=u;t<h;t+=a)n.push(s[t],s[t+1]);const e=n.length;u=l[t],this.drawChars_(r,e),r=e}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||En,justify:e.justify,textBaseline:e.textBaseline||Pn,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,s=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=Ta[n.textBaseline],c=this.textOffsetY_*a,h=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([ya.DRAW_CHARS,t,e,l,n.overflow,s,n.maxAngle,a,c,r,u*a,h,o,1]),this.hitDetectionInstructions.push([ya.DRAW_CHARS,t,e,l,n.overflow,s,n.maxAngle,1,c,r,u,h,o,1/a])}setTextStyle(t,e){let i,n,r;if(t){const e=t.getFill();e?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Gs(e.getColor()||bn)):(n=null,this.textFillState_=n);const o=t.getStroke();if(o){r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const t=o.getLineDash(),e=o.getLineDashOffset(),i=o.getWidth(),n=o.getMiterLimit();r.lineCap=o.getLineCap()||Cn,r.lineDash=t?t.slice():Tn,r.lineDashOffset=void 0===e?0:e,r.lineJoin=o.getLineJoin()||Sn,r.lineWidth=void 0===i?1:i,r.miterLimit=void 0===n?10:n,r.strokeStyle=Gs(o.getColor()||kn)}else r=null,this.textStrokeState_=r;i=this.textState_;const s=t.getFont()||xn;On(s);const a=t.getScaleArray();i.overflow=t.getOverflow(),i.font=s,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Pn,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||Mn,i.scale=void 0===a?[1,1]:a;const l=t.getOffsetX(),c=t.getOffsetY(),h=t.getRotateWithView(),u=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===c?0:c,this.textRotateWithView_=void 0!==h&&h,this.textRotation_=void 0===u?0:u,this.strokeKey_=r?("string"==typeof r.strokeStyle?r.strokeStyle:ue(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+ue(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},ka=class{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const r=i[n].finish();t[e][n]=r}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let r=n[e];return void 0===r&&(r=new(0,Sa[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r),r}},Ea=class extends le{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ce()}getData(t){return null}prepareFrame(t){return ce()}renderFrame(t,e){return ce()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(function(n,r){const o=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,r,o)}).bind(this)}forEachFeatureAtCoordinate(t,e,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){2===t.target.getState()&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return 2!=e&&3!=e&&t.addEventListener(Jt,this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},Pa=[];let Ma=null;const Ia=class extends Ea{constructor(t){super(t),this.container=null,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let n;Ma||function(){const t=document.createElement("canvas");t.width=1,t.height=1,Ma=t.getContext("2d")}(),Ma.clearRect(0,0,1,1);try{Ma.drawImage(t,e,i,1,1,0,0,1,1),n=Ma.getImageData(0,0,1,1).data}catch(r){return Ma=null,null}return n}getBackground(t){let e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let r,o;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&qt(Fi(t.style.backgroundColor),Fi(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(o=e.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=n;let t=r.style;t.position="absolute",t.width="100%",t.height="100%",o=fn();const e=o.canvas;r.appendChild(e),t=e.style,t.position="absolute",t.left="0",t.transformOrigin="top left",this.container=r,this.context=o}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=mi(i),r=_i(i),o=ci(i),s=li(i);Ze(e.coordinateToPixelTransform,n),Ze(e.coordinateToPixelTransform,r),Ze(e.coordinateToPixelTransform,o),Ze(e.coordinateToPixelTransform,s);const a=this.inversePixelTransform;Ze(a,n),Ze(a,r),Ze(a,o),Ze(a,s),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const r=new ln(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,i,n,r,o,s){const a=n/e;return je(this.tempTransform,r/2,o/2,a,-a,-i,-t[0]+s,-t[1])}disposeInternal(){delete this.frameState,super.disposeInternal()}};function La(t,e,i,n,r,o,s,a,l,c,h,u){let d=t[e],p=t[e+1],f=0,g=0,m=0,_=0;function v(){f=d,g=p,d=t[e+=n],p=t[e+1],_+=m,m=Math.sqrt((d-f)*(d-f)+(p-g)*(p-g))}do{v()}while(e<i-n&&_+m<o);let y=0===m?0:(o-_)/m;const w=Ei(f,d,y),x=Ei(g,p,y),b=e-n,C=_,T=o+a*l(c,r,h);for(;e<i-n&&_+m<T;)v();y=0===m?0:(T-_)/m;const S=Ei(f,d,y),k=Ei(g,p,y);let E;if(u){const t=[w,x,S,k];eo(t,0,4,2,u,t,t),E=t[0]>t[2]}else E=w>S;const P=Math.PI,M=[],I=b+n===e;let L;if(m=0,_=C,d=t[e=b],p=t[e+1],I)return v(),L=Math.atan2(p-g,d-f),E&&(L+=L>0?-P:P),M[0]=[(S+w)/2,(k+x)/2,(T-o)/2,L,r],M;for(let A=0,R=(r=r.replace(/\n/g," ")).length;A<R;){v();let t=Math.atan2(p-g,d-f);if(E&&(t+=t>0?-P:P),void 0!==L){let e=t-L;if(e+=e>P?-2*P:e<-P?2*P:0,Math.abs(e)>s)return null}L=t;const u=A;let w=0;for(;A<R;++A){const t=a*l(c,r[E?R-A-1:A],h);if(e+n<i&&_+m<o+w+t/2)break;w+=t}if(A===u)continue;const x=E?r.substring(R-u,R-A):r.substring(u,A);y=0===m?0:(o+w/2-_)/m;const b=Ei(f,d,y),C=Ei(g,p,y);M.push([b,C,w/2,t,x]),o+=w}return M}function Aa(t,e,i,n){let r=t[e],o=t[e+1],s=0;for(let a=e+n;a<i;a+=n){const e=t[a],i=t[a+1];s+=Math.sqrt((e-r)*(e-r)+(i-o)*(i-o)),r=e,o=i}return s}const Ra=[1/0,1/0,-1/0,-1/0],Oa=[],Fa=[],Da=[],Za=[];function Na(t){return t[3].declutterBox}const ja=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Ga(t,e){return"start"!==e&&"end"!==e||ja.test(t)||(e="start"===e?"left":"right"),Ta[e]}function za(t,e,i){return i>0&&t.push("\n",""),t.push(e,""),t}const Va=class{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const r=t+e+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,s=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,c=[a.scale[0]*l,a.scale[1]*l],h=Array.isArray(t),u=a.justify?Ta[a.justify]:Ga(Array.isArray(t)?t[0]:t,a.textAlign||En),d=n&&o.lineWidth?o.lineWidth:0,p=h?t:t.split("\n").reduce(za,[]),{width:f,height:g,widths:m,heights:_,lineWidths:v}=function(t,e){const i=[],n=[],r=[];let o=0,s=0,a=0,l=0;for(let c=0,h=e.length;c<=h;c+=2){const u=e[c];if("\n"===u||c===h){o=Math.max(o,s),r.push(s),s=0,a+=l;continue}const d=e[c+1]||t.font,p=Zn(d,u);i.push(p),s+=p;const f=Fn(d);n.push(f),l=Math.max(l,f)}return{width:o,height:a,widths:i,heights:n,lineWidths:r}}(a,p),y=f+d,w=[],x=(y+2)*c[0],b=(g+d)*c[1],C={width:x<0?Math.floor(x):Math.ceil(x),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:w};1==c[0]&&1==c[1]||w.push("scale",c),n&&(w.push("strokeStyle",o.strokeStyle),w.push("lineWidth",d),w.push("lineCap",o.lineCap),w.push("lineJoin",o.lineJoin),w.push("miterLimit",o.miterLimit),w.push("setLineDash",[o.lineDash]),w.push("lineDashOffset",o.lineDashOffset)),i&&w.push("fillStyle",s.fillStyle),w.push("textBaseline","middle"),w.push("textAlign","center");const T=.5-u;let S=u*y+T*d;const k=[],E=[];let P,M=0,I=0,L=0,A=0;for(let R=0,O=p.length;R<O;R+=2){const t=p[R];if("\n"===t){I+=M,M=0,S=u*y+T*d,++A;continue}const e=p[R+1]||a.font;e!==P&&(n&&k.push("font",e),i&&E.push("font",e),P=e),M=Math.max(M,_[L]);const r=[t,S+T*m[L]+u*(m[L]-v[A]),.5*(d+M)+I];S+=m[L],n&&k.push("strokeText",r),i&&E.push("fillText",r),++L}return Array.prototype.push.apply(w,k),Array.prototype.push.apply(w,E),this.labels_[r]=C,C}replayTextBackground_(t,e,i,n,r,o,s){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),s&&(this.setStrokeStyle_(t,s),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,r,o,s,a,l,c,h,u,d,p,f,g){let m=i-(s*=u[0]),_=n-(a*=u[1]);const v=r+l>t?t-l:r,y=o+c>e?e-c:o,w=p[3]+v*u[0]+p[1],x=p[0]+y*u[1]+p[2],b=m-p[3],C=_-p[0];let T;return(f||0!==h)&&(Oa[0]=b,Za[0]=b,Oa[1]=C,Fa[1]=C,Fa[0]=b+w,Da[0]=Fa[0],Da[1]=C+x,Za[1]=Da[1]),0!==h?(T=je([1,0,0,1,0,0],i,n,1,1,h,-i,-n),Ze(T,Oa),Ze(T,Fa),Ze(T,Da),Ze(T,Za),Je(Math.min(Oa[0],Fa[0],Da[0],Za[0]),Math.min(Oa[1],Fa[1],Da[1],Za[1]),Math.max(Oa[0],Fa[0],Da[0],Za[0]),Math.max(Oa[1],Fa[1],Da[1],Za[1]),Ra)):Je(Math.min(b,b+w),Math.min(C,C+x),Math.max(b,b+w),Math.max(C,C+x),Ra),d&&(m=Math.round(m),_=Math.round(_)),{drawImageX:m,drawImageY:_,drawImageW:v,drawImageH:y,originX:l,originY:c,declutterBox:{minX:Ra[0],minY:Ra[1],maxX:Ra[2],maxY:Ra[3],value:g},canvasTransform:T,scale:u}}replayImageOrLabel_(t,e,i,n,r,o,s){const a=n.declutterBox,l=t.canvas,c=s?s[2]*n.scale[0]/2:0;return a.minX-c<=l.width/e&&a.maxX+c>=0&&a.minY-c<=l.height/e&&a.maxY+c>=0&&(!(!o&&!s)&&this.replayTextBackground_(t,Oa,Fa,Da,Za,o,s),function(t,e,i,n,r,o,s,a,l,c,h){t.save(),1!==i&&(t.globalAlpha*=i),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(l,c),t.scale(h[0],h[1]),function(t,e){const i=t.contextInstructions;for(let n=0,r=i.length;n<r;n+=2)Array.isArray(i[n+1])?e[i[n]].apply(e,i[n+1]):e[i[n]]=i[n+1]}(n,t)):h[0]<0||h[1]<0?(t.translate(l,c),t.scale(h[0],h[1]),t.drawImage(n,r,o,s,a,0,0,s,a)):t.drawImage(n,r,o,s,a,l,c,s*h[0],a*h[1]),t.restore()}(t,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=Ze(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const r=this.textStates[e],o=this.createLabel(t,e,n,i),s=this.strokeStates[i],a=this.pixelRatio,l=Ga(Array.isArray(t)?t[0]:t,r.textAlign||En),c=Ta[r.textBaseline||Pn],h=s&&s.lineWidth?s.lineWidth:0;return{label:o,anchorX:l*(o.width/a-2*r.scale[0])+2*(.5-l)*h,anchorY:c*o.height/a+2*(.5-c)*h}}execute_(t,e,i,n,r,o,s,a){let l;var c,h;this.pixelCoordinates_&&qt(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=to(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),(c=this.renderedTransform_)[0]=(h=i)[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5]);let u=0;const d=n.length;let p,f,g,m,_,v,y,w,x,b,C,T,S=0,k=0,E=0,P=null,M=null;const I=this.coordinateCache_,L=this.viewRotation_,A=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,R={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:L},O=this.instructions!=n||this.overlaps?0:200;let F,D,Z,N;for(;u<d;){const i=n[u];switch(i[0]){case ya.BEGIN_GEOMETRY:F=i[1],N=i[3],F.getGeometry()?void 0===s||yi(s,N.getExtent())?++u:u=i[2]+1:u=i[2];break;case ya.BEGIN_PATH:k>O&&(this.fill_(t),k=0),E>O&&(t.stroke(),E=0),k||E||(t.beginPath(),m=NaN,_=NaN),++u;break;case ya.CIRCLE:S=i[1];const n=l[S],c=l[S+1],h=l[S+2]-n,d=l[S+3]-c,j=Math.sqrt(h*h+d*d);t.moveTo(n+j,c),t.arc(n,c,j,0,2*Math.PI,!0),++u;break;case ya.CLOSE_PATH:t.closePath(),++u;break;case ya.CUSTOM:S=i[1],p=i[2];const G=i[4],z=6==i.length?i[5]:void 0;R.geometry=i[3],R.feature=F,u in I||(I[u]=[]);const V=I[u];z?z(l,S,p,2,V):(V[0]=l[S],V[1]=l[S+1],V.length=2),G(V,R),++u;break;case ya.DRAW_IMAGE:S=i[1],p=i[2],w=i[3],f=i[4],g=i[5];let B=i[6];const q=i[7],U=i[8],$=i[9],Y=i[10];let X=i[11];const W=i[12];let H=i[13];const J=i[14],K=i[15];if(!w&&i.length>=20){x=i[19],b=i[20],C=i[21],T=i[22];const t=this.drawLabelWithPointPlacement_(x,b,C,T);w=t.label,i[3]=w,f=(t.anchorX-i[23])*this.pixelRatio,i[4]=f,g=(t.anchorY-i[24])*this.pixelRatio,i[5]=g,B=w.height,i[6]=B,H=w.width,i[13]=H}let Q,tt,et,it;i.length>25&&(Q=i[25]),i.length>17?(tt=i[16],et=i[17],it=i[18]):(tt=Mn,et=!1,it=!1),Y&&A?X+=L:Y||A||(X-=L);let nt=0;for(;S<p;S+=2){if(Q&&Q[nt++]<H/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(w.width,w.height,l[S],l[S+1],H,B,f,g,U,$,X,W,r,tt,et||it,F),n=[t,e,w,i,q,et?P:null,it?M:null];if(a){if("none"===J)continue;if("obstacle"===J){a.insert(i.declutterBox);continue}{let t,e;if(K){const i=p-S;if(!K[i]){K[i]=n;continue}if(t=K[i],delete K[i],e=Na(t),a.collides(e))continue}if(a.collides(i.declutterBox))continue;t&&(a.insert(e),this.replayImageOrLabel_.apply(this,t)),a.insert(i.declutterBox)}}this.replayImageOrLabel_.apply(this,n)}++u;break;case ya.DRAW_CHARS:const rt=i[1],ot=i[2],st=i[3],at=i[4];T=i[5];const lt=i[6],ct=i[7],ht=i[8];C=i[9];const ut=i[10];x=i[11],b=i[12];const dt=[i[13],i[13]],pt=this.textStates[b],ft=pt.font,gt=[pt.scale[0]*ct,pt.scale[1]*ct];let mt;ft in this.widths_?mt=this.widths_[ft]:(mt={},this.widths_[ft]=mt);const _t=Aa(l,rt,ot,2),vt=Math.abs(gt[0])*Nn(ft,x,mt);if(at||vt<=_t){const i=La(l,rt,ot,2,x,(_t-vt)*Ta[this.textStates[b].textAlign],lt,Math.abs(gt[0]),Nn,ft,mt,A?0:this.viewRotation_);t:if(i){const n=[];let r,o,s,l,c;if(C)for(r=0,o=i.length;r<o;++r){c=i[r],s=c[4],l=this.createLabel(s,b,"",C),f=c[2]+(gt[0]<0?-ut:ut),g=st*l.height+2*(.5-st)*ut*gt[1]/gt[0]-ht;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,f,g,0,0,c[3],dt,!1,Mn,!1,F);if(a&&a.collides(o.declutterBox))break t;n.push([t,e,l,o,1,null,null])}if(T)for(r=0,o=i.length;r<o;++r){c=i[r],s=c[4],l=this.createLabel(s,b,T,""),f=c[2],g=st*l.height-ht;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,f,g,0,0,c[3],dt,!1,Mn,!1,F);if(a&&a.collides(o.declutterBox))break t;n.push([t,e,l,o,1,null,null])}a&&a.load(n.map(Na));for(let t=0,e=n.length;t<e;++t)this.replayImageOrLabel_.apply(this,n[t])}}++u;break;case ya.END_GEOMETRY:if(void 0!==o){F=i[1];const t=o(F,N);if(t)return t}++u;break;case ya.FILL:O?k++:this.fill_(t),++u;break;case ya.MOVE_TO_LINE_TO:for(S=i[1],p=i[2],D=l[S],Z=l[S+1],v=D+.5|0,y=Z+.5|0,v===m&&y===_||(t.moveTo(D,Z),m=v,_=y),S+=2;S<p;S+=2)D=l[S],Z=l[S+1],v=D+.5|0,y=Z+.5|0,S!=p-2&&v===m&&y===_||(t.lineTo(D,Z),m=v,_=y);++u;break;case ya.SET_FILL_STYLE:P=i,this.alignFill_=i[2],k&&(this.fill_(t),k=0,E&&(t.stroke(),E=0)),t.fillStyle=i[1],++u;break;case ya.SET_STROKE_STYLE:M=i,E&&(t.stroke(),E=0),this.setStrokeStyle_(t,i),++u;break;case ya.STROKE:O?E++:t.stroke(),++u;break;default:++u}}k&&this.fill_(t),E&&t.stroke()}execute(t,e,i,n,r,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,r)}},Ba=["Polygon","Circle","LineString","Image","Text","Default"],qa={},Ua=class{constructor(t,e,i,n,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(r)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const t in n)i[t]=new Va(this.resolution_,this.pixelRatio_,this.overlaps_,n[t])}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,n=t.length;e<n;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,r,o){const s=2*(n=Math.round(n))+1,a=je(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=fn(s,s));const c=this.hitDetectionContext_;let h;c.canvas.width!==s||c.canvas.height!==s?(c.canvas.width=s,c.canvas.height=s):l||c.clearRect(0,0,s,s),void 0!==this.renderBuffer_&&(h=[1/0,1/0,-1/0,-1/0],ni(h,t),qe(h,e*(this.renderBuffer_+n),h));const u=function(t){if(void 0!==qa[t])return qa[t];const e=2*t+1,i=t*t,n=new Array(i+1);for(let o=0;o<=t;++o)for(let r=0;r<=t;++r){const s=o*o+r*r;if(s>i)break;let a=n[s];a||(a=[],n[s]=a),a.push(4*((t+o)*e+(t+r))+3),o>0&&a.push(4*((t-o)*e+(t+r))+3),r>0&&(a.push(4*((t+o)*e+(t-r))+3),o>0&&a.push(4*((t-o)*e+(t-r))+3))}const r=[];for(let o=0,s=n.length;o<s;++o)n[o]&&r.push(...n[o]);return qa[t]=r,r}(n);let d;function p(t,e){const i=c.getImageData(0,0,s,s).data;for(let a=0,l=u.length;a<l;a++)if(i[u[a]]>0){if(!o||"Image"!==d&&"Text"!==d||o.includes(t)){const i=(u[a]-3)/4,o=n-i%s,l=n-(i/s|0),c=r(t,e,o*o+l*l);if(c)return c}c.clearRect(0,0,s,s);break}}const f=Object.keys(this.executorsByZIndex_).map(Number);let g,m,_,v,y;for(f.sort(Gt),g=f.length-1;g>=0;--g){const t=f[g].toString();for(_=this.executorsByZIndex_[t],m=Ba.length-1;m>=0;--m)if(d=Ba[m],v=_[d],void 0!==v&&(y=v.executeHitDetection(c,a,i,p,h),y))return y}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],r=e[2],o=e[3],s=[i,n,i,o,r,o,r,n];return to(s,0,8,2,t,s),s}isEmpty(){return Wt(this.executorsByZIndex_)}execute(t,e,i,n,r,o,s){const a=Object.keys(this.executorsByZIndex_).map(Number);let l,c,h,u,d,p;for(a.sort(Gt),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||Ba,s&&a.reverse(),l=0,c=a.length;l<c;++l){const c=a[l].toString();for(d=this.executorsByZIndex_[c],h=0,u=o.length;h<u;++h)p=d[o[h]],void 0!==p&&p.execute(t,e,i,n,r,s)}this.maxExtent_&&t.restore()}},$a=class extends wa{constructor(t,e,i,n,r,o,s){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=s,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,n){if(!this.image_)return;const r=to(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,s=this.tmpLocalTransform_,a=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(let c=0,h=r.length;c<h;c+=2){const t=r[c]-this.imageAnchorX_,e=r[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const i=t+this.imageAnchorX_,n=e+this.imageAnchorY_;je(s,i,n,1,1,l,-i,-n),o.setTransform.apply(o,s),o.translate(i,n),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,t,e,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=a)}drawText_(t,e,i,n){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=to(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let s=this.textRotation_;for(this.textRotateWithView_&&(s+=this.viewRotation_);e<i;e+=n){const t=r[e]+this.textOffsetX_,i=r[e+1]+this.textOffsetY_;0!==s||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.translate(t-this.textOffsetX_,i-this.textOffsetY_),o.rotate(s),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,t,i),this.textFillState_&&o.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,n,r){const o=this.context_,s=to(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(s[0],s[1]);let a=s.length;r&&(a-=2);for(let l=2;l<a;l+=2)o.lineTo(s[l],s[l+1]);return r&&o.closePath(),i}drawRings_(t,e,i,n){for(let r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e}drawCircle(t){if(yi(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(t,e,i){const n=t.getFlatCoordinates();if(n){const r=t.getStride();return to(n,0,n.length,r,e,i)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&yi(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),yi(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(yi(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let n=0;const r=t.getEnds(),o=t.getStride();e.beginPath();for(let t=0,s=r.length;t<s;++t)n=this.moveToLineTo_(i,n,r[t],o,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),yi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),yi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let t=0,s=r.length;t<s;++t)n=this.drawRings_(i,n,r[t],o);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),qt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:En;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:Gs(e||bn)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),n=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),s=e.getWidth(),a=e.getMiterLimit(),l=n||Tn;this.strokeState_={lineCap:void 0!==i?i:Cn,lineDash:1===this.pixelRatio_?l:l.map(t=>t*this.pixelRatio_),lineDashOffset:(r||0)*this.pixelRatio_,lineJoin:void 0!==o?o:Sn,lineWidth:(void 0!==s?s:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:Gs(t||kn)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:Gs(t||bn)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),n=i.getLineDash(),r=i.getLineDashOffset(),o=i.getLineJoin(),s=i.getWidth(),a=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:Cn,lineDash:n||Tn,lineDashOffset:r||0,lineJoin:void 0!==o?o:Sn,lineWidth:void 0!==s?s:1,miterLimit:void 0!==a?a:10,strokeStyle:Gs(t||kn)}}else this.textStrokeState_=null;const n=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),s=t.getRotateWithView(),a=t.getRotation(),l=t.getScaleArray(),c=t.getText(),h=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==n?n:xn,textAlign:void 0!==h?h:En,textBaseline:void 0!==u?u:Pn},this.text_=void 0!==c?Array.isArray(c)?c.reduce((t,e,i)=>t+(i%2?" ":e),""):c:"",this.textOffsetX_=void 0!==r?this.pixelRatio_*r:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==s&&s,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}},Ya=.5;function Xa(t,e,i,n,r,o,s){const a=fn(t[0]*Ya,t[1]*Ya);a.imageSmoothingEnabled=!1;const l=a.canvas,c=new $a(a,Ya,r,null,s),h=i.length,u=Math.floor(16777215/h),d={};for(let f=1;f<=h;++f){const t=i[f-1],e=t.getStyleFunction()||n;if(!n)continue;let s=e(t,o);if(!s)continue;Array.isArray(s)||(s=[s]);const a="#"+("000000"+(f*u).toString(16)).slice(-6);for(let i=0,n=s.length;i<n;++i){const e=s[i],n=e.getGeometryFunction()(t);if(!n||!yi(r,n.getExtent()))continue;const o=e.clone(),l=o.getFill();l&&l.setColor(a);const c=o.getStroke();c&&(c.setColor(a),c.setLineDash(null)),o.setText(void 0);const h=e.getImage();if(h&&0!==h.getOpacity()){const t=h.getImageSize();if(!t)continue;const e=fn(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=a,e.fillRect(0,0,i.width,i.height),o.setImage(new ra({img:i,imgSize:t,anchor:h.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:h.getOrigin(),opacity:1,size:h.getSize(),scale:h.getScale(),rotation:h.getRotation(),rotateWithView:h.getRotateWithView()}))}const u=o.getZIndex()||0;let p=d[u];p||(p={},d[u]=p,p.Polygon=[],p.Circle=[],p.LineString=[],p.Point=[]),p[n.getType().replace("Multi","")].push(n,o)}}const p=Object.keys(d).map(Number).sort(Gt);for(let f=0,g=p.length;f<g;++f){const t=d[p[f]];for(const i in t){const n=t[i];for(let t=0,i=n.length;t<i;t+=2){c.setStyle(n[t+1]);for(let i=0,r=e.length;i<r;++i)c.setTransform(e[i]),c.drawGeometry(n[t])}}}return a.getImageData(0,0,l.width,l.height)}function Wa(t,e,i){const n=[];if(i){const r=Math.floor(Math.round(t[0])*Ya),o=Math.floor(Math.round(t[1])*Ya),s=4*(bi(r,0,i.width-1)+bi(o,0,i.height-1)*i.width),a=i.data[s+2]+256*(i.data[s+1]+256*i.data[s]),l=Math.floor(16777215/e.length);a&&a%l==0&&n.push(e[a/l-1])}return n}const Ha={Point:function(t,e,i,n,r){const o=i.getImage(),s=i.getText();let a;if(o){if(2!=o.getImageState())return;let l=t;if(r){const c=o.getDeclutterMode();if("none"!==c)if(l=r,"obstacle"===c){const r=t.getBuilder(i.getZIndex(),"Image");r.setImageStyle(o,a),r.drawPoint(e,n)}else s&&s.getText()&&(a={})}const c=l.getBuilder(i.getZIndex(),"Image");c.setImageStyle(o,a),c.drawPoint(e,n)}if(s&&s.getText()){let o=t;r&&(o=r);const l=o.getBuilder(i.getZIndex(),"Text");l.setTextStyle(s,a),l.drawText(e,n)}},LineString:function(t,e,i,n,r){const o=i.getStroke();if(o){const r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,o),r.drawLineString(e,n)}const s=i.getText();if(s&&s.getText()){const o=(r||t).getBuilder(i.getZIndex(),"Text");o.setTextStyle(s),o.drawText(e,n)}},Polygon:function(t,e,i,n,r){const o=i.getFill(),s=i.getStroke();if(o||s){const r=t.getBuilder(i.getZIndex(),"Polygon");r.setFillStrokeStyle(o,s),r.drawPolygon(e,n)}const a=i.getText();if(a&&a.getText()){const o=(r||t).getBuilder(i.getZIndex(),"Text");o.setTextStyle(a),o.drawText(e,n)}},MultiPoint:function(t,e,i,n,r){const o=i.getImage(),s=i.getText();let a;if(o){if(2!=o.getImageState())return;let l=t;if(r){const c=o.getDeclutterMode();if("none"!==c)if(l=r,"obstacle"===c){const r=t.getBuilder(i.getZIndex(),"Image");r.setImageStyle(o,a),r.drawMultiPoint(e,n)}else s&&s.getText()&&(a={})}const c=l.getBuilder(i.getZIndex(),"Image");c.setImageStyle(o,a),c.drawMultiPoint(e,n)}if(s&&s.getText()){let o=t;r&&(o=r);const l=o.getBuilder(i.getZIndex(),"Text");l.setTextStyle(s,a),l.drawText(e,n)}},MultiLineString:function(t,e,i,n,r){const o=i.getStroke();if(o){const r=t.getBuilder(i.getZIndex(),"LineString");r.setFillStrokeStyle(null,o),r.drawMultiLineString(e,n)}const s=i.getText();if(s&&s.getText()){const o=(r||t).getBuilder(i.getZIndex(),"Text");o.setTextStyle(s),o.drawText(e,n)}},MultiPolygon:function(t,e,i,n,r){const o=i.getFill(),s=i.getStroke();if(s||o){const r=t.getBuilder(i.getZIndex(),"Polygon");r.setFillStrokeStyle(o,s),r.drawMultiPolygon(e,n)}const a=i.getText();if(a&&a.getText()){const o=(r||t).getBuilder(i.getZIndex(),"Text");o.setTextStyle(a),o.drawText(e,n)}},GeometryCollection:function(t,e,i,n,r){const o=e.getGeometriesArray();let s,a;for(s=0,a=o.length;s<a;++s)(0,Ha[o[s].getType()])(t,o[s],i,n,r)},Circle:function(t,e,i,n,r){const o=i.getFill(),s=i.getStroke();if(o||s){const r=t.getBuilder(i.getZIndex(),"Circle");r.setFillStrokeStyle(o,s),r.drawCircle(e,n)}const a=i.getText();if(a&&a.getText()){const o=(r||t).getBuilder(i.getZIndex(),"Text");o.setTextStyle(a),o.drawText(e,n)}}};function Ja(t,e){return parseInt(ue(t),10)-parseInt(ue(e),10)}function Ka(t,e){const i=Qa(t,e);return i*i}function Qa(t,e){return.5*t/e}function tl(t,e,i,n,r,o,s){let a=!1;const l=i.getImage();if(l){const t=l.getImageState();2==t||3==t?l.unlistenImageChange(r):(0==t&&l.load(),l.listenImageChange(r),a=!0)}return function(t,e,i,n,r,o){const s=i.getGeometryFunction()(e);if(!s)return;const a=s.simplifyTransformed(n,r);i.getRenderer()?el(t,a,i,e):(0,Ha[a.getType()])(t,a,i,e,o)}(t,e,i,n,o,s),a}function el(t,e,i,n){if("GeometryCollection"!=e.getType())t.getBuilder(i.getZIndex(),"Default").drawCustom(e,n,i.getRenderer(),i.getHitDetectionRenderer());else{const r=e.getGeometries();for(let e=0,o=r.length;e<o;++e)el(t,r[e],i,n)}}const il=class extends Ia{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,r=e.viewState,o=r.center,s=r.resolution,a=r.projection,l=r.rotation,c=a.getExtent(),h=this.getLayer().getSource(),u=e.pixelRatio,d=e.viewHints,p=!(d[0]||d[1]),f=this.compositionContext_,g=Math.round(e.size[0]*u),m=Math.round(e.size[1]*u),_=h.getWrapX()&&a.canWrapX(),v=_?vi(c):null,y=_?Math.ceil((n[2]-c[2])/v)+1:1;let w=_?Math.floor((n[0]-c[0])/v):0;do{const e=this.getRenderTransform(o,s,l,u,g,m,w*v);t.execute(f,1,e,l,p,void 0,i)}while(++w<y)}setupCompositionContext_(){if(1!==this.opacity_){const t=fn(this.context.canvas.width,this.context.canvas.height,Pa);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,gn(this.compositionContext_),Pa.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];!function(t,e,i){De(t,e,0,0,i,0,0)}(this.pixelTransform,1/i,1/i),Ge(this.inversePixelTransform,this.pixelTransform);const r=Ve(this.pixelTransform);this.useContainer(e,r,this.getBackground(t));const o=this.context,s=o.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!l||l.isEmpty()))return null;const c=Math.round(t.size[0]*i),h=Math.round(t.size[1]*i);s.width!=c||s.height!=h?(s.width=c,s.height=h,s.style.transform!==r&&(s.style.transform=r)):this.containerReused||o.clearRect(0,0,c,h),this.preRender(o,t);const u=t.viewState;this.opacity_=n.opacity,this.setupCompositionContext_();let d=!1,p=!0;if(n.extent&&this.clipping){const e=jr(n.extent);p=yi(e,t.extent),d=p&&!Xe(e,t.extent),d&&this.clipUnrotated(this.compositionContext_,t,e)}return p&&this.renderWorlds(a,t),d&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const t=[this.context.canvas.width,this.context.canvas.height];Ze(this.pixelTransform,t);const e=this.renderedCenter_,i=this.renderedResolution_,n=this.renderedRotation_,r=this.renderedProjection_,o=this.wrappedRenderedExtent_,s=this.getLayer(),a=[],l=t[0]*Ya,c=t[1]*Ya;a.push(this.getRenderTransform(e,i,n,Ya,l,c,0).slice());const h=s.getSource(),u=r.getExtent();if(h.getWrapX()&&r.canWrapX()&&!Xe(u,o)){let t=o[0];const r=vi(u);let s,h=0;for(;t<u[0];)--h,s=r*h,a.push(this.getRenderTransform(e,i,n,Ya,l,c,s).slice()),t+=r;for(h=0,t=o[2];t>u[2];)++h,s=r*h,a.push(this.getRenderTransform(e,i,n,Ya,l,c,s).slice()),t-=r}this.hitDetectionImageData_=Xa(t,a,this.renderedFeatures_,s.getStyleFunction(),o,i,n)}e(Wa(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))}forEachFeatureAtCoordinate(t,e,i,n,r){if(!this.replayGroup_)return;const o=e.viewState.resolution,s=e.viewState.rotation,a=this.getLayer(),l={},c=function(t,e,i){const o=ue(t),s=l[o];if(s){if(!0!==s&&i<s.distanceSq){if(0===i)return l[o]=!0,r.splice(r.lastIndexOf(s),1),n(t,a,e);s.geometry=e,s.distanceSq=i}}else{if(0===i)return l[o]=!0,n(t,a,e);r.push(l[o]={feature:t,layer:a,geometry:e,distanceSq:i,callback:n})}};let h;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(n=>h=n.forEachFeatureAtCoordinate(t,o,s,i,c,n===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(t=>t.value):null)),h}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[0],r=t.viewHints[1],o=e.getUpdateWhileAnimating(),s=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!s&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,l=t.viewState,c=l.projection,h=l.resolution,u=t.pixelRatio,d=e.getRevision(),p=e.getRenderBuffer();let f=e.getRenderOrder();void 0===f&&(f=Ja);const g=l.center.slice(),m=qe(a,p*h),_=m.slice(),v=[m.slice()],y=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!Xe(y,t.extent)){const t=vi(y),e=Math.max(vi(m)/2,t);m[0]=y[0]-e,m[2]=y[2]+e,on(g,c);const i=xi(v[0],c);i[0]<y[0]&&i[2]<y[2]?v.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>y[0]&&i[2]>y[2]&&v.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==h&&this.renderedRevision_==d&&this.renderedRenderOrder_==f&&Xe(this.wrappedRenderedExtent_,m))return qt(this.renderedExtent_,_)||(this.hitDetectionImageData_=null,this.renderedExtent_=_),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const w=new ka(Qa(h,u),m,h,u);let x;this.getLayer().getDeclutter()&&(x=new ka(Qa(h,u),m,h,u));let b;for(let I=0,L=v.length;I<L;++I)i.loadFeatures(v[I],h,c);const C=Ka(h,u);let T=!0;const S=(function(t){let i;const n=t.getStyleFunction()||e.getStyleFunction();if(n&&(i=n(t,h)),i){const e=this.renderFeature(t,C,i,w,b,x);T=T&&!e}}).bind(this),k=Nr(m),E=i.getFeaturesInExtent(k);f&&E.sort(f);for(let I=0,L=E.length;I<L;++I)S(E[I]);this.renderedFeatures_=E,this.ready=T;const P=w.finish(),M=new Ua(m,h,u,i.getOverlaps(),P,e.getRenderBuffer());return x&&(this.declutterExecutorGroup=new Ua(m,h,u,i.getOverlaps(),x.finish(),e.getRenderBuffer())),this.renderedResolution_=h,this.renderedRevision_=d,this.renderedRenderOrder_=f,this.renderedExtent_=_,this.wrappedRenderedExtent_=m,this.renderedCenter_=g,this.renderedProjection_=c,this.replayGroup_=M,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,r,o){if(!i)return!1;let s=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)s=tl(n,t,i[a],e,this.boundHandleStyleImageChange_,r,o)||s;else s=tl(n,t,i,e,this.boundHandleStyleImageChange_,r,o);return s}},nl=class extends pa{constructor(t){super(t)}createRenderer(){return new il(this)}},rl=class{constructor(t){this.rbush_=new Zs(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[ue(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,r=e.length;n<r;n++){const r=t[n],o=e[n],s={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[n]=s,this.items_[ue(o)]=s}this.rbush_.load(i)}remove(t){const e=ue(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[ue(e)];ei([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(t){return t.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,r=t.length;n<r;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Wt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Je(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function sl(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const al=class extends pe{constructor(t){super(),this.projection=kr(t.projection),this.attributions_=sl(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(t,i){e.viewResolver=t,e.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return ce()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=sl(t),this.changed()}setState(t){this.state_=t,this.changed()}},ll="addfeature",cl="removefeature";function hl(t,e){return[[-1/0,-1/0,1/0,1/0]]}function ul(t,e,i,n,r,o,s){const a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(i,n,r):t,!0),"arraybuffer"==e.getType()&&(a.responseType="arraybuffer"),a.withCredentials=!1,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let n;"json"==t||"text"==t?n=a.responseText:"xml"==t?(n=a.responseXML,n||(n=(new DOMParser).parseFromString(a.responseText,"application/xml"))):"arraybuffer"==t&&(n=a.response),n?o(e.readFeatures(n,{extent:i,featureProjection:r}),e.readProjection(n)):s()}else s()},a.onerror=s,a.send()}function dl(t,e){return function(i,n,r,o,s){const a=this;ul(t,e,i,n,r,function(t,e){a.addFeatures(t),void 0!==o&&o(t)},s||Yt)}}class pl extends Zt{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const fl=class extends al{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.loader_=Yt,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(_e(this.format_,7),this.loader_=dl(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:hl;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,n;this.featuresRtree_=e?new rl:null,this.loadedExtentsRtree_=new rl,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),e||void 0!==i||(i=new Te(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=ue(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new pl(ll,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[re(e,Jt,this.handleFeatureChange_,this),re(e,Nt,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(_e(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let r=0,o=t.length;r<o;r++){const e=t[r],n=ue(e);this.addToIndex_(n,e)&&i.push(e)}for(let r=0,o=i.length;r<o;r++){const t=i[r],o=ue(t);this.setupChangeEvents_(o,t);const s=t.getGeometry();if(s){const i=s.getExtent();e.push(i),n.push(t)}else this.nullGeometryFeatures_[o]=t}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(ll))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new pl(ll,i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(ll,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(cl,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(we,(function(t){e||(e=!0,this.addFeature(t.element),e=!1)}).bind(this)),t.addEventListener(xe,(function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}).bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(se);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=(function(t){this.removeFeatureInternal(t)}).bind(this);this.featuresRtree_.forEach(t);for(const e in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new pl("clear");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(i){return i.getGeometry().intersectsCoordinate(t)?e(i):void 0})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const t=e(i);if(t)return t}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Wt(this.nullGeometryFeatures_)||Bt(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=function(t,e){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];xi(t,e);const n=vi(i);if(vi(t)>n)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+n,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-n,t[3]]]}return[t]}(t,e);return[].concat(...i.map(t=>this.featuresRtree_.getInExtent(t)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let r=null;const o=[NaN,NaN];let s=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||Ut,this.featuresRtree_.forEachInExtent(a,function(t){if(e(t)){const e=t.getGeometry(),l=s;if(s=e.closestPointXY(i,n,o,s),s<l){r=t;const e=Math.sqrt(s);a[0]=i-e,a[1]=n-e,a[2]=i+e,a[3]=n+e}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=ue(e),n=e.getGeometry();if(n){const t=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const r=e.getId();if(void 0!==r){const t=r.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new pl("changefeature",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:ue(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Wt(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let o=0,s=r.length;o<s;++o){const t=r[o];n.forEachInExtent(t,function(e){return Xe(e.extent,t)})||(++this.loadingExtentsCount_,this.dispatchEvent(new pl("featuresloadstart")),this.loader_.call(this,t,e,i,(function(t){--this.loadingExtentsCount_,this.dispatchEvent(new pl("featuresloadend",void 0,t))}).bind(this),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new pl("featuresloaderror"))}).bind(this)),n.insert(t,{extent:t.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(e){if(ei(e.extent,t))return i=e,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=ue(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=ue(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(se),delete this.featureChangeKeys_[e];const n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new pl(cl,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){_e(this.format_,7),this.url_=t,this.setLoader(dl(t,this.format_))}};class gl extends Zt{constructor(t,e,i,n){super(t),this.selected=e,this.deselected=i,this.mapBrowserEvent=n}}const ml={};class _l extends ns{constructor(t){let e;if(super(),t=t||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=t.condition?t.condition:fs,this.addCondition_=t.addCondition?t.addCondition:ds,this.removeCondition_=t.removeCondition?t.removeCondition:ds,this.toggleCondition_=t.toggleCondition?t.toggleCondition:ms,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:Ut,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.style_=void 0!==t.style?t.style:function(){const t=function(){const t={},e=[255,255,255,1],i=[0,153,255,1];return t.Polygon=[new Ws({fill:new $s({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new Ws({stroke:new Xs({color:e,width:5})}),new Ws({stroke:new Xs({color:i,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new Ws({image:new qs({radius:6,fill:new $s({color:i}),stroke:new Xs({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}();return Bt(t.Polygon,t.LineString),Bt(t.GeometryCollection,t.LineString),function(e){return e.getGeometry()?t[e.getGeometry().getType()]:null}}(),this.features_=t.features||new Te,t.layers)if("function"==typeof t.layers)e=t.layers;else{const i=t.layers;e=function(t){return i.includes(t)}}else e=Ut;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(t,e){this.featureLayerAssociation_[ue(t)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(t){return this.featureLayerAssociation_[ue(t)]}setHitTolerance(t){this.hitTolerance_=t}setMap(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(t),t?(this.features_.addEventListener(we,this.boundAddFeature_),this.features_.addEventListener(xe,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(we,this.boundAddFeature_),this.features_.removeEventListener(xe,this.boundRemoveFeature_))}addFeature_(t){const e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){const t=this.getMap().getAllLayers().find(function(t){if(t instanceof nl&&t.getSource()&&t.getSource().hasFeature(e))return t});t&&this.addFeatureLayerAssociation_(e,t)}}removeFeature_(t){this.style_&&this.restorePreviousStyle_(t.element)}getStyle(){return this.style_}applySelectedStyle_(t){const e=ue(t);e in ml||(ml[e]=t.getStyle()),t.setStyle(this.style_)}restorePreviousStyle_(t){const e=this.getMap().getInteractions().getArray();for(let n=e.length-1;n>=0;--n){const i=e[n];if(i!==this&&i instanceof _l&&i.getStyle()&&-1!==i.getFeatures().getArray().lastIndexOf(t))return void t.setStyle(i.getStyle())}const i=ue(t);t.setStyle(ml[i]),delete ml[i]}removeFeatureLayerAssociation_(t){delete this.featureLayerAssociation_[ue(t)]}handleEvent(t){if(!this.condition_(t))return!0;const e=this.addCondition_(t),i=this.removeCondition_(t),n=this.toggleCondition_(t),r=!e&&!i&&!n,o=t.map,s=this.getFeatures(),a=[],l=[];if(r){Xt(this.featureLayerAssociation_),o.forEachFeatureAtPixel(t.pixel,(function(t,e){if(t instanceof ye&&this.filter_(t,e))return this.addFeatureLayerAssociation_(t,e),l.push(t),!this.multi_}).bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=s.getLength()-1;t>=0;--t){const e=s.item(t),i=l.indexOf(e);i>-1?l.splice(i,1):(s.remove(e),a.push(e))}0!==l.length&&s.extend(l)}else{o.forEachFeatureAtPixel(t.pixel,(function(t,r){if(t instanceof ye&&this.filter_(t,r))return!e&&!n||s.getArray().includes(t)?(i||n)&&s.getArray().includes(t)&&(a.push(t),this.removeFeatureLayerAssociation_(t)):(this.addFeatureLayerAssociation_(t,r),l.push(t)),!this.multi_}).bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let t=a.length-1;t>=0;--t)s.remove(a[t]);s.extend(l)}return(l.length>0||a.length>0)&&this.dispatchEvent(new gl("select",l,a,t)),!0}}const vl=_l;function yl(t,e,i,n,r,o,s){let a,l;const c=(i-e)/n;if(1===c)a=e;else if(2===c)a=e,l=r;else if(0!==c){let o=t[e],s=t[e+1],c=0;const h=[0];for(let r=e+n;r<i;r+=n){const e=t[r],i=t[r+1];c+=Math.sqrt((e-o)*(e-o)+(i-s)*(i-s)),h.push(c),o=e,s=i}const u=r*c,d=function(t,e,i){let n,r;i=i||Gt;let o=0,s=t.length,a=!1;for(;o<s;)n=o+(s-o>>1),r=+i(t[n],e),r<0?o=n+1:(s=n,a=!r);return a?o:~o}(h,u);d<0?(l=(u-h[-d-2])/(h[-d-1]-h[-d-2]),a=e+(-d-2)*n):a=e+d*n}s=s>1?s:2,o=o||new Array(s);for(let h=0;h<s;++h)o[h]=void 0===a?NaN:void 0===l?t[a+h]:Ei(t[a+h],t[a+n+h],l);return o}function wl(t,e,i,n,r,o){if(i==e)return null;let s;if(r<t[e+n-1])return o?(s=t.slice(e,e+n),s[n-1]=r,s):null;if(t[i-1]<r)return o?(s=t.slice(i-n,i),s[n-1]=r,s):null;if(r==t[e+n-1])return t.slice(e,e+n);let a=e/n,l=i/n;for(;a<l;){const e=a+l>>1;r<t[(e+1)*n-1]?l=e:a=e+1}const c=t[a*n-1];if(r==c)return t.slice((a-1)*n,(a-1)*n+n);const h=(r-c)/(t[(a+1)*n-1]-c);s=[];for(let u=0;u<n-1;++u)s.push(Ei(t[(a-1)*n+u],t[a*n+u],h));return s.push(r),s}class xl extends so{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?Bt(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new xl(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<$e(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ho(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return Oo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:wl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e=void 0!==e&&e)}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return yl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new xl(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Fo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fo(this.flatCoordinates,0,t,this.stride),this.changed()}}const bl=xl,Cl=function(t){const e=t.frameState,i=Fe(t.inversePixelTransform.slice(),e.coordinateToPixelTransform);return new $a(t.context,e.pixelRatio,e.extent,i,e.viewState.rotation)},Tl=class extends vl{constructor(t){t=t||{};var e=new nl({source:new fl({features:new Te,wrapX:t.wrapX,useSpatialIndex:!0}),name:"Cluster overlay",updateWhileAnimating:!0,updateWhileInteracting:!0,displayInLayerSwitcher:!1,style:t.featureStyle});if(t.layers)if("function"==typeof t.layers){var i=t.layers;t.layers=function(t){return t===e||i(t)}}else t.layers.push&&t.layers.push(e);if(t.filter){var n=t.filter;t.filter=function(t,e){return!(!e&&t.get("selectclusterlink"))&&n(t,e)}}else t.filter=function(t,e){return!(!e&&t.get("selectclusterlink"))};!1!==t.autoClose||t.toggleCondition||(t.toggleCondition=fs),super(t),this.overlayLayer_=e,this.filter_=t.filter,this.pointRadius=t.pointRadius||12,this.circleMaxObjects=t.circleMaxObjects||10,this.maxObjects=t.maxObjects||60,this.spiral=!1!==t.spiral,this.animate=t.animate,this.animationDuration=t.animationDuration||500,this.selectCluster_=!1!==t.selectCluster,this._autoClose=!1!==t.autoClose,this.on("select",this.selectCluster.bind(this))}setMap(t){this.getMap()&&this.getMap().removeLayer(this.overlayLayer_),this._listener&&ae(this._listener),this._listener=null,super.setMap(t),this.overlayLayer_.setMap(t),t&&t.getView()&&(this._listener=t.getView().on("change:resolution",this.clear.bind(this)))}clear(){this.getFeatures().clear(),this.overlayLayer_.getSource().clear()}getLayer(){return this.overlayLayer_}selectCluster(t){if(t instanceof ye&&(t={selected:[t]}),t.selected.length){var e=t.selected[0];if(!e.get("selectclusterfeature")){var i=this.overlayLayer_.getSource();this._autoClose&&i.clear();var n=e.get("features");if(n&&1!=n.length){this.selectCluster_||this.getFeatures().clear();var r,o,s,a,l,c,h,u=e.getGeometry().getCoordinates(),d=this.getMap().getView().getResolution(),p=[];if(!this.spiral||n.length<=this.circleMaxObjects)for(a=Math.min(n.length,this.circleMaxObjects),r=d*this.pointRadius*(.5+a/4),s=0;s<a;s++)o=2*Math.PI*s/a,2!=a&&4!=a||(o+=Math.PI/4),l=[u[0]+r*Math.sin(o),u[1]+r*Math.cos(o)],(c=new ye({selectclusterfeature:!0,features:[n[s]],geometry:new Po(l)})).setStyle(n[s].getStyle()),p.push(c),h=new ye({selectclusterlink:!0,geometry:new bl([u,l])}),p.push(h);else{o=0;var f=2*this.pointRadius;for(a=Math.min(this.maxObjects,n.length),s=0;s<a;s++){o+=(f+.1)/(r=f/2+f*o/(2*Math.PI));var g=d*r*Math.sin(o),m=d*r*Math.cos(o);(c=new ye({selectclusterfeature:!0,features:[n[s]],geometry:new Po(l=[u[0]+g,u[1]+m])})).setStyle(n[s].getStyle()),p.push(c),h=new ye({selectclusterlink:!0,geometry:new bl([u,l])}),p.push(h)}}e.set("selectcluserfeatures",p),this.animate?this.animateCluster_(u,p):i.addFeatures(p)}}}else this._autoClose?this.clear():t.deselected.forEach(t=>{var e=t.get("selectcluserfeatures");e&&e.forEach(t=>{this.overlayLayer_.getSource().removeFeature(t)})})}animateCluster_(t,e){if(this.listenerKey_&&ae(this.listenerKey_),e.length){var i=this.overlayLayer_.getStyle(),n="function"==typeof i?i:i.length?function(){return i}:function(){return[i]},r=this.animationDuration||500,o=(new Date).getTime();this.listenerKey_=this.overlayLayer_.on(["postcompose","postrender"],(function(i){for(var s,a=i.vectorContext||Cl(i),l=i.frameState.pixelRatio,c=this.getMap().getView().getResolution(),h=Jr((i.frameState.time-o)/r),u=0;s=e[u];u++)if(s.get("features")){var d=s.getGeometry().getCoordinates();d[0]=t[0]+h*(d[0]-t[0]),d[1]=t[1]+h*(d[1]-t[1]);for(var p=new Po(d),f=n(s,c),g=0;g<f.length;g++){var m,_=!Ds.prototype.getFeaturesAtPixel&&f[g].getImage();_&&(m=_.getScale(),_.setScale(l)),a.setStyle?(a.setStyle(f[g]),a.drawGeometry(p)):(a.setImageStyle(_),a.drawPointGeometry(p)),_&&_.setScale(m)}}if(h>1)return ae(this.listenerKey_),this.overlayLayer_.getSource().addFeatures(e),void this.overlayLayer_.changed();i.frameState.animate=!0}).bind(this));var s=new ye(new Po(this.getMap().getView().getCenter()));s.setStyle(new Qs({image:new qs({})})),this.overlayLayer_.getSource().addFeature(s)}}getClusterExtent(t){if(!t.get("features"))return null;var e=[1/0,1/0,-1/0,-1/0];return t.get("features").forEach(function(t){e=ii(e,t.getGeometry().getExtent())}),e[0]===e[2]&&e[1]===e[3]?null:e}};window.ol&&(ol.util?ol.util.VERSION||(ol.util.VERSION=ol.VERSION||"6.1.0"):ol.util={VERSION:ol.VERSION||"5.3.0"});var Sl="7.1.0".split(".");Sl=100*parseInt(Sl[0])+parseInt(Sl[1]);const kl=function(t,e){var i=t.frameState.pixelRatio;if(Sl>605&&1!==i&&e.getImage()instanceof ra){var n=(e=e.clone()).getImage();n.setScale(n.getScale()*i);var r=n.getAnchor();if(n.setDisplacement){var o=n.getDisplacement();o&&(o[0]-=r[0]/i,o[1]+=r[1]/i,n.setAnchor([0,0]))}else r&&(r[0]/=i,r[1]/=i)}return e},El=class extends nl{constructor(t){var e=t||{};super(e),this.oldcluster=new fl,this.clusters=[],this.animation={start:!1},this.set("animationDuration","number"==typeof e.animationDuration?e.animationDuration:700),this.set("animationMethod",e.animationMethod||Jr),this.getSource().on("change",this.saveCluster.bind(this)),this.on(["precompose","prerender"],this.animate.bind(this)),this.on(["postcompose","postrender"],this.postanimate.bind(this))}saveCluster(){if(this.oldcluster){if(this.oldcluster.clear(),!this.get("animationDuration"))return;var t=this.getSource().getFeatures();t.length&&t[0].get("features")&&(this.oldcluster.addFeatures(this.clusters),this.clusters=t.slice(0),this.sourceChanged=!0)}}getClusterForFeature(t,e){for(var i,n=0;i=e[n];n++){var r=i.get("features");if(r&&r.length)for(var o,s=0;o=r[s];s++)if(t===o)return i}return!1}stopAnimation(){this.animation.start=!1,this.animation.cA=[],this.animation.cB=[]}animate(t){var e=this.get("animationDuration");if(e){var i,n,r=t.frameState.viewState.resolution,o=this.animation,s=t.frameState.time;if(o.resolution!=r&&this.sourceChanged){var a=t.frameState.extent;for(o.resolution<r?(a=qe(a,100*r),o.cA=this.oldcluster.getFeaturesInExtent(a),o.cB=this.getSource().getFeaturesInExtent(a),o.revers=!1):(a=qe(a,100*r),o.cA=this.getSource().getFeaturesInExtent(a),o.cB=this.oldcluster.getFeaturesInExtent(a),o.revers=!0),o.clusters=[],i=0;n=o.cA[i];i++){var l=n.get("features");if(l&&l.length){var c=this.getClusterForFeature(l[0],o.cB);c&&o.clusters.push({f:n,pt:c.getGeometry().getCoordinates()})}}if(o.resolution=r,this.sourceChanged=!1,!o.clusters.length||o.clusters.length>1e3)return void this.stopAnimation();s=o.start=(new Date).getTime()}if(o.start){var h=t.vectorContext||Cl(t),u=(s-o.start)/e;u>1&&(this.stopAnimation(),u=1),u=this.get("animationMethod")(u);var d=this.getStyle(),p="function"==typeof d?d:d.length?function(){return d}:function(){return[d]};for(t.context.save(),t.context.globalAlpha=this.getOpacity(),i=0;c=o.clusters[i];i++){var f=c.f.getGeometry().getCoordinates(),g=f[0]-c.pt[0],m=f[1]-c.pt[1];o.revers?(f[0]=c.pt[0]+u*g,f[1]=c.pt[1]+u*m):(f[0]=f[0]-u*g,f[1]=f[1]-u*m);var _=p(c.f,r,!0);if(_.length||(_=[_]),1!==c.f.get("features").length||g||m){var v=new Po(f);l=new ye(v)}else l=c.f.get("features")[0];for(var y,w=0;y=_[w];w++)if(y.getText()&&/\n/.test(y.getText().getText())){var x,b=y.getText().getOffsetX(),C=y.getText().getOffsetY(),T=y.getText().getRotation()||0,S=1.2*Number((y.getText().getFont()||"10px").match(/\d+/)),k=y.getText().getText().split("\n"),E=k.length-1,P=y.clone();k.forEach(function(e,i){switch(1==i&&(P.setImage(),P.setFill(),P.setStroke()),y.getText().getTextBaseline()){case"alphabetic":case"ideographic":case"bottom":x=E;break;case"hanging":case"top":x=0;break;default:x=E/2}P.getText().setOffsetX(b-Math.sin(T)*S*(i-x)),P.getText().setOffsetY(C+Math.cos(T)*S*(i-x)),P.getText().setText(e),h.drawFeature(l,kl(t,P))})}else h.drawFeature(l,kl(t,y))}t.context.restore(),t.frameState.animate=!0,t.context.save(),t.context.beginPath(),t.context.rect(0,0,0,0),t.context.clip(),this.clip_=!0}}}postanimate(t){this.clip_&&(t.context.restore(),this.clip_=!1)}},Pl=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?kr(e.dataProjection):this.readProjection(t);e.extent&&i&&"tile-pixels"===i.getUnits()&&(i=kr(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return ce()}readFeature(t,e){return ce()}readFeatures(t,e){return ce()}readGeometry(t,e){return ce()}readProjection(t){return ce()}writeFeature(t,e){return ce()}writeFeatures(t,e){return ce()}writeGeometry(t,e){return ce()}};function Ml(t,e,i){const n=i?kr(i.featureProjection):null,r=i?kr(i.dataProjection):null;let o;if(o=n&&r&&!Ar(n,r)?(e?t.clone():t).transform(e?n:r,e?r:n):t,e&&i&&void 0!==i.decimals){const e=Math.pow(10,i.decimals),n=function(t){for(let i=0,n=t.length;i<n;++i)t[i]=Math.round(t[i]*e)/e;return t};o===t&&(o=t.clone()),o.applyTransform(n)}return o}class Il extends so{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let e=this.getLayout();const i=t,n=[],r=[];for(let t=0,o=i.length;t<o;++t){const o=i[t];0===t&&(e=o.getLayout()),Bt(n,o.getFlatCoordinates()),r.push(n.length)}this.setFlatCoordinates(e,n),this.ends_=r}}appendLineString(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Il(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<$e(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(co(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),uo(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:function(t,e,i,n,r,o,s){if(s)return wl(t,e,i[i.length-1],n,r,o);let a;if(r<t[n-1])return o?(a=t.slice(0,n),a[n-1]=r,a):null;if(t[t.length-1]<r)return o?(a=t.slice(t.length-n),a[n-1]=r,a):null;for(let l=0,c=i.length;l<c;++l){const o=i[l];if(e!=o){if(r<t[e+n-1])return null;if(r<=t[o-1])return wl(t,e,o,n,r,!1);e=o}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e=void 0!==e&&e,i=void 0!==i&&i)}getCoordinates(){return xo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new bl(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let r=0;for(let o=0,s=e.length;o<s;++o){const s=e[o],a=new bl(t.slice(r,s),i);n.push(a),r=s}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let o=0,s=n.length;o<s;++o){const s=n[o];Bt(t,yl(e,i,s,r,.5)),i=s}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,n,r,o,s,a){for(let l=0,c=i.length;l<c;++l){const c=i[l];s=mo(t,e,c,n,r,o,s),a.push(s),e=c}return s}(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new Il(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return function(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){if(Fo(t,e,i[o],n,r))return!0;e=i[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=go(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}const Ll=Il;class Al extends so{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?Bt(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Al(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<$e(this.getExtent(),t,e))return n;const r=this.flatCoordinates,o=this.stride;for(let s=0,a=r.length;s<a;s+=o){const a=Ti(t,e,r[s],r[s+1]);if(a<n){n=a;for(let t=0;t<o;++t)i[t]=r[s+t];i.length=o}}return n}getCoordinates(){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new Po(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let r=0,o=t.length;r<o;r+=i){const o=new Po(t.slice(r,r+i),e);n.push(o)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,r=e.length;n<r;n+=i)if(We(t,e[n],e[n+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fo(this.flatCoordinates,0,t,this.stride),this.changed()}}const Rl=Al;function Ol(t,e,i,n){const r=[];let o=[1/0,1/0,-1/0,-1/0];for(let s=0,a=i.length;s<a;++s){const a=i[s];o=ti(t,e,a[0],n),r.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=a[a.length-1]}return r}class Fl extends so{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const r=t,o=[],s=[];for(let t=0,e=r.length;t<e;++t){const e=r[t];0===t&&(n=e.getLayout());const i=o.length,a=e.getEnds();for(let t=0,n=a.length;t<n;++t)a[t]+=i;Bt(o,e.getFlatCoordinates()),s.push(a)}e=n,t=o,i=s}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;Bt(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,n=e.length;t<n;++t)e[t]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new Fl(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<$e(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){const s=i[o];r=co(t,e,s,n,r),e=s[s.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,r,o,s,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const o=i[u];c=uo(t,e,o,n,r,!0,s,a,l,c,h),e=o[o.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,n))}containsXY(t,e){return function(t,e,i,n,r,o){if(0===i.length)return!1;for(let s=0,a=i.length;s<a;++s){const a=i[s];if(Lo(t,e,a,n,r,o))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return function(t,e,i,n){let r=0;for(let o=0,s=i.length;o<s;++o){const s=i[o];r+=To(t,e,s,n),e=s[s.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Vo(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,bo(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Ol(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Ro(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Rl(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){const r=i[o];if(!Go(t,e,r,n,void 0))return!1;r.length&&(e=r[r.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Vo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,n,r,o,s,a){for(let l=0,c=i.length;l<c;++l){const c=i[l],h=[];s=yo(t,e,c,n,r,o,s,h),a.push(h),e=c[c.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new Fl(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const i=this.endss_[t-1];e=i[i.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(0!==e)for(let r=0,o=i.length;r<o;++r)i[r]-=e;return new qo(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let o=0,s=i.length;o<s;++o){const s=i[o].slice(),a=s[s.length-1];if(0!==r)for(let t=0,e=s.length;t<e;++t)s[t]-=r;const l=new qo(e.slice(r,a),t,s);n.push(l),r=a}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return function(t,e,i,n,r){for(let o=0,s=i.length;o<s;++o){const s=i[o];if(Zo(t,e,s,n,r))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=function(t,e,i,n,r){r=r||[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=go(t,e,i[s],n,r[o]);0===a.length&&(a[0]=e),r[o++]=a,e=a[a.length-1]}return r.length=o,r}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const t=i[i.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}const Dl=Fl;var Zl=i(9688);const Nl=[1,0,0,1,0,0];class jl{constructor(t,e,i,n,r){this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i,this.properties_=n}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_="Point"===this.type_?Qe(this.flatCoordinates_):ti(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=hi(this.getExtent());this.flatInteriorPoints_=Ao(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Ol(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Ro(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=yl(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let n=0,r=i.length;n<r;++n){const r=i[n],o=yl(t,e,r,2,.5);Bt(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){const e=(t=kr(t)).getExtent(),i=t.getWorldExtent();if(e&&i){const t=fi(i)/fi(e);je(Nl,i[0],i[3],t,-t,0,0,0),to(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Nl,this.flatCoordinates_)}}getEnds(){return this.ends_}}jl.prototype.getEndss=jl.prototype.getEnds,jl.prototype.getFlatCoordinates=jl.prototype.getOrientedFlatCoordinates;const Gl=jl;function zl(t,e,i){if(3===t){const t={keys:[],values:[],features:[]},n=i.readVarint()+i.pos;i.readFields(Vl,t,n),t.length=t.features.length,t.length&&(e[t.name]=t)}}function Vl(t,e,i){if(15===t)e.version=i.readVarint();else if(1===t)e.name=i.readString();else if(5===t)e.extent=i.readVarint();else if(2===t)e.features.push(i.pos);else if(3===t)e.keys.push(i.readString());else if(4===t){let n=null;const r=i.readVarint()+i.pos;for(;i.pos<r;)n=1==(t=i.readVarint()>>3)?i.readString():2===t?i.readFloat():3===t?i.readDouble():4===t?i.readVarint64():5===t?i.readVarint():6===t?i.readSVarint():7===t?i.readBoolean():null;e.values.push(n)}}function Bl(t,e,i){if(1==t)e.id=i.readVarint();else if(2==t){const t=i.readVarint()+i.pos;for(;i.pos<t;){const t=e.layer.keys[i.readVarint()],n=e.layer.values[i.readVarint()];e.properties[t]=n}}else 3==t?e.type=i.readVarint():4==t&&(e.geometry=i.pos)}function ql(t,e,i){t.pos=e.features[i];const n=t.readVarint()+t.pos,r={layer:e,type:0,properties:{}};return t.readFields(Bl,r,n),r}const Ul=class extends Pl{constructor(t){super(),t=t||{},this.dataProjection=new or({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:Gl,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,i,n){t.pos=e.geometry;const r=t.readVarint()+t.pos;let o=1,s=0,a=0,l=0,c=0,h=0;for(;t.pos<r;){if(!s){const e=t.readVarint();o=7&e,s=e>>3}s--,1===o||2===o?(a+=t.readSVarint(),l+=t.readSVarint(),1===o&&c>h&&(n.push(c),h=c),i.push(a,l),c+=2):7===o?c>h&&(i.push(i[h],i[h+1]),c+=2):_e(!1,59)}c>h&&(n.push(c),h=c)}createFeature_(t,e,i){const n=e.type;if(0===n)return null;let r;const o=e.properties;let s;this.idProperty_?(s=o[this.idProperty_],delete o[this.idProperty_]):s=e.id,o[this.layerName_]=e.layer.name;const a=[],l=[];this.readRawGeometry_(t,e,a,l);const c=function(t,e){let i;return 1===t?i=1===e?"Point":"MultiPoint":2===t?i=1===e?"LineString":"MultiLineString":3===t&&(i="Polygon"),i}(n,l.length);if(this.featureClass_===Gl)r=new this.featureClass_(c,a,l,o,s),r.transform(i.dataProjection);else{let t;if("Polygon"==c){const e=function(t,e){const i=[];let n=0,r=0;for(let o=0,s=e.length;o<s;++o){const s=e[o];if(jo(t,n,s,2)){if(0===i.length)continue;i[i.length-1].push(e[r])}else i.push(e.slice(r,o+1));r=o+1,n=s}return i}(a,l);t=e.length>1?new Dl(a,"XY",e):new qo(a,"XY",l)}else t="Point"===c?new Po(a,"XY"):"LineString"===c?new bl(a,"XY"):"MultiPoint"===c?new Rl(a,"XY"):"MultiLineString"===c?new Ll(a,"XY",l):null;r=new(0,this.featureClass_),this.geometryName_&&r.setGeometryName(this.geometryName_);const e=Ml(t,!1,i);r.setGeometry(e),void 0!==s&&r.setId(s),r.setProperties(o,!0)}return r}getType(){return"arraybuffer"}readFeatures(t,e){const i=this.layers_,n=kr((e=this.adaptOptions(e)).dataProjection);n.setWorldExtent(e.extent),e.dataProjection=n;const r=new Zl(t),o=r.readFields(zl,{}),s=[];for(const a in o){if(i&&!i.includes(a))continue;const t=o[a];n.setExtent(t?[0,0,t.extent,t.extent]:null);for(let i=0,n=t.length;i<n;++i){const n=ql(r,t,i),o=this.createFeature_(r,n,e);null!==o&&s.push(o)}}return s}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}},$l=class extends Ht{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Jt)}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ce()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const n=e-i+1e3/60;return n>=this.transition_?1:Hr(n/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},Yl=class extends $l{constructor(t,e,i,n,r,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function(){const t=fn(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;this.state=t.naturalWidth&&t.naturalHeight?2:4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=ta(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let Xl;const Wl=[];function Hl(t,e,i,n,r){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(n,r),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(i,r)),t.restore()}function Jl(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function Kl(t,e,i,n){const r=Fr(i,e,t);let o=Er(e,n,i);const s=e.getMetersPerUnit();void 0!==s&&(o*=s);const a=t.getMetersPerUnit();void 0!==a&&(o/=a);const l=t.getExtent();if(!l||Ye(l,r)){const e=Er(t,o,r)/o;isFinite(e)&&e>0&&(o/=e)}return o}const Ql=class extends $l{constructor(t,e,i,n,r,o,s,a,l,c,h,u){super(r,0,{interpolate:!!u}),this.renderEdges_=void 0!==h&&h,this.pixelRatio_=s,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const d=n.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const g=p?gi(d,p):d;if(0===ai(g))return void(this.state=4);const m=t.getExtent();m&&(f=f?gi(f,m):m);const _=n.getResolution(this.wrappedTileCoord_[0]),v=function(t,e,i,n){const r=hi(i);let o=Kl(t,e,r,n);return(!isFinite(o)||o<=0)&&si(i,function(i){return o=Kl(t,e,i,n),isFinite(o)&&o>0}),o}(t,i,g,_);if(!isFinite(v)||v<=0)return void(this.state=4);if(this.triangulation_=new class{constructor(t,e,i,n,r,o){this.sourceProj_=t,this.targetProj_=e;let s={};const a=Or(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return s[e]||(s[e]=a(t)),s[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&vi(n)==vi(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?vi(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?vi(this.targetProj_.getExtent()):null;const l=mi(i),c=_i(i),h=ci(i),u=li(i),d=this.transformInv_(l),p=this.transformInv_(c),f=this.transformInv_(h),g=this.transformInv_(u),m=10+(o?Math.max(0,Math.ceil(Math.log2(ai(i)/(o*o*256*256)))):0);if(this.addQuad_(l,c,h,u,d,p,f,g,m),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach(function(e,i,n){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])}),this.triangles_.forEach((function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const n=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-n<this.sourceWorldWidth_/2&&(e.source=i)}}).bind(this))}s={}}addTriangle_(t,e,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[t,e,i]})}addQuad_(t,e,i,n,r,o,s,a,l){const c=Be([r,o,s,a]),h=this.sourceWorldWidth_?vi(c)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&h>.5&&h<1;let p=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=vi(Be([t,e,i,n]))/this.targetWorldWidth_>.25||p),!d&&this.sourceProj_.isGlobal()&&h&&(p=h>.25||p)),!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!yi(c,this.maxSourceExtent_))return;let f=0;if(!(p||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1])))if(l>0)p=!0;else if(f=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(s[0])&&isFinite(s[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1),1!=f&&2!=f&&4!=f&&8!=f)return;if(l>0){if(!p){const e=this.transformInv_([(t[0]+i[0])/2,(t[1]+i[1])/2]);let n;n=d?(ki(r[0],u)+ki(s[0],u))/2-ki(e[0],u):(r[0]+s[0])/2-e[0];const o=(r[1]+s[1])/2-e[1];p=n*n+o*o>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const c=[(e[0]+i[0])/2,(e[1]+i[1])/2],h=this.transformInv_(c),u=[(n[0]+t[0])/2,(n[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,c,u,r,o,h,d,l-1),this.addQuad_(u,c,i,n,d,h,s,a,l-1)}else{const c=[(t[0]+e[0])/2,(t[1]+e[1])/2],h=this.transformInv_(c),u=[(i[0]+n[0])/2,(i[1]+n[1])/2],d=this.transformInv_(u);this.addQuad_(t,c,u,n,r,h,d,a,l-1),this.addQuad_(c,e,i,u,h,o,s,d,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&f)&&this.addTriangle_(t,i,n,r,s,a),0==(14&f)&&this.addTriangle_(t,i,e,r,s,o),f&&(0==(13&f)&&this.addTriangle_(e,n,t,o,a,r),0==(7&f)&&this.addTriangle_(e,n,i,o,a,s))}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,i,n){const r=e.source;ni(t,r[0]),ni(t,r[1]),ni(t,r[2])}),t}getTriangles(){return this.triangles_}}(t,i,g,f,v*(void 0!==c?c:.5),_),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=e.getZForResolution(v);let y=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(y[1]=bi(y[1],f[1],f[3]),y[3]=bi(y[3],f[1],f[3])):y=gi(y,f)),ai(y)){const t=e.getTileRangeForExtentAndZ(y,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=l(this.sourceZ_,e,i,s);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((function(e,i,n){e&&2==e.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}).bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=3;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n="number"==typeof i?i:i[0],r="number"==typeof i?i:i[1],o=this.targetTileGrid_.getResolution(e),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(t,e,i,n,r,o,s,a,l,c,h,u){const d=fn(Math.round(i*t),Math.round(i*e),Wl);if(u||(d.imageSmoothingEnabled=!1),0===l.length)return d.canvas;function p(t){return Math.round(t*i)/i}d.scale(i,i),d.globalCompositeOperation="lighter";const f=[1/0,1/0,-1/0,-1/0];l.forEach(function(t,e,i){ii(f,t.extent)});const g=vi(f),m=fi(f),_=fn(Math.round(i*g/n),Math.round(i*m/n));u||(_.imageSmoothingEnabled=!1);const v=i/n;l.forEach(function(t,e,i){const n=t.extent[0]-f[0],r=-(t.extent[3]-f[3]),o=vi(t.extent),s=fi(t.extent);t.image.width>0&&t.image.height>0&&_.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,n*v,r*v,o*v,s*v)});const y=mi(s);return a.getTriangles().forEach(function(t,e,r){const s=t.source,a=t.target;let l=s[0][0],c=s[0][1],h=s[1][0],g=s[1][1],m=s[2][0],v=s[2][1];const w=p((a[0][0]-y[0])/o),x=p(-(a[0][1]-y[1])/o),b=p((a[1][0]-y[0])/o),C=p(-(a[1][1]-y[1])/o),T=p((a[2][0]-y[0])/o),S=p(-(a[2][1]-y[1])/o),k=l,E=c;l=0,c=0,h-=k,g-=E,m-=k,v-=E;const P=function(t){const e=t.length;for(let n=0;n<e;n++){let i=n,r=Math.abs(t[n][n]);for(let s=n+1;s<e;s++){const e=Math.abs(t[s][n]);e>r&&(r=e,i=s)}if(0===r)return null;const o=t[i];t[i]=t[n],t[n]=o;for(let s=n+1;s<e;s++){const i=-t[s][n]/t[n][n];for(let r=n;r<e+1;r++)n==r?t[s][r]=0:t[s][r]+=i*t[n][r]}}const i=new Array(e);for(let n=e-1;n>=0;n--){i[n]=t[n][e]/t[n][n];for(let r=n-1;r>=0;r--)t[r][e]-=t[r][n]*i[n]}return i}([[h,g,0,0,b-w],[m,v,0,0,T-w],[0,0,h,g,C-x],[0,0,m,v,S-x]]);if(P){if(d.save(),d.beginPath(),function(){if(void 0===Xl){const t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",Hl(t,4,5,4,0),Hl(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;Xl=Jl(e,0)||Jl(e,4)||Jl(e,8)}return Xl}()||!u){d.moveTo(b,C);const t=4,e=w-b,i=x-C;for(let n=0;n<t;n++)d.lineTo(b+p((n+1)*e/t),C+p(n*i/(t-1))),n!=t-1&&d.lineTo(b+p((n+1)*e/t),C+p((n+1)*i/(t-1)));d.lineTo(T,S)}else d.moveTo(b,C),d.lineTo(w,x),d.lineTo(T,S);d.clip(),d.transform(P[0],P[2],P[1],P[3],w,x),d.translate(f[0]-k,f[3]-E),d.scale(n/i,-n/i),d.drawImage(_.canvas,0,0),d.restore()}}),h&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(t,e,i){const n=t.target,r=(n[0][0]-y[0])/o,s=-(n[0][1]-y[1])/o,a=(n[1][0]-y[0])/o,l=-(n[1][1]-y[1])/o,c=(n[2][0]-y[0])/o,h=-(n[2][1]-y[1])/o;d.beginPath(),d.moveTo(a,l),d.lineTo(r,s),d.lineTo(c,h),d.closePath(),d.stroke()}),d.restore()),d.canvas}(n,r,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(e,i,n){const r=e.getState();if(0==r||1==r){t++;const i=re(e,Jt,function(n){const r=e.getState();2!=r&&3!=r&&4!=r||(se(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}).bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,e,i){0==t.getState()&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(se),this.sourcesListenerKeys_=null}release(){this.canvas_&&(gn(this.canvas_.getContext("2d")),Wl.push(this.canvas_),this.canvas_=null),super.release()}};class tc{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ec(t,e,i,n,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=i,r.maxY=n,r):new tc(t,e,i,n)}const ic=tc,nc=class extends Ia{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedProjection=null,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new ic(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!n}getTile(t,e,i,n){const r=n.pixelRatio,o=n.viewState.projection,s=this.getLayer();let a=s.getSource().getTile(t,e,i,r,o);return 3==a.getState()&&s.getUseInterimTilesOnError()&&s.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=Ze(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!Ye(r,n))return null;const o=e.pixelRatio,s=e.viewState.projection,a=e.viewState,l=i.getRenderSource(),c=l.getTileGridForProjection(a.projection),h=l.getTilePixelRatio(e.pixelRatio);for(let u=c.getZForResolution(a.resolution);u>=c.getMinZoom();--u){const t=c.getTileCoordForCoordAndZ(n,u),e=l.getTile(u,t[1],t[2],o,s);if(!(e instanceof Yl||e instanceof Ql)||e instanceof Ql&&4===e.getState())return null;if(2!==e.getState())continue;const i=c.getOrigin(u),r=Rs(c.getTileSize(u)),d=c.getResolution(u),p=Math.floor(h*((n[0]-i[0])/d-t[1]*r[0])),f=Math.floor(h*((i[1]-n[1])/d-t[2]*r[1])),g=Math.round(h*l.getGutterForProjection(a.projection));return this.getImageData(e.getImage(),p+g,f+g)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,o=n.resolution,s=n.center,a=n.rotation,l=t.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getRevision(),d=h.getTileGridForProjection(r),p=d.getZForResolution(o,h.zDirection),f=d.getResolution(p);let g=t.extent;const m=t.viewState.resolution,_=h.getTilePixelRatio(l),v=Math.round(vi(g)/m*l),y=Math.round(fi(g)/m*l),w=i.extent&&jr(i.extent);w&&(g=gi(g,jr(i.extent)));const x=f*v/2/_,b=f*y/2/_,C=[s[0]-x,s[1]-b,s[0]+x,s[1]+b],T=d.getTileRangeForExtentAndZ(g,p),S={};S[p]={};const k=this.createLoadedTileFinder(h,r,S),E=this.tmpExtent,P=this.tmpTileRange_;this.newTiles_=!1;const M=a?pi(n.center,m,a,t.size):void 0;for(let N=T.minX;N<=T.maxX;++N)for(let e=T.minY;e<=T.maxY;++e){if(a&&!d.tileCoordIntersectsViewport([p,N,e],M))continue;const n=this.getTile(p,N,e,t);if(this.isDrawableTile(n)){const e=ue(this);if(2==n.getState()){S[p][n.tileCoord.toString()]=n;let t=n.inTransition(e);t&&1!==i.opacity&&(n.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(n)||(this.newTiles_=!0)}if(1===n.getAlpha(e,t.time))continue}const r=d.getTileCoordChildTileRange(n.tileCoord,P,E);let o=!1;r&&(o=k(p+1,r)),o||d.forEachTileCoordParentTileRange(n.tileCoord,k,P,E)}const I=f/o*l/_;je(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/l,1/l,a,-v/2,-y/2);const L=Ve(this.pixelTransform);this.useContainer(e,L,this.getBackground(t));const A=this.context,R=A.canvas;Ge(this.inversePixelTransform,this.pixelTransform),je(this.tempTransform,v/2,y/2,I,I,0,-v/2,-y/2),R.width!=v||R.height!=y?(R.width=v,R.height=y):this.containerReused||A.clearRect(0,0,v,y),w&&this.clipUnrotated(A,t,w),h.getInterpolate()||(A.imageSmoothingEnabled=!1),this.preRender(A,t),this.renderedTiles.length=0;let O,F,D,Z=Object.keys(S).map(Number);Z.sort(Gt),1!==i.opacity||this.containerReused&&!h.getOpaque(t.viewState.projection)?(O=[],F=[]):Z=Z.reverse();for(let N=Z.length-1;N>=0;--N){const e=Z[N],i=h.getTilePixelSize(e,l,r),n=d.getResolution(e)/f,o=i[0]*n*I,s=i[1]*n*I,a=d.getTileCoordForCoordAndZ(mi(C),e),c=d.getTileCoordExtent(a),u=Ze(this.tempTransform,[_*(c[0]-C[0])/f,_*(C[3]-c[3])/f]),g=_*h.getGutterForProjection(r),m=S[e];for(const r in m){const i=m[r],n=i.tileCoord,l=a[1]-n[1],c=Math.round(u[0]-(l-1)*o),d=a[2]-n[2],f=Math.round(u[1]-(d-1)*s),_=Math.round(u[0]-l*o),v=Math.round(u[1]-d*s),y=c-_,w=f-v,x=p===e,b=x&&1!==i.getAlpha(ue(this),t.time);let C=!1;if(!b)if(O){D=[_,v,_+y,v,_+y,v+w,_,v+w];for(let t=0,i=O.length;t<i;++t)if(p!==e&&e<F[t]){const e=O[t];yi([_,v,_+y,v+w],[e[0],e[3],e[4],e[7]])&&(C||(A.save(),C=!0),A.beginPath(),A.moveTo(D[0],D[1]),A.lineTo(D[2],D[3]),A.lineTo(D[4],D[5]),A.lineTo(D[6],D[7]),A.moveTo(e[6],e[7]),A.lineTo(e[4],e[5]),A.lineTo(e[2],e[3]),A.lineTo(e[0],e[1]),A.clip())}O.push(D),F.push(e)}else A.clearRect(_,v,y,w);this.drawTileImage(i,t,_,v,y,w,g,x),O&&!b?(C&&A.restore(),this.renderedTiles.unshift(i)):this.renderedTiles.push(i),this.updateUsedTiles(t.usedTiles,h,i)}}return this.renderedRevision=u,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!ei(this.renderedExtent_,C),this.renderedExtent_=C,this.renderedPixelRatio=l,this.renderedProjection=r,this.manageTilePyramid(t,h,d,l,r,g,p,c.getPreload()),this.scheduleExpireCache(t,h),this.postRender(A,t),i.extent&&A.restore(),A.imageSmoothingEnabled=!0,L!==R.style.transform&&(R.style.transform=L),this.container}drawTileImage(t,e,i,n,r,o,s,a){const l=this.getTileImage(t);if(!l)return;const c=ue(this),h=e.layerStatesArray[e.layerIndex],u=h.opacity*(a?t.getAlpha(c,e.time):1),d=u!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,s,s,l.width-2*s,l.height-2*s,i,n,r,o),d&&this.context.restore(),u!==h.opacity?e.animate=!0:a&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(t,e,i){const n=ue(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=ue(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,r,o,s,a,l){const c=ue(e);c in t.wantedTiles||(t.wantedTiles[c]={});const h=t.wantedTiles[c],u=t.tileQueue,d=i.getMinZoom(),p=t.viewState.rotation,f=p?pi(t.viewState.center,t.viewState.resolution,p,t.size):void 0;let g,m,_,v,y,w,x=0;for(w=d;w<=s;++w)for(m=i.getTileRangeForExtentAndZ(o,w,m),_=i.getResolution(w),v=m.minX;v<=m.maxX;++v)for(y=m.minY;y<=m.maxY;++y)p&&!i.tileCoordIntersectsViewport([w,v,y],f)||(s-w<=a?(++x,g=e.getTile(w,v,y,n,r),0==g.getState()&&(h[g.getKey()]=!0,u.isKeyQueued(g.getKey())||u.enqueue([g,c,i.getTileCoordCenter(g.tileCoord),_])),void 0!==l&&l(g)):e.useTile(w,v,y,r));e.updateCacheSize(x,r)}},rc={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},oc={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},sc=class extends nc{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedPixelToCoordinateTransform_=null,this.tmpTransform_=[1,0,0,1,0,0]}prepareTile(t,e,i){let n;const r=t.getState();return 2!==r&&3!==r||(this.updateExecutorGroup_(t,e,i),this.tileImageNeedsRender_(t)&&(n=!0)),n}getTile(t,e,i,n){const r=n.pixelRatio,o=n.viewState,s=o.resolution,a=o.projection,l=this.getLayer(),c=l.getSource().getTile(t,e,i,r,a),h=n.viewHints,u=!(h[0]||h[1]);return!u&&c.wantedResolution||(c.wantedResolution=s),this.prepareTile(c,r,a)&&(u||Date.now()-n.time<8)&&"vector"!==l.getRenderMode()&&this.renderTileImage_(c,n),super.getTile(t,e,i,n)}isDrawableTile(t){const e=this.getLayer();return super.isDrawableTile(t)&&("vector"===e.getRenderMode()?ue(e)in t.executorGroups:t.hasContext(e))}getTileImage(t){return t.getImage(this.getLayer())}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,i){const n=this.getLayer(),r=n.getRevision(),o=n.getRenderOrder()||null,s=t.wantedResolution,a=t.getReplayState(n);if(!a.dirty&&a.renderedResolution===s&&a.renderedRevision==r&&a.renderedRenderOrder==o)return;const l=n.getSource(),c=n.getDeclutter(),h=l.getTileGrid(),u=l.getTileGridForProjection(i).getTileCoordExtent(t.wrappedTileCoord),d=l.getSourceTiles(e,i,t),p=ue(n);delete t.hitDetectionImageData[p],t.executorGroups[p]=[],c&&(t.declutterExecutorGroups[p]=[]),a.dirty=!1;for(let f=0,g=d.length;f<g;++f){const i=d[f];if(2!=i.getState())continue;const r=h.getTileCoordExtent(i.tileCoord),g=gi(u,r),m=qe(g,n.getRenderBuffer()*s,this.tmpExtent),_=ei(r,g)?null:m,v=new ka(0,m,s,e),y=c?new ka(0,g,s,e):void 0,w=Ka(s,e),x=function(t){let e;const i=t.getStyleFunction()||n.getStyleFunction();if(i&&(e=i(t,s)),e){const i=this.renderFeature(t,w,e,v,y);a.dirty=a.dirty||i}},b=i.getFeatures();o&&o!==a.renderedRenderOrder&&b.sort(o);for(let t=0,e=b.length;t<e;++t){const e=b[t];_&&!yi(_,e.getGeometry().getExtent())||x.call(this,e)}const C=v.finish(),T="vector"!==n.getRenderMode()&&c&&1===d.length?null:g,S=new Ua(T,s,e,l.getOverlaps(),C,n.getRenderBuffer());if(t.executorGroups[p].push(S),y){const i=new Ua(null,s,e,l.getOverlaps(),y.finish(),n.getRenderBuffer());t.declutterExecutorGroups[p].push(i)}}a.renderedRevision=r,a.renderedRenderOrder=o,a.renderedResolution=s}forEachFeatureAtCoordinate(t,e,i,n,r){const o=e.viewState.resolution,s=e.viewState.rotation;i=null==i?0:i;const a=this.getLayer(),l=a.getSource().getTileGridForProjection(e.viewState.projection),c=Be([t]);qe(c,o*i,c);const h={},u=function(t,e,i){let o=t.getId();void 0===o&&(o=ue(t));const s=h[o];if(s){if(!0!==s&&i<s.distanceSq){if(0===i)return h[o]=!0,r.splice(r.lastIndexOf(s),1),n(t,a,e);s.geometry=e,s.distanceSq=i}}else{if(0===i)return h[o]=!0,n(t,a,e);r.push(h[o]={feature:t,layer:a,geometry:e,distanceSq:i,callback:n})}},d=this.renderedTiles;let p;for(let f=0,g=d.length;!p&&f<g;++f){const n=d[f];if(!yi(l.getTileCoordExtent(n.wrappedTileCoord),c))continue;const r=ue(a),h=[n.executorGroups[r]],g=n.declutterExecutorGroups[r];g&&h.push(g),h.some(n=>{const r=n===g?e.declutterTree.all().map(t=>t.value):null;for(let e=0,a=n.length;e<a;++e)if(p=n[e].forEachFeatureAtCoordinate(t,o,s,i,u,r),p)return!0})}return p}getFeatures(t){return new Promise((function(e,i){const n=this.getLayer(),r=ue(n),o=n.getSource(),s=this.renderedProjection,a=s.getExtent(),l=this.renderedResolution,c=o.getTileGridForProjection(s),h=Ze(this.renderedPixelToCoordinateTransform_,t.slice()),u=c.getTileCoordForCoordAndResolution(h,l);let d;for(let t=0,_=this.renderedTiles.length;t<_;++t)if(u.toString()===this.renderedTiles[t].tileCoord.toString()){if(d=this.renderedTiles[t],2===d.getState()){const t=c.getTileCoordExtent(d.tileCoord);o.getWrapX()&&s.canWrapX()&&!Xe(a,t)&&on(h,s);break}d=void 0}if(!d||d.loadingSourceTiles>0)return void e([]);const p=mi(c.getTileCoordExtent(d.wrappedTileCoord)),f=[(h[0]-p[0])/l,(p[1]-h[1])/l],g=d.getSourceTiles().reduce(function(t,e){return t.concat(e.getFeatures())},[]);let m=d.hitDetectionImageData[r];if(!m&&!this.animatingOrInteracting_){const t=Rs(c.getTileSize(c.getZForResolution(l,o.zDirection))),e=this.renderedRotation_;m=Xa(t,[this.getRenderTransform(c.getTileCoordCenter(d.wrappedTileCoord),l,0,Ya,t[0]*Ya,t[1]*Ya,0)],g,n.getStyleFunction(),c.getTileCoordExtent(d.wrappedTileCoord),d.getReplayState(n).renderedResolution,e),d.hitDetectionImageData[r]=m}e(Wa(f,g,m))}).bind(this))}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t){const e=this.context,i=e.globalAlpha;e.globalAlpha=this.getLayer().getOpacity();const n=t.viewHints,r=!(n[0]||n[1]),o=this.renderedTiles;for(let s=0,a=o.length;s<a;++s){const e=o[s],i=e.declutterExecutorGroups[ue(this.getLayer())];if(i)for(let n=i.length-1;n>=0;--n)i[n].execute(this.context,1,this.getTileRenderTransform(e,t),t.viewState.rotation,r,void 0,t.declutterTree)}e.globalAlpha=i}getTileRenderTransform(t,e){const i=e.pixelRatio,n=e.viewState,r=n.center,o=n.resolution,s=n.rotation,a=e.size,l=Math.round(a[0]*i),c=Math.round(a[1]*i),h=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),u=t.tileCoord,d=h.getTileCoordExtent(t.wrappedTileCoord),p=h.getTileCoordExtent(u,this.tmpExtent)[0]-d[0];return Fe(Ne(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(r,o,s,i,l,c,p))}postRender(t,e){const i=e.viewHints,n=!(i[0]||i[1]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation;const r=this.getLayer(),o=r.getRenderMode(),s=t.globalAlpha;t.globalAlpha=r.getOpacity();const a=oc[o],l=e.viewState,c=l.rotation,h=r.getSource(),u=h.getTileGridForProjection(l.projection).getZForResolution(l.resolution,h.zDirection),d=this.renderedTiles,p=[],f=[];let g=!0;for(let m=d.length-1;m>=0;--m){const i=d[m];g=g&&!i.getReplayState(r).dirty;const o=i.executorGroups[ue(r)].filter(t=>t.hasExecutors(a));if(0===o.length)continue;const s=this.getTileRenderTransform(i,e),l=i.tileCoord[0];let h=!1;const _=o[0].getClipCoords(s);if(_){for(let e=0,i=p.length;e<i;++e)if(u!==l&&l<f[e]){const i=p[e];yi([_[0],_[3],_[4],_[7]],[i[0],i[3],i[4],i[7]])&&(h||(t.save(),h=!0),t.beginPath(),t.moveTo(_[0],_[1]),t.lineTo(_[2],_[3]),t.lineTo(_[4],_[5]),t.lineTo(_[6],_[7]),t.moveTo(i[6],i[7]),t.lineTo(i[4],i[5]),t.lineTo(i[2],i[3]),t.lineTo(i[0],i[1]),t.clip())}p.push(_),f.push(l)}for(let e=0,r=o.length;e<r;++e)o[e].execute(t,1,s,c,n,a);h&&t.restore()}t.globalAlpha=s,this.ready=g,super.postRender(t,e)}renderFeature(t,e,i,n,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let s=0,a=i.length;s<a;++s)o=tl(n,t,i[s],e,this.boundHandleStyleImageChange_,void 0,r)||o;else o=tl(n,t,i,e,this.boundHandleStyleImageChange_,void 0,r);return o}tileImageNeedsRender_(t){const e=this.getLayer();if("vector"===e.getRenderMode())return!1;const i=t.getReplayState(e),n=e.getRevision();return i.renderedTileResolution!==t.wantedResolution||i.renderedTileRevision!==n}renderTileImage_(t,e){const i=this.getLayer(),n=t.getReplayState(i),r=i.getRevision(),o=t.executorGroups[ue(i)];n.renderedTileRevision=r;const s=t.wrappedTileCoord,a=s[0],l=i.getSource();let c=e.pixelRatio;const h=e.viewState.projection,u=l.getTileGridForProjection(h),d=u.getResolution(t.tileCoord[0]),p=e.pixelRatio/t.wantedResolution*d,f=u.getResolution(a),g=t.getContext(i);c=Math.round(Math.max(c,p/c));const m=l.getTilePixelSize(a,c,h);g.canvas.width=m[0],g.canvas.height=m[1];const _=c/p;if(1!==_){const t=Oe(this.tmpTransform_);Ne(t,_,_),g.setTransform.apply(g,t)}const v=u.getTileCoordExtent(s,this.tmpExtent),y=p/f,w=Oe(this.tmpTransform_);Ne(w,y,-y),function(t,e,i){Fe(t,De(Re,1,0,0,1,e,i))}(w,-v[0],-v[3]);for(let x=0,b=o.length;x<b;++x)o[x].execute(g,_,w,0,!0,rc[i.getRenderMode()]);n.renderedTileResolution=t.wantedResolution}},ac="preload",lc="useInterimTilesOnError",cc=class extends pa{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e);const i=t.renderMode||"hybrid";_e("hybrid"==i||"vector"==i,28),this.renderMode_=i,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}createRenderer(){return new sc(this)}getFeatures(t){return super.getFeatures(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(ac)}getUseInterimTilesOnError(){return this.get(lc)}setPreload(t){this.set(ac,t)}setUseInterimTilesOnError(t){this.set(lc,t)}},hc=class extends fl{constructor(t){super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=void 0!==t.distance?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(t){const e=t.getGeometry();return _e("Point"==e.getType(),10),e},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,e,i){this.source.loadFeatures(t,e,i),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(Jt,this.boundRefresh_),this.source=t,t&&t.addEventListener(Jt,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,e){const i=0===t?0:Math.min(e,t)/t,n=t!==this.distance||this.interpolationRatio!==i;this.distance=t,this.minDistance=e,this.interpolationRatio=i,n&&this.refresh()}cluster(){if(void 0===this.resolution||!this.source)return;const t=[1/0,1/0,-1/0,-1/0],e=this.distance*this.resolution,i=this.source.getFeatures(),n={};for(let r=0,o=i.length;r<o;r++){const o=i[r];if(!(ue(o)in n)){const i=this.geometryFunction(o);if(i){Qe(i.getCoordinates(),t),qe(t,e,t);const r=this.source.getFeaturesInExtent(t).filter(function(t){const e=ue(t);return!(e in n)&&(n[e]=!0,!0)});this.features.push(this.createCluster(r,t))}}}}createCluster(t,e){const i=[0,0];for(let s=t.length-1;s>=0;--s){const e=this.geometryFunction(t[s]);e?tn(i,e.getCoordinates()):t.splice(s,1)}rn(i,1/t.length);const n=hi(e),r=this.interpolationRatio,o=new Po([i[0]*(1-r)+n[0]*r,i[1]*(1-r)+n[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(o,t):new ye({geometry:o,features:t})}};function uc(t,e,i,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=i,n):[t,e,i]}function dc(t,e,i){return t+"/"+e+"/"+i}function pc(t){return dc(t[0],t[1],t[2])}function fc(t){return t.split("/").map(Number)}const gc=class extends class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return _e(void 0!==i,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return _e(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){_e(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=fc(this.peekFirstKey())[0];this.forEach((function(e){e.tileCoord[0]!==t&&(this.remove(pc(e.tileCoord)),e.release())}).bind(this))}},mc=[0,0,0],_c=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,_e(function(t,e,i){const n=function(t,e){return e-t}||Gt;return t.every(function(e,i){if(0===i)return!0;const r=n(t[i-1],e);return!(r>0||0===r)})}(this.resolutions_),17),!t.origins)for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(e){if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}else e=this.resolutions_[n]/this.resolutions_[n+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,_e(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=mi(i)),_e(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,_e(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,_e(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){const n=new ic(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(i){const t=this.getTileRangeForExtentAndZ(i,e);n.minX=Math.max(t.minX,n.minX),n.maxX=Math.min(t.maxX,n.maxX),n.minY=Math.max(t.minY,n.minY),n.maxY=Math.min(t.maxY,n.maxY)}return n},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let t=n.minY,s=n.maxY;t<=s;++t)i([e,r,t])}forEachTileCoordParentTileRange(t,e,i,n){let r,o,s,a=null,l=t[0]-1;for(2===this.zoomFactor_?(o=t[1],s=t[2]):a=this.getTileCoordExtent(t,n);l>=this.minZoom;){if(2===this.zoomFactor_?(o=Math.floor(o/2),s=Math.floor(s/2),r=ec(o,o,s,s,i)):r=this.getTileRangeForExtentAndZ(a,l,i),e(l,r))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],n=2*t[2];return ec(i,i+1,n,n+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],r=t[1],o=t[2];if(e===n)return ec(r,o,r,o,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-n),s=Math.floor(r*t),a=Math.floor(o*t);return e<n?ec(s,s,a,a,i):ec(s,Math.floor(t*(r+1))-1,a,Math.floor(t*(o+1))-1,i)}const s=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e,i)}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),r=this.getResolution(t),o=Rs(this.getTileSize(t),this.tmpSize_);return Je(n[0]+e.minX*o[0]*r,n[1]+e.minY*o[1]*r,n[0]+(e.maxX+1)*o[0]*r,n[1]+(e.maxY+1)*o[1]*r,i)}getTileRangeForExtentAndZ(t,e,i){const n=mc;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const r=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),ec(r,n[1],o,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=Rs(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=Rs(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*n,s=i[1]-(t[2]+1)*r[1]*n;return Je(o,s,o+r[0]*n,s+r[1]*n,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,r){const o=this.getZForResolution(i),s=i/this.getResolution(o),a=this.getOrigin(o),l=Rs(this.getTileSize(o),this.tmpSize_);let c=s*(t-a[0])/i/l[0],h=s*(a[1]-e)/i/l[1];return n?(c=Ii(c,5)-1,h=Ii(h,5)-1):(c=Mi(c,5),h=Mi(h,5)),uc(o,c,h,r)}getTileCoordForXYAndZ_(t,e,i,n,r){const o=this.getOrigin(i),s=this.getResolution(i),a=Rs(this.getTileSize(i),this.tmpSize_);let l=(t-o[0])/s/a[0],c=(o[1]-e)/s/a[1];return n?(l=Ii(l,5)-1,c=Ii(c,5)-1):(l=Mi(l,5),c=Mi(c,5)),uc(i,l,c,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return bi(zt(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Do(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}};function vc(t){let e=t.getDefaultTileGrid();return e||(e=function(t,e,i,n){return function(t,e,i,n){n=void 0!==n?n:"top-left";const r=wc(t,void 0,i);return new _c({extent:t,origin:ui(t,n),resolutions:r,tileSize:i})}(xc(t),0,void 0,void 0)}(t),t.setDefaultTileGrid(e)),e}function yc(t){const e=t||{},i=e.extent||kr("EPSG:3857").getExtent(),n={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:wc(i,e.maxZoom,e.tileSize,e.maxResolution)};return new _c(n)}function wc(t,e,i,n){e=void 0!==e?e:42,i=Rs(void 0!==i?i:256);const r=fi(t),o=vi(t);n=n>0?n:Math.max(o/i[0],r/i[1]);const s=e+1,a=new Array(s);for(let l=0;l<s;++l)a[l]=n/Math.pow(2,l);return a}function xc(t){let e=(t=kr(t)).getExtent();if(!e){const i=180*rr.degrees/t.getMetersPerUnit();e=Je(-i,-i,i,i)}return e}class bc extends Zt{constructor(t,e){super(t),this.tile=e}}const Cc=class extends al{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.tileGrid&&Rs(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new gc(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const r=this.getTileCacheForProjection(t);if(!r)return!1;let o,s,a,l=!0;for(let c=i.minX;c<=i.maxX;++c)for(let t=i.minY;t<=i.maxY;++t)s=dc(e,c,t),a=!1,r.containsKey(s)&&(o=r.get(s),a=2===o.getState(),a&&(a=!1!==n(o))),a||(l=!1);return l}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,r){return ce()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:vc(t)}getTileCacheForProjection(t){const e=this.getProjection();return _e(null===e||Ar(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=Rs(n.getTileSize(t),this.tmpSize);return 1==r?o:(void 0===(l=this.tmpSize)&&(l=[0,0]),l[0]=(s=o)[0]*(a=r)+.5|0,l[1]=s[1]*a+.5|0,l);var s,a,l}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=function(t,e,i){const n=e[0],r=t.getTileCoordCenter(e),o=xc(i);if(Ye(o,r))return e;{const e=vi(o),i=Math.ceil((o[0]-r[0])/e);return r[0]+=e*i,t.getTileCoordForCoordAndZ(r,n)}}(i,t,e)),function(t,e){const i=t[0],n=t[1],r=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const o=e.getFullTileRange(i);return!o||o.containsXY(n,r)}(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}};function Tc(t,e){const i=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,o=/\{-y\}/g;return function(s,a,l){return s?t.replace(i,s[0].toString()).replace(n,s[1].toString()).replace(r,s[2].toString()).replace(o,function(){const t=e.getFullTileRange(s[0]);return _e(t,55),(t.getHeight()-s[2]-1).toString()}):void 0}}class Sc extends Cc{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Sc.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=ue(e),n=e.getState();let r;1==n?(this.tileLoadingKeys_[i]=!0,r="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=3==n?"tileloaderror":2==n?"tileloadend":void 0),null!=r&&this.dispatchEvent(new bc(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=function(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const n=i[1].charCodeAt(0),r=i[2].charCodeAt(0);let o;for(o=n;o<=r;++o)e.push(t.replace(i[0],String.fromCharCode(o)));return e}if(i=/\{(\d+)-(\d+)\}/.exec(t),i){const n=parseInt(i[2],10);for(let r=parseInt(i[1],10);r<=n;r++)e.push(t.replace(i[0],r.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=Tc(t[r],e);return function(t){return 1===t.length?t[0]:function(e,i,n){if(e){const r=ki(function(t){return(t[1]<<t[0])+t[2]}(e),t.length);return t[r](e,i,n)}}}(n)}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=dc(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const kc=Sc;function Ec(t,e){t.getImage().src=e}const Pc=class extends kc{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Ec,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:Yl,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const n in this.tileCacheForProjection){const t=this.tileCacheForProjection[n];t.expireCache(t==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ar(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!Ar(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(!this.tileGrid||e&&!Ar(e,t)){const e=ue(t);return e in this.tileGridForProjection||(this.tileGridForProjection[e]=vc(t)),this.tileGridForProjection[e]}return this.tileGrid}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ar(e,t))return this.tileCache;{const e=ue(t);return e in this.tileCacheForProjection||(this.tileCacheForProjection[e]=new gc(this.tileCache.highWaterMark)),this.tileCacheForProjection[e]}}createTile_(t,e,i,n,r,o){const s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,r),l=a?this.tileUrlFunction(a,n,r):void 0,c=new this.tileClass(s,void 0!==l?0:4,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(Jt,this.handleTileChange.bind(this)),c}getTile(t,e,i,n,r){const o=this.getProjection();if(o&&r&&!Ar(o,r)){const s=this.getTileCacheForProjection(r),a=[t,e,i];let l;const c=pc(a);s.containsKey(c)&&(l=s.get(c));const h=this.getKey();if(l&&l.key==h)return l;{const t=this.getTileGridForProjection(o),e=this.getTileGridForProjection(r),i=this.getTileCoordForTileUrlFunction(a,r),u=new Ql(o,t,r,e,a,i,this.getTilePixelRatio(n),this.getGutter(),(function(t,e,i,n){return this.getTileInternal(t,e,i,n,o)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return u.key=h,l?(u.interimTile=l,u.refreshInterimChain(),s.replace(c,u)):s.set(c,u),u}}return this.getTileInternal(t,e,i,n,o||r)}getTileInternal(t,e,i,n,r){let o=null;const s=dc(t,e,i),a=this.getKey();if(this.tileCache.containsKey(s)){if(o=this.tileCache.get(s),o.key!=a){const l=o;o=this.createTile_(t,e,i,n,r,a),o.interimTile=0==l.getState()?l.interimTile:l,o.refreshInterimChain(),this.tileCache.replace(s,o)}}else o=this.createTile_(t,e,i,n,r,a),this.tileCache.set(s,o);return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){const i=kr(t);if(i){const t=ue(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Mc=class extends Pc{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:yc({extent:xc(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Ic=class extends $l{constructor(t,e,i,n,r,o){super(t,e,o),this.extent=null,this.format_=n,this.features_=null,this.projection=null,this.tileLoadFunction_=r,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){0==this.state&&(this.setState(1),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,e){this.setFeatures(t)}onError(){this.setState(3)}setFeatures(t){this.features_=t,this.setState(2)}setLoader(t){this.loader_=t}},Lc=[],Ac=class extends $l{constructor(t,e,i,n){super(t,e,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=i}getContext(t){const e=ue(t);return e in this.context_||(this.context_[e]=fn(1,1,Lc)),this.context_[e]}hasContext(t){return ue(t)in this.context_}getImage(t){return this.hasContext(t)?this.getContext(t).canvas:null}getReplayState(t){const e=ue(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(const t in this.context_){const e=this.context_[t];gn(e),Lc.push(e.canvas),delete this.context_[t]}super.release()}},Rc=class extends kc{constructor(t){const e=t.projection||"EPSG:3857",i=t.extent||xc(e),n=t.tileGrid||yc({extent:i,maxResolution:t.maxResolution,maxZoom:void 0!==t.maxZoom?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:e,state:t.state,tileGrid:n,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Oc,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:void 0===t.zDirection?1:t.zDirection}),this.format_=t.format?t.format:null,this.sourceTileCache=new gc(this.tileCache.highWaterMark),this.overlaps_=null==t.overlaps||t.overlaps,this.tileClass=t.tileClass?t.tileClass:Ic,this.tileGrids_={}}getFeaturesInExtent(t){const e=[],i=this.tileCache;if(0===i.getCount())return e;const n=fc(i.peekFirstKey())[0],r=this.tileGrid;return i.forEach(function(i){if(i.tileCoord[0]!==n||2!==i.getState())return;const o=i.getSourceTiles();for(let n=0,s=o.length;n<s;++n){const i=o[n];if(yi(t,r.getTileCoordExtent(i.tileCoord))){const n=i.getFeatures();if(n)for(let i=0,r=n.length;i<r;++i){const r=n[i],o=r.getGeometry();yi(t,o.getExtent())&&e.push(r)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(t,e){const i=this.getTileCacheForProjection(t),n=Object.keys(e).reduce((t,e)=>{const n=function(t){const[e,i,n]=t.substring(t.lastIndexOf("/")+1,t.length).split(",").map(Number);return dc(e,i,n)}(e),r=i.peek(n);if(r){const e=r.sourceTiles;for(let i=0,n=e.length;i<n;++i)t[e[i].getKey()]=!0}return t},{});super.expireCache(t,e),this.sourceTileCache.expireCache(n)}getSourceTiles(t,e,i){if(0===i.getState()){i.setState(1);const n=i.wrappedTileCoord,r=this.getTileGridForProjection(e),o=r.getTileCoordExtent(n),s=r.getResolution(n[0]);qe(o,-s,o);const a=this.tileGrid,l=a.getExtent();l&&gi(o,l,o);const c=a.getZForResolution(s,this.zDirection);a.forEachTileCoord(o,c,n=>{const r=this.tileUrlFunction(n,t,e),o=this.sourceTileCache.containsKey(r)?this.sourceTileCache.get(r):new this.tileClass(n,r?0:4,r,this.format_,this.tileLoadFunction);i.sourceTiles.push(o);const s=o.getState();if(s<2){const t=e=>{this.handleTileChange(e);const n=o.getState();if(2===n||3===n){const e=o.getKey();e in i.errorTileKeys?2===o.getState()&&delete i.errorTileKeys[e]:i.loadingSourceTiles--,3===n?i.errorTileKeys[e]=!0:o.removeEventListener(Jt,t),0===i.loadingSourceTiles&&i.setState(Wt(i.errorTileKeys)?2:3)}};o.addEventListener(Jt,t),i.loadingSourceTiles++}0===s&&(o.extent=a.getTileCoordExtent(n),o.projection=e,o.resolution=a.getResolution(n[0]),this.sourceTileCache.set(r,o),o.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(t=>3===t.getState())?3:2)}return i.sourceTiles}getTile(t,e,i,n,r){const o=dc(t,e,i),s=this.getKey();let a;if(this.tileCache.containsKey(o)&&(a=this.tileCache.get(o),a.key===s))return a;const l=[t,e,i];let c=this.getTileCoordForTileUrlFunction(l,r);const h=this.getTileGrid().getExtent(),u=this.getTileGridForProjection(r);if(c&&h){const e=u.getTileCoordExtent(c);qe(e,-u.getResolution(t),e),yi(h,e)||(c=null)}let d=!0;if(null!==c){const e=this.tileGrid,i=u.getResolution(t),o=e.getZForResolution(i,1),s=u.getTileCoordExtent(c);qe(s,-i,s),e.forEachTileCoord(s,o,(function(t){d=d&&!this.tileUrlFunction(t,n,r)}).bind(this))}const p=new Ac(l,d?4:0,c,this.getSourceTiles.bind(this,n,r));return p.key=s,a?(p.interimTile=a,p.refreshInterimChain(),this.tileCache.replace(o,p)):this.tileCache.set(o,p),p}getTileGridForProjection(t){const e=t.getCode();let i=this.tileGrids_[e];if(!i){const t=this.tileGrid,n=t.getResolutions().slice(),r=n.map(function(e,i){return t.getOrigin(i)}),o=n.map(function(e,i){return t.getTileSize(i)}),s=43;for(let e=n.length;e<s;++e)n.push(n[e-1]/2),r.push(r[e-1]),o.push(o[e-1]);i=new _c({extent:t.getExtent(),origins:r,resolutions:n,tileSizes:o}),this.tileGrids_[e]=i}return i}getTilePixelRatio(t){return t}getTilePixelSize(t,e,i){const n=Rs(this.getTileGridForProjection(i).getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]}updateCacheSize(t,e){super.updateCacheSize(2*t,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}};function Oc(t,e){t.setLoader(function(i,n,r){ul(e,t.getFormat(),i,n,r,t.onLoad.bind(t),t.onError.bind(t))})}var Fc,Dc=i(3317);!function(){var t=function(t,e,i){return(t[0]-i[0])*(e[1]-i[1])-(t[1]-i[1])*(e[0]-i[0])<=0};Fc=function(e){var i;e.sort(function(t,e){return t[0]==e[0]?t[1]-e[1]:t[0]-e[0]});var n=[];for(i=0;i<e.length;i++){for(;n.length>=2&&t(n[n.length-2],n[n.length-1],e[i]);)n.pop();n.push(e[i])}var r=[];for(i=e.length-1;i>=0;i--){for(;r.length>=2&&t(r[r.length-2],r[r.length-1],e[i]);)r.pop();r.push(e[i])}return r.pop(),n.pop(),n.concat(r)};var e=function(t){var i,n,r=[];switch(t.getType()){case"Point":r.push(t.getCoordinates());break;case"LineString":case"LinearRing":case"MultiPoint":r=t.getCoordinates();break;case"MultiLineString":for(n=t.getLineStrings(),i=0;i<n.length;i++)r.concat(e(n[i]));break;case"Polygon":r=e(t.getLinearRing(0));break;case"MultiPolygon":for(n=t.getPolygons(),i=0;i<n.length;i++)r.concat(e(n[i]));break;case"GeometryCollection":for(n=t.getGeometries(),i=0;i<n.length;i++)r.concat(e(n[i]))}return r};ro.prototype.convexHull=function(){return Fc(e(this))}}();const Zc=Fc,Nc="red",jc=[-180,-85,180,85],Gc="rgba(245, 159, 26, 1)";function zc(t,e,i,n,r,o,s,a){let l=null;if(null!=a)try{l=null!=a?function(t){const e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let n=0,r=t.length;n<r;n++)i[n]=t.charCodeAt(n);return i}(a):null,null!=l&&o(e.readFeatures(l,{extent:i,featureProjection:r}),e.readProjection(l))}catch(wm){console.log(wm),l=null}if(null==l){var c=new XMLHttpRequest;c.open("POST",t,!0),c.responseType="arraybuffer",c.onload=function(){if(!c.status||c.status>=200&&c.status<300){let n=c.response,a=null;try{a=function(t){try{let e="";const i=new Uint8Array(t);for(let t=0;t<i.byteLength;t++)e+=String.fromCharCode(i[t]);return e}catch(wm){return console.warn(wm),null}}(n)}catch(wm){console.log(wm)}if(null!=a)try{!function(t,e){if(t.search("low")>-1)try{localStorage.setItem(t,e)}catch(wm){Dc.setItem(t,e)}else Dc.setItem(t,e)}(t,a)}catch(wm){console.warn(wm),a=null}n?o(e.readFeatures(n,{extent:i,featureProjection:r}),e.readProjection(n)):s()}else s()},c.onerror=s,c.send()}}class Vc extends so{constructor(t,e,i){super(),void 0!==i&&void 0===e?this.setFlatCoordinates(i,t):this.setCenterAndRadius(t,e=e||0,i)}clone(){const t=new Vc(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,o=t-r[0],s=e-r[1],a=o*o+s*s;if(a<n){if(0===a)for(let t=0;t<this.stride;++t)i[t]=r[t];else{const t=this.getRadius()/Math.sqrt(a);i[0]=r[0]+t*o,i[1]=r[1]+t*s;for(let e=2;e<this.stride;++e)i[e]=r[e]}return i.length=this.stride,a}return n}containsXY(t,e){const i=this.flatCoordinates,n=t-i[0],r=e-i[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return Je(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){if(yi(t,this.getExtent())){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||si(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(let r=1;r<e;++r)n[e+r]=t[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=po(n,0,t);n[r++]=n[0]+e;for(let o=1,s=this.stride;o<s;++o)n[r++]=n[o];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter(eo(i,0,i.length,n,t,e,i)),this.changed()}translate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter(io(i,0,i.length,n,t,e,i)),this.changed()}}const Bc=Vc;var qc,Uc=function(t,e){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},$c=function(t,e){return t[0]==e[0]&&t[1]==e[1]};!function(){function t(t,e){for(let i=t.length-1;i>0;i--)(t[i][0]>e&&t[i-1][0]<e||t[i][0]<e&&t[i-1][0]>e)&&t.splice(i,0,[e,(e-t[i][0])/(t[i-1][0]-t[i][0])*(t[i-1][1]-t[i][1])+t[i][1]])}function e(t,e){for(let i=t.length-1;i>0;i--)(t[i][1]>e&&t[i-1][1]<e||t[i][1]<e&&t[i-1][1]>e)&&t.splice(i,0,[(e-t[i][1])/(t[i-1][1]-t[i][1])*(t[i-1][0]-t[i][0])+t[i][0],e])}qc=function(i,n){var r="Polygon"===n.getType();if(!r&&"MultiPolygon"!==n.getType())return null;var o=n.getCoordinates();return r&&(o=[o]),o.forEach(function(n){n.forEach(function(n){t(n,i[0]),t(n,i[2]),e(n,i[1]),e(n,i[3])})}),o.forEach(function(t){t.forEach(function(t){t.forEach(function(t){t[0]<i[0]?t[0]=i[0]:t[0]>i[2]&&(t[0]=i[2]),t[1]<i[1]?t[1]=i[1]:t[1]>i[3]&&(t[1]=i[3])})})}),r?new qo(o[0]):new Dl(o)}}();var Yc=function(t,e,i,n){var r=[];!1!==n&&r.push(t);var o=Uc(t,e);if(o){var s=Math.round(o/i);if(s>1)for(var a=(e[0]-t[0])/s,l=(e[1]-t[1])/s,c=1;c<s;c++)r.push([t[0]+a*c,t[1]+l*c])}return r.push(e),r};bl.prototype.sampleAt=function(t){for(var e=this.getCoordinates(),i=[],n=1;n<e.length;n++)i=i.concat(Yc(e[n-1],e[n],t,1===n));return new bl(i)},Ll.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){for(var n=[],r=1;r<e.length;r++)n=n.concat(Yc(e[r-1],e[r],t,1===r));i.push(n)}),new Ll(i)},qo.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){for(var n=[],r=1;r<e.length;r++)n=n.concat(Yc(e[r-1],e[r],t,1===r));i.push(n)}),new qo(i)},Dl.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){var n=[];i.push(n),e.forEach(function(e){for(var i=[],r=1;r<e.length;r++)i=i.concat(Yc(e[r-1],e[r],t,1===r));n.push(i)})}),new Dl(i)},Bc.prototype.intersection=function(t,e){if(t.sampleAt){var i=qe(this.getCenter().concat(this.getCenter()),this.getRadius());t=(t=qc(i,t)).simplify(e);var n=this.getCenter(),r=this.getRadius(),o=t.sampleAt(e).getCoordinates();switch(t.getType()){case"Polygon":o=[o];case"MultiPolygon":var s=!1,a=[];return o.forEach(function(t){var e=[];a.push(e),t.forEach(function(t){var i=[];e.push(i),t.forEach(function(t){var e=Uc(n,t);e>r?(s=!0,i.push([n[0]+r/e*(t[0]-n[0]),n[1]+r/e*(t[1]-n[1])])):i.push(t)})})}),s?"Polygon"===t.getType()?new qo(a[0]):new Dl(a):t}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+t.getType());return t},bl.prototype.splitAt=function(t,e){var i;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var n=[this];for(i=0;i<t.length;i++){for(var r=[],o=0;o<n.length;o++){var s=n[o].splitAt(t[i],e);r=r.concat(s)}n=r}return n}if($c(t,this.getFirstCoordinate())||$c(t,this.getLastCoordinate()))return[this];var a=this.getCoordinates(),l=[a[0]],c=[];for(i=0;i<a.length-1;i++)if(!$c(a[i],a[i+1])){if($c(t,a[i+1]))l.push(a[i+1]),c.push(new bl(l)),l=[];else if(!$c(t,a[i])){var h,u=!1;a[i][0]==a[i+1][0]?(h=(a[i][1]-t[1])/(a[i][1]-a[i+1][1]),u=a[i][0]==t[0]&&0<h&&h<=1):a[i][1]==a[i+1][1]?(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=a[i][1]==t[1]&&0<h&&h<=1):(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=Math.abs(h-(a[i][1]-t[1])/(a[i][1]-a[i+1][1]))<=e&&0<h&&h<=1),u&&(l.push(t),c.push(new bl(l)),l=[t])}l.push(a[i+1])}return l.length>1&&c.push(new bl(l)),c.length?c:[this]};const Xc=class extends Qs{constructor(t){super({stroke:(t=t||{}).stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this.setRenderer(this._render.bind(this)),this._visible=!1!==t.visible,"function"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),"function"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap}setWidth(t){this._width=t||0}setWidth2(t){this._width2=t}getOffset(t){return this._offset[t]}setOffset(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}}setLineCap(t){this._lineCap="round"===t?"round":"butt"}getWidth(t,e){return this._widthFn?this._widthFn(t,e):this._width+(("number"==typeof this._width2?this._width2:this._width)-this._width)*e}setColor(t){try{this._color=Fi(t)}catch(wm){this._color=[0,0,0,1]}}setColor2(t){try{this._color2=Fi(t)}catch(wm){this._color2=null}}setArrowColor(t){try{this._acolor=Ri(t)}catch(wm){this._acolor=null}}getColor(t,e){if(this._colorFn)return Ri(this._colorFn(t,e));var i=this._color,n=this._color2||this._color;return"rgba("+ +Math.round(i[0]+(n[0]-i[0])*e)+","+Math.round(i[1]+(n[1]-i[1])*e)+","+Math.round(i[2]+(n[2]-i[2])*e)+","+(i[3]+(n[3]-i[3])*e)+")"}getArrow(){return this._arrow}setArrow(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(t){Array.isArray(t)?this._arrowSize=t:"number"==typeof t&&(this._arrowSize=[t,t])}drawArrow(t,e,i,n,r){var o=this.getArrowSize()[0]*r,s=Uc(e,i),a=(e[0]-i[0])/s,l=(e[1]-i[1])/s;n=Math.max(this.getArrowSize()[1]/2,n/2)*r,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-o*a+n*l,e[1]-o*l-n*a),t.lineTo(e[0]-o*a-n*l,e[1]-o*l+n*a),t.lineTo(e[0],e[1]),t.fill()}_render(t,e){if("LineString"===e.geometry.getType()){var i,n,r,o=e.context;if(!this._visible){var s=e.pixelRatio/e.resolution,a=Math.cos(e.rotation),l=Math.sin(e.rotation);n=e.geometry.getCoordinates();var c=t[0][0]-n[0][0]*s*a-n[0][1]*s*l,h=t[0][1]-n[0][0]*s*l+n[0][1]*s*a;for(t=[],i=0;r=n[i];i++)t[i]=[c+r[0]*s*a+r[1]*s*l,h+r[0]*s*l-r[1]*s*a,r[2]]}var u=this.getArrowSize()[0]*e.pixelRatio;o.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(r=this._splitAsize(t,u),o.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,0),this.drawArrow(o,r[0],r[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(r=this._splitAsize(t,u,!0),o.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,1),this.drawArrow(o,r[0],r[1],this.getWidth(e.feature,1),e.pixelRatio));var d=this._splitInto(t,255,2),p=0,f=d.length;if(o.lineJoin="round",o.lineCap=this._lineCap||"butt",d.length>1)for(p=0;p<d.length;p++){var g=p/f;for(n=d[p],o.lineWidth=this.getWidth(e.feature,g)*e.pixelRatio,o.strokeStyle=this.getColor(e.feature,g),o.beginPath(),o.moveTo(n[0][0],n[0][1]),i=1;r=n[i];i++)o.lineTo(r[0],r[1]);o.stroke()}o.restore()}}_splitAsize(t,e,i){var n,r,o,s,a=0;for(n=o=i?t.pop():t.shift();t.length;){if(r=i?t.pop():t.shift(),a+(s=Uc(n,r))>e){s=Uc(n=[n[0]+(r[0]-n[0])*(e-a)/s,n[1]+(r[1]-n[1])*(e-a)/s],o),i?(t.push(r),t.push(n),t.push([n[0]+(o[0]-n[0])/s,n[1]+(o[1]-n[1])/s])):(t.unshift(r),t.unshift(n),t.unshift([n[0]+(o[0]-n[0])/s,n[1]+(o[1]-n[1])/s]));break}a+=s,n=r}return[o,n]}_splitInto(t,e,i){var n,r,o,s=this._noOverlap?1:.9,a=[],l=0;for(n=1;r=t[n];n++)l+=Uc(t[n-1],r);var c=Math.max(i||2,l/(e||255)),h=t[0];l=0;var u=[h];for(n=1,r=t[1];n<t.length;){var d=r[0]-h[0],p=r[1]-h[1];if(l+(o=Math.sqrt(d*d+p*p))>c){var f=(c-l)/o;u.push([h[0]+d*f,h[1]+p*f]),a.push(u),u=[h=[h[0]+d*f*s,h[1]+p*f*s]],l=0}else l+=o,u.push(h=r),r=t[++n]}return a.push(u),a}};function Wc(t){const e=[];return t||(t="255, 177, 0"),"#"===t[0]&&(t=parseInt(t.substring(1,3),16)+", "+parseInt(t.substring(3,5),16)+", "+parseInt(t.substring(5,7),16)),t="rgba("+t+",1)",e.push(new Qs({stroke:new Xs({color:"rgba(255, 255, 255, 0.9)",width:12}),zIndex:51})),e.push(new Qs({stroke:new Xs({color:t,width:6,lineDash:[],lineCap:"round"}),zIndex:52})),e}function Hc(t,e=[]){const i=e.filter(e=>+e.id==+t);return i[0]&&i[0].style&&i[0].style.color?i[0].style.color:Nc}function Jc(t,e){var i=t.get("features").length,n="41,128,185",r=Math.max(8,Math.min(.75*i,20)),o=2*Math.PI*r/6,s=[0,o,o,o,o,o,o];const a=t.getProperties();return 1===i&&a.features&&null!=a.features[0]?t.getProperties().features[0].getStyle()||null:new Qs({image:new qs({radius:r,stroke:new Xs({color:"rgba("+n+",0.5)",width:15,lineDash:s,lineCap:"butt"}),fill:new $s({color:"rgba("+n+",1)"})}),text:new sa({text:i.toString(),font:"bold 12px comic sans ms",fill:new $s({color:"#fff"})})})}function Kc(t){if(null!=t||null==t)return;const e=t.get("features").map(t=>t.getGeometry().getCoordinates());return new Qs({geometry:new qo([Zc(e)]),fill:new $s({color:"rgba(255, 153, 0, 0.4)"}),stroke:new Xs({color:"rgba(204, 85, 0, 1)",width:1.5})})}function Qc(t){var e,i,n,r,o;const s=t.getProperties(),a=t.getGeometry().getFlatCoordinates(),l=JSON.parse(s.layers),c=s.strokeColor&&""!=s.strokeColor?s.strokeColor:null;let h=new Xs;if(null!=c)h.setColor(c);else if(null!=this.currentLayer)if(l.indexOf(+this.currentLayer.id)>=0){const t=null!==(n=null===(i=null===(e=this.currentLayer)||void 0===e?void 0:e.style)||void 0===i?void 0:i.color)&&void 0!==n?n:Nc;h.setColor(t)}else h.setColor("rgba(0,0,0,0)");else h.setColor(Hc(+l[0],this.conf.layers));if(null!=this.filters&&this.filters.filterTracks.length>0)this.filters.filterTracks.forEach(t=>{if("slider"===t.type){const e=s[t.identifier];null!=e&&(null!=t.lower&&e<t.lower||null!=t.upper&&e>t.upper)&&h.setColor("rgba(0,0,0,0)")}null==t.type&&null!=t.taxonomy&&null!=t.taxonomy&&null!=s[t.taxonomy]&&s[t.taxonomy].indexOf(t.identifier)<0&&h.setColor("rgba(0,0,0,0)")});else{const t=`${JSON.stringify(null!==(r=null==s?void 0:s.name)&&void 0!==r?r:"")}${null!==(o=null==s?void 0:s.searchable)&&void 0!==o?o:""}`;null!=this.inputTyped&&""!=this.inputTyped&&""!=t&&t.toLowerCase().indexOf(this.inputTyped.toLocaleLowerCase())<0&&h.setColor("rgba(0,0,0,0)")}var u;u={strokeStyle:h,minZoom:this.conf.minZoom,maxZoom:this.conf.maxZoom,minStrokeWidth:this.minStrokeWidth,maxStrokeWidth:this.conf.maxStrokeWidth,currentZoom:this.map.getView().getZoom()},(u=Object.assign({minStrokeWidth:3,maxStrokeWidth:6},u)).strokeStyle.setWidth(u.minStrokeWidth+(u.currentZoom-u.minZoom)/(u.maxZoom-u.minZoom)*(u.maxStrokeWidth-u.minStrokeWidth));let d=[new Qs({stroke:h,zIndex:491})];return this.conf.start_end_icons_show&&this.map.getView().getZoom()>this.conf.start_end_icons_min_zoom&&(d=[...d,...eh(a)]),this.conf.ref_on_track_show&&this.map.getView().getZoom()>this.conf.ref_on_track_min_zoom&&(d=[...d,th.bind(this)(t)]),d}function th(t){const e=t.getProperties();let i=new sa({text:null!=e.ref&&this.conf.ref_on_track_show?e.ref:"",font:'bold 12px "Open Sans", "Arial Unicode MS", "sans-serif"',placement:"point",rotateWithView:!0,overflow:!0,maxAngle:Math.PI/16,fill:new $s({color:this._defaultFeatureColor}),stroke:new Xs({color:"#fff",width:4})});return new Qs({zIndex:491,text:i})}function eh(t){const e=[t[t.length-2],t[t.length-1]];return[new Qs({geometry:new Po([t[0],t[1]]),image:new Vs({fill:new $s({color:"green"}),stroke:new Xs({color:"white"}),points:6,radius:6}),zIndex:492}),new Qs({geometry:new Po(e),image:new Vs({fill:new $s({color:"red"}),stroke:new Xs({color:"white"}),points:6,radius:10,angle:0}),zIndex:491})]}function ih(t){return this.TRACK_ZINDEX=491,this.minStrokeWidth=this.conf.minStrokeWidth+1,Qc.bind(this)(t)}function nh(t){return this.TRACK_ZINDEX=490,this.minStrokeWidth=this.conf.minStrokeWidth+1,Qc.bind(this)(t)}const rh={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},oh={"#f0f8ff":"aliceblue","#faebd7":"antiquewhite","#00ffff":"cyan","#7fffd4":"aquamarine","#f0ffff":"azure","#f5f5dc":"beige","#ffe4c4":"bisque","#000000":"black","#ffebcd":"blanchedalmond","#0000ff":"blue","#8a2be2":"blueviolet","#a52a2a":"brown","#deb887":"burlywood","#5f9ea0":"cadetblue","#7fff00":"chartreuse","#d2691e":"chocolate","#ff7f50":"coral","#6495ed":"cornflowerblue","#fff8dc":"cornsilk","#dc143c":"crimson","#00008b":"darkblue","#008b8b":"darkcyan","#b8860b":"darkgoldenrod","#a9a9a9":"darkgrey","#006400":"darkgreen","#bdb76b":"darkkhaki","#8b008b":"darkmagenta","#556b2f":"darkolivegreen","#ff8c00":"darkorange","#9932cc":"darkorchid","#8b0000":"darkred","#e9967a":"darksalmon","#8fbc8f":"darkseagreen","#483d8b":"darkslateblue","#2f4f4f":"darkslategrey","#00ced1":"darkturquoise","#9400d3":"darkviolet","#ff1493":"deeppink","#00bfff":"deepskyblue","#696969":"dimgrey","#1e90ff":"dodgerblue","#b22222":"firebrick","#fffaf0":"floralwhite","#228b22":"forestgreen","#ff00ff":"magenta","#dcdcdc":"gainsboro","#f8f8ff":"ghostwhite","#daa520":"goldenrod","#ffd700":"gold","#808080":"grey","#008000":"green","#adff2f":"greenyellow","#f0fff0":"honeydew","#ff69b4":"hotpink","#cd5c5c":"indianred","#4b0082":"indigo","#fffff0":"ivory","#f0e68c":"khaki","#fff0f5":"lavenderblush","#e6e6fa":"lavender","#7cfc00":"lawngreen","#fffacd":"lemonchiffon","#add8e6":"lightblue","#f08080":"lightcoral","#e0ffff":"lightcyan","#fafad2":"lightgoldenrodyellow","#d3d3d3":"lightgrey","#90ee90":"lightgreen","#ffb6c1":"lightpink","#ffa07a":"lightsalmon","#20b2aa":"lightseagreen","#87cefa":"lightskyblue","#778899":"lightslategrey","#b0c4de":"lightsteelblue","#ffffe0":"lightyellow","#00ff00":"lime","#32cd32":"limegreen","#faf0e6":"linen","#800000":"maroon","#66cdaa":"mediumaquamarine","#0000cd":"mediumblue","#ba55d3":"mediumorchid","#9370db":"mediumpurple","#3cb371":"mediumseagreen","#7b68ee":"mediumslateblue","#00fa9a":"mediumspringgreen","#48d1cc":"mediumturquoise","#c71585":"mediumvioletred","#191970":"midnightblue","#f5fffa":"mintcream","#ffe4e1":"mistyrose","#ffe4b5":"moccasin","#ffdead":"navajowhite","#000080":"navy","#fdf5e6":"oldlace","#808000":"olive","#6b8e23":"olivedrab","#ffa500":"orange","#ff4500":"orangered","#da70d6":"orchid","#eee8aa":"palegoldenrod","#98fb98":"palegreen","#afeeee":"paleturquoise","#db7093":"palevioletred","#ffefd5":"papayawhip","#ffdab9":"peachpuff","#cd853f":"peru","#ffc0cb":"pink","#dda0dd":"plum","#b0e0e6":"powderblue","#800080":"purple","#663399":"rebeccapurple","#ff0000":"red","#bc8f8f":"rosybrown","#4169e1":"royalblue","#8b4513":"saddlebrown","#fa8072":"salmon","#f4a460":"sandybrown","#2e8b57":"seagreen","#fff5ee":"seashell","#a0522d":"sienna","#c0c0c0":"silver","#87ceeb":"skyblue","#6a5acd":"slateblue","#708090":"slategrey","#fffafa":"snow","#00ff7f":"springgreen","#4682b4":"steelblue","#d2b48c":"tan","#008080":"teal","#d8bfd8":"thistle","#ff6347":"tomato","#40e0d0":"turquoise","#ee82ee":"violet","#f5deb3":"wheat","#ffffff":"white","#f5f5f5":"whitesmoke","#ffff00":"yellow","#9acd32":"yellowgreen"},sh=class extends Qi{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(ac)}setPreload(t){this.set(ac,t)}getUseInterimTilesOnError(){return this.get(lc)}setUseInterimTilesOnError(t){this.set(lc,t)}getData(t){return super.getData(t)}},ah=class extends sh{constructor(t){super(t)}createRenderer(){return new nc(this)}};function lh(t,e){null!=t&&null!=t.getSource()&&t.getSource().addFeature(e)}function ch(t,e){return t||(t=new nl({source:new fl({features:[]}),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:e})),t}function hh(t,e){const i=document.getElementById("canvas").getContext("2d"),n=window.URL,r=new Image,o=new Blob([t],{type:"image/svg+xml"}),s=n.createObjectURL(o);r.onload=()=>{i.drawImage(r,0,0),n.revokeObjectURL(s)},r.src=s;const a=new ye({geometry:new Po(Ir(e))}),l=new Qs({image:new ra({anchor:[.5,.5],img:r,imgSize:[32,32],opacity:1,crossOrigin:"anonymous"}),zIndex:999999999});return a.setStyle(l),a}function uh(t,e){const i=new ye({geometry:new Po(Ir(e))}),n=new Qs({image:new ra({anchor:[.5,.5],src:t,imgSize:[32,32],opacity:1,crossOrigin:"anonymous"}),zIndex:999999999});return i.setStyle(n),i}function dh(t){return Fr(t,"EPSG:4326","EPSG:3857")}function ph(t){return function(t,e,i,n){return function(t,e,i,n){let r=[];if(n>1){const e=t[2]-t[0],i=t[3]-t[1];for(let o=0;o<n;++o)r.push(t[0]+e*o/n,t[1],t[2],t[1]+i*o/n,t[2]-e*o/n,t[3],t[0],t[3]-i*o/n)}else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(r,r,2);const o=[],s=[];for(let a=0,l=r.length;a<l;a+=2)o.push(r[a]),s.push(r[a+1]);return function(t,e,i){return Je(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),void 0)}(o,s)}(t,Or(e,i),0,n)}(t,"EPSG:4326","EPSG:3857")}function fh(t,e){const i=t.getSource();i.hasFeature(e)&&i.removeFeature(e)}function gh(t,e,i,n=!1){if(t)return new cc({zIndex:490,renderMode:"vector",renderBuffer:2048,source:new Rc({format:new Ul,url:t,overlaps:!1,tileLoadFunction:i}),style:e})}function mh(t,e){Dc.getItem(e).then(i=>{t.setLoader(zc(e,t.getFormat(),t.extent,0,t.projection,t.onLoad.bind(t),t.onError.bind(t),i))})}function _h(t,e){let i=null;try{i=localStorage.getItem(e)}catch(wm){console.warn(wm),i=null}null!=i?t.setLoader(zc(e,t.getFormat(),t.extent,0,t.projection,t.onLoad.bind(t),t.onError.bind(t),i)):mh(t,e)}function vh(t){null!=t&&null!=t.getSource&&t.getSource().clear()}function yh(t,e,i=100){const n=null==e?void 0:e.getSource();if(n&&t){const e=[t.longitude,t.latitude],r=n.getClosestFeatureToCoordinate(e);if(null!=r){const t=wr(e,Lr(r.getGeometry().getCoordinates()));if(t>i)return null;const n=r.getProperties();return r.setProperties(Object.assign(Object.assign({},n),{distance_from_user:t})),r}}return null}"*".repeat(200);var wh=i(5257);const xh="units",bh=[1,2,5],Ch=25.4/.28,Th=class extends Ho{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target});const i=void 0!==t.className?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" ol-unselectable",this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==t.minWidth?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(xh,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(xh)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(xh,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=t.center,i=t.projection,n=this.getUnits();let r=Er(i,t.resolution,e,"degrees"==n?"degrees":"m");const o=this.minWidth_*(this.dpi_||Ch)/Ch,s=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||Ch)/Ch:void 0;let a=o*r,l="";if("degrees"==n){const t=rr.degrees;a*=t,a<t/60?(l="\u2033",r*=3600):a<t?(l="\u2032",r*=60):l="\xb0"}else"imperial"==n?a<.9144?(l="in",r/=.0254):a<1609.344?(l="ft",r/=.3048):(l="mi",r/=1609.344):"nautical"==n?(r/=1852,l="NM"):"metric"==n?a<.001?(l="\u03bcm",r*=1e6):a<1?(l="mm",r*=1e3):a<1e3?l="m":(l="km",r/=1e3):"us"==n?a<.9144?(l="in",r*=39.37):a<1609.344?(l="ft",r/=.30480061):(l="mi",r/=1609.3472):_e(!1,33);let c,h,u,d,p,f,g=3*Math.floor(Math.log(o*r)/Math.log(10));for(;;){u=Math.floor(g/3);const t=Math.pow(10,u);if(c=bh[(g%3+3)%3]*t,h=Math.round(c/r),isNaN(h))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==s&&h>=s){c=d,h=p,u=f;break}if(h>=o)break;d=c,p=h,f=u,++g}const m=this.scaleBar_?this.createScaleBar(h,c,l):c.toFixed(u<0?-u:0)+" "+l;this.renderedHTML_!=m&&(this.innerElement_.innerHTML=m,this.renderedHTML_=m),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,i){const n=this.getScaleForResolution(),r=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),o=this.scaleBarSteps_,s=t/o,a=[this.createMarker("absolute")];for(let l=0;l<o;++l)a.push(`<div><div class="ol-scale-singlebar ${l%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even"}" style="width: ${s}px;"></div>`+this.createMarker("relative")+(l%2==0||2===o?this.createStepText(l,t,!1,e,i):"")+"</div>");return a.push(this.createStepText(o,t,!0,e,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+r+"</div>":"")+a.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${"absolute"===t?3:-10}px;"></div>`}createStepText(t,e,i,n,r){const o=0===t?0:Math.round(n/this.scaleBarSteps_*t*100)/100;return`<div class="ol-scale-step-text" style="margin-left: ${0===t?-3:e/this.scaleBarSteps_*-1}px;text-align: ${0===t?"left":"center"};min-width: ${0===t?0:e/this.scaleBarSteps_*2}px;left: ${i?e+"px":"unset"};">`+o+(0===t?"":" "+r)+"</div>"}getScaleForResolution(){return Er(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||Ch)}render(t){const e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()}};var Sh=i(9075);function kh(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"ion-label",2),l._uU(2),l.qZA(),l.BQk()),2&t){const t=l.oxw();l.xp6(2),l.Oqu(t.translationCallback(t.control.label))}}const Eh=function(t){return[t]};function Ph(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",3),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.click(e.control.id)}),l._UZ(1,"div",4),l.TgZ(2,"span",5),l._uU(3),l.qZA(),l.qZA()}if(2&t){const t=l.oxw();l.xp6(1),l.Q6J("innerHtml",t.sanitaze(t.control.icon),l.oJD)("ngClass",l.VKq(3,Eh,t.wmMapButtonControlSelected$.value?"selected":"")),l.xp6(2),l.Oqu(t.translationCallback(t.control.label))}}let Mh=(()=>{class t{constructor(t){this.sanitizer=t,this.translationCallback=t=>t,this.clickedEvt=new l.vpe,this.wmMapButtonControlSelected$=new rt.X(!1)}set selected(t){this.wmMapButtonControlSelected$.next(t)}click(t){this.clickedEvt.emit(t)}sanitaze(t){return this.sanitizer.bypassSecurityTrustHtml(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Sh.H7))},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-map-button-control"]],inputs:{selected:["wmMapButtonControlSelect","selected"],control:["wmMapButtonControl","control"],translationCallback:["wmMapTranslationCallback","translationCallback"]},outputs:{clickedEvt:"wmMapButtonContolClicked"},decls:2,vars:2,consts:[[4,"ngIf"],["class","wm-map-button-control-button",3,"click",4,"ngIf"],[1,"wm-map-button-control-title"],[1,"wm-map-button-control-button",3,"click"],[1,"wm-map-button-control-icon",3,"innerHtml","ngClass"],[1,"wm-map-button-control-label"]],template:function(t,e){1&t&&(l.YNc(0,kh,3,1,"ng-container",0),l.YNc(1,Ph,4,5,"div",1)),2&t&&(l.Q6J("ngIf","title"===e.control.type),l.xp6(1),l.Q6J("ngIf","button"===e.control.type))},directives:[r.O5,s.Q$,r.mk],styles:["wm-map-button-control{cursor:pointer}wm-map-button-control .wm-map-button-control-button{display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:normal;align-items:normal;align-content:normal}wm-map-button-control .wm-map-button-control-button .selected{border:4px solid var(--wm-color-primary);border-radius:4px}wm-map-button-control .wm-map-button-control-button .wm-map-button-control-icon{height:40px;width:40px;min-width:40px;margin-right:5px;background-color:#d3d3d3}wm-map-button-control .wm-map-button-control-button .wm-map-button-control-icon svg{height:100%;width:100%}wm-map-button-control .wm-map-button-control-button .wm-map-button-control-label{display:block;flex-grow:1;flex-shrink:1;flex-basis:auto;align-self:center;order:0}"],encapsulation:2,changeDetection:0}),t})();function Ih(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",2),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.toggle$.next(!e.toggle$.value)}),l._UZ(1,"ion-icon",3),l.qZA()}}function Lh(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-item"),l.TgZ(1,"wm-map-button-control",7),l.NdJ("wmMapButtonContolClicked",function(e){return l.CHM(t),l.oxw(4).selectTileLayer(e)}),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=l.oxw(4);l.xp6(1),l.Q6J("wmMapButtonControl",t)("wmMapTranslationCallback",n.translationCallback)("wmMapButtonControlSelect",n.currentTileLayerIdx$.value===i)}}function Ah(t,e){1&t&&l._UZ(0,"ion-item-divider")}function Rh(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Lh,2,3,"ion-item",6),l.YNc(2,Ah,1,0,"ion-item-divider",5),l.BQk()),2&t){const t=l.oxw().ngIf,e=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",t),l.xp6(1),l.Q6J("ngIf",null!=e.conf.overlays&&e.conf.overlays.length>0)}}function Oh(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Rh,3,2,"ng-container",5),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",t.length>2)}}function Fh(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-item"),l.TgZ(1,"wm-map-button-control",7),l.NdJ("wmMapButtonContolClicked",function(e){const i=l.CHM(t).$implicit;return l.oxw(3).selectOverlay(e,i)}),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=l.oxw(3);l.xp6(1),l.Q6J("wmMapButtonControl",t)("wmMapTranslationCallback",n.translationCallback)("wmMapButtonControlSelect",n.currentOverlayIdx$.value===i)}}function Dh(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Fh,2,3,"ion-item",6),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngForOf",t)}}function Zh(t,e){if(1&t&&(l.TgZ(0,"ion-list",4),l.YNc(1,Oh,2,1,"ng-container",5),l.YNc(2,Dh,2,1,"ng-container",5),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.Q6J("ngIf",t.conf.tiles),l.xp6(1),l.Q6J("ngIf",t.conf.overlays)}}let Nh=(()=>{class t{constructor(t){this.sanitizer=t,this.translationCallback=t=>t,this.overlayEVT=new l.vpe(null),this.currentOverlayIdx$=new rt.X(-1),this.currentTileLayerIdx$=new rt.X(0),this.showButton$=new rt.X(!1),this.toggle$=new rt.X(!1)}set wmMapControlClose(t){"wm-map-controls"!=t&&(this.toggle$.next(!1),this.currentOverlayIdx$.next(null))}ngOnChanges(t){var e,i,n,r;null!=(null==t?void 0:t.tileLayers)&&null!=(null===(e=null==t?void 0:t.tileLayers)||void 0===e?void 0:e.currentValue)&&t.tileLayers.currentValue.length>1&&this.showButton$.next(!0),null!=(null==t?void 0:t.conf)&&null!=(null===(i=null==t?void 0:t.conf)||void 0===i?void 0:i.currentValue)&&null!=(null===(n=null==t?void 0:t.conf)||void 0===n?void 0:n.currentValue.overlays)&&(null===(r=null==t?void 0:t.conf)||void 0===r?void 0:r.currentValue.overlays.length)>1&&this.showButton$.next(!0)}selectOverlay(t,e){t===this.currentOverlayIdx$.value?(this.currentOverlayIdx$.next(-1),this.overlayEVT.emit(null)):(this.currentOverlayIdx$.next(t),this.overlayEVT.emit(e))}selectTileLayer(t){this.currentTileLayerIdx$.next(t),this.tileLayers.forEach(e=>{const i=t===e.getProperties().id;e.setVisible(i)}),this.toggle$.next(!this.toggle$.value)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Sh.H7))},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-map-controls"]],inputs:{wmMapControlClose:"wmMapControlClose",conf:"conf",tileLayers:"tileLayers",translationCallback:["wmMapTranslationCallback","translationCallback"]},outputs:{overlayEVT:"wmMapControlOverlay"},features:[l.TTD],decls:4,vars:6,consts:[["class","layer-button",3,"click",4,"ngIf"],["class","layer-content","lines","none",4,"ngIf"],[1,"layer-button",3,"click"],["name","layers-outline"],["lines","none",1,"layer-content"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"wmMapButtonControl","wmMapTranslationCallback","wmMapButtonControlSelect","wmMapButtonContolClicked"]],template:function(t,e){1&t&&(l.YNc(0,Ih,2,0,"div",0),l.ALo(1,"async"),l.YNc(2,Zh,3,2,"ion-list",1),l.ALo(3,"async")),2&t&&(l.Q6J("ngIf",l.lcZ(1,2,e.showButton$)),l.xp6(2),l.Q6J("ngIf",l.lcZ(3,4,e.toggle$)))},directives:[r.O5,s.gu,s.q_,r.sg,s.Ie,Mh,s.rH],pipes:[r.Ov],styles:["wm-map-controls .layer-button{position:relative!important;color:#000;background-color:#fffc;position:fixed;font-size:20px;top:2%;right:2%;height:40px;display:block;padding:10px;cursor:pointer;z-index:1}wm-map-controls .layer-content{position:fixed;background-color:#fffc;top:calc(2% + 50px);right:2%;z-index:1}wm-map-controls ion-item{--background:rgba($color:white,$alpha:0.8)!important}"],encapsulation:2,changeDetection:0}),t})();const jh=["scaleLineContainer"],Gh=[[["","top-left",""]],[["","top-right",""]],[["","bottom-right",""]]],zh=["[top-left]","[top-right]","[bottom-right]"];let Vh=(()=>{class t{constructor(){this.translationCallback=t=>{if(null==t)return"";if("string"==typeof t)return t;for(const e in t)if(t[e])return t[e]},this.wmMapTarget="ol-map",this.clickEVT$=new l.vpe,this.wmMapCloseTopRightBtnsEVT$=new l.vpe,this.wmMapOverlayEVT$=new l.vpe(null),this.wmMapRotateEVT$=new l.vpe,this.isInit$=new rt.X(!1),this.map$=new rt.X(null),this.tileLayers=[],this.wmMapConf$=new rt.X(null)}set wmMapCloseTopRightBtns(t){this.wmMapCloseTopRightBtnsEVT$.emit(t)}set wmMapConf(t){this.wmMapConf$.next(t)}initBaseSource(t){return""===t?null:new Mc({url:t,cacheSize:5e4})}fitView(t,e){null!=this.map&&(null==e&&(e={duration:500}),this._view.fit(t,e),this.map.on("rendercomplete",()=>{}))}ngAfterViewInit(){this.wmMapConf$.pipe((0,wh.q)(3),(0,Pt.h)(t=>null!=t)).subscribe(t=>{this._initMap(t)})}ngOnChanges(t){t.reset&&null!=t.reset.currentValue&&this._reset(),t.wmMapPadding&&null!=this._view&&this._view.fit(this._centerExtent,{padding:this.wmMapPadding,maxZoom:this._view.getZoom()}),t.filters&&null!=this.map&&setTimeout(()=>{var t;null===(t=this.map)||void 0===t||t.changed(),this.map.renderSync(),this.map.render(),this.map.updateSize(),this.map.dispatchEvent("over")},300)}orientNorth(){this._view.animate({duration:400,rotation:0})}resetRotation(){this._view.animate({duration:0,rotation:0})}setOverlay(t){this.wmMapOverlayEVT$.emit(t)}_initDefaultInteractions(){return Ls({doubleClickZoom:!1,dragPan:!0,mouseWheelZoom:!0,pinchRotate:!1,altShiftDragRotate:!1})}_initMap(t){var e;this._centerExtent=ph(null!==(e=t.bbox)&&void 0!==e?e:jc),this._view=new Wo({maxZoom:t.maxZoom,zoom:t.defZoom||10,minZoom:t.minZoom,projection:"EPSG:3857",constrainOnlyCenter:!0,padding:this.wmMapPadding,extent:this._centerExtent,showFullExtent:!0}),t.controls.tiles&&(this.tileLayers=function(t){var e;const i=t=>""===t?null:new Mc({url:t,cacheSize:5e4});return null!==(e=t.filter(t=>"button"===t.type).map((t,e)=>new ah({preload:1/0,source:i(t.url),visible:0===e,zIndex:e,className:Object.keys(t)[0],properties:Object.assign({},t)})))&&void 0!==e?e:[new ah({preload:1/0,source:i("https://api.webmapp.it/tiles/{z}/{x}/{y}.png"),visible:!0,zIndex:0,className:"webmapp"})]}(t.controls.tiles)),this.map=new Ds({view:this._view,controls:ts({rotate:!1,attribution:!1}).extend([new Th({units:"metric",minWidth:50,target:this.scaleLineContainer.nativeElement})]),interactions:this._initDefaultInteractions(),layers:this.tileLayers,moveTolerance:3,target:this.wmMapTarget}),this.map.on("postrender",()=>{this._updateDegrees()}),this.map$.next(this.map),this._view.setZoom(t.defZoom),t.bbox&&this._view.fit(this._centerExtent,{maxZoom:t.defZoom}),this.map.updateSize(),this.isInit$.next(!0)}_reset(){null!=this._view&&(this._view.animate({duration:0,rotation:0}),this._view.fit(this._centerExtent))}_updateDegrees(){const t=this.map.getView().getRotation()/(2*Math.PI)*360;t!=this.mapDegrees&&this.wmMapRotateEVT$.emit(t),this.mapDegrees=t,this.map.updateSize()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-map"]],viewQuery:function(t,e){if(1&t&&l.Gf(jh,5),2&t){let t;l.iGM(t=l.CRH())&&(e.scaleLineContainer=t.first)}},inputs:{wmMapCloseTopRightBtns:"wmMapCloseTopRightBtns",wmMapConf:"wmMapConf",filters:["wmMapFilters","filters"],translationCallback:["wmMapTranslationCallback","translationCallback"],wmMapPadding:"wmMapPadding",wmMapTarget:"wmMapTarget",initBaseSource:"initBaseSource"},outputs:{clickEVT$:"clickEVT$",wmMapCloseTopRightBtnsEVT$:"wmMapCloseTopRightBtnsEVT$",wmMapOverlayEVT$:"wmMapOverlayEVT$",wmMapRotateEVT$:"wmMapRotateEVT$"},features:[l.TTD],ngContentSelectors:zh,decls:21,vars:9,consts:[[1,"map-container",3,"id"],["mapContainer",""],["id","canvas"],["id","ol-map","width","100","height","100"],["id","webmapp-map-scale-line-container"],["scaleLineContainer",""],["id","webmapp-map-attribution-container"],[1,"webmapp-map-attribution"],["href","http://webmapp.it","target","blank",1,"wm-clickable","webmapp-map-attribution-link"],["href","https://www.openstreetmap.org/about/","target","blank",1,"wm-clickable","webmapp-map-attribution-link"],[1,"top-left"],[1,"top-right"],[3,"conf","tileLayers","wmMapTranslationCallback","wmMapControlClose","wmMapControlOverlay","click"],[1,"bottom-right"]],template:function(t,e){if(1&t&&(l.F$t(Gh),l.TgZ(0,"div",0,1),l._UZ(2,"canvas",2),l._UZ(3,"canvas",3),l._UZ(4,"div",4,5),l.TgZ(6,"div",6),l.TgZ(7,"div",7),l.TgZ(8,"a",8),l._uU(9," \xa9 Webmapp "),l.qZA(),l.TgZ(10,"a",9),l._uU(11,"\xa9 OpenStreetMap "),l.qZA(),l.qZA(),l.qZA(),l.TgZ(12,"div",10),l.Hsn(13),l.qZA(),l.TgZ(14,"div",11),l.TgZ(15,"wm-map-controls",12),l.NdJ("wmMapControlOverlay",function(t){return e.setOverlay(t)})("click",function(){return e.wmMapCloseTopRightBtns="wm-map-controls"}),l.ALo(16,"async"),l.ALo(17,"async"),l.qZA(),l.Hsn(18,1),l.qZA(),l.TgZ(19,"div",13),l.Hsn(20,2),l.qZA(),l.qZA()),2&t){let t;l.Q6J("id",e.wmMapTarget),l.xp6(15),l.Q6J("conf",null==(t=l.lcZ(16,5,e.wmMapConf$))?null:t.controls)("tileLayers",e.tileLayers)("wmMapTranslationCallback",e.translationCallback)("wmMapControlClose",l.lcZ(17,7,e.wmMapCloseTopRightBtnsEVT$))}},directives:[Nh],pipes:[r.Ov],styles:["wm-map{height:100%;width:100%;display:flex}wm-map .map-container{flex-grow:1;height:100%;position:relative}wm-map .map-container .bottom-right{position:absolute;right:22px;bottom:40px;display:inline-flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:center;z-index:2}wm-map .map-container .bottom-right>*{order:0;flex:0 1 auto;align-self:auto;margin-bottom:10px}wm-map .map-container .bottom-right ion-fab{position:relative}wm-map .map-container .bottom-right .wm-btn-track-recording,wm-map .map-container .bottom-right ion-fab-button{height:42px;width:42px;margin:0 0 16px 10px}wm-map .map-container .top-right{position:absolute;right:22px;top:calc(10px + constant(safe-area-inset-top));top:calc(10px + env(safe-area-inset-top));z-index:2;display:inline-flex;flex-direction:row-reverse;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start}wm-map .map-container .top-right>*{order:0;flex:0 1 auto;align-self:auto;margin-left:10px}wm-map .map-container .top-left{position:absolute;left:22px;top:constant(safe-area-inset-top,30px);top:env(safe-area-inset-top,30px);z-index:2;display:inline-flex;flex-direction:row-reverse;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start}wm-map .map-container .top-left>*{order:0;flex:0 1 auto;align-self:auto;margin-left:10px}wm-map .map-container .ol-zoom{position:absolute;top:50%;right:20px;width:-moz-fit-content;width:fit-content;height:58px}wm-map .map-container #webmapp-map-scale-line-container{position:absolute;bottom:0;left:0;width:100px;z-index:1}wm-map .map-container #webmapp-map-attribution-container{position:absolute;bottom:0;right:0;display:flex;justify-content:center;align-items:center;padding:5px 10px;border-top-left-radius:5px;transition:bottom .5s;z-index:1;background:rgba(var(--wm-color-light-rgb),.75);box-shadow:-1px -1px 5px -3px var(--wm-color-dark)}wm-map .map-container #webmapp-map-attribution-container .webmapp-map-attribution{display:inline-block;font-size:var(--font-sm)}wm-map .map-container #webmapp-map-attribution-container .webmapp-map-attribution .webmapp-map-attribution-link{color:var(--wm-color-dark);text-decoration:none}wm-map canvas{position:absolute}"],encapsulation:2,changeDetection:0}),t})(),Bh=(()=>{class t{constructor(t){this.mapCmp=t}fitView(e,i,n){var r;if(null!=this.mapCmp.map){const o=this.mapCmp.map.getView();null!=o&&(null==i&&(i={duration:500,padding:null!==(r=this.wmMapPadding)&&void 0!==r?r:void 0}),null==n||null!=n&&n>=t.priority?(t.priority=null!=n?n:0,this.mapCmp.map.once("rendercomplete",()=>{o.fit(e,i)})):t.priority=0)}}fitViewFromLonLat(e,i,n){var r;if(null!=this.mapCmp.map){const o=this.mapCmp.map.getView();null!=o&&(null==i&&(i={padding:null!==(r=this.wmMapPadding)&&void 0!==r?r:void 0,maxZoom:this.wmMapConf.defZoom,duration:500}),(null==n||null!=n&&n>t.priority)&&(t.priority=null!=n?n:0,this.mapCmp.map.once("rendercomplete",()=>{o.fit(ph(e),i)})))}}}return t.priority=0,t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapBase",""]],inputs:{wmMapConf:"wmMapConf",wmMapPadding:"wmMapPadding"}}),t})();var qh=i(9765);class Uh extends ro{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(se),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(re(this.geometries_[t],Jt,this.changed,this))}clone(){const t=new Uh(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<$e(this.getExtent(),t,e))return n;const r=this.geometries_;for(let o=0,s=r.length;o<s;++o)n=r[o].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){Ke(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)ii(t,e[i].getExtent());return t}getGeometries(){return $h(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let r=0,o=i.length;r<o;++r){const o=i[r],s=o.getSimplifiedGeometry(t);e.push(s),s!==o&&(n=!0)}if(n){const t=new Uh(null);return t.setGeometriesArray(e),t}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=hi(this.getExtent()));const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)n[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray($h(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function $h(t){const e=[];for(let i=0,n=t.length;i<n;++i)e.push(t[i].clone());return e}const Yh=Uh;function Xh(t){return"string"==typeof t?JSON.parse(t)||null:null!==t?t:null}const Wh=class extends Pl{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Xh(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Xh(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ce()}readFeaturesFromObject(t,e){return ce()}readGeometry(t,e){return this.readGeometryFromObject(Xh(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ce()}readProjection(t){return this.readProjectionFromObject(Xh(t))}readProjectionFromObject(t){return ce()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ce()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ce()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ce()}};function Hh(t,e){if(!t)return null;let i;switch(t.type){case"Point":i=function(t){return new Po(t.coordinates)}(t);break;case"LineString":i=function(t){return new bl(t.coordinates)}(t);break;case"Polygon":i=function(t){return new qo(t.coordinates)}(t);break;case"MultiPoint":i=function(t){return new Rl(t.coordinates)}(t);break;case"MultiLineString":i=function(t){return new Ll(t.coordinates)}(t);break;case"MultiPolygon":i=function(t){return new Dl(t.coordinates)}(t);break;case"GeometryCollection":i=function(t,e){const i=t.geometries.map(function(t){return Hh(t,void 0)});return new Yh(i)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Ml(i,!1,e)}function Jh(t,e){const i=(t=Ml(t,!0,e)).getType();let n;switch(i){case"Point":n=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":n=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"MultiPoint":n=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":n=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case"GeometryCollection":n=function(t,e){return delete(e=Object.assign({},e)).featureProjection,{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){return Jh(t,e)})}}(t,e);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return n}const Kh=class extends Wh{constructor(t){t=t||{},super(),this.dataProjection=kr(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=kr(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null};const n=Hh(i.geometry,e),r=new ye;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(n),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){let i=null;if("FeatureCollection"===t.type){i=[];const n=t.features;for(let t=0,r=n.length;t<r;++t)i.push(this.readFeatureFromObject(n[t],e))}else i=[this.readFeatureFromObject(t,e)];return i}readGeometryFromObject(t,e){return Hh(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?"name"==e.type?i=kr(e.properties.name):"EPSG"===e.type?i=kr("EPSG:"+e.properties.code):_e(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(i.id=n),!t.hasProperties())return i;const r=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=Jh(o,e),delete r[t.getGeometryName()]),Wt(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,r=t.length;n<r;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Jh(t,this.adaptOptions(e))}},Qh='\n<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32">\n  <foreignObject width="100%" height="100%">\n    <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px">\n      <div class="webmapp-map-clustermarker-container" style="position: relative;width: 32px;height: 32px; ">\n        <svg \n          id="Livello_1" \n          data-name="Livello 1" \n          xmlns="http://www.w3.org/2000/svg" \n          viewBox="0 0 74 74">\n            <path d="M32,63.5a6.42,6.42,0,0,1-3.47-1.11,64.93,64.93,0,0,1-16.7-15.51,32.63,32.63,0,0,1-7-19.76C4.88,12.44,17,.5,32,.5S59.12,12.44,59.12,27.12a32.65,32.65,0,0,1-7,19.77A66.08,66.08,0,0,1,35.47,62.38,6.25,6.25,0,0,1,32,63.5Z" style="fill:#fff"/><path d="M32,5.5A21.89,21.89,0,0,0,9.88,27.12a27.61,27.61,0,0,0,5.95,16.74h0A60,60,0,0,0,31.24,58.18c.7.45.91.4,1.5,0A61,61,0,0,0,48.17,43.86a27.61,27.61,0,0,0,5.95-16.74C54.12,15.2,44.19,5.5,32,5.5Z" style="fill:#2f9e44"/><path d="M32,42.05A14.25,14.25,0,1,1,46.32,27.87,14.25,14.25,0,0,1,32,42.05Zm0-23.49a9.25,9.25,0,1,0,9.34,9.31A9.32,9.32,0,0,0,32,18.56Z" style="fill:#fff"/>\n        </svg>\n      </div>\n    </div>\n  </foreignObject>\n</svg>',tu='\n<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32">\n  <foreignObject width="100%" height="100%">\n    <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px">\n      <div class="webmapp-map-clustermarker-container" style="position: relative;width: 32px;height: 32px; ">\n        <svg \n          id="Livello_1" \n          data-name="Livello 1" \n          xmlns="http://www.w3.org/2000/svg" \n          viewBox="0 0 74 74">\n            <path d="M14.82,4.51a3,3,0,0,1,2.95,3V9.64A33.47,33.47,0,0,0,32.21,8.8,35.64,35.64,0,0,1,50,8.4a2.8,2.8,0,0,1,2.1,2.76V34.83a3,3,0,0,1-3.49,3,44,44,0,0,0-16,.41A44.59,44.59,0,0,1,22.21,39a35.1,35.1,0,0,1-4.44-.46v18a2.95,2.95,0,1,1-5.89,0V7.46A2.94,2.94,0,0,1,14.82,4.51Z" style="fill:#2f9e44;fill-rule:evenodd"/><path d="M14.82,4.51a3,3,0,0,1,2.95,3V9.64a36.08,36.08,0,0,0,5.45.42,31.41,31.41,0,0,0,9-1.26,33.4,33.4,0,0,1,9.55-1.34A35.38,35.38,0,0,1,50,8.4a2.8,2.8,0,0,1,2.1,2.76V34.83a3,3,0,0,1-3,3l-.48,0a43.21,43.21,0,0,0-6.74-.54,47,47,0,0,0-9.21.95A44.47,44.47,0,0,1,24.1,39c-.64,0-1.28,0-1.89,0a35.1,35.1,0,0,1-4.44-.46v18a2.95,2.95,0,1,1-5.89,0V7.46a2.94,2.94,0,0,1,2.94-2.95m0-2.87A5.83,5.83,0,0,0,9,7.46V56.54a5.82,5.82,0,0,0,11.64,0V41.77l1.44.08c.67,0,1.34,0,2,0A47.48,47.48,0,0,0,33.25,41a43.75,43.75,0,0,1,8.64-.9,40.11,40.11,0,0,1,6.3.51,7,7,0,0,0,.92.07A5.88,5.88,0,0,0,55,34.83V11.16a5.68,5.68,0,0,0-4.29-5.55,37.89,37.89,0,0,0-9-1A35.82,35.82,0,0,0,31.38,6.05a28.53,28.53,0,0,1-8.16,1.13c-.87,0-1.73,0-2.59-.1a5.84,5.84,0,0,0-5.81-5.44Z" style="fill:#fff"/>\n        </svg>\n      </div>\n    </div>\n  </foreignObject>\n</svg>';let eu=(()=>{class t extends Bh{constructor(t){super(t),this._customPoiSource=new fl({features:[]}),this._savedTracks$=new rt.X([]),this.reset$=new qh.xQ,this.mapCmp.isInit$.pipe((0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this.mapCmp.map.once("rendercomplete",()=>{this.reset$.next(void 0),this._loadSavedTracks(),this._initLayer()})})}set reloadCustomTracks(t){null!=t&&(this._clear(),this._loadSavedTracks(),null!=this._customTrackLayer&&this._customTrackLayer.getSource().addFeatures(this._savedTracks$.value))}_clear(){null!=this._customTrackLayer&&this._customTrackLayer.getSource().clear(),null!=this._customPoiLayer&&this._customPoiLayer.getSource().clear()}_initLayer(){this._customTrackLayer||(this._customTrackLayer=new nl({source:new fl({format:new Kh}),style:()=>Wc("#CA1551"),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:0}),this._customTrackLayer.getSource().addFeatures(this._savedTracks$.value),null!=this.mapCmp.map&&this.mapCmp.map.addLayer(this._customTrackLayer),this.mapCmp.map.getRenderer()),this._customPoiLayer=new nl({zIndex:1100,source:this._customPoiSource}),this.mapCmp.map.addLayer(this._customPoiLayer)}_loadSavedTracks(){const t=localStorage.getItem("wm-saved-tracks");if(null!=t){const e=JSON.parse(t).map((t,e)=>{const i=new Kh({featureProjection:"EPSG:3857"}).readFeature(t.geometry);return i.setProperties(t.properties),i.setId(`${t.properties.id}-${e}`),i});e.forEach(t=>{const e=t.getGeometry().getCoordinates(),i=e[0],n=e[e.length-1],r=Lr([i[0],i[1]]),o=Lr([n[0],n[1]]),s=hh(Qh,r),a=hh(tu,o);this._customPoiSource.addFeature(s),this._customPoiSource.addFeature(a)}),null!=e&&this._savedTracks$.next(e)}}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapCustomTracks",""]],inputs:{reloadCustomTracks:"reloadCustomTracks"},features:[l.qOj]}),t})();var iu=i(774),nu=i.n(iu);const ru="wm-current_record_track";let ou=(()=>{class t extends Bh{constructor(t,e){super(e),this._toastCtrl=t,this._customPoiSource=new fl({features:[]}),this._enabled$=new rt.X(!1),this._points=[],this.currentCustomTrack=new l.vpe,this.reset$=new qh.xQ,this.mapCmp.isInit$.pipe((0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this.mapCmp.map.once("rendercomplete",()=>{this._init()})})}set enabled(t){this._enabled$.next(t)}set reloadCustomTracks(t){null!=t&&this._clear()}_init(){this.reset$.next(void 0),this._initializeCustomTrackLayer(),this._customTrack={type:"Feature",geometry:{type:"LineString",coordinates:[]},properties:{id:"wm-current_record_track",name:"",color:"rgba(226, 249, 0, 0.6)"}},this._graphHopperRoutingObj||(this._graphHopperRoutingObj=new(nu())({vehicle:"foot",elevation:!0,instructions:!1}),this.wmMapCustomTrackDrawTrackHost&&(this._graphHopperRoutingObj.host=this.wmMapCustomTrackDrawTrackHost),this._graphHopperRoutingObj.defaults.profile="hike"),this.mapCmp.map.on("click",t=>{if(this._enabled$.value){let n=null;try{n=this.mapCmp.map.getFeaturesAtPixel(t.pixel,{hitTolerance:20})}catch(e){}try{if(Dt(t),null!=n&&n.length>0){const t=Lr(n[0].getGeometry().getCoordinates());this._points=this._points.filter(e=>e[0]!=t[0]&&e[1]!=t[1])}else{const e=Lr(t.coordinate);this._points.push(e)}this._points.length>1?this._graphHopperRoutingObj.doRequest({points:this._points}).then(t=>{this._customTrack.geometry=t.paths[0].points,this._customTrack.properties.ascent=t.paths[0].ascend?Math.round(t.paths[0].ascend):this._customTrack.properties.ascent,this._customTrack.properties.descent=t.paths[0].descend?Math.round(t.paths[0].descend):this._customTrack.properties.descent,this._customTrack.properties.distance=t.paths[0].distance?t.paths[0].distance/1e3:this._customTrack.properties.distance;let e=t.paths[0].distance&&t.paths[0].ascend?(t.paths[0].distance+10*t.paths[0].ascend)/3e3:t.paths[0].time?t.paths[0].time/36e5:void 0;void 0!==e&&(this._customTrack.properties["duration:forward"]=Math.floor(e)+":"+("0"+Math.round(e%1*60)).slice(-2)+" h"),this._updateTrack(),this.currentCustomTrack.emit(this._customTrack)},t=>{console.warn(t),-1!==t.message.indexOf("Specify at least 2 points")?(this._customTrack.geometry.coordinates=[],this._customTrack.properties.ascent=void 0,this._customTrack.properties.descent=void 0,this._customTrack.properties.distance=void 0,this._customTrack.properties["duration:forward"]=void 0,this._updateTrack()):-1!==t.message.indexOf("Cannot find point")&&(this._message(t.message),this._points.pop(),this._redrawPoints())}):this._customTrackLayer.getSource().clear(),this._redrawPoints()}catch(i){console.error(i)}}}),this._enabled$.subscribe(t=>{!1===t&&this._clear()})}_clear(){this._customTrackLayer.getSource().clear(),this._customPoiLayer.getSource().clear(),this._points=[]}_initializeCustomTrackLayer(){this._customTrackLayer||(this._customTrackLayer=new nl({source:new fl({format:new Kh}),style:()=>Wc("#CA1551"),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:1e3}),null!=this.mapCmp.map&&(this.mapCmp.map.addLayer(this._customTrackLayer),this._customPoiLayer=new nl({zIndex:1100,source:this._customPoiSource}),this.mapCmp.map.addLayer(this._customPoiLayer),this.mapCmp.map.getRenderer()))}_message(t){return Ft(this,void 0,void 0,function*(){const e=yield this._toastCtrl.create({message:t,duration:1e3});yield e.present()})}_redrawPoints(){this.mapCmp.map.once("rendercomplete",()=>{setTimeout(()=>{console.log("redraw"),this._customPoiSource.clear(),this._points.forEach((t,e)=>{try{if(1===this._points.length||e!=this._points.length-1){const e=uh("assets/start-icon.svg",t);this._customPoiSource.addFeature(e)}else{const e=uh("assets/end-icon.svg",t);this._customPoiSource.addFeature(e)}}catch(i){}})},300)})}_updateTrack(){this.mapCmp.map.once("rendercomplete",()=>{let t=new Kh({featureProjection:"EPSG:3857"}).readFeatures(this._customTrack)[0];t.setId(ru),this._customTrackLayer.getSource().getFeatureById(ru)&&this._customTrackLayer.getSource().removeFeature(this._customTrackLayer.getSource().getFeatureById(ru)),this._customTrackLayer.getSource().addFeature(t),this._customTrackLayer.getSource().changed()})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(s.yF),l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapCustomTrackDrawTrack",""]],inputs:{enabled:["wmMapCustomTrackDrawTrack","enabled"],reloadCustomTracks:"reloadCustomTracks",customTracks:"customTracks",trackElevationChartElements:"trackElevationChartElements",wmMapCustomTrackDrawTrackHost:"wmMapCustomTrackDrawTrackHost"},outputs:{currentCustomTrack:"currentCustomTrack"},features:[l.qOj]}),t})(),su=(()=>{class t extends Bh{constructor(t){super(t),this._disabled=!1,this._opacity=1,this.colorSelectedFromLayerEVT=new l.vpe,this.trackSelectedFromLayerEVT=new l.vpe,Dc.config({name:"JIDO",version:1,size:49807360,storeName:"xyz",description:"tile vector tiles"}),this.mapCmp.isInit$.pipe((0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this.mapCmp.map.once("precompose",()=>{!1===this._disabled&&this._initLayer(this.wmMapConf)}),this.mapCmp.map.on("moveend",()=>{!1===this._disabled&&this._resolutionLayerSwitcher()}),this.mapCmp.map.on("movestart",()=>{!1===this._disabled&&this._resolutionLayerSwitcher()}),this.mapCmp.map.on("click",t=>{if(!1===this._disabled)try{this.mapCmp.map.forEachFeatureAtPixel(t.pixel,(function(t){var e,i,n,r,o;const s=null!==(i=null===(e=null==t?void 0:t.getProperties())||void 0===e?void 0:e.id)&&void 0!==i?i:void 0,a=null!==(r=JSON.parse(null===(n=null==t?void 0:t.getProperties())||void 0===n?void 0:n.layers)[0])&&void 0!==r?r:void 0;if(s>-1&&1===this._highVectorTileLayer.getOpacity()&&null!=t.getType()){this.trackSelectedFromLayerEVT.emit(s);const t=Hc(a,this.wmMapConf.layers);this.colorSelectedFromLayerEVT.emit(null!==(o=rh[t])&&void 0!==o?o:t)}return!0}).bind(this),{hitTolerance:100})}catch(e){}})})}set jidoUpdateTime(t){const e=localStorage.getItem("JIDO_UPDATE_TIME");null!=t&&t!=+e&&(Object.keys(localStorage).filter(t=>t.indexOf("geohub")>=0).forEach(t=>{localStorage.removeItem(t)}),Dc.clear(),localStorage.setItem("JIDO_UPDATE_TIME",`${t}`))}set wmMapLayerDataLayerUrls(t){this._dataLayerUrls=t}set wmMapLayerDisableLayers(t){this._disabled=t,null!=this._highVectorTileLayer&&this._highVectorTileLayer.setVisible(!t),null!=this._lowVectorTileLayer&&this._lowVectorTileLayer.setVisible(!t)}set wmMapLayerLayer(t){this._currentLayer=t,null!=t&&null!=t.bbox&&this.fitViewFromLonLat(t.bbox,null,400)}set wmMapLayerOpacity(t){this._opacity=t?.3:1,this._resolutionLayerSwitcher()}set wmMapLayerRefresh(t){this._updateMap()}ngOnChanges(t){null==this._lowVectorTileLayer&&null==this._highVectorTileLayer||this._updateMap()}_initLayer(t){var e;this._initializeDataLayers(t),(null==e&&(e={doubleClickZoom:!1,dragPan:!0,mouseWheelZoom:!0,pinchRotate:!1,altShiftDragRotate:!1}),Ls(e)).forEach(t=>{this.mapCmp.map.addInteraction(t)}),this._resolutionLayerSwitcher(),this.mapCmp.map.updateSize()}_initializeDataLayers(t){this._lowVectorTileLayer=gh(this._dataLayerUrls.low,t=>ih.bind({currentLayer:this._currentLayer,conf:this.wmMapConf,map:this.mapCmp.map,opacity:this.wmMapLayerOpacity,filters:this.mapCmp.filters,tileLayer:this._lowVectorTileLayer,inputTyped:this.wmMapInputTyped})(t),_h,!0),this._highVectorTileLayer=gh(this._dataLayerUrls.high,t=>nh.bind({currentLayer:this._currentLayer,conf:this.wmMapConf,map:this.mapCmp.map,opacity:this.wmMapLayerOpacity,filters:this.mapCmp.filters,tileLayer:this._highVectorTileLayer,inputTyped:this.wmMapInputTyped})(t),mh,!0),this._lowVectorTileLayer.setProperties({high:!1}),this._highVectorTileLayer.setProperties({high:!0}),this.mapCmp.map.addLayer(this._lowVectorTileLayer),this.mapCmp.map.addLayer(this._highVectorTileLayer),this._resolutionLayerSwitcher()}_resolutionLayerSwitcher(){if(null!=this._highVectorTileLayer&&null!=this._lowVectorTileLayer){const t=this.mapCmp.map.getView().getZoom(),e=8;!1===this._disabled?t<e?(this._highVectorTileLayer.setVisible(!1),this._lowVectorTileLayer.setVisible(!0),this._lowVectorTileLayer.setOpacity(this._opacity)):e<t&&t<10?(this._highVectorTileLayer.setOpacity(0),this._highVectorTileLayer.setVisible(!0),this._lowVectorTileLayer.setVisible(!0),this._lowVectorTileLayer.setOpacity(this._opacity)):(this._highVectorTileLayer.setOpacity(this._opacity),this._highVectorTileLayer.setVisible(!0),this._lowVectorTileLayer.setVisible(!1)):(this._highVectorTileLayer.setVisible(!1),this._lowVectorTileLayer.setVisible(!1))}}_updateMap(){null!=this._lowVectorTileLayer&&this._lowVectorTileLayer.changed(),null!=this._highVectorTileLayer&&this._highVectorTileLayer.changed()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapLayer",""]],inputs:{jidoUpdateTime:"jidoUpdateTime",wmMapLayerDataLayerUrls:"wmMapLayerDataLayerUrls",wmMapLayerDisableLayers:"wmMapLayerDisableLayers",wmMapLayerLayer:"wmMapLayerLayer",wmMapLayerOpacity:"wmMapLayerOpacity",wmMapLayerRefresh:"wmMapLayerRefresh",wmMapInputTyped:"wmMapInputTyped"},outputs:{colorSelectedFromLayerEVT:"colorSelectedFromLayerEVT",trackSelectedFromLayerEVT:"trackSelectedFromLayerEVT"},features:[l.qOj,l.TTD]}),t})();const au="element",lu="map",cu="offset",hu="position",uu="positioning",du=class extends pe{constructor(t){super(),this.options=t,this.id=t.id,this.insertFirst=void 0===t.insertFirst||t.insertFirst,this.stopEvent=void 0===t.stopEvent||t.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==t.className?t.className:"ol-overlay-container ol-selectable",this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===t.autoPan?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(au,this.handleElementChanged),this.addChangeListener(lu,this.handleMapChanged),this.addChangeListener(cu,this.handleOffsetChanged),this.addChangeListener(hu,this.handlePositionChanged),this.addChangeListener(uu,this.handlePositioningChanged),void 0!==t.element&&this.setElement(t.element),this.setOffset(void 0!==t.offset?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),void 0!==t.position&&this.setPosition(t.position)}getElement(){return this.get(au)}getId(){return this.id}getMap(){return this.get(lu)||null}getOffset(){return this.get(cu)}getPosition(){return this.get(hu)}getPositioning(){return this.get(uu)}handleElementChanged(){wn(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(yn(this.element),se(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=re(t,Wn,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(au,t)}setMap(t){this.set(lu,t)}setOffset(t){this.set(cu,t)}setPosition(t){this.set(hu,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(hu))return;const i=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),r=this.getRect(n,[mn(n),_n(n)]),o=void 0===(t=t||{}).margin?20:t.margin;if(!Xe(i,r)){const n=r[0]-i[0],s=i[2]-r[2],a=r[1]-i[1],l=i[3]-r[3],c=[0,0];if(n<0?c[0]=n-o:s<0&&(c[0]=Math.abs(s)+o),a<0?c[1]=a-o:l<0&&(c[1]=Math.abs(l)+o),0!==c[0]||0!==c[1]){const i=e.getView().getCenterInternal(),n=e.getPixelFromCoordinateInternal(i);if(!n)return;const r=[n[0]+c[0],n[1]+c[1]],o=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(r),duration:o.duration,easing:o.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+e[0],r+e[1]]}setPositioning(t){this.set(uu,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);const i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(t,e){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);let o="0%",s="0%";"bottom-right"==r||"center-right"==r||"top-right"==r?o="-100%":"bottom-center"!=r&&"center-center"!=r&&"top-center"!=r||(o="-50%"),"bottom-left"==r||"bottom-center"==r||"bottom-right"==r?s="-100%":"center-left"!=r&&"center-center"!=r&&"center-right"!=r||(s="-50%");const a=`translate(${o}, ${s}) translate(${Math.round(t[0]+n[0])+"px"}, ${Math.round(t[1]+n[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a)}getOptions(){return this.options}};window.ol&&ol.ext&&!ol.ext.input&&(ol.ext.input={});const pu=class extends pe{constructor(t){t=t||{},super();var e,i=this.input=t.input;i||(i=this.input=document.createElement("INPUT"),t.type&&i.setAttribute("type",t.type),void 0!==t.min&&i.setAttribute("min",t.min),void 0!==t.max&&i.setAttribute("max",t.max),void 0!==t.step&&i.setAttribute("step",t.step),t.parent&&t.parent.appendChild(i)),t.disabled&&(i.disabled=!0),void 0!==t.checked&&(i.checked=!!t.checked),void 0!==t.val&&(i.value=t.val),t.hidden&&(i.style.display="none"),i.addEventListener("focus",(function(){this.element&&this.element.classList.add("ol-focus")}).bind(this)),i.addEventListener("focusout",(function(){this.element&&(e&&clearTimeout(e),e=setTimeout((function(){this.element.classList.remove("ol-focus")}).bind(this),0))}).bind(this))}_listenDrag(t,e){var i=(function(i){this.moving=!0,this.element.classList.add("ol-moving");var n=(function(i){"pointerup"===i.type&&(document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",n),document.removeEventListener("pointercancel",n),setTimeout((function(){this.moving=!1,this.element.classList.remove("ol-moving")}).bind(this))),i.target===t&&e(i),i.stopPropagation(),i.preventDefault()}).bind(this);document.addEventListener("pointermove",n,!1),document.addEventListener("pointerup",n,!1),document.addEventListener("pointercancel",n,!1),i.stopPropagation(),i.preventDefault()}).bind(this);t.addEventListener("mousedown",i,!1),t.addEventListener("touchstart",i,!1)}setValue(t){void 0!==t&&(this.input.value=t),this.input.dispatchEvent(new Event("change"))}getValue(){return this.input.value}getInputElement(){return this.input}},fu=class extends pu{constructor(t){super(t=t||{});var e=this.element=document.createElement("LABEL");t.html instanceof Element?e.appendChild(t.html):void 0!==t.html&&(e.innerHTML=t.html),e.className=("ol-ext-check ol-ext-checkbox "+(t.className||"")).trim(),this.input.parentNode&&this.input.parentNode.insertBefore(e,this.input),e.appendChild(this.input),e.appendChild(document.createElement("SPAN")),t.after&&e.appendChild(document.createTextNode(t.after)),this.input.addEventListener("change",(function(){this.dispatchEvent({type:"check",checked:this.input.checked,value:this.input.value})}).bind(this))}isChecked(){return this.input.checked}},gu=class extends fu{constructor(t){super(t=t||{}),this.element.className=("ol-ext-toggle-switch "+(t.className||"")).trim()}},mu=class extends fu{constructor(t){super(t=t||{}),this.element.className=("ol-ext-check ol-ext-radio "+(t.className||"")).trim()}};var _u={create:function(t,e){var i;if(e=e||{},"TEXT"===t)i=document.createTextNode(e.html||""),e.parent&&e.parent.appendChild(i);else for(var n in i=document.createElement(t),/button/i.test(t)&&i.setAttribute("type","button"),e)switch(n){case"className":e.className&&e.className.trim&&i.setAttribute("class",e.className.trim());break;case"text":i.innerText=e.text;break;case"html":e.html instanceof Element?i.appendChild(e.html):void 0!==e.html&&(i.innerHTML=e.html);break;case"parent":e.parent&&e.parent.appendChild(i);break;case"options":if(/select/i.test(t))for(var r in e.options)_u.create("OPTION",{html:r,value:e.options[r],parent:i});break;case"style":_u.setStyle(i,e.style);break;case"change":case"click":_u.addListener(i,n,e[n]);break;case"on":for(var o in e.on)_u.addListener(i,o,e.on[o]);break;case"checked":i.checked=!!e.checked;break;default:i.setAttribute(n,e[n])}return i},createSwitch:function(t){var e=_u.create("INPUT",{type:"checkbox",on:t.on,click:t.click,change:t.change,parent:t.parent}),i=Object.assign({input:e},t||{});return new gu(i),e},createCheck:function(t){var e=_u.create("INPUT",{name:t.name,type:"radio"===t.type?"radio":"checkbox",on:t.on,parent:t.parent}),i=Object.assign({input:e},t||{});return"radio"===t.type?new mu(i):new fu(i),e},setHTML:function(t,e){e instanceof Element?t.appendChild(e):void 0!==e&&(t.innerHTML=e)},appendText:function(t,e){t.appendChild(document.createTextNode(e||""))},addListener:function(t,e,i,n){"string"==typeof e&&(e=e.split(" ")),e.forEach(function(e){t.addEventListener(e,i,n)})},removeListener:function(t,e,i){"string"==typeof e&&(e=e.split(" ")),e.forEach(function(e){t.removeEventListener(e,i)})},show:function(t){t.style.display=""},hide:function(t){t.style.display="none"},hidden:function(t){return"none"===_u.getStyle(t,"display")},toggle:function(t){t.style.display="none"===t.style.display?"":"none"},setStyle:function(t,e){for(var i in e)switch(i){case"top":case"left":case"bottom":case"right":case"minWidth":case"maxWidth":case"width":case"height":t.style[i]="number"==typeof e[i]?e[i]+"px":e[i];break;default:t.style[i]=e[i]}},getStyle:function(t,e){var i,n=(t.ownerDocument||document).defaultView;if(n&&n.getComputedStyle)e=e.replace(/([A-Z])/g,"-$1").toLowerCase(),i=n.getComputedStyle(t,null).getPropertyValue(e);else if(t.currentStyle&&(e=e.replace(/-(\w)/g,function(t,e){return e.toUpperCase()}),/^\d+(em|pt|%|ex)?$/i.test(i=t.currentStyle[e])))return function(e){var i=t.style.left,n=t.runtimeStyle.left;return t.runtimeStyle.left=t.currentStyle.left,t.style.left=e||0,e=t.style.pixelLeft+"px",t.style.left=i,t.runtimeStyle.left=n,e}(i);return/px$/.test(i)?parseInt(i):i},outerHeight:function(t){return t.offsetHeight+_u.getStyle(t,"marginBottom")},outerWidth:function(t){return t.offsetWidth+_u.getStyle(t,"marginLeft")},offsetRect:function(t){var e=t.getBoundingClientRect();return{top:e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:e.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),height:e.height||e.bottom-e.top,width:e.width||e.right-e.left}},getFixedOffset:function(t){var e={left:0,top:0},i=function(t){if(!t)return e;if("absolute"===_u.getStyle(t,"position")&&"none"!==_u.getStyle(t,"transform")){var n=t.getBoundingClientRect();return e.left+=n.left,e.top+=n.top,e}return i(t.offsetParent)};return i(t.offsetParent)},positionRect:function(t,e){var i=0,n=0,r=function(o){if(o)return i+=o.offsetLeft,n+=o.offsetTop,r(o.offsetParent);var s={top:t.offsetTop+n,left:t.offsetLeft+i};return e&&(s.top-=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,s.left-=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),s.bottom=s.top+t.offsetHeight,s.right=s.top+t.offsetWidth,s};return r(t.offsetParent)},scrollDiv:function(t,e){var i,n,r,o,s,a=!1,l=0,c=0,h="function"==typeof(e=e||{}).onmove?e.onmove:function(){},u=e.vertical?"screenY":"screenX",d=e.vertical?"scrollTop":"scrollLeft",p=!1,f=0,g=function(){s&&(f++,setTimeout(m))},m=function(){if(s){if(--f)return;var e=t.clientHeight,i=t.scrollHeight;s.style.height=100*(n=e/i)+"%",s.style.top=t.scrollTop/i*100+"%",o.style.height=e+"px",e>i-.5?o.classList.add("ol-100pc"):o.classList.remove("ol-100pc")}},_=function(e){e.target.classList.contains("ol-noscroll")||(p=!1,a=e[u],c=new Date,t.classList.add("ol-move"),e.preventDefault(),window.addEventListener("pointermove",v),_u.addListener(window,["pointerup","pointercancel"],x))},v=function(e){if(!1!==a){var o=(r?-1/n:1)*(a-e[u]);p=p||Math.round(o),t[d]+=o,(i=new Date)-c&&(l=(l+o/(i-c))/2),a=e[u],c=i,o&&h(!0)}else p=!0},y=function(e){var i=e>0?Math.min(100,e/2):Math.max(-100,e/2);e-=i,t[d]+=i,-1<e&&e<1?(p?setTimeout(function(){t.classList.remove("ol-move")}):t.classList.remove("ol-move"),p=!1,h(!1)):setTimeout(function(){y(e)},40)};if(e.vertical&&e.minibar){var w=function(i){t.removeEventListener("pointermove",w),t.parentNode.classList.add("ol-miniscroll"),s=_u.create("DIV"),o=_u.create("DIV",{className:"ol-scroll",html:s}),t.parentNode.insertBefore(o,t),s.addEventListener("pointerdown",function(t){r=!0,_(t)}),e.mousewheel&&(_u.addListener(o,["mousewheel","DOMMouseScroll","onmousewheel"],function(t){b(t)}),_u.addListener(s,["mousewheel","DOMMouseScroll","onmousewheel"],function(t){b(t)})),t.parentNode.addEventListener("pointerenter",g),window.addEventListener("resize",g),!1!==i&&g()};t.parentNode?w(!1):t.addEventListener("pointermove",w),t.addEventListener("scroll",function(){g()})}t.style["touch-action"]="none",t.style.overflow="hidden",t.classList.add("ol-scrolldiv"),_u.addListener(t,["pointerdown"],function(t){r=!1,_(t)}),t.addEventListener("click",function(e){t.classList.contains("ol-move")&&(e.preventDefault(),e.stopPropagation())},!0);var x=function(i){(c=new Date-c)>100||r?l=0:c>0&&(l=((l||0)+(a-i[u])/c)/2),y(!1===e.animate?0:200*l),a=!1,l=0,c=0,t.classList.contains("ol-move")?t.classList.remove("ol-hasClick"):(t.classList.add("ol-hasClick"),setTimeout(function(){t.classList.remove("ol-hasClick")},500)),r=!1,window.removeEventListener("pointermove",v),_u.removeListener(window,["pointerup","pointercancel"],x)},b=function(e){var i=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));return t.classList.add("ol-move"),t[d]-=30*i,t.classList.remove("ol-move"),!1};return e.mousewheel&&_u.addListener(t,["mousewheel","DOMMouseScroll","onmousewheel"],b),{refresh:g}},dispatchEvent:function(t,e){var i;try{i=new CustomEvent(t)}catch(wm){(i=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,{})}e.dispatchEvent(i)}};const vu=_u,yu=class extends du{constructor(t){t=t||{};var e=document.createElement("div");t.element=e,super(t),this.offsetBox="number"==typeof t.offsetBox?[t.offsetBox,t.offsetBox,t.offsetBox,t.offsetBox]:t.offsetBox,this.closeBox=t.closeBox,this.onclose=t.onclose,this.onshow=t.onshow,vu.create("BUTTON",{className:"closeBox"+(t.closeBox?" hasclosebox":""),type:"button",click:(function(){this.hide()}).bind(this),parent:e}),!1!==t.anchor&&vu.create("DIV",{className:"anchor",parent:e}),this.content=vu.create("DIV",{html:t.html||"",className:"ol-popup-content",parent:e}),t.minibar&&vu.scrollDiv(this.content,{vertical:!0,mousewheel:!0,minibar:!0}),t.stopEvent&&(e.addEventListener("mousedown",function(t){t.stopPropagation()}),e.addEventListener("touchstart",function(t){t.stopPropagation()})),this._elt=e,this.setPositioning(t.positioning||"auto"),this.setPopupClass(t.popupClass||t.className||"default"),t.anim&&this.addPopupClass("anim"),t.position&&setTimeout((function(){this.show(t.position)}).bind(this))}getClassPositioning(){var t="",e=this.getPositioning();return/bottom/.test(e)&&(t+="ol-popup-bottom "),/top/.test(e)&&(t+="ol-popup-top "),/left/.test(e)&&(t+="ol-popup-left "),/right/.test(e)&&(t+="ol-popup-right "),/^center/.test(e)&&(t+="ol-popup-middle "),/center$/.test(e)&&(t+="ol-popup-center "),t}setClosebox(t){this.closeBox=t,t?this.element.classList.add("hasclosebox"):this.element.classList.remove("hasclosebox")}setPopupClass(t){var e=["ol-popup"];this.getVisible()&&e.push("visible"),this.element.className="";var i=this.getClassPositioning().split(" ").filter(function(t){return t.length>0});t?t.split(" ").filter(function(t){return t.length>0}).forEach(function(t){e.push(t)}):e.push("default"),i.forEach(function(t){e.push(t)}),this.closeBox&&e.push("hasclosebox"),this.element.classList.add.apply(this.element.classList,e)}addPopupClass(t){this.element.classList.add(t)}removePopupClass(t){this.element.classList.remove(t)}setPositioning(t){void 0!==t&&(/auto/.test(t)?(this.autoPositioning=t.split("-"),1==this.autoPositioning.length&&(this.autoPositioning[1]="auto")):this.autoPositioning=!1,"center"==(t=t.replace(/auto/g,"center"))&&(t="bottom-center"),this.setPositioning_(t))}setPositioning_(t){if(this.element){super.setPositioning(t),this.element.classList.remove("ol-popup-top","ol-popup-bottom","ol-popup-left","ol-popup-right","ol-popup-center","ol-popup-middle");var e=this.getClassPositioning().split(" ").filter(function(t){return t.length>0});this.element.classList.add.apply(this.element.classList,e)}}getVisible(){return this.element.classList.contains("visible")}show(t,e){e||"string"!=typeof t||(e=t,t=null),!0===t&&(t=this.getPosition());var i=this,n=this.getMap();if(n&&(e&&e!==this.prevHTML&&(this.prevHTML=e,this.content.innerHTML="",e instanceof Element?this.content.appendChild(e):vu.create("DIV",{html:e,parent:this.content}),Array.prototype.slice.call(this.content.querySelectorAll("img")).forEach(function(t){t.addEventListener("load",function(){try{n.renderSync()}catch(wm){}i.content.dispatchEvent(new Event("scroll"))})})),t)){if(this.autoPositioning){var r=n.getPixelFromCoordinate(t),o=n.getSize(),s=[];s[0]="auto"==this.autoPositioning[0]?r[1]<o[1]/3?"top":"bottom":this.autoPositioning[0],s[1]=r[0]<2*o[0]/3?"left":"right",this.setPositioning_(s[0]+"-"+s[1]),this.offsetBox&&this.setOffset([this.offsetBox["left"==s[1]?2:0],this.offsetBox["top"==s[0]?3:1]])}else this.offsetBox&&this.setOffset(this.offsetBox);this.setPosition(t),this.element.parentElement.style.display="","function"==typeof this.onshow&&this.onshow(),this.dispatchEvent({type:"show"}),this._tout=setTimeout(function(){i.element.classList.add("visible")},0)}}hide(){null!=this.getPosition()&&("function"==typeof this.onclose&&this.onclose(),this.setPosition(void 0),this._tout&&clearTimeout(this._tout),this.element.classList.remove("visible"),this.dispatchEvent({type:"hide"}))}},wu=[80,80,80,80];let xu=(()=>{class t extends Bh{constructor(t,e){super(e),this._cdr=t,this._disabled=!1,this._olFeatures=[],this._wmMapPoisPois=new rt.X(null),this.wmMapPoisFilters=[],this.currentPoiEvt=new l.vpe,this.mapCmp.isInit$.pipe((0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this._initDirective(),this.mapCmp.map.once("rendercomplete",()=>{this._wmMapPoisPois.pipe((0,Pt.h)(t=>null!=t),(0,wh.q)(1)).subscribe(t=>{this._renderPois(t),this._updatePois()})})})}set wmMapLayerLayer(t){this._currentLayer=t}set wmMapPoisDisableClusterLayer(t){var e;this._disabled=t,null===(e=this._poisClusterLayer)||void 0===e||e.setVisible(!t)}set wmMapPoisPois(t){this._wmMapPoisPois.next(t)}ngOnChanges(t){t.wmMapPoisPoi&&(null!=this.mapCmp.map?this.setPoi(this.wmMapPoisPoi):setTimeout(()=>{this.setPoi(this.wmMapPoisPoi)},500)),(null!=t.wmMapPoisFilters&&!1===t.wmMapPoisFilters.firstChange||null!=t.WmMapPoisUnselectPoi)&&vh(this._selectedPoiLayer),null==this.mapCmp.map||(null==t.wmMapPoisFilters||null==t.wmMapPoisFilters.currentValue)&&null==t.wmMapPoisPois&&null==t.wmMapInputTyped||this._updatePois()}setPoi(t){if("reset"!=t&&t>-1&&null!=this._wmMapPoisPois.value){const e=this._wmMapPoisPois.value.features.find(e=>+e.properties.id==+t);setTimeout(()=>{this._selectIcon(e)},200)}}_addPoisFeature(t){vh(this._poisClusterLayer);const e=this._poisClusterLayer.getSource(),i=e.getSource();if(i.clear(),t)for(const n of t.filter(t=>null!=t.geometry)){const t=n.properties||null,r=t.taxonomy||null,o=(null==r?void 0:r.poi_type)||null,s=this._getIcnFromTaxonomies(t.taxonomyIdentifiers),a=[n.geometry.coordinates[0],n.geometry.coordinates[1]]||0,l=(null==o?void 0:o.color)?o.color:t.color?t.color:"#ff8c00",c=oh[l]||"darkorange",h=Ir([a[0],a[1]]),u=new ye({type:"icon",geometry:new Po([h[0],h[1]]),properties:Object.assign(Object.assign(Object.assign({},t),{color:l}),{taxonomyIdentifiers:t.taxonomyIdentifiers})});let d=new Qs({image:new ra({anchor:[.5,.5],scale:.5,src:`assets/icons/pois/${s}.png`})});if(null!=n&&null!=n.properties&&null!=n.properties.svgIcon){const t=`data:image/svg+xml;utf8,${n.properties.svgIcon.replaceAll("darkorange",c)}`;d=new Qs({image:new ra({anchor:[.5,.5],scale:1,src:t})})}u.setStyle(d),u.setId(n.properties.id),i.addFeature(u),i.changed(),e.changed()}this._olFeatures=i.getFeatures(),this.mapCmp.map.on("moveend",t=>{!1===this._disabled&&this._checkZoom(this._poisClusterLayer)}),this.mapCmp.map.on("pointermove",t=>{if(!1===this._disabled){var e=this.mapCmp.map.getEventPixel(t.originalEvent);try{var i=this.mapCmp.map.hasFeatureAtPixel(e);this.mapCmp.map.getViewport().style.cursor=i?"pointer":""}catch(n){}}})}_checkZoom(t){var e,i;if(!this._disabled){const n=this.mapCmp.map.getView();if(null!=n&&null!=this.wmMapConf){const r=+n.getZoom(),o=+(null===(i=null===(e=this.wmMapConf)||void 0===e?void 0:e.pois)||void 0===i?void 0:i.poiMinZoom)||15;t.setVisible(r>=o)}}}_cleanObj(t){if("string"==typeof t)return t;const e={};return Object.keys(t).forEach(i=>{null!=t[i]&&""!==t[i]&&(e[i]=t[i])}),e}_fitView(t,e){if(null==e){const t=this.wmMapConf.maxZoom,i=this.mapCmp.map.getView().getZoom();e={maxZoom:this.mapCmp.map.getView().getMaxZoom()-4,duration:500,padding:wu},t-i<4&&(e={maxZoom:i,duration:500,padding:wu})}this.mapCmp.map.getView().fit(t,e)}_getIcnFromTaxonomies(t){const e=["theme_ucvs"],i=null==t?void 0:t.filter(t=>-1===e.indexOf(t)&&t.indexOf("poi_type")>-1);return(null==i?void 0:i.length)>0?i[0]:null!=t&&t.length>0?t[0]:null}_initDirective(){var t;this._selectedPoiLayer=ch(this._selectedPoiLayer,570),this._poisClusterLayer=(null==(t=this._poisClusterLayer)&&(t=new El({name:"cluster",animationDuration:0,source:new hc({distance:60,source:new fl({features:[]}),geometryFunction:t=>t.getGeometry()}),style:Jc,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:500})),t);const e=this._poisClusterLayer.getSource();this._hullClusterLayer=new nl({style:Kc,source:e}),this._selectCluster=(new qs({radius:5,stroke:new Xs({color:"rgba(0,255,255,1)",width:1}),fill:new $s({color:"rgba(0,255,255,0.3)"})}),new Tl({pointRadius:34,circleMaxObjects:4,maxObjects:4,spiral:!1,autoClose:!0,animate:!0,name:"selectCluster",style:function(t,e){var i=t.get("features");if(null!=i){if(i.length>1){var n=[];if(Zc){var r=[];for(let t=0;t<i.length;t++)r.push(i[t].getGeometry().getFirstCoordinate());var o=Zc(r);n.push(new Qs({stroke:new Xs({color:"rgba(0,0,192,0.5)",width:2}),fill:new $s({color:"rgba(0,0,192,0.3)"}),geometry:new qo([o]),zIndex:1}))}return n}{const t=i[0].getProperties().properties,e=oh[t.color||"darkorange"]||"darkorange";if(null!=t.svgIcon){const i=`data:image/svg+xml;utf8,${t.svgIcon.replaceAll('<circle fill="darkorange"','<circle fill="white" ').replaceAll('<g fill="white"',`<g fill="${e||"darkorange"}" `)}`;return new Qs({image:new ra({anchor:[.5,.5],scale:1,src:i})})}}}}})),this.mapCmp.map.addInteraction(this._selectCluster),this._popupOverlay=new yu({popupClass:"default anim",closeBox:!0,offset:[0,-16],positioning:"bottom-center",onclose:()=>{vh(this._selectedPoiLayer)},autoPan:{animation:{duration:100}}}),this._checkZoom(this._poisClusterLayer),this.mapCmp.map.addLayer(this._poisClusterLayer),this.mapCmp.map.addLayer(this._hullClusterLayer),this.mapCmp.map.addLayer(this._selectedPoiLayer),this.mapCmp.map.addOverlay(this._popupOverlay),this._selectCluster.getFeatures().on(["add"],t=>{var e=t.element.get("features");if(null!=e&&1===e.length){const t=e[0].getProperties();this._selectIcon(t)}}),this.mapCmp.map.on("click",t=>{this._poisClusterLayer.getFeatures(t.pixel).then(t=>{if(t.length>0){const e=t[0].get("features");if(e.length>4&&setTimeout(()=>{const t=this.mapCmp.map.getView(),i=[1/0,1/0,-1/0,-1/0];e.forEach(t=>ii(i,t.getGeometry().getExtent())),t.fit(i,{duration:500,padding:wu})},400),1===e.length){const t=e[0].getProperties();this._selectIcon(t)}}})}),this.mapCmp.map.once("rendercomplete",()=>{setTimeout(()=>{this._updatePois()},500)})}_isArrayContained(t,e){return!(t.length>e.length)&&t.every(t=>e.includes(t))}_renderPois(t){null!=t?this._addPoisFeature(t.features):null!=this.wmMapPoisPois&&this._addPoisFeature(this.wmMapPoisPois.features)}_selectIcon(t){var e,i,n,r;if(vh(this._selectedPoiLayer),null!=t){const o=this._selectedPoiLayer.getSource();let s=null;if(null!=t.geometry&&null!=t.geometry.coordinates){const e=[t.geometry.coordinates[0],t.geometry.coordinates[1]]||0,i=Ir([e[0],e[1]]);s=new Po([i[0],i[1]])}else s=t.geometry;if(null!=t.properties&&null!=t.properties.svgIcon){const e=new ye({type:"icon",geometry:s}),i=t.properties||null,n=i.taxonomy||null,r=(null==n?void 0:n.poi_type)||null,a=oh[(null==r?void 0:r.color)?r.color:i.color?i.color:"#ff8c00"]||"darkorange";let l=new Qs({zIndex:200,image:new ra({anchor:[.5,.5],scale:1,src:`data:image/svg+xml;utf8,${t.properties.svgIcon.replaceAll('<circle fill="darkorange"','<circle fill="white" ').replaceAll('<g fill="white"',`<g fill="${a||"darkorange"}" `)}`})});e.setStyle(l),e.setId(t.properties.id),o.addFeature(e),o.changed(),this._selectCluster.clear()}const a=null!==(e=this.wmMapConf.pois.poi_interaction)&&void 0!==e?e:"tooltip";switch(a){case"no_interaction":break;case"popup":default:this.currentPoiEvt.emit(t);break;case"tooltip":case"tooltip_popup":const e=null!==(i=localStorage.getItem("wm-lang"))&&void 0!==i?i:"it";let o=this._cleanObj(t.properties.name),l=o;"string"!=typeof o&&(l=null!=o[e]?o[e]:o[Object.keys(l)[0]]);let c="<ion-card>";(null===(r=null===(n=null==t?void 0:t.properties)||void 0===n?void 0:n.feature_image)||void 0===r?void 0:r.url)&&(c+=`<div class="img-cnt"><img src='${t.properties.feature_image.url}'/></div>`),c+=`\n          <ion-card-content>\n              ${l}\n          </ion-card-content>`,window.details=()=>{this.currentPoiEvt.emit(t),this._fitView(s),this._popupOverlay.hide()},"tooltip_popup"===a&&(c+='<ion-button  expand="block" onclick="details()" style="text-align:right">info<ion-icon name="information-circle-outline"></ion-icon></ion-button>'),c+="</ion-card>";const h=t.geometry.getCoordinates?t.geometry.getCoordinates():Ir([t.geometry.coordinates[0],t.geometry.coordinates[1]]);this._popupOverlay.show(h,c),setTimeout(()=>{this.mapCmp.map.updateSize(),this.mapCmp.map.setTarget("ol-map"),this.mapCmp.map.changed(),this._cdr.detectChanges()},500)}this.mapCmp.map.once("rendercomplete",()=>{this._fitView(s)})}}_updatePois(){var t,e,i,n;if(null!=this._poisClusterLayer){const r=this._poisClusterLayer.getSource(),o=r.getSource(),s=[...null!==(e=null===(t=this._currentLayer)||void 0===t?void 0:t.taxonomy_activities)&&void 0!==e?e:[],...null!==(n=null===(i=this._currentLayer)||void 0===i?void 0:i.taxonomy_themes)&&void 0!==n?n:[]];if(o.clear(),""!=this.wmMapInputTyped||this.wmMapPoisFilters.length>0||s.length>0){const t=this._olFeatures.filter(t=>{var e,i;if(null!=this.wmMapInputTyped&&""!=this.wmMapInputTyped){const n=t.getProperties().properties;return`${JSON.stringify(null!==(e=null==n?void 0:n.name)&&void 0!==e?e:"")}${null!==(i=null==n?void 0:n.searchable)&&void 0!==i?i:""}`.toLowerCase().indexOf(this.wmMapInputTyped.toLocaleLowerCase())>=0}return!0}).filter(t=>{if(this.wmMapPoisFilters.length>0){const e=t.getProperties().properties;return this._isArrayContained(this.wmMapPoisFilters,e.taxonomyIdentifiers)}return!0}).filter(t=>{if(s.length>0){const e=t.getProperties().properties,i=s[0].identifier;return this._isArrayContained([i],e.taxonomyIdentifiers),this._isArrayContained([i],e.taxonomyIdentifiers)}return!0});o.addFeatures(t)}else o.addFeatures(this._olFeatures);o.changed(),r.changed(),this._poisClusterLayer.changed(),this._cdr.detectChanges()}}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.sBO),l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapPois",""]],inputs:{wmMapLayerLayer:"wmMapLayerLayer",wmMapPoisDisableClusterLayer:"wmMapPoisDisableClusterLayer",wmMapPoisPois:"wmMapPoisPois",WmMapPoisUnselectPoi:"WmMapPoisUnselectPoi",wmMapInputTyped:"wmMapInputTyped",wmMapPoisFilters:"wmMapPoisFilters",wmMapPoisPoi:"wmMapPoisPoi"},outputs:{currentPoiEvt:"currentPoiEvt"},features:[l.qOj,l.TTD]}),t})(),bu=(()=>{class t extends Bh{constructor(t){super(t),this._defaultFeatureColor=Nc,this._onClickSub=bt.w.EMPTY,this._poiMarkers=[],this._relatedPois=[],this.poiClick=new l.vpe,this.relatedPoiEvt=new l.vpe,this.wmMapTrackRelatedPoisNearestPoiEvt=new l.vpe,this.currentRelatedPoi$=new rt.X(null),this.mapCmp.isInit$.pipe((0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this.mapCmp.map.on("click",t=>{this._deselectCurrentPoi();const e=function(t,e,i){const n=40*i.getView().getResolution();let r=null;const o=[];return t&&t.getSource()&&t.getSource().forEachFeatureInExtent(qe([e.coordinate[0],e.coordinate[1],e.coordinate[0],e.coordinate[1]],n),t=>{o.push(t)}),o.length>0&&(r=function(t,e){let i=t[0],n=Number.MAX_VALUE;return t.forEach(t=>{const r=(o=t.getGeometry().getFlatCoordinates(),s=e,Math.sqrt(Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)));var o,s;r<n&&(n=r,i=t)}),i}(o,e.coordinate)),r}(this._poisLayer,t,this.mapCmp.map);if(e){t.preventDefault(),Dt(t);const i=+e.getId()||-1;this.currentRelatedPoi$.next(this._getPoi(i)),this.relatedPoiEvt.emit(this.currentRelatedPoi$.value),this.poiClick.emit(i),this.setPoi=i}})})}set next(t){null!=this._selectedPoiLayer&&this.mapCmp.map.removeLayer(this._selectedPoiLayer)}set setPoi(t){if(-1===t&&null!=this._selectedPoiLayer)this.mapCmp.map.removeLayer(this._selectedPoiLayer),this._selectedPoiLayer=void 0,this.relatedPoiEvt.next(null);else{const e=this._poiMarkers.find(e=>+e.id==+t);null!=e&&(this._fitView(e.icon.getGeometry()),this._selectCurrentPoi(e),this.currentRelatedPoi$.next(this._getPoi(+t)),this.relatedPoiEvt.next(this.currentRelatedPoi$.value))}}ngOnChanges(t){var e;const i=null!==(e=t.track&&null!=t.track.previousValue&&null!=t.track.currentValue&&(t.track.previousValue.properties.id!=t.track.currentValue.properties.id||null==t.track.previousValue&&null!=t.track.currentValue.properties.id))&&void 0!==e&&e;(null==this.track||null==this.mapCmp.map||i)&&(this._resetView(),this._initPois=!1);const n=null!=t.track?t.track.currentValue:null;if(null!=n&&null!=n.properties&&null!=n.properties.related_pois&&null!=this.mapCmp.map&&!1===this._initPois&&(this._resetView(),this._relatedPois=n.properties.related_pois,this._addPoisMarkers(this._relatedPois),yh(this.wmMapPositioncurrentLocation,this._poisLayer,this.wmMapTrackRelatedPoisAlertPoiRadius),this._initPois=!0),t.wmMapPositioncurrentLocation&&null!=t.wmMapPositioncurrentLocation.currentValue){const e=yh(t.wmMapPositioncurrentLocation.currentValue,this._poisLayer);null!=e&&e.getStyle().getImage().setScale(1.2),this.wmMapTrackRelatedPoisNearestPoiEvt.emit(e)}}ngOnDestroy(){this._onClickSub.unsubscribe()}poiNext(){const t=this.currentRelatedPoi$.value.properties.id,e=this._relatedPois.map(t=>t.properties.id).indexOf(t);this.setPoi=this._relatedPois[(e+1)%this._relatedPois.length].properties.id}poiPrev(){const t=this.currentRelatedPoi$.value.properties.id,e=this._relatedPois.map(t=>t.properties.id).indexOf(t);this.setPoi=this._relatedPois[(e+this._relatedPois.length-1)%this._relatedPois.length].properties.id}_addPoisMarkers(t){var e,i;return Ft(this,void 0,void 0,function*(){this._poisLayer=ch(this._poisLayer,500),this.mapCmp.map.addLayer(this._poisLayer);for(let i=(null===(e=this._poiMarkers)||void 0===e?void 0:e.length)-1;i>=0;i--){const e=this._poiMarkers[i];(null==t?void 0:t.find(t=>t.properties.id+""===e.id))||(fh(this._poisLayer,e.icon),this._poiMarkers.splice(i,1))}if(t)for(const e of t)if(!(null===(i=this._poiMarkers)||void 0===i?void 0:i.find(t=>{var i,n;return t.id===e.properties.id+""&&(null===(n=null===(i=e.properties)||void 0===i?void 0:i.feature_image)||void 0===n?void 0:n.sizes)}))){const{marker:t}=yield this._createPoiCanvasIcon(e);lh(this._poisLayer,t.icon),this._poiMarkers.push(t)}})}_createIconFeature(t,e,i,n=!1,r=[.5,.5]){return Ft(this,void 0,void 0,function*(){if(!t)return;const o=Ir([t[0],t[1]]),s=new ye({type:"icon",geometry:new Po([o[0],o[1]])}),a=new Qs({image:new ra({anchor:r,img:e,imgSize:[i,i],opacity:n?.5:1})});return s.setStyle(a),{iconFeature:s,style:a}})}_createPoiCanvasIcon(t,e=null,i=!1){return Ft(this,void 0,void 0,function*(){const n=yield this._createPoiCavasImage(t,i),{iconFeature:r,style:o}=yield this._createIconFeature(e||[t.geometry.coordinates[0],t.geometry.coordinates[1]],n,46);return r.setId(t.properties.id),{marker:{poi:t,icon:r,id:t.properties.id+""},style:o}})}_createPoiCavasImage(t,e=!1){return Ft(this,void 0,void 0,function*(){return function(t,e){return Ft(this,void 0,void 0,function*(){const e='<svg xmlns="http://www.w3.org/2000/svg" width="46" height="46"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px">'+t+"</div></foreignObject></svg>",i=window.URL,n=new Image,r=new Blob([e],{type:"image/svg+xml"}),o=i.createObjectURL(r);return n.onload=()=>{i.revokeObjectURL(o)},n.src=o,n})}(yield this._createPoiMarkerHtmlForCanvas(t,e))})}_createPoiMarkerHtmlForCanvas(t,e=!1){var i,n;return Ft(this,void 0,void 0,function*(){let r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAdeSURBVHgB7ZkLbFRVGsf/986j8+i0M9MHnZa+QKCuXVwE45YlAaKGZWsIZLeSbLtbVxOzkG5W08RHaDCiqCH4lhiMT7DaqFgRhRikCmpVQKGiDlWkhT6mdIaZdt4zd+4cz72jUy4z086rGBJ/6eR+557vdP5z7nfOPec7DKHgMoTFZcplK1yOLEHCBHyYR5jnIUQfy7JwevsR4NxQyDVQ5eRBnWOEXJZDvRlkSkbCBYF+nw8hLgSeCr4QhVIBu7sfDudpyX2tqgB6XRVKjFdDJlMiXTLu8WAgiITjO85tj/88gpwHoW4b3KcHUdVwE7QzTUgVJtNZRehxv88v2kJ4yGQyMPQql8vh8vfD6bEgGHIhEHDCzzlFv5lFi3DmvrfgHx4Fo5BjZv0NqFq7CnK1KunvzVg4IWEqPIAcVY4ofDICnAtWhxnyIRbm+7dJ6nKrK1B7bwvUxUVIBua3mseHD36OM+2d8I/aIMYU/VMW6DF/w53Qza6Ysv2U0yFvPQbe8R2yTenSOlz7xCZU3nxT5AadaFgaXvzwAPw9x6f+B2QS+PHTxP1SKfG8UkVC9m/JdDH80afk83X3EMehT8hI/Y3k3N+uJ9zgwKRtEoZKOEgHU+dSEFtP5Afq50K79jgYefIDKBVC/gDGbm9G6KdTYpktr0DhCzvAanPj+icIFYLgkQcnRNOPcmHbtIkWkNPBrfnXf6Ll8MBZuF/bmdA/rnB+rBf8iWdEWxCtWLQBypomTDeaG1dA29QcLfs6XkPw1A9xfeMK545spuojczOTVwnFNXfhUqFtvhVscbFoE78Pruefi+sXI5wLeADjfCB/Lu1tAsV1D4FV6JAtzGYzPB5PwnpWo4Xu/62iLZs1G9y8Gvg4Ltbx4tFqPvg42ffYQtJ76Ckybu4g2cJut5PNmzeTJUuWkKGhocmdw4Sc/eILsnFPF9G3PkLu7twf4xLT4yO9+xH02HHy4OMYHhlENtizZw+ampqwb98+1NbWorS0dPIGdE5/1uLGpr2HMOb14d1vemNcJMKDPgdc507+2hYVC25GJlgsFrS2tmLLli1wOiPrlNWrVyfV9ta/LIjaJ89ZYfN4kVC4a7RXjGsBtb4cmvxypMvu3buxfv16HD58OHrPZDJhxYoVSbW/osiIUn1kbAlvmu+GRpFQuNtxNmprjVVIl23btmHr1q2w2WyS+2vWrEEqXFM+sdz90WqX1EmEB9wTv0qTX4Z06OjoED8XYzQasWzZMqSCKX9iNhtxuiV1ko2ERj8TpprIoyyouBapIsT09u3bRXvlypXiVRiQAnV1dWKopMLi6jLY3BHB1XTlmFD4Id9svGVfJtqr3NW4Bamxa9cuhEIh0WaYiX2lsE5vbm5Gqlyf24+rjAdF2yRuMuYjrvC+82PoPG4W7QKNGrfU/QnJYrVa0dXVFS3v3bs3are0tKTc2wL2gSOwnPxAtPNLrpLUSWK8WKeN2haXG6nQ3d0tir+YxsZGNDQ0IB2840NRW5VbLKmT9PjcYmPUPjYwIk6MySYS2tvbJWWhh9etW4fly5cjPQg85/ujJY1BuiuSCK8tLRZjk75RMTzmwik6Bc0pMmIqDhw4IA7MXxHmakF0QUEB0sU7PgzvmDA9R7pOVzRPUi8JlQKtBleWFEYKVPxLnx1DMnR2dopXg8GAjRs3oq2tLSPRAme+fj0qOm/GlcjRGCT1MXmVVX+cJ/b2/5b/GbcXqoEpAkbo6Z6eHtTX14tvyry8PGSK8I1lJeVgl96JvqOvoGTuDXGcLsIb5Mi5F58no40NxLJ4IfF2fTjpQs7tdhO6VCXZJNDbTlzPgLh3ziHerx4hQb8rxidmdaimCRr5D9+D7/tJLDuffBRkkvWzVqtFTU0NsgUJusB9uYE+Y/qUx0+BOf8tFDmx+864O6Dc2/4LRqWO/CPrKFw7XsClInhsC+2tM5HvlqnEbWM84gpXXjEHmrX/jJa9r+6Ab/8HmG6Cve3gjj4ULcvmt0BmiP80EyaEtI3/BlsxMXd6Xn0ZfMCP6YLwAbrXfYAGSGRZzRRejZxFbQn9EwoX8hnGrU+BNejB0pWd4rYWHL7jflg+7sZ05OwYmjdX1b8NRlcJRmuC6q9vg1UmnqGmzB0K6TC/0wPzznd+yfMBlQ2rULFmJeSa7OdZeMf3IKEA5EULJvVLKunp6juLE5ueQMDhiN5TFReiuvHvmLH0usgMcIlJOlvro7194uGn4emb2CUJDf9wXwtCZTyKDPTtNkUaIxwOI0BTbSq6RL1w2ZsOKaWZQ14/+t94F4PvfwhCcx1q0wyUb/oHhqxHxXqVUgelQg8V/QG52hLkqSrp+pwXc+g8vQrCRT8qXKVWIxPSyI/TVdvgCPrffA+5s8pgr7GC430xXgbdLJQaFoMLxiZzhN7O0+dn1OsZJfb5MIcR23GM0UMq4WznQhIJF45a5ApFxuGStROJEM01ev12elziBBfy0JDR0VCpEsODZRn6kf1yPpSdgfybHaVkyu9H4peanwEleI5n4QeUjAAAAABJRU5ErkJggg==";const o=null===(n=null===(i=t.properties)||void 0===i?void 0:i.feature_image)||void 0===n?void 0:n.sizes["108x137"];o&&(r=yield function(t){return Ft(this,void 0,void 0,function*(){const e=yield fetch(t,{}),i=yield e.blob();return new Promise(t=>{const e=new FileReader;e.readAsDataURL(i);try{e.onloadend=()=>{t(e.result)}}catch(n){t("")}})})}(o));let s='\n    <div class="webmapp-map-poimarker-container" style="position: relative;width: 30px;height: 60px;">';return s+=`\n        <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style=" position: absolute;  width: 46px;  height: 46px;  left: 0px;  top: 0px;">\n          <circle opacity="${e?1:.2}" cx="23" cy="23" r="23" fill="${this._defaultFeatureColor}"/>\n          <rect x="5" y="5" width="36" height="36" rx="18" fill="url(#img)" stroke="white" stroke-width="2"/>\n          <defs>\n            <pattern height="100%" width="100%" patternContentUnits="objectBoundingBox" id="img">\n              <image height="1" width="1" preserveAspectRatio="xMidYMid slice" xlink:href="${r}">\n              </image>\n            </pattern>\n          </defs>\n        </svg>`,s+=" </div>",s})}_deselectCurrentPoi(){null!=this._selectedPoiMarker&&(this.mapCmp.map.removeLayer(this._selectedPoiLayer),this._selectedPoiLayer=void 0)}_fitView(t,e){if(null==e){const t=this.mapCmp.map.getSize();e={maxZoom:this.mapCmp.map.getView().getZoom(),duration:500,size:t}}this.mapCmp.fitView(t,e)}_getPoi(t){return this._relatedPois.find(e=>e.properties.id===t)}_resetView(){null!=this.mapCmp.map&&null!=this._poisLayer&&(this.mapCmp.map.removeLayer(this._poisLayer),this._poisLayer=void 0),null!=this.mapCmp.map&&null!=this._selectedPoiLayer&&(this.mapCmp.map.removeLayer(this._selectedPoiLayer),this._selectedPoiLayer=void 0),null!=this.mapCmp.map&&this.mapCmp.map.render(),this._poiMarkers=[],this.relatedPoiEvt.emit(null)}_selectCurrentPoi(t){return Ft(this,void 0,void 0,function*(){this._deselectCurrentPoi(),this._selectedPoiLayer=ch(this._selectedPoiLayer,999999999999999),this.mapCmp.map.addLayer(this._selectedPoiLayer),this._selectedPoiMarker=t;const{marker:e}=yield this._createPoiCanvasIcon(t.poi,null,!0);lh(this._selectedPoiLayer,e.icon)})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapTrackRelatedPois",""]],inputs:{next:"next",setPoi:["poi","setPoi"],track:"track",wmMapPositioncurrentLocation:"wmMapPositioncurrentLocation",wmMapTrackRelatedPoisAlertPoiRadius:"wmMapTrackRelatedPoisAlertPoiRadius"},outputs:{poiClick:"related-poi-click",relatedPoiEvt:"related-poi",wmMapTrackRelatedPoisNearestPoiEvt:"wmMapTrackRelatedPoisNearestPoiEvt"},features:[l.qOj,l.TTD]}),t})();function Cu(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"ion-card"),l.TgZ(2,"ion-card-content"),l.TgZ(3,"div"),l._UZ(4,"span",1),l.TgZ(5,"a",2),l.NdJ("click",function(){return l.CHM(t),l.oxw().message$.next(null)}),l._uU(6," X"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.BQk()}if(2&t){const t=e.ngIf;l.xp6(4),l.Q6J("innerHTML",t,l.oJD)}}let Tu=(()=>{class t{constructor(){this.message$=new rt.X(null)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-map-popover"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"innerHTML"],[3,"click"]],template:function(t,e){1&t&&(l.YNc(0,Cu,7,1,"ng-container",0),l.ALo(1,"async")),2&t&&l.Q6J("ngIf",l.lcZ(1,1,e.message$))},directives:[r.O5,s.PM,s.FN],pipes:[r.Ov],styles:["wm-map-popover{position:absolute;top:0;right:0;min-width:400px;z-index:1}wm-map-popover .red{color:red}wm-map-popover .orange{color:orange}wm-map-popover .green{color:green}"],encapsulation:2,changeDetection:0}),t})(),Su=(()=>{class t extends Bh{constructor(t,e,i,n){super(n),this.element=t,this.viewContainerRef=e,this.componentFactoryResolver=i,this._initTrack=!1,this.wmMapTrackColor="#caaf15"}drawTrack(t){const e=this.wmMapConf.flow_line_quote_show||!1,i=this.wmMapConf.flow_line_quote_orange||800,n=this.wmMapConf.flow_line_quote_red||1500,r=this._getGeoJson(t);e&&this._initPopover(),this._trackFeatures=new Kh({featureProjection:"EPSG:3857"}).readFeatures(r),this._trackLayer=new nl({source:new fl({format:new Kh,features:this._trackFeatures}),style:()=>e?function(t=800,e=1500){return new Xc({lineCap:"butt",color:function(i,n){const r=i.getGeometry().getCoordinates(),o=r[+(r.length*n).toFixed()];let s=100;try{s=o[2]}catch(a){}return s>=t&&s<e?"orange":s>=e?"red":"green"},width:10})}(i,n):Wc(this.wmMapTrackColor),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:495}),this.mapCmp.map.addLayer(this._trackLayer)}ngOnChanges(t){var e,i,n,r,o,s,a;const l=null!==(e=t.track&&null!=t.track.previousValue&&null!=t.track.currentValue&&t.track.previousValue.properties.id!=t.track.currentValue.properties.id)&&void 0!==e&&e;if((null==this.track||null==this.mapCmp.map||l)&&(this._resetView(),this._initTrack=!1),null!=this.wmMapConf&&null!=this.track&&null!=this.mapCmp.map&&!1===this._initTrack&&(this._init(),this._initTrack=!0),null!=this.track&&null!=this.mapCmp.map&&null!=this.trackElevationChartElements){if(null!=this._popoverRef){const t=(null===(n=null===(i=this.trackElevationChartElements)||void 0===i?void 0:i.location)||void 0===n?void 0:n.altitude)||void 0;this._popoverRef.instance.message$.next(function(t=0,e=800,i=1500){return t<e?`<span class="green">Livello 1: tratti non interessati dall'alta quota (quota minore di ${e} metri)</span>`:t>e&&t<i?`<span class="orange">Livello 2: tratti parzialmente in alta quota (quota compresa tra ${e} metri e ${i} metri)</span>`:`<span class="red">Livello 3: in alta quota (quota superiore ${i} metri)</span>`}(t,this.wmMapConf.flow_line_quote_orange,this.wmMapConf.flow_line_quote_red))}this._drawTemporaryLocationFeature(null===(r=this.trackElevationChartElements)||void 0===r?void 0:r.location,null===(o=this.trackElevationChartElements)||void 0===o?void 0:o.track)}null!=t.wmMapTrackColor&&!1===t.wmMapTrackColor.firstChange&&(null===(s=this._trackLayer)||void 0===s||s.setStyle(Wc(this.wmMapTrackColor)),null===(a=this._trackLayer)||void 0===a||a.changed())}_centerMapToTrack(){if(this._trackLayer){const t=this._trackLayer.getSource().getExtent();t&&null!=this.mapCmp&&null!=this.mapCmp.map&&this.mapCmp.map.once("rendercomplete",()=>{this.fitView(t,{padding:[80,80,80,80],duration:500},500)})}}_drawTemporaryLocationFeature(t,e){var i;if(t){if(this._elevationChartSource||(this._elevationChartSource=new fl({format:new Kh})),this._elevationChartLayer||(this._elevationChartLayer=new nl({source:this._elevationChartSource,style:t=>"Point"===t.getGeometry().getType()?[new Qs({image:new qs({fill:new $s({color:"#000"}),radius:7,stroke:new Xs({width:2,color:"#fff"})}),zIndex:496})]:Wc(this._elevationChartTrack.get("color")),updateWhileAnimating:!1,updateWhileInteracting:!1,zIndex:496}),this.mapCmp.map.addLayer(this._elevationChartLayer)),t){const n=new Po(dh([t.longitude,t.latitude]));if(this._elevationChartPoint?this._elevationChartPoint.setGeometry(n):(this._elevationChartPoint=new ye(n),this._elevationChartSource.addFeature(this._elevationChartPoint)),e){const t=new bl(e.geometry.coordinates.map(t=>dh(t))),n=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.color;this._elevationChartTrack?(this._elevationChartTrack.setGeometry(t),this._elevationChartTrack.set("color",n)):(this._elevationChartTrack=new ye(t),this._elevationChartTrack.set("color",n),this._elevationChartSource.addFeature(this._elevationChartTrack))}}else this._elevationChartPoint=void 0,this._elevationChartTrack=void 0,this._elevationChartSource.clear();this.mapCmp.map.render()}else this._elevationChartSource&&this.mapCmp.map&&(this._elevationChartPoint=void 0,this._elevationChartTrack=void 0,this._elevationChartSource.clear(),this.mapCmp.map.render())}_getGeoJson(t){return(null==t?void 0:t.geojson)?t.geojson:(null==t?void 0:t.geometry)?t.geometry:(null==t?void 0:t._geometry)?t._geometry:t}_init(){const t=this.track.geometry.coordinates[this.track.geometry.coordinates.length-1];this._startFeature=hh(Qh,this.track.geometry.coordinates[0]),this._endFeature=hh(tu,t),this._startEndLayer=new nl({zIndex:497,source:new fl({features:[this._startFeature,this._endFeature]})}),this.mapCmp.map.addLayer(this._startEndLayer),this.drawTrack(this.track),this.mapCmp.map.getInteractions().extend([new Ms]),this._centerMapToTrack()}_initPopover(){const t=this.componentFactoryResolver.resolveComponentFactory(Tu);this._popoverRef=this.viewContainerRef.createComponent(t);const e=this.element.nativeElement;e.insertBefore(this._popoverRef.location.nativeElement,e.firstChild)}_resetView(){null!=this._elevationChartLayer&&(this._elevationChartSource.removeFeature(this._elevationChartPoint),this._elevationChartSource.clear(),this.mapCmp.map.removeLayer(this._elevationChartLayer),this._elevationChartLayer=void 0,this._elevationChartPoint=void 0,this._elevationChartTrack=void 0,this.trackElevationChartElements=void 0),null!=this._startEndLayer&&(this.mapCmp.map.removeLayer(this._startEndLayer),this._startEndLayer=void 0),null!=this._trackLayer&&(this.mapCmp.map.removeLayer(this._trackLayer),this._trackLayer=void 0),null!=this._popoverRef&&this._popoverRef.instance.message$.next(null)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(l.SBq),l.Y36(l.s_b),l.Y36(l._Vd),l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapTrack",""]],inputs:{track:"track",trackElevationChartElements:"trackElevationChartElements",wmMapTrackColor:"wmMapTrackColor"},features:[l.qOj,l.TTD]}),t})(),ku=(()=>{class t extends Bh{constructor(t){super(t),this._enabled$=new rt.X(!1),this._url$=new rt.X(null),this._enabled$.pipe((0,Pt.h)(t=>!0===t),(0,Mt.w)(()=>this.mapCmp.isInit$),(0,Pt.h)(t=>!0===t),(0,wh.q)(1)).subscribe(()=>{this.mapCmp.map.once("precompose",()=>{this._overlayLayer=new nl({source:new fl({format:new Kh,url:this._url$.value}),style:new Qs({fill:new $s({color:"rgba(255, 0, 0, 0)"}),stroke:new Xs({color:"rgba(0, 0, 0, 1)",width:3})}),zIndex:1}),this._overlayLayer.setOpacity(.8),this.mapCmp.map.addLayer(this._overlayLayer)})})}set enabled(t){this._enabled$.next(t)}set url(t){this._url$.next(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapOverlay",""]],inputs:{enabled:["wmMapOverlay","enabled"],url:["wmMapOverlayUrl","url"]},features:[l.qOj]}),t})();var Eu=i(1841);let Pu=(()=>{class t extends Bh{constructor(t,e){super(t),this._http=e,this._enabled$=new rt.X(!1),this._overlay$=new rt.X(null),this._primaryColor=null,this._selectedFeature=null,this._selectedStyle=new Qs({stroke:new Xs({color:Gc,width:4}),fill:new $s({color:"rgba(245, 159, 26, 0.4)"})}),this._unselectedStyle=new Qs({stroke:new Xs({color:Gc,width:4}),fill:new $s({color:"rgba(245, 159, 26, 0)"})}),this.translationCallback=t=>{if(null==t)return"";if("string"==typeof t)return t;for(const e in t)if(t[e])return t[e]},this.wmMapFeatureCollectionLayerSelected=new l.vpe,this._enabled$.pipe((0,Pt.h)(t=>!0===t),(0,Mt.w)(()=>this.mapCmp.isInit$),(0,Pt.h)(t=>!0===t),(0,Mt.w)(t=>this._overlay$),(0,Pt.h)(t=>null!=t),(0,Mt.w)(t=>(this._unselectedStyle=new Qs({stroke:new Xs({color:t.strokeColor?t.strokeColor:Gc,width:t.strokeWidth?t.strokeWidth:4})}),this._http.get(t.url)))).subscribe(t=>{this.mapCmp.map.once("precompose",()=>{this._buildGeojson(t)})})}set color(t){this._primaryColor=t}set enabled(t){this._enabled$.next(t),null!=this._featureCollectionLayer&&this._featureCollectionLayer.setVisible(t)}set overlay(t){this._overlay$.next(t)}_buildGeojson(t){const e=new Kh({featureProjection:"EPSG:3857"}).readFeatures(t),i=new fl({format:new Kh,features:e});if(null!=this._featureCollectionLayer&&null!=this._featureCollectionLayer.getSource()&&this._featureCollectionLayer.getSource().clear(),this._featureCollectionLayer=new nl({source:i,style:this._unselectedStyle,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:480}),null!=this.mapCmp.map){this.mapCmp.map.addLayer(this._featureCollectionLayer);const t=i.getExtent();null!=t&&this.fitView(t,{duration:500,maxZoom:18,padding:[10,10,10,10]})}var n=new vl({hitTolerance:5,multi:!0,condition:ps});this._popupOverlay=new yu({popupClass:"default anim",closeBox:!0,offset:[0,-16],positioning:"bottom-center",select:n,onclose:()=>{},autoPan:{animation:{duration:100}}}),this.mapCmp.map.addOverlay(this._popupOverlay);let r=null;this.mapCmp.map.on("pointermove",t=>{this.mapCmp.map.getViewport().style.cursor="",this.mapCmp.map.forEachFeatureAtPixel(t.pixel,t=>{if(t instanceof ye&&(t.getGeometry()instanceof qo||t.getGeometry()instanceof Dl)){if(null!=t.getProperties().layer){this.mapCmp.map.getViewport().style.cursor="pointer",null!=this._selectedFeature&&this._selectedFeature.setStyle(this._unselectedStyle),this._selectedFeature=t,this._selectedFeature.setStyle(this._selectedStyle);const e=t.getProperties();if(null!=e&&null!=e.layer){const i=e.layer;if(i.id){const e=` \n                <ion-card style="max-width:300px">\n                ${i.feature_image?`<img  src="${i.feature_image}" />`:""}\n                  <ion-card-header>\n                    <ion-card-title>${this.translationCallback(i.title)}</ion-card-title>\n                  </ion-card-header>\n                  <ion-card-content>\n                  ${i.description?this.translationCallback(i.description).substring(0,200)+"...":""}\n                  </ion-card-content>\n                </ion-card>`,n=hi(t.getGeometry().getExtent());JSON.stringify(n)!=JSON.stringify(r)&&(this._popupOverlay.show(n,e),r=n)}}}else null!=this._selectedFeature&&this._selectedFeature.setStyle(this._unselectedStyle),this._popupOverlay.hide(),r=null;return!0}})}),this.mapCmp.map.on("click",t=>{this.mapCmp.map.forEachFeatureAtPixel(t.pixel,t=>{if(t instanceof ye){const e=t.getProperties();if(null!=e&&null!=e.layer){const i=e.layer,n=t.getGeometry().getExtent();this.fitView(n),console.log("seleziono nuovo layer",i.id),this._popupOverlay.hide(),this.wmMapFeatureCollectionLayerSelected.emit(i)}}})})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Vh,1),l.Y36(Eu.eN))},t.\u0275dir=l.lG2({type:t,selectors:[["","wmMapFeatureCollection",""]],inputs:{color:["wmMapFeatureCollectionPrimaryColor","color"],enabled:["wmMapFeatureCollection","enabled"],overlay:["wmMapFeatureCollectionOverlay","overlay"],translationCallback:["wmMapTranslationCallback","translationCallback"]},outputs:{wmMapFeatureCollectionLayerSelected:"wmMapFeatureCollectionLayerSelected"},features:[l.qOj]}),t})();var Mu=i(8334),Iu=i(8496),Lu=i(3065);function Au(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"div",1),l.NdJ("click",function(){return l.CHM(t),l.oxw().dismiss()}),l._UZ(2,"ion-icon",2),l.qZA(),l._UZ(3,"div",3),l.BQk()}if(2&t){const t=e.ngIf,i=l.oxw();l.xp6(3),l.Q6J("innerHTML",i.sanitizer.bypassSecurityTrustHtml(t.HTML),l.oJD)}}let Ru=(()=>{class t{constructor(t,e,i,n,r){this._store=t,this._modalCtrl=e,this._route=i,this._router=n,this.sanitizer=r,this.html$=this._store.select(Mu.SZ)}dismiss(){this._modalCtrl.dismiss(),this._router.navigate([],{relativeTo:this._route,queryParams:{slug:null},queryParamsHandling:"merge"})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Lu.yh),l.Y36(s.IN),l.Y36(yt.gz),l.Y36(yt.F0),l.Y36(Sh.H7))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-project-page"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"dismiss",3,"click"],["name","close"],[1,"content",3,"innerHTML"]],template:function(t,e){1&t&&(l.YNc(0,Au,4,1,"ng-container",0),l.ALo(1,"async")),2&t&&l.Q6J("ngIf",l.lcZ(1,1,e.html$))},directives:[r.O5,s.gu],pipes:[r.Ov],styles:["webmapp-project-page{margin:5%;display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:space-around;align-content:stretch;align-items:stretch}webmapp-project-page .dismiss{flex:0 1 auto;align-self:auto;text-align:end;font-size:40px}webmapp-project-page .content{overflow-y:auto;flex:1 1 auto;align-self:auto}"],encapsulation:2,changeDetection:0}),t})();const Ou=["*"];let Fu=(()=>{class t{constructor(t,e){this.isTypingsEVT=new l.vpe(!1),this.wordsEVT=new l.vpe(!1),this.isBlankEVT=new l.vpe,this.searchForm=t.group({search:[""]}),this.searchForm.valueChanges.pipe((0,It.b)(500)).subscribe(t=>{t&&null!=t.search&&""!==t.search?(e.dispatch((0,wt.hy)({inputTyped:t.search})),this.isTypingsEVT.emit(!0),this.wordsEVT.emit(t.search)):this.isTypingsEVT.emit(!1),""===(null==t?void 0:t.search)&&this.isBlankEVT.emit()})}set setSearch(t){this.searchForm.controls.search.setValue(t)}reset(){this.searchForm.reset(),this.wordsEVT.emit(""),this.isTypingsEVT.emit(!1)}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(o.qu),l.Y36(Lu.yh))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-search"]],inputs:{setSearch:["initSearch","setSearch"]},outputs:{isTypingsEVT:"isTypings",wordsEVT:"words",isBlankEVT:"isBlankEVT"},ngContentSelectors:Ou,decls:7,vars:4,consts:[[3,"formGroup"],["name","search"],["id","first-name","type","text","formControlName","search",3,"placeholder"],["name","close",1,"close",3,"click"]],template:function(t,e){1&t&&(l.F$t(),l.TgZ(0,"div"),l.TgZ(1,"form",0),l._UZ(2,"ion-icon",1),l._UZ(3,"input",2),l.ALo(4,"wmtrans"),l.qZA(),l.TgZ(5,"ion-icon",3),l.NdJ("click",function(){return e.reset()}),l.qZA(),l.qZA(),l.Hsn(6)),2&t&&(l.xp6(1),l.Q6J("formGroup",e.searchForm),l.xp6(2),l.s9C("placeholder",l.lcZ(4,2,"Cerca")))},directives:[o._Y,o.JL,o.sg,s.gu,o.Fj,o.JJ,o.u],pipes:[K.a],styles:["webmapp-search{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch}webmapp-search div{flex:0 1 auto;align-self:auto;display:flex;position:relative;align-items:center;font-family:var(--wm-font-family-content,inherit);box-sizing:border-box;background:inherit;padding-inline-start:7px;padding-inline-end:7px;min-height:46px;visibility:inherit;border-radius:2px;box-shadow:0 2px 2px 0 #00000024,0 3px 1px -2px #0003,0 1px 5px 0 #0000001f;flex-shrink:1;width:auto;margin:10px}webmapp-search div form{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start;width:100%}webmapp-search div form ion-icon{position:inherit;order:0;flex:0 1 auto;align-self:auto;color:var(--wm-color-primary);pointer-events:none;font-size:24px}webmapp-search div form input{flex:1 1 auto;align-self:auto;-webkit-appearance:none;outline:none;width:100%;border:unset;padding:5px;margin-left:5px;background-color:unset;font:unset}webmapp-search div form input:focus{outline:none;border-color:inherit;box-shadow:none}webmapp-search div .close{cursor:pointer;color:var(--wm-color-primary);font-family:var(--wm-font-family-content,inherit);background:inherit}webmapp-search wm-filters{margin:-10px 10px 10px;font-family:var(--wm-font-family-content,inherit)}"],encapsulation:2,changeDetection:0}),t})();var Du=i(7009),Zu=i(8926),Nu=i(9629),ju=i(4495);const Gu=["searchCmp"];function zu(t,e){if(1&t&&(l.TgZ(0,"ion-item",7),l._UZ(1,"ion-label",8),l.ALo(2,"wmtrans"),l.qZA()),2&t){const t=e.ngIf,i=l.oxw(2);l.xp6(1),l.Q6J("innerHTML",i.sanitizer.bypassSecurityTrustHtml(l.lcZ(2,1,t)),l.oJD)}}function Vu(t,e){if(1&t&&(l.ynx(0),l.YNc(1,zu,3,3,"ion-item",6),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",t.welcome)}}function Bu(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"wm-home-result",11),l.NdJ("trackEVT",function(e){return l.CHM(t),l.oxw(2).setTrack(e)})("poiEVT",function(e){return l.CHM(t),l.oxw(2).setPoi(e)}),l.qZA()}}function qu(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"wm-status-filter",9),l.NdJ("resetFiltersEVT",function(){return l.CHM(t),l.oxw().goToHome()})("removeLayerEVT",function(e){return l.CHM(t),l.oxw().removeLayer(e)}),l.qZA(),l._UZ(2,"wm-home-layer"),l.YNc(3,Bu,1,0,"wm-home-result",10),l.ALo(4,"async"),l.BQk()}if(2&t){const t=l.oxw(),e=l.MAs(9);l.xp6(3),l.Q6J("ngIf",l.lcZ(4,2,t.showResult$))("ngIfElse",e)}}function Uu(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"wm-home-page",12),l.NdJ("poiTypeFilterBoxEVT",function(e){return l.CHM(t),l.oxw().togglePoiFilter(e[0],e[1])})("slugBoxEVT",function(e){return l.CHM(t),l.oxw().openSlug(e[0],e[1])})("externalUrlBoxEVT",function(e){return l.CHM(t),l.oxw().openExternalUrl(e)})("tracksBoxEVT",function(e){return l.CHM(t),l.oxw().setTrack(e)})("layerBoxEVT",function(e){return l.CHM(t),l.oxw().setLayer(e[0],e[1])}),l.qZA()}}const $u=["*"];let Yu=(()=>{class t{constructor(t,e,i,n,r,o){this._store=t,this._router=e,this._route=i,this._modalCtrl=n,this._navCtrl=r,this.sanitizer=o,this.confAPP$=this._store.select(Mu.I8),this.confHOME$=this._store.select(Mu.Gj),this.showResult$=this._store.select(xt.vE)}goToHome(){this.setLayer(null),this.searchCmp.reset(),this._router.navigate([],{relativeTo:this._route,queryParams:{layer:null,filter:null},queryParamsHandling:"merge"}),Bh.priority=0}ngAfterContentInit(){this.confHOME$.pipe((0,Pt.h)(t=>null!=t),(0,Ot.M)(this._route.queryParams),(0,It.b)(1800)).subscribe(([t,e])=>{null!=e.layer&&null!=t[e.layer]?this.setLayer(t[+e.layer].layer):null!=e.filter&&null!=t[e.filter]&&this.togglePoiFilter(t[+e.filter].identifier),null!=e.slug&&null!=t[e.slug]&&this.openSlug(t[+e.slug].slug)})}openExternalUrl(t){window.open(t)}openSlug(t,e){"project"===t?this._modalCtrl.create({component:Ru,cssClass:"wm-modal",backdropDismiss:!0,keyboardClose:!0}).then(t=>{t.present(),e&&this._router.navigate([],{relativeTo:this._route,queryParams:{slug:e},queryParamsHandling:"merge"})}):this._navCtrl.navigateForward(t)}removeLayer(t){this.setLayer(null),this._router.navigate([],{relativeTo:this._route,queryParams:{layer:null},queryParamsHandling:"merge"})}setFilter(t){null!=t&&this._store.dispatch("poi_types"===t.taxonomy?(0,wt.Dq)({filterIdentifier:t.identifier}):(0,wt.z8)({identifier:t.identifier,taxonomy:t.taxonomy}))}setLayer(t,e){null!=t&&null!=t.id?this._store.dispatch((0,wt.uF)({layer:t})):(this._store.dispatch((0,wt.uF)(null)),this._store.dispatch((0,wt.AF)())),e&&this._router.navigate([],{relativeTo:this._route,queryParams:{layer:e},queryParamsHandling:"merge"})}setPoi(t){this._store.dispatch((0,Iu.hB)({currentPoi:null})),setTimeout(()=>{this._store.dispatch((0,Iu.hB)({currentPoi:t}))},200)}setSearch(t){this._store.dispatch((0,wt.hy)({inputTyped:t}))}setTrack(t){this._router.navigate([],{relativeTo:this._route,queryParams:{track:t||null},queryParamsHandling:"merge"})}togglePoiFilter(t,e){this.setFilter({identifier:t,taxonomy:"poi_types"}),e&&this._router.navigate([],{relativeTo:this._route,queryParams:{filter:e},queryParamsHandling:"merge"})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Lu.yh),l.Y36(yt.F0),l.Y36(yt.gz),l.Y36(s.IN),l.Y36(s.SH),l.Y36(Sh.H7))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-home"]],viewQuery:function(t,e){if(1&t&&l.Gf(Gu,5),2&t){let t;l.iGM(t=l.CRH())&&(e.searchCmp=t.first)}},ngContentSelectors:$u,decls:10,vars:8,consts:[[1,"root"],[4,"ngIf"],[3,"initSearch","words"],["searchCmp",""],[4,"ngIf","ngIfElse"],["home",""],["lines","none",4,"ngIf"],["lines","none"],[3,"innerHTML"],[3,"resetFiltersEVT","removeLayerEVT"],[3,"trackEVT","poiEVT",4,"ngIf","ngIfElse"],[3,"trackEVT","poiEVT"],[3,"poiTypeFilterBoxEVT","slugBoxEVT","externalUrlBoxEVT","tracksBoxEVT","layerBoxEVT"]],template:function(t,e){if(1&t&&(l.F$t(),l.TgZ(0,"div",0),l.Hsn(1),l.YNc(2,Vu,2,1,"ng-container",1),l.ALo(3,"async"),l.TgZ(4,"webmapp-search",2,3),l.NdJ("words",function(t){return e.setSearch(t)}),l.qZA(),l.YNc(6,qu,5,4,"ng-container",4),l.ALo(7,"async"),l.YNc(8,Uu,1,0,"ng-template",null,5,l.W1O),l.qZA()),2&t){const t=l.MAs(9);l.xp6(2),l.Q6J("ngIf",l.lcZ(3,4,e.confAPP$)),l.xp6(2),l.Q6J("initSearch",""),l.xp6(2),l.Q6J("ngIf",l.lcZ(7,6,e.showResult$))("ngIfElse",t)}},directives:[r.O5,Fu,s.Ie,s.Q$,Du.C,Zu.N,Nu.u,ju.I],pipes:[r.Ov,K.a],styles:["webmapp-home .root{width:100%;height:100%;padding:1% 1% 100px;overflow-y:auto}webmapp-home .root ion-content{--padding-bottom:100px}webmapp-home .root .wm-home-cardcontainer{margin-bottom:200px}webmapp-home .pois{margin-bottom:100px}.wm-modal .modal-wrapper{--height:90%;--width:90%;position:absolute;top:5%;border-radius:25px!important;display:block}"],encapsulation:2,changeDetection:0}),t})();var Xu=i(8697),Wu=i(7294);const Hu=(0,Lu.ZF)(Wu.U),Ju=(0,Lu.P1)(Hu,t=>t&&t.currentPoi?t.currentPoi:null),Ku=(0,Lu.P1)(Ju,t=>t&&t.id?t.id:null);(0,Lu.P1)(Hu,t=>!(!t||!t.drawTrack)&&t.drawTrack);var Qu=i(2340),td=i(4762);let ed=(()=>{class t{constructor(){const t=window.location.hostname;t.indexOf("localhost")>=0?this._geohubAppId=Qu.N.geohubId:(this._geohubAppId=parseInt(t.split(".")[0],10),Number.isNaN(this._geohubAppId)&&(this._geohubAppId=Qu.N.geohubId))}get configUrl(){return`${this._geohubApiBaseUrl}config`}get geohubAppId(){return this._geohubAppId}get vectorStyleUrl(){return`${this._geohubApiBaseUrl}vector_style`}get _geohubApiBaseUrl(){return`${Qu.N.api}/api/app/webapp/${this._geohubAppId}/`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),id=(()=>{class t{constructor(t){this._http=t}get(t,e){return this._http.get(t,e)}post(t,e,i){return this._http.post(t,e,i)}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(Eu.eN))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),nd=(()=>{class t{constructor(t,e){this._configService=t,this._communicationService=e,this._ecTracks=[]}getEcTrack(t){return(0,td.mG)(this,void 0,void 0,function*(){const e=this._ecTracks.find(e=>{var i;return(null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.id)===t});if(e)return e;if(t>-1){const e=yield this._communicationService.get(`${Qu.N.api}/api/ec/track/${t}`).pipe((0,ot.U)(t=>{const e=(t.properties.related_pois||[]).map(t=>(t.properties.related=!0,t)),i=Object.assign(Object.assign({},t.properties),{related_pois:e});return Object.assign(Object.assign({},t),{properties:i})})).toPromise();return this._ecTracks.push(e),this._ecTracks.length>10&&this._ecTracks.splice(0,1),e}})}getVectorLayerStyle(){return(0,td.mG)(this,void 0,void 0,function*(){return yield this._communicationService.get(this._configService.vectorStyleUrl).toPromise()})}search(t){return(0,td.mG)(this,void 0,void 0,function*(){return yield this._communicationService.get(`${Qu.N.api}/api/ec/track/${t}`).pipe((0,ot.U)(t=>{const e=t.properties.related_pois.map(t=>(t.properties.related=!0,t)),i=Object.assign(Object.assign({},t.properties),{related_pois:e});return Object.assign(Object.assign({},t),{properties:i})})).toPromise()})}}return t.\u0275fac=function(e){return new(e||t)(l.LFG(ed),l.LFG(id))},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var rd=i(6782);const od=["gallerySlider"],sd=function(t){return{expanded:t}};function ad(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",9),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).expandCaption()}),l.qZA()}if(2&t){const t=l.oxw().$implicit,e=l.oxw();l.Q6J("innerHtml",t.caption,l.oJD)("ngClass",l.VKq(2,sd,e.isExpanded))}}const ld=function(t){return{"background-image":t}};function cd(t,e){if(1&t&&(l.TgZ(0,"ion-slide",7),l.YNc(1,ad,1,4,"div",8),l.qZA()),2&t){const t=e.$implicit;l.Q6J("ngStyle",l.VKq(2,ld,"url('"+t.url+"')")),l.xp6(1),l.Q6J("ngIf",t.caption&&""!==t.caption)}}function hd(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",10),l.NdJ("click",function(){return l.CHM(t),l.oxw().previous()}),l._UZ(1,"ion-icon",11),l.qZA()}}function ud(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",12),l.NdJ("click",function(){return l.CHM(t),l.oxw().next()}),l._UZ(1,"ion-icon",13),l.qZA()}}let dd=(()=>{class t{constructor(t){this._modalController=t,this._destroyer=new qh.xQ,this.isExpanded=!1,this.isStart=!0,this.isEnd=!1,this.galleryOptions={slidesPerView:1},this.galleryOptions.on={beforeInit(){const t=this;t.classNames.push(`${t.params.containerModifierClass}fade`);const e={slidesPerView:1,slidesPerColumn:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!0};t.params=Object.assign(t.params,e),t.params=Object.assign(t.originalParams,e)},setTranslate(){const t=this,{slides:e}=t;for(let i=0;i<e.length;i+=1){const e=t.slides.eq(i);let n=-e[0].swiperSlideOffset;t.params.virtualTranslate||(n-=t.translate);let r=0;t.isHorizontal()||(r=n,n=0);const o=t.params.fadeEffect.crossFade?Math.max(1-Math.abs(e[0].progress),0):1+Math.min(Math.max(e[0].progress,-1),0);e.css({opacity:o}).transform(`translate3d(${n}px, ${r}px, 0px)`)}},setTransition(t){const e=this,{slides:i,$wrapperEl:n}=e;if(i.transition(t),e.params.virtualTranslate&&0!==t){let t=!1;i.transitionEnd(()=>{if(t)return;if(!e||e.destroyed)return;t=!0,e.animating=!1;const i=["webkitTransitionEnd","transitionend"];for(const t of i)n.trigger(t)})}}}}ngOnInit(){setTimeout(()=>{this.slider.ionSlideTransitionEnd.pipe((0,rd.R)(this._destroyer)).subscribe(t=>{this.slider.getActiveIndex().then(t=>{this.isStart=0===t,this.isEnd=t===this.gallery.length-1,this.isExpanded=!1})},t=>{console.warn(t)}),console.log("------- ~ ModalGalleryComponent ~ setTimeout ~ this.gallery",this.gallery),1===this.gallery.length&&(this.isEnd=!0)},0)}next(){this.slider.slideNext()}previous(){this.slider.slidePrev()}dismiss(){this._modalController.dismiss()}expandCaption(){this.isExpanded=!this.isExpanded}ngOnDestroy(){this._destroyer.next()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(s.IN))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-modal-gallery"]],viewQuery:function(t,e){if(1&t&&l.Gf(od,5),2&t){let t;l.iGM(t=l.CRH())&&(e.slider=t.first)}},inputs:{gallery:"gallery"},decls:7,vars:4,consts:[[1,"modal__dismiss",3,"click"],["name","close"],["pager","true",1,"gallery__slides",3,"options"],["gallerySlider",""],["class","gallery__slide",3,"ngStyle",4,"ngFor","ngForOf"],["class","gallery__previous wm-clickable",3,"click",4,"ngIf"],["class","gallery__next wm-clickable",3,"click",4,"ngIf"],[1,"gallery__slide",3,"ngStyle"],["class","gallery__caption wm-clickable",3,"innerHtml","ngClass","click",4,"ngIf"],[1,"gallery__caption","wm-clickable",3,"innerHtml","ngClass","click"],[1,"gallery__previous","wm-clickable",3,"click"],["name","arrow-back","mode","ios"],[1,"gallery__next","wm-clickable",3,"click"],["name","arrow-forward","mode","ios"]],template:function(t,e){1&t&&(l.TgZ(0,"div",0),l.NdJ("click",function(){return e.dismiss()}),l._UZ(1,"ion-icon",1),l.qZA(),l.TgZ(2,"ion-slides",2,3),l.YNc(4,cd,2,4,"ion-slide",4),l.qZA(),l.YNc(5,hd,2,0,"div",5),l.YNc(6,ud,2,0,"div",6)),2&t&&(l.xp6(2),l.Q6J("options",e.galleryOptions),l.xp6(2),l.Q6J("ngForOf",e.gallery),l.xp6(1),l.Q6J("ngIf",!e.isStart),l.xp6(1),l.Q6J("ngIf",!e.isEnd))},directives:[s.gu,s.Hr,r.sg,r.O5,s.A$,r.PC,r.mk],styles:['[_ngcontent-%COMP%]:root{--wm-color-primary:#3880ff;--wm-color-primary-rgb:56,128,255;--wm-color-primary-contrast:#fff;--wm-color-primary-contrast-rgb:255,255,255;--wm-color-primary-shade:#3171e0;--wm-color-primary-tint:#4c8dff;--wm-color-secondary:#3dc2ff;--wm-color-secondary-rgb:61,194,255;--wm-color-secondary-contrast:#fff;--wm-color-secondary-contrast-rgb:255,255,255;--wm-color-secondary-shade:#36abe0;--wm-color-secondary-tint:#50c8ff;--wm-color-tertiary:#5260ff;--wm-color-tertiary-rgb:82,96,255;--wm-color-tertiary-contrast:#fff;--wm-color-tertiary-contrast-rgb:255,255,255;--wm-color-tertiary-shade:#4854e0;--wm-color-tertiary-tint:#6370ff;--wm-color-success:#2dd36f;--wm-color-success-rgb:45,211,111;--wm-color-success-contrast:#fff;--wm-color-success-contrast-rgb:255,255,255;--wm-color-success-shade:#28ba62;--wm-color-success-tint:#42d77d;--wm-color-warning:#ffc409;--wm-color-warning-rgb:255,196,9;--wm-color-warning-contrast:#000;--wm-color-warning-contrast-rgb:0,0,0;--wm-color-warning-shade:#e0ac08;--wm-color-warning-tint:#ffca22;--wm-color-danger:#eb445a;--wm-color-danger-rgb:235,68,90;--wm-color-danger-contrast:#fff;--wm-color-danger-contrast-rgb:255,255,255;--wm-color-danger-shade:#cf3c4f;--wm-color-danger-tint:#ed576b;--wm-color-dark:#222428;--wm-color-dark-rgb:34,36,40;--wm-color-dark-contrast:#fff;--wm-color-dark-contrast-rgb:255,255,255;--wm-color-dark-shade:#1e2023;--wm-color-dark-tint:#383a3e;--wm-color-medium:#92949c;--wm-color-medium-rgb:146,148,156;--wm-color-medium-contrast:#fff;--wm-color-medium-contrast-rgb:255,255,255;--wm-color-medium-shade:#808289;--wm-color-medium-tint:#9d9fa6;--wm-color-light:#f4f5f8;--wm-color-light-rgb:244,245,248;--wm-color-light-contrast:#000;--wm-color-light-contrast-rgb:0,0,0;--wm-color-light-shade:#d7d8da;--wm-color-light-tint:#f5f6f9;--wm-font-xxx-lg:28px;--wm-font-xx-lg:25px;--wm-font-x-lg:22px;--wm-font-lg:20px;--wm-font-md:18px;--wm-font-sm:14px;--wm-font-x-sm:12px;--wm-font-family-header:"Inter";--wm-font-family-content:"Inter"}.modal__dismiss[_ngcontent-%COMP%]{position:absolute;top:0;right:0;margin:20px 30px;font-size:var(--wm-font-xxx-lg);z-index:1000;color:var(--wm-color-light);will-change:transform}.gallery__slides[_ngcontent-%COMP%], .gallery__slides[_ngcontent-%COMP%]   .gallery__slide[_ngcontent-%COMP%]{width:100%;height:100%;background-color:var(--wm-color-dark)}.gallery__slides[_ngcontent-%COMP%]   .gallery__slide[_ngcontent-%COMP%]{background-position:50%;background-repeat:no-repeat;background-size:contain}.gallery__slides[_ngcontent-%COMP%]   .gallery__slide[_ngcontent-%COMP%]   .gallery__caption[_ngcontent-%COMP%]{font-family:var(--wm-font-family-content);font-size:var(--font-md);text-align:justify;bottom:30px;padding:0 10px;line-height:1.1}.gallery__next[_ngcontent-%COMP%], .gallery__previous[_ngcontent-%COMP%], .gallery__slides[_ngcontent-%COMP%]   .gallery__slide[_ngcontent-%COMP%]   .gallery__caption[_ngcontent-%COMP%]{color:var(--wm-color-light);background:rgba(var(--wm-color-dark-rgb),.6);position:absolute}.gallery__next[_ngcontent-%COMP%], .gallery__previous[_ngcontent-%COMP%]{padding:10px;font-size:var(--wm-font-xx-lg);top:50%;transform:translateY(-50%);z-index:1000}.gallery__next[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .gallery__previous[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{position:relative;top:3px}.gallery__previous[_ngcontent-%COMP%]{padding-left:0;border-top-right-radius:80% 50%;border-bottom-right-radius:80% 50%;left:0}.gallery__next[_ngcontent-%COMP%]{padding-right:0;border-top-left-radius:80% 50%;border-bottom-left-radius:80% 50%;right:0}']}),t})(),pd=(()=>{class t{constructor(){}formatDistance(t){return(Math.round(10*t)/10+" km").replace(".",",")}formatDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);return e+":"+(i>9?i:"0"+i)+" h"}formatElevation(t){return Math.round(t)+" m"}formatAscent(t){return Math.round(t)+" m"}formatDescent(t){return this.formatAscent(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function fd(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",3),l.TgZ(2,"i",4),l._UZ(3,"span",5),l._UZ(4,"span",6),l.qZA(),l.TgZ(5,"div",7),l._uU(6),l.ALo(7,"wmtrans"),l.qZA(),l.TgZ(8,"div",8),l._uU(9),l.ALo(10,"wmtrans"),l.qZA(),l.qZA(),l._UZ(11,"hr"),l.BQk()),2&t){const t=e.$implicit;l.xp6(2),l.MGl("className","",t.icon," webmapp-pageroute-tabdetail-icon"),l.xp6(4),l.hij(" ",l.lcZ(7,3,t.label)," "),l.xp6(3),l.hij(" ",l.lcZ(10,5,t.value)," ")}}function gd(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",1),l.YNc(2,fd,12,7,"ng-container",2),l.qZA(),l.BQk()),2&t){const t=l.oxw();l.xp6(2),l.Q6J("ngForOf",t.technicalData)}}let md=(()=>{class t{constructor(t){this._utilsService=t}set feature(t){this._feature=t,this.technicalData=this._initializeTechnicalData()}ngOnInit(){}_initializeTechnicalData(){var t,e,i,n,r,o,s,a,l,c,h,u,d,p,f,g,m,_,v,y,w,x,b,C,T,S;const k=[];return(null===(e=null===(t=null==this?void 0:this._feature)||void 0===t?void 0:t.properties)||void 0===e?void 0:e.difficulty)&&k.push({icon:"icon-outline-difficulty",label:"difficulty",value:this._feature.properties.difficulty}),(null===(n=null===(i=null==this?void 0:this._feature)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.distance)&&k.push({icon:"icon-outline-distance",label:"distance",value:this._utilsService.formatDistance(this._feature.properties.distance)}),(null===(o=null===(r=null==this?void 0:this._feature)||void 0===r?void 0:r.properties)||void 0===o?void 0:o.duration_forward)&&k.push({icon:"icon-outline-duration",label:"duration_forward",value:this._utilsService.formatDuration(this._feature.properties.duration_forward)}),(null===(a=null===(s=null==this?void 0:this._feature)||void 0===s?void 0:s.properties)||void 0===a?void 0:a.duration_backward)&&!1===(null===(c=null===(l=null==this?void 0:this._feature)||void 0===l?void 0:l.properties)||void 0===c?void 0:c.roundtrip)&&k.push({icon:"icon-outline-duration",label:"duration_backward",value:this._utilsService.formatDuration(this._feature.properties.duration_backward)}),(null===(u=null===(h=null==this?void 0:this._feature)||void 0===h?void 0:h.properties)||void 0===u?void 0:u.ascent)&&k.push({icon:"icon-outline-dislivello-positivo",label:"ascent",value:this._utilsService.formatAscent(this._feature.properties.ascent)}),(null===(p=null===(d=null==this?void 0:this._feature)||void 0===d?void 0:d.properties)||void 0===p?void 0:p.descent)&&!1===(null===(g=null===(f=null==this?void 0:this._feature)||void 0===f?void 0:f.properties)||void 0===g?void 0:g.roundtrip)&&k.push({icon:"icon-outline-dislivello-negativo",label:"descent",value:this._utilsService.formatDescent(this._feature.properties.descent)}),(null===(_=null===(m=null==this?void 0:this._feature)||void 0===m?void 0:m.properties)||void 0===_?void 0:_.ele_from)&&k.push({icon:"icon-fill-starting-point",label:"ele_from",value:this._utilsService.formatElevation(this._feature.properties.ele_from)}),(null===(y=null===(v=null==this?void 0:this._feature)||void 0===v?void 0:v.properties)||void 0===y?void 0:y.ele_to)&&!1===(null===(x=null===(w=null==this?void 0:this._feature)||void 0===w?void 0:w.properties)||void 0===x?void 0:x.roundtrip)&&k.push({icon:"icon-fill-flag",label:"ele_to",value:this._utilsService.formatElevation(this._feature.properties.ele_to)}),(null===(C=null===(b=null==this?void 0:this._feature)||void 0===b?void 0:b.properties)||void 0===C?void 0:C.ele_min)&&k.push({icon:"icon-outline-minus",label:"ele_min",value:this._utilsService.formatElevation(this._feature.properties.ele_min)}),(null===(S=null===(T=null==this?void 0:this._feature)||void 0===T?void 0:T.properties)||void 0===S?void 0:S.ele_max)&&k.push({icon:"icon-outline-plus",label:"ele_max",value:this._utilsService.formatElevation(this._feature.properties.ele_max)}),k}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(pd))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-technical-data"]],inputs:{feature:"feature"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"webmapp-track-technical-data-container"],[4,"ngFor","ngForOf"],[1,"webmapp-track-technical-data-item"],[3,"className"],[1,"path1"],[1,"path2"],[1,"webmapp-track-technical-data-label"],[1,"webmapp-track-technical-data-value"]],template:function(t,e){1&t&&l.YNc(0,gd,3,1,"ng-container",0),2&t&&l.Q6J("ngIf",null==e.technicalData?null:e.technicalData.length)},directives:[r.O5,r.sg],pipes:[K.a],styles:["webmapp-track-technical-data{display:block}webmapp-track-technical-data .webmapp-track-technical-data-container{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start}webmapp-track-technical-data .webmapp-track-technical-data-container .webmapp-track-technical-data-item{flex:1 1 auto;align-self:stretch;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start;margin:10px}webmapp-track-technical-data .webmapp-track-technical-data-container .webmapp-track-technical-data-item .webmapp-track-technical-data-label{flex:1 1 auto;font-size:var(--wm-font-mf);font-style:normal;font-weight:400;line-height:20px;letter-spacing:0;text-align:left}webmapp-track-technical-data .webmapp-track-technical-data-container .webmapp-track-technical-data-item .webmapp-track-technical-data-value{flex:0 1 auto;display:inline-flex;white-space:nowrap;font-size:var(--wm-font-mf);font-style:normal;font-weight:400;line-height:20px;letter-spacing:0;text-align:right}webmapp-track-technical-data .webmapp-track-technical-data-container hr{border:0;margin-top:4px;border-top:1px solid #d2d2d2;width:100%}"],encapsulation:2}),t})();var _d=i(2205),vd=(()=>(function(t){t.ASPHALT="asphalt",t.CONCRETE="concrete",t.DIRT="dirt",t.GRASS="grass",t.GRAVEL="gravel",t.PAVED="paved",t.SAND="sand"}(vd||(vd={})),vd))();const yd=[67,227,9],wd=[195,255,0],xd=[255,239,10],bd=[255,174,0],Cd=[196,30,4],Td={[vd.ASPHALT]:{backgroundColor:"186, 189, 194"},[vd.CONCRETE]:{backgroundColor:"186, 189, 194"},[vd.DIRT]:{backgroundColor:"186, 189, 194"},[vd.GRASS]:{backgroundColor:"186, 189, 194"},[vd.GRAVEL]:{backgroundColor:"186, 189, 194"},[vd.PAVED]:{backgroundColor:"186, 189, 194"},[vd.SAND]:{backgroundColor:"186, 189, 194"}};var Sd=(()=>(function(t){t.POINT="Point",t.LINE_STRING="LineString",t.MULTI_LINE_STRING="MultiLineString",t.POLYGON="Polygon",t.MULTI_POLYGON="MultiPolygon"}(Sd||(Sd={})),Sd))();class kd extends class{constructor(){this.type="Feature",this._properties={id:null}}get properties(){return null==this?void 0:this._properties}get geometry(){return null==this?void 0:this._geometry}get geometryType(){var t;return null===(t=null==this?void 0:this._geometry)||void 0===t?void 0:t.type}get id(){var t;return null===(t=null==this?void 0:this._properties)||void 0===t?void 0:t.id}get geojson(){return{type:this.type,properties:this.properties,geometry:this.geometry}}setProperty(t,e){this._properties[t]=e}}{constructor(t){super(),t&&"LineString"===t.type&&(this._geometry=t)}addCoordinates(t){this._geometry||this._initializeGeometry();const e=[t.longitude,t.latitude];t.altitude&&e.push(t.altitude),this._geometry.coordinates.push(e)}setGeometry(t){"LineString"===t.type&&(this._geometry=t)}_initializeGeometry(){this._geometry={type:Sd.LINE_STRING,coordinates:[]}}}class Ed{constructor(t,e,i,n,r,o){this.longitude=Math.round(1e5*t)/1e5,this.latitude=Math.round(1e5*e)/1e5,this.altitude=Math.round(i)||void 0,this.accuracy=Math.round(n)||void 0,this.speed=Math.round(100*r)/100||void 0,this.bearing=Math.round(o)||void 0,this.timestamp=Date.now()}getLatLng(){return[this.latitude,this.longitude]}}var Pd={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Md={};Md[Pd.DEGREES]=2*Math.PI*6370997/360,Md[Pd.FEET]=.3048,Md[Pd.METERS]=1,Md[Pd.USFEET]=1200/3937;const Id=Pd,Ld=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Md[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();var Ad="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function Rd(t,e,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return Od(t,e,i,n)}function Od(t,e,i,n){var r=i-t,o=n-e;return r*r+o*o}function Fd(t,e,i){return t+i*(e-t)}"log2"in Math&&Math;var Dd,Zd=(Dd=function(t,e){return(Dd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}Dd(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Nd=6378137,jd=Math.PI*Nd,Gd=[-jd,-jd,jd,jd],zd=[-180,-85,180,85],Vd=Nd*Math.log(Math.tan(Math.PI/2)),Bd=function(t){function e(e){return t.call(this,{code:e,units:Id.METERS,extent:Gd,global:!0,worldExtent:zd,getPointResolution:function(t,e){return t/Ad(e[1]/Nd)}})||this}return Zd(e,t),e}(Ld),qd=[new Bd("EPSG:3857"),new Bd("EPSG:102100"),new Bd("EPSG:102113"),new Bd("EPSG:900913"),new Bd("http://www.opengis.net/gml/srs/epsg.xml#3857")],Ud=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),$d=[-180,-90,180,90],Yd=6378137*Math.PI/180,Xd=function(t){function e(e,i){return t.call(this,{code:e,units:Id.DEGREES,extent:$d,axisOrientation:i,global:!0,metersPerUnit:Yd,worldExtent:$d})||this}return Ud(e,t),e}(Ld),Wd=[new Xd("CRS:84"),new Xd("EPSG:4326","neu"),new Xd("urn:ogc:def:crs:OGC:1.3:CRS84"),new Xd("urn:ogc:def:crs:OGC:2:84"),new Xd("http://www.opengis.net/gml/srs/epsg.xml#4326","neu")],Hd={},Jd={};function Kd(t,e,i){var n=t.getCode(),r=e.getCode();n in Jd||(Jd[n]={}),Jd[n][r]=i}function Qd(t,e,i){var n,r;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(r=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*r}function tp(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function ep(t,e){var i=e[0],n=e[1],r=0;return i<t[0]?r|=16:i>t[2]&&(r|=4),n<t[1]?r|=8:n>t[3]&&(r|=2),0===r&&(r=1),r}function ip(t,e,i,n,r){return r?(r[0]=t,r[1]=e,r[2]=i,r[3]=n,r):[t,e,i,n]}function np(t){return ip(1/0,1/0,-1/0,-1/0,t)}function rp(t,e,i,n,r){return op(np(r),t,e,i,n)}function op(t,e,i,n,r){for(;i<n;i+=r)sp(t,e[i],e[i+1]);return t}function sp(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function ap(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function lp(t){return t[3]-t[1]}function cp(t,e,i){var n;if(void 0!==e){for(var r=0,o=t.length;r<o;++r)e[r]=t[r];n=e}else n=t.slice();return n}function hp(t,e,i){if(void 0!==e&&t!==e){for(var n=0,r=t.length;n<r;++n)e[n]=t[n];t=e}return t}function up(t){!function(t,e){Hd[t]=e}(t.getCode(),t),Kd(t,t,cp)}function dp(t){return"string"==typeof t?Hd[e=t]||Hd[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function pp(t){!function(t){t.forEach(up)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&Kd(e,t,cp)})})}function fp(t,e){var i,n,r,o=(i=t.getCode(),n=e.getCode(),i in Jd&&n in Jd[i]&&(r=Jd[i][n]),r);return o||(o=hp),o}function gp(t,e){return fp(dp(t),dp(e))}function mp(t,e,i){return gp(e,i)(t,void 0,t.length)}function _p(t,e,i,n){return function(t,e,i,n){var r=[];if(n>1)for(var o=t[2]-t[0],s=t[3]-t[1],a=0;a<n;++a)r.push(t[0]+o*a/n,t[1],t[2],t[1]+s*a/n,t[2]-o*a/n,t[3],t[0],t[3]-s*a/n);else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(r,r,2);for(var l=[],c=[],h=(a=0,r.length);a<h;a+=2)l.push(r[a]),c.push(r[a+1]);return function(t,e,i){return ip(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),undefined)}(l,c)}(t,gp(e,i),0,n)}pp(qd),pp(Wd),function(t,e,i,n){t.forEach(function(t){e.forEach(function(e){Kd(t,e,i),Kd(e,t,n)})})}(Wd,qd,function(t,e,i){var n=t.length,r=i>1?i:2,o=e;void 0===o&&(o=r>2?t.slice():new Array(n));for(var s=0;s<n;s+=r){o[s]=jd*t[s]/180;var a=Nd*Math.log(Math.tan(Math.PI*(+t[s+1]+90)/360));a>Vd?a=Vd:a<-Vd&&(a=-Vd),o[s+1]=a}return o},function(t,e,i){var n=t.length,r=i>1?i:2,o=e;void 0===o&&(o=r>2?t.slice():new Array(n));for(var s=0;s<n;s+=r)o[s]=180*t[s]/jd,o[s+1]=360*Math.atan(Math.exp(t[s+1]/Nd))/Math.PI-90;return o});let vp=(()=>{class t{constructor(){}coordsToLonLat(t){return mp(t,"EPSG:3857","EPSG:4326")}coordsFromLonLat(t){return mp(t,"EPSG:4326","EPSG:3857")}extentToLonLat(t){return _p(t,"EPSG:3857","EPSG:4326")}extentFromLonLat(t){return _p(t,"EPSG:4326","EPSG:3857")}distanceBetweenPoints(t,e){const i=t.latitude*Math.PI/180,n=e.latitude*Math.PI/180,r=t.longitude*Math.PI/180,o=n-i,s=e.longitude*Math.PI/180-r,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(n)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371e3}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const yp=["chartCanvas"],wp=function(t){return{left:t}};function xp(t,e){if(1&t&&(l.TgZ(0,"div",12),l.TgZ(1,"div",13),l._uU(2),l.qZA(),l._UZ(3,"div",14),l.qZA()),2&t){const t=l.oxw(3);l.Q6J("ngStyle",l.VKq(2,wp,t.slope.selectedPercentage+"%")),l.xp6(2),l.hij(" ",t.slope.selectedValue,"% ")}}function bp(t,e){if(1&t&&(l.TgZ(0,"div",8),l.TgZ(1,"div",9),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"div",10),l.YNc(5,xp,4,4,"div",11),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.hij(" ",l.lcZ(3,2,"trackDetails.elevationChart.slope.label")," "),l.xp6(3),l.Q6J("ngIf",void 0!==(null==t.slope?null:t.slope.selectedValue)&&t.slope.selectedPercentage>0)}}const Cp=function(t){return{background:t}};function Tp(t,e){if(1&t&&(l.TgZ(0,"div",18),l._UZ(1,"span",19),l.TgZ(2,"div",20),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=e.$implicit;l.xp6(1),l.Q6J("ngStyle",l.VKq(4,Cp,"rgb("+t.backgroundColor+")")),l.xp6(2),l.hij(" ",l.lcZ(4,2,"trackDetails.elevationChart.surfaces."+t.id+".label")," ")}}function Sp(t,e){if(1&t&&(l.TgZ(0,"div",16),l.YNc(1,Tp,5,6,"div",17),l.qZA()),2&t){const t=l.oxw(3);l.xp6(1),l.Q6J("ngForOf",t.surfaces)}}function kp(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Sp,2,1,"div",15),l.BQk()),2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("ngIf",t.surfaces&&t.surfaces.length>0)}}function Ep(t,e){if(1&t&&(l.TgZ(0,"div",1),l.TgZ(1,"div",2),l._UZ(2,"canvas",3,4),l.qZA(),l.TgZ(4,"div",5),l.YNc(5,bp,6,4,"div",6),l.ALo(6,"async"),l.YNc(7,kp,2,1,"ng-container",7),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.xp6(5),l.Q6J("ngIf",l.lcZ(6,2,t.enableSlope$)),l.xp6(2),l.Q6J("ngIf",!1)}}let Pp=(()=>{class t{constructor(t,e){this._mapService=t,this._cdr=e,this.hover=new l.vpe,this.enableChart$=new rt.X(!0),this.enableSlope$=new rt.X(!0),this.slope={available:!0,selectedValue:void 0,selectedPercentage:0},this.surfaces=[],_d.kL.register(..._d.zX)}set feature(t){this.enableChart$.next(t.geometry.coordinates[0].length>2),this.enableSlope$.next(t.geometry.coordinates[0].length>3),this._cdr.detectChanges(),this._feature=t,this._chart&&this._chart.destroy(),this._chartCanvas&&setTimeout(()=>{this._setChart()},600)}set content(t){this._chartCanvas=(null==t?void 0:t.nativeElement)||void 0}ngAfterViewInit(){this._setChart()}_createChart(t,e,i,n,r){if(this._chartCanvas){const o=[];this.slopeValues=r;for(const t in n)o.push(this._getSlopeChartSurfaceDataset(n[t].values,n[t].surface));null!=this._chart&&this._chart.destroy(),this._chart=new _d.kL(this._chartCanvas,{type:"line",data:{labels:t,datasets:[...this._getSlopeChartSlopeDataset(r),...o]},options:{events:["mousemove","click","touchstart","touchmove","pointermove"],layout:{padding:{top:40}},maintainAspectRatio:!1,hover:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{enabled:!0,intersect:!1,mode:"index",cornerRadius:8,caretPadding:150,xAlign:"center",yAlign:"bottom",titleMarginBottom:0,callbacks:{title:t=>{var e;let i=t[0].raw+" m";return"number"==typeof(null===(e=null==r?void 0:r[t[0].dataIndex])||void 0===e?void 0:e[1])&&(i+=" / "+r[t[0].dataIndex][1]+"%"),i},label:()=>{}}}},scales:{y:{title:{display:!1},max:i,ticks:{maxTicksLimit:2,maxRotation:0,includeBounds:!0,z:10,align:"end",callback:(t,e,i)=>t+" m"},grid:{drawOnChartArea:!0,drawTicks:!1,drawBorder:!1,borderDash:[10,10],color:"#D2D2D2"}},x:{title:{display:!1},max:e,min:0,ticks:{maxTicksLimit:4,maxRotation:0,includeBounds:!0,callback:(e,i,n)=>t[i]+" km"},grid:{color:"#D2D2D2",drawOnChartArea:!1,drawTicks:!0,drawBorder:!0,tickLength:10}}}},plugins:[{id:"webmappTooltipPlugin",beforeTooltipDraw:e=>{var i,o,s,a,l,c,h,u,d,p,f,g;const m=e.tooltip;if(m._active&&m._active.length>0){const _=e.ctx,v=m._active[0].element.x,y=e.scales.y.top-15,w=e.scales.y.bottom+10;if(_.save(),_.beginPath(),_.moveTo(v,y),_.lineTo(v,w),_.lineWidth=1,_.strokeStyle="#000000",_.stroke(),(null===(s=null===(o=null===(i=m)||void 0===i?void 0:i._tooltipItems)||void 0===o?void 0:o[0])||void 0===s?void 0:s.dataIndex)>=0&&void 0!==t[null===(c=null===(l=null===(a=m)||void 0===a?void 0:a._tooltipItems)||void 0===l?void 0:l[0])||void 0===c?void 0:c.dataIndex]){const i=t[m._tooltipItems[0].dataIndex]+" km",n=_.measureText(i),r=Math.max(0,Math.min(e.width-n.width,v-n.width/2)),o=w;_.fillStyle="#ffffff",_.fillRect(r-4,o,n.width+8,20),_.fillStyle="#000000",_.fillText(i,r,w+14)}_.restore(),this.slope.selectedValue=r[null===(d=null===(u=null===(h=m)||void 0===h?void 0:h._tooltipItems)||void 0===u?void 0:u[0])||void 0===d?void 0:d.dataIndex][1],this.slope.selectedPercentage=100*Math.min(15,Math.max(0,Math.abs(this.slope.selectedValue)))/15;const x=m._tooltipItems[0].dataIndex;let b,C=[];for(const t in n)if(n[t].values[x]){C=n[t].locations;const e=n[t].surface;for(const t of this.surfaces)if(t.id===e){b=t.backgroundColor;break}break}const T=C.map(t=>[t.longitude,t.latitude]),S=new kd({type:Sd.LINE_STRING,coordinates:T});S.setProperty("color",b),this.hover.emit({location:this._chartValues[null===(g=null===(f=null===(p=m)||void 0===p?void 0:p._tooltipItems)||void 0===f?void 0:f[0])||void 0===g?void 0:g.dataIndex],track:S})}else this.slope.selectedValue=void 0,this.hover.emit(void 0)}}]})}}_getSlopeChartSlopeDataset(t){const e=t.map(t=>t[0]),i=t.map(t=>t[1]);return[{fill:!1,cubicInterpolationMode:"monotone",tension:.3,backgroundColor:"rgba(0, 0, 0, 0)",borderColor:t=>{const e=t.chart,{ctx:n,chartArea:r}=e;if(!r)return null;const o=n.createLinearGradient(r.left,0,r.right,0);for(const s in i)o.addColorStop(parseInt(s,10)/i.length,this._getSlopeGradientColor(i[s]));return o},borderWidth:3,pointRadius:0,pointHoverBackgroundColor:"#000000",pointHoverBorderColor:"#FFFFFF",pointHoverRadius:6,pointHoverBorderWidth:2,data:e,spanGaps:!1},{fill:!1,cubicInterpolationMode:"monotone",tension:.3,borderColor:"rgba(255, 255, 255, 1)",borderWidth:8,pointRadius:0,data:e,spanGaps:!1}]}_getSlopeChartSurfaceDataset(t,e){return{fill:!0,cubicInterpolationMode:"monotone",tension:.3,backgroundColor:"rgb("+Td[e].backgroundColor+")",borderColor:"rgba(255, 199, 132, 0)",pointRadius:0,data:t,spanGaps:!1}}_getSlopeGradientColor(t){let e,i,n=0;const r=3.75;(t=Math.abs(t))<=0?(e=yd,i=yd):t<r?(e=yd,i=wd,n=t/r):t<7.5?(e=wd,i=xd,n=(t-r)/r):t<11.25?(e=xd,i=bd,n=(t-7.5)/r):t<15?(e=bd,i=Cd,n=(t-11.25)/r):(e=Cd,i=Cd,n=1);const o=["0","0","0"];return o[0]=Math.abs(Math.round(e[0]+(i[0]-e[0])*n)).toString(16),o[1]=Math.abs(Math.round(e[1]+(i[1]-e[1])*n)).toString(16),o[2]=Math.abs(Math.round(e[2]+(i[2]-e[2])*n)).toString(16),"#"+(o[0].length<2?"0":"")+o[0]+(o[1].length<2?"0":"")+o[1]+(o[2].length<2?"0":"")+o[2]}_setChart(){if(this._chartCanvas&&this._feature){let t=[];const e=[],i=[],n=100;let r,o,s,a,l=0,c=0;const h=[];this._chartValues=[],i.push(0),o=new Ed(this._feature.geometry.coordinates[0][0],this._feature.geometry.coordinates[0][1],this._feature.geometry.coordinates[0][2]),this._chartValues.push(o),s=o.altitude,a=o.altitude;const u=Object.values(vd)[0];t=this._setSurfaceValue(u,this._feature.geometry.coordinates[0][2],[o],t),h.includes(u)||h.push(u),e.push([this._feature.geometry.coordinates[0][2],0]);for(let f=1;f<this._feature.geometry.coordinates.length;f++)r=o,o=new Ed(this._feature.geometry.coordinates[f][0],this._feature.geometry.coordinates[f][1],this._feature.geometry.coordinates[f][2]),l+=this._mapService.distanceBetweenPoints(r,o),(!s||s<o.altitude)&&(s=o.altitude),(!a||a>o.altitude)&&(a=o.altitude);let d=1,p=[];o=new Ed(this._feature.geometry.coordinates[0][0],this._feature.geometry.coordinates[0][1],this._feature.geometry.coordinates[0][2]);for(let f=1;f<this._feature.geometry.coordinates.length&&d<=n;f++){p.push(o),r=o,o=new Ed(this._feature.geometry.coordinates[f][0],this._feature.geometry.coordinates[f][1],this._feature.geometry.coordinates[f][2]);const s=this._mapService.distanceBetweenPoints(r,o);for(c+=s;c>=l/n*d;){const a=s-(c-l/n*d),u=r.longitude+(o.longitude-r.longitude)*a/s,f=r.latitude+(o.latitude-r.latitude)*a/s,g=Math.round(r.altitude+(o.altitude-r.altitude)*a/s),m=Object.values(vd)[Math.round(d/10)%(Object.keys(vd).length-2)],_=parseFloat((100*(g-this._chartValues[this._chartValues.length-1].altitude)/(l/n)).toPrecision(1)),v=new Ed(u,f,g);this._chartValues.push(v),p.push(v),t=this._setSurfaceValue(m,g,p,t),p=[v],h.includes(m)||h.push(m),e.push([g,_]),i.push(parseFloat((d*l/(1e3*n)).toFixed(1))),d++}}this.surfaces=[];for(const f of h)this.surfaces.push({id:f,backgroundColor:Td[f].backgroundColor});setTimeout(()=>{this._createChart(i,l,s,t,e)},100)}}_setSurfaceValue(t,e,i,n){var r,o;if((null===(r=null==n?void 0:n[n.length-1])||void 0===r?void 0:r.surface)===t)n[n.length-1].values.push(e),n[n.length-1].locations.length>0&&n[n.length-1].locations.splice(-1,1),n[n.length-1].locations.push(...i);else{const r=[];(null===(o=null==n?void 0:n[n.length-1])||void 0===o?void 0:o.values)&&(r.length=n[n.length-1].values.length,n[n.length-1].values.push(e)),n.push({surface:t,values:[...r,e],locations:i})}return n}_smooth(t,e){const i=t=>t.reduce((t,e)=>t+e,0)/t.length;if(0===e)return t;const n=i(t)*e,r=[];for(const o in t){const e=t[o],s=Number(i([n,r[+o-1]||t[o],e,e||t[0]]).toFixed(0));r.push(s)}return r}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(vp),l.Y36(l.sBO))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-elevation-chart"]],viewQuery:function(t,e){if(1&t&&l.Gf(yp,5),2&t){let t;l.iGM(t=l.CRH())&&(e.content=t.first)}},inputs:{feature:"feature"},outputs:{hover:"hover"},decls:2,vars:3,consts:[["id","webmapp-track-elevation-chart-container",4,"ngIf"],["id","webmapp-track-elevation-chart-container"],[1,"webmapp-track-elevation-chart-canvas-container"],[1,"webmapp-track-elevation-chart-canvas"],["chartCanvas",""],[1,"webmapp-track-elevation-chart-legend-container"],["class","webmapp-track-elevation-chart-legend-slope-container",4,"ngIf"],[4,"ngIf"],[1,"webmapp-track-elevation-chart-legend-slope-container"],[1,"webmapp-track-elevation-chart-legend-slope-label"],[1,"webmapp-track-elevation-chart-legend-slope-bar"],["class","webmapp-track-elevation-chart-legend-slope-selected-container",3,"ngStyle",4,"ngIf"],[1,"webmapp-track-elevation-chart-legend-slope-selected-container",3,"ngStyle"],[1,"webmapp-track-elevation-chart-legend-slope-selected-text"],[1,"webmapp-track-elevation-chart-legend-slope-selected-dot"],["class","webmapp-track-elevation-chart-legend-surface-container",4,"ngIf"],[1,"webmapp-track-elevation-chart-legend-surface-container"],["class","webmapp-track-elevation-chart-legend-surface",4,"ngFor","ngForOf"],[1,"webmapp-track-elevation-chart-legend-surface"],[1,"webmapp-track-elevation-chart-legend-surface-dot",3,"ngStyle"],[1,"webmapp-track-elevation-chart-legend-surface-label"]],template:function(t,e){1&t&&(l.YNc(0,Ep,8,4,"div",0),l.ALo(1,"async")),2&t&&l.Q6J("ngIf",l.lcZ(1,1,e.enableChart$))},directives:[r.O5,r.PC,r.sg],pipes:[r.Ov,K.a],styles:["webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-canvas-container{margin:0 auto;width:100%;height:160px}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-canvas-container .webmapp-track-elevation-chart-canvas{margin:0 auto;width:100%}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container{margin:15px 0 10px;width:100%;display:flex;justify-content:space-evenly;align-items:center;padding-right:15px}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container .webmapp-track-elevation-chart-legend-slope-label{flex-grow:1;font-size:var(--font-sm)}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container .webmapp-track-elevation-chart-legend-slope-label:first-letter{text-transform:uppercase}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container .webmapp-track-elevation-chart-legend-slope-bar{height:4px;flex-grow:10;background:linear-gradient(90deg,#43e309 0,#c3ff00 25%,#ffef0a 50%,#ffae00 75%,#c41e04);overflow:visible;position:relative}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container .webmapp-track-elevation-chart-legend-slope-bar .webmapp-track-elevation-chart-legend-slope-selected-container{position:absolute;bottom:-5px;display:flex;justify-content:center;align-items:center;flex-direction:column;transform:translateX(-50%);transition:left .5s}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-slope-container .webmapp-track-elevation-chart-legend-slope-bar .webmapp-track-elevation-chart-legend-slope-selected-container .webmapp-track-elevation-chart-legend-slope-selected-dot{width:14px;height:14px;border-radius:10px;border:2px solid #fff;background:#000}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-surface-container{margin:10px 0;display:flex;align-items:center;flex-wrap:wrap;justify-content:space-evenly}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-surface-container .webmapp-track-elevation-chart-legend-surface{display:inline-flex;justify-content:center;align-items:center;margin:0 5px}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-surface-container .webmapp-track-elevation-chart-legend-surface .webmapp-track-elevation-chart-legend-surface-dot{width:10px;height:10px;border-radius:10px;display:inline-block}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-surface-container .webmapp-track-elevation-chart-legend-surface .webmapp-track-elevation-chart-legend-surface-label{margin-left:5px}webmapp-track-elevation-chart #webmapp-track-elevation-chart-container .webmapp-track-elevation-chart-legend-container .webmapp-track-elevation-chart-legend-surface-container .webmapp-track-elevation-chart-legend-surface .webmapp-track-elevation-chart-legend-surface-label:first-letter{text-transform:uppercase}"],encapsulation:2,changeDetection:0}),t})();function Mp(t,e){1&t&&(l.TgZ(0,"div",10),l._UZ(1,"i",11),l.qZA())}function Ip(t,e){1&t&&(l.TgZ(0,"div",12),l._UZ(1,"i",13),l.qZA())}function Lp(t,e){1&t&&(l.TgZ(0,"div",12),l._UZ(1,"i",14),l.qZA())}function Ap(t,e){1&t&&(l.TgZ(0,"div",10),l._UZ(1,"i",15),l.qZA())}const Rp=function(t){return{selected:t}};function Op(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",1),l.TgZ(1,"div",2),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw().selectPoi(e)}),l._UZ(2,"img",3),l.TgZ(3,"div",4),l.TgZ(4,"div",5),l._uU(5),l.ALo(6,"lowercase"),l.ALo(7,"wmtrans"),l.qZA(),l._UZ(8,"div",6),l.ALo(9,"wmtrans"),l.TgZ(10,"div",7),l.YNc(11,Mp,2,0,"div",8),l.YNc(12,Ip,2,0,"div",9),l.YNc(13,Lp,2,0,"div",9),l.YNc(14,Ap,2,0,"div",8),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=l.oxw();l.xp6(1),l.Q6J("ngClass",l.VKq(14,Rp,null!=i.currentPoi&&t.id===i.currentPoi.id)),l.xp6(1),l.Q6J("src",null!=t.feature_image?t.feature_image.url:i.defaultPhotoPath,l.LSH),l.xp6(3),l.hij(" ",l.lcZ(6,8,l.lcZ(7,10,t.name))," "),l.xp6(3),l.Q6J("innerHTML",l.lcZ(9,12,t.description),l.oJD),l.xp6(3),l.Q6J("ngIf",t.address),l.xp6(1),l.Q6J("ngIf",t.contact_phone),l.xp6(1),l.Q6J("ngIf",t.contact_email),l.xp6(1),l.Q6J("ngIf",null!=t.related_url)}}let Fp=(()=>{class t{constructor(){this.poiClick=new l.vpe,this.currentPoi=null,this.defaultPhotoPath="/assets/icon/no-photo.svg",this.poi=[]}set feature(t){this.poi=[],this.poiClick.emit(-1),null!=t&&null!=t.properties&&null!=t.properties.related_pois&&(this.poi=t.properties.related_pois.map(t=>{const e=t.properties;return null!=e.related_url&&(delete e.related_url[""],e.related_url=0===Object.keys(e.related_url).length?null:e.related_url||void 0),e.address=[e.addr_locality,e.addr_street].filter(t=>null!=t).join(", "),e}))}set setPoi(t){const e=this.poi.find(e=>e.id===t);this.currentPoi=e}selectPoi(t){this.currentPoi=t,this.poiClick.emit(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-poi"]],inputs:{feature:["track","feature"],setPoi:["poi","setPoi"]},outputs:{poiClick:"poi-click"},decls:1,vars:1,consts:[["class","webmapp-track-poi-list",4,"ngFor","ngForOf"],[1,"webmapp-track-poi-list"],[1,"webmapp-track-poi-item",3,"ngClass","click"],[1,"webmapp-track-poi-img",3,"src"],[1,"webmapp-track-poi-text"],[1,"webmapp-track-poi-title"],[1,"webmapp-track-poi-description",3,"innerHTML"],[1,"webmapp-track-poi-btns"],["class","webmapp-poi-popup-btn",4,"ngIf"],["class","webmapp-poi-popup-btn","target","_blank",4,"ngIf"],[1,"webmapp-poi-popup-btn"],[1,"wm-icn","icon-fill-pin"],["target","_blank",1,"webmapp-poi-popup-btn"],[1,"wm-icn","icon-fill-phone"],[1,"wm-icn","icon-fill-mail"],[1,"wm-icn","icon-fill-globe"]],template:function(t,e){1&t&&l.YNc(0,Op,15,16,"div",0),2&t&&l.Q6J("ngForOf",e.poi)},directives:[r.sg,r.mk,r.O5],pipes:[r.i8,K.a],styles:["webmapp-track-poi{display:flex;flex-direction:column}webmapp-track-poi .webmapp-track-poi-list{padding:10px;display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-item{flex:0 1 auto;align-self:auto;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch;margin-bottom:10px;height:160px;cursor:pointer}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-text{margin-left:5px;flex:1 1 auto;align-self:auto;height:-moz-fit-content;height:fit-content;width:230px;display:flex;flex-direction:column}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-text .webmapp-track-poi-title{font-size:18px;font-weight:700;line-height:22px;letter-spacing:0;text-align:left}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-text .webmapp-track-poi-description{align-self:stretch;display:-webkit-box;overflow:hidden;-webkit-line-clamp:4;-webkit-box-orient:vertical;flex:0 1 auto}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-text .webmapp-track-poi-btns{margin-top:5px;display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start}webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-img{height:100%;width:108px;left:0;top:0;border-radius:8px;object-fit:cover;flex:0 1 auto;align-self:auto}webmapp-track-poi .webmapp-track-poi-list .selected{background-color:#f3f4f6;border-radius:8px}"],encapsulation:2,changeDetection:0}),t})();function Dp(t,e){1&t&&(l.TgZ(0,"span"),l._uU(1),l.ALo(2,"wmtrans"),l.qZA()),2&t&&(l.xp6(1),l.hij(" ",l.lcZ(2,1,"trackDetails.description.readAll")," "))}function Zp(t,e){1&t&&(l.TgZ(0,"span"),l._uU(1),l.ALo(2,"wmtrans"),l.qZA()),2&t&&(l.xp6(1),l.hij(" ",l.lcZ(2,1,"trackDetails.description.hide")," "))}function Np(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",4),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).toggleExpansion()}),l.YNc(1,Dp,3,3,"span",5),l.YNc(2,Zp,3,3,"span",5),l.qZA()}if(2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("ngIf",!t.isExpanded),l.xp6(1),l.Q6J("ngIf",t.isExpanded)}}const jp=function(t,e){return{"webmapp-track-description-container-expanded":t,"webmapp-track-description-container-not-expandable":e}};function Gp(t,e){if(1&t&&(l.TgZ(0,"div",1),l._UZ(1,"div",2),l.YNc(2,Np,3,2,"div",3),l.qZA()),2&t){const t=l.oxw();l.Q6J("ngClass",l.WLB(3,jp,t.isExpanded,!t.isExpandable)),l.xp6(1),l.Q6J("innerHtml",t.safeHtml,l.oJD),l.xp6(1),l.Q6J("ngIf",t.isExpandable)}}let zp=(()=>{class t{constructor(t){this._domSanitizer=t,this.isExpandable=!0,this.isExpanded=!1}set description(t){this._initializeSafeHtml(t)}ngOnInit(){}toggleExpansion(){this.isExpanded=!this.isExpanded}_initializeSafeHtml(t){if(t&&"string"==typeof t){t=t.replace(/(href="[^\"]*")/gm,'$1 target="_system"'),this.safeHtml=this._domSanitizer.bypassSecurityTrustHtml(t);const e=setInterval(()=>{const t=document.getElementById("webmapp-track-description-html");this.isExpandable=t&&t.scrollHeight>.4*window.innerHeight},100);setTimeout(()=>{clearInterval(e)},1e3)}}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Sh.H7))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-description"]],inputs:{description:"description"},decls:1,vars:1,consts:[["id","webmapp-track-description-container",3,"ngClass",4,"ngIf"],["id","webmapp-track-description-container",3,"ngClass"],["id","webmapp-track-description-html",3,"innerHtml"],["class","webmapp-track-description-expand-container",3,"click",4,"ngIf"],[1,"webmapp-track-description-expand-container",3,"click"],[4,"ngIf"]],template:function(t,e){1&t&&l.YNc(0,Gp,3,6,"div",0),2&t&&l.Q6J("ngIf",e.safeHtml)},directives:[r.O5,r.mk],pipes:[K.a],styles:["#webmapp-track-description-container[_ngcontent-%COMP%]{width:100%;transition:max-height .5s cubic-bezier(0,1,.05,1);max-height:calc(30vh + 40px);overflow:hidden;position:relative}#webmapp-track-description-container[_ngcontent-%COMP%]   #webmapp-track-description-html[_ngcontent-%COMP%]{overflow:hidden;padding-bottom:60px}#webmapp-track-description-container[_ngcontent-%COMP%]   .webmapp-track-description-expand-container[_ngcontent-%COMP%]{color:var(--wm-color-primary);font-weight:700;font-family:var(--wm-font-family-content);text-transform:uppercase;position:absolute;bottom:0;width:100%;text-align:center;padding-top:40px;padding-bottom:30px;cursor:pointer;left:0;font-family:Inter;font-size:16px;font-style:normal;font-weight:400;line-height:20px;letter-spacing:0;text-align:left;background:linear-gradient(0deg,#fff 0,#fff 60%,#fff0)}#webmapp-track-description-container.webmapp-track-description-container-not-expandable[_ngcontent-%COMP%]{padding-bottom:10px;max-height:1000vh}#webmapp-track-description-container.webmapp-track-description-container-expanded[_ngcontent-%COMP%]{transition:max-height .5s ease-in;max-height:1000vh}#webmapp-track-description-container.webmapp-track-description-container-expanded[_ngcontent-%COMP%]   .details__expand-description[_ngcontent-%COMP%]{padding-top:0;background:linear-gradient(0deg,#fff 0,#fff 60%,#fff0 0,#fff0)}@media print{#webmapp-track-description-container[_ngcontent-%COMP%]   .webmapp-track-description-expand-container[_ngcontent-%COMP%]{display:none}#webmapp-track-description-container[_ngcontent-%COMP%]   #webmapp-track-description-html[_ngcontent-%COMP%]{padding:0!important}#webmapp-track-description-container[_ngcontent-%COMP%]   #webmapp-track-description-container[_ngcontent-%COMP%]{position:absolute;height:100%}}"]}),t})();function Vp(t,e){if(1&t&&(l.TgZ(0,"ion-item",3),l._UZ(1,"ion-icon",4),l.TgZ(2,"ion-label",5),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.Q6J("href",t.gpx),l.xp6(3),l.hij(" ",l.lcZ(4,2,"trackDetails.downloadUrls.gpx")," ")}}function Bp(t,e){if(1&t&&(l.TgZ(0,"ion-item",3),l._UZ(1,"ion-icon",4),l.TgZ(2,"ion-label",5),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.Q6J("href",t.kml),l.xp6(3),l.hij(" ",l.lcZ(4,2,"trackDetails.downloadUrls.kml")," ")}}function qp(t,e){if(1&t&&(l.TgZ(0,"ion-item",3),l._UZ(1,"ion-icon",4),l.TgZ(2,"ion-label",5),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.Q6J("href",t.geojson),l.xp6(3),l.hij(" ",l.lcZ(4,2,"trackDetails.downloadUrls.geojson")," ")}}function Up(t,e){if(1&t&&(l.TgZ(0,"ion-item",6),l._UZ(1,"ion-icon",7),l.TgZ(2,"ion-label",5),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw();l.Q6J("href",t.osm),l.xp6(3),l.hij(" ",l.lcZ(4,2,"Vedi su OpenStreetMap")," ")}}const $p=["*"];let Yp=(()=>{class t{constructor(){}set feature(t){this._feature=t,this._initializeDownloadUrls()}ngOnInit(){}_initializeDownloadUrls(){var t,e,i,n,r,o,s,a;this.gpx=null===(e=null===(t=this._feature)||void 0===t?void 0:t.properties)||void 0===e?void 0:e.gpx_url,this.kml=null===(n=null===(i=this._feature)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.kml_url,this.geojson=null===(o=null===(r=this._feature)||void 0===r?void 0:r.properties)||void 0===o?void 0:o.geojson_url,this.osm=null===(a=null===(s=this._feature)||void 0===s?void 0:s.properties)||void 0===a?void 0:a.osm_url}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-download-urls"]],inputs:{feature:"feature"},ngContentSelectors:$p,decls:6,vars:4,consts:[["id","webmapp-track-download-urls-list"],["class","webmapp-track-download-urls-item",3,"href",4,"ngIf"],["class","webmapp-track-download-urls-item","target","_blank",3,"href",4,"ngIf"],[1,"webmapp-track-download-urls-item",3,"href"],["name","download","slot","start"],[1,"webmapp-track-download-urls-item-label"],["target","_blank",1,"webmapp-track-download-urls-item",3,"href"],["slot","start",1,"wm-icn","icon-link"]],template:function(t,e){1&t&&(l.F$t(),l.TgZ(0,"ion-list",0),l.YNc(1,Vp,5,4,"ion-item",1),l.YNc(2,Bp,5,4,"ion-item",1),l.YNc(3,qp,5,4,"ion-item",1),l.YNc(4,Up,5,4,"ion-item",2),l.Hsn(5),l.qZA()),2&t&&(l.xp6(1),l.Q6J("ngIf",e.gpx),l.xp6(1),l.Q6J("ngIf",e.kml),l.xp6(1),l.Q6J("ngIf",e.geojson),l.xp6(1),l.Q6J("ngIf",e.osm))},directives:[s.q_,r.O5,s.Ie,s.gu,s.Q$],pipes:[K.a],styles:[".webmapp-track-download-urls-item[_ngcontent-%COMP%]   .webmapp-track-download-urls-item-label[_ngcontent-%COMP%]{font-family:var(--wm-font-family-content)}"]}),t})();const Xp=["content"];function Wp(t,e){if(1&t&&(l._UZ(0,"ion-title",20),l.ALo(1,"wmtrans")),2&t){const t=l.oxw().ngIf;l.Q6J("innerHtml",l.lcZ(1,1,t.name),l.oJD)}}function Hp(t,e){if(1&t&&(l.TgZ(0,"div",21),l._uU(1),l.ALo(2,"wmtrans"),l.qZA()),2&t){const t=e.ngIf;l.xp6(1),l.hij(" ",l.lcZ(2,1,t)," ")}}function Jp(t,e){if(1&t&&(l.TgZ(0,"div",22),l._UZ(1,"ion-icon",23),l.TgZ(2,"ion-label"),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().ngIf;let e;l.xp6(3),l.hij(" ",l.lcZ(4,1,null!==(e=null==t?null:t.not_accessible_message)&&void 0!==e?e:"Questo percorso non \xe8 accessibile")," ")}}function Kp(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"webmapp-track-elevation-chart",24),l.NdJ("hover",function(e){return l.CHM(t),l.oxw(3).onLocationHover(e)}),l.qZA()}if(2&t){const t=l.oxw(3);l.Q6J("feature",t.track)}}function Qp(t,e){if(1&t&&(l.TgZ(0,"div",27),l.TgZ(1,"div"),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"div"),l._uU(5),l.qZA(),l.qZA()),2&t){const t=e.ngIf;l.xp6(2),l.Oqu(l.lcZ(3,2,"Punto di partenza")),l.xp6(3),l.Oqu(t)}}function tf(t,e){if(1&t&&(l.TgZ(0,"div",27),l.TgZ(1,"div"),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"div"),l._uU(5),l.qZA(),l.qZA()),2&t){const t=e.ngIf;l.xp6(2),l.Oqu(l.lcZ(3,2,"Punto di arrivo")),l.xp6(3),l.Oqu(t)}}function ef(t,e){if(1&t&&(l.TgZ(0,"div",25),l.YNc(1,Qp,6,4,"div",26),l.YNc(2,tf,6,4,"div",26),l.qZA()),2&t){const t=l.oxw(3);l.xp6(1),l.Q6J("ngIf",t.track.properties.from),l.xp6(1),l.Q6J("ngIf",t.track.properties.to)}}function nf(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",33),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function rf(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",35),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function of(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",36),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function sf(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",37),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function af(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",38),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function lf(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"i",39),l.TgZ(2,"span",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw().$implicit;l.xp6(3),l.Oqu(l.lcZ(4,1,t.identifier))}}function cf(t,e){if(1&t&&(l.ynx(0),l.YNc(1,nf,5,3,"div",31),l.YNc(2,rf,5,3,"div",31),l.YNc(3,of,5,3,"div",31),l.YNc(4,sf,5,3,"div",31),l.YNc(5,af,5,3,"div",31),l.YNc(6,lf,5,3,"div",31),l.BQk()),2&t){const t=e.$implicit;l.xp6(1),l.Q6J("ngIf","mtb"===t.identifier),l.xp6(1),l.Q6J("ngIf","hiking"===t.identifier),l.xp6(1),l.Q6J("ngIf","cycling"===t.identifier),l.xp6(1),l.Q6J("ngIf","running"===t.identifier),l.xp6(1),l.Q6J("ngIf","walking"===t.identifier),l.xp6(1),l.Q6J("ngIf","skitouring"===t.identifier)}}function hf(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",13),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"div",29),l.YNc(5,cf,7,6,"ng-container",30),l.qZA(),l.BQk()),2&t){const t=l.oxw().ngIf;l.xp6(2),l.Oqu(l.lcZ(3,2,"Attivit\xe0")),l.xp6(3),l.Q6J("ngForOf",t.activity)}}function uf(t,e){if(1&t&&(l.TgZ(0,"div",28),l.YNc(1,hf,6,4,"ng-container",0),l.qZA()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",(null==t?null:t.activity)&&(null==t||null==t.activity?null:t.activity.length)>0)}}function df(t,e){1&t&&(l.ynx(0),l.TgZ(1,"div",13),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"div",40),l.TgZ(5,"div",41),l._UZ(6,"i",36),l.TgZ(7,"span",42),l._uU(8),l.ALo(9,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(10,"div",41),l._UZ(11,"i",43),l.TgZ(12,"span",42),l._uU(13),l.ALo(14,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(15,"div",41),l._UZ(16,"i",44),l.TgZ(17,"span",42),l._uU(18),l.ALo(19,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(20,"div",41),l._UZ(21,"i",45),l.TgZ(22,"span",42),l._uU(23),l.ALo(24,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(25,"div",41),l._UZ(26,"i",46),l.TgZ(27,"span",42),l._uU(28),l.ALo(29,"wmtrans"),l.qZA(),l.qZA(),l.qZA(),l.BQk()),2&t&&(l.xp6(2),l.Oqu(l.lcZ(3,6,"Come arrivare")),l.xp6(6),l.Oqu(l.lcZ(9,8,"Bici muscolari")),l.xp6(5),l.Oqu(l.lcZ(14,10,"Bici elettriche")),l.xp6(5),l.Oqu(l.lcZ(19,12,"Mezzi pubblici")),l.xp6(5),l.Oqu(l.lcZ(24,14,"NCC")),l.xp6(5),l.Oqu(l.lcZ(29,16,"Auto Propria")))}function pf(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"div",47),l.TgZ(2,"div",13),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.TgZ(5,"webmapp-track-poi",48),l.NdJ("poi-click",function(e){return l.CHM(t),l.oxw(3).poiClick.emit(e)}),l.qZA(),l.qZA(),l.BQk()}if(2&t){const t=l.oxw(3);l.xp6(3),l.Oqu(l.lcZ(4,3,"Punti di interesse")),l.xp6(2),l.Q6J("track",t.track)("poi",t.poiId)}}function ff(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",49),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l._UZ(4,"webmapp-track-description",50),l.ALo(5,"wmtrans"),l.BQk()),2&t){const t=l.oxw().ngIf;l.xp6(2),l.Oqu(l.lcZ(3,2,"Descrizione")),l.xp6(2),l.Q6J("description",l.lcZ(5,4,null==t?null:t.description))}}function gf(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",13),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l._UZ(4,"webmapp-track-audio",51),l.BQk()),2&t){const t=l.oxw().ngIf;l.xp6(2),l.Oqu(l.lcZ(3,2,"Descrizione Audio")),l.xp6(2),l.Q6J("audio",null==t?null:t.audio)}}function mf(t,e){1&t&&l._UZ(0,"wm-gallery",52),2&t&&l.Q6J("gallery",e.ngIf)}function _f(t,e){if(1&t&&(l.TgZ(0,"div",53),l.TgZ(1,"div",13),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l._UZ(4,"webmapp-related-urls",54),l.qZA()),2&t){const t=e.ngIf;l.xp6(2),l.hij(" ",l.lcZ(3,2,"Collegamenti esterni")," "),l.xp6(2),l.Q6J("relatedUrls",t)}}function vf(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",13),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l.TgZ(4,"webmapp-track-download-urls",56),l.Hsn(5,1),l.qZA(),l.BQk()),2&t){const t=l.oxw(4);l.xp6(2),l.Oqu(l.lcZ(3,2,"Downloads")),l.xp6(2),l.Q6J("feature",t.track)}}function yf(t,e){if(1&t&&(l.TgZ(0,"div",55),l.YNc(1,vf,6,4,"ng-container",0),l.qZA()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",!0===t.download_track_enable)}}function wf(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-button",57),l.NdJ("click",function(){return l.CHM(t),l.oxw(3).openGeohub()}),l._uU(1),l.ALo(2,"wmtrans"),l.qZA()}2&t&&(l.xp6(1),l.hij(" ",l.lcZ(2,1,"edit geohub"),""))}function xf(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"ion-header"),l.TgZ(2,"ion-toolbar",1),l.YNc(3,Wp,2,3,"ion-title",2),l.TgZ(4,"ion-buttons",3),l.TgZ(5,"ion-button",4),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).triggerDismiss()}),l._UZ(6,"ion-icon",5),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(7,"div",6,7),l.YNc(9,Hp,3,3,"div",8),l.YNc(10,Jp,5,3,"div",9),l.YNc(11,Kp,1,1,"webmapp-track-elevation-chart",10),l.YNc(12,ef,3,2,"div",11),l.TgZ(13,"div",12),l.TgZ(14,"span",13),l._uU(15),l.ALo(16,"wmtrans"),l.qZA(),l._UZ(17,"webmapp-track-technical-data",14),l.qZA(),l.YNc(18,uf,2,1,"div",15),l.YNc(19,df,30,18,"ng-container",0),l.YNc(20,pf,6,5,"ng-container",0),l.YNc(21,ff,6,6,"ng-container",0),l.YNc(22,gf,5,4,"ng-container",0),l.YNc(23,mf,1,1,"wm-gallery",16),l.YNc(24,_f,5,4,"div",17),l.YNc(25,yf,2,1,"div",18),l.ALo(26,"async"),l.YNc(27,wf,3,3,"ion-button",19),l.ALo(28,"async"),l.qZA(),l.BQk()}if(2&t){const t=e.ngIf,i=l.oxw(2);l.xp6(3),l.Q6J("ngIf",null==t?null:t.name),l.xp6(6),l.Q6J("ngIf",null==t?null:t.name),l.xp6(1),l.Q6J("ngIf",null!=(null==t?null:t.not_accessible)&&!0===(null==t?null:t.not_accessible)),l.xp6(1),l.Q6J("ngIf",null!=i.track),l.xp6(1),l.Q6J("ngIf",i.track&&(i.track.properties.from||i.track.properties.to)),l.xp6(3),l.Oqu(l.lcZ(16,16,"Dettagli tecnici")),l.xp6(2),l.Q6J("feature",i.track),l.xp6(1),l.Q6J("ngIf",t.taxonomy),l.xp6(1),l.Q6J("ngIf",!1),l.xp6(1),l.Q6J("ngIf",(null==i.track||null==i.track.properties||null==i.track.properties.related_pois?null:i.track.properties.related_pois.length)>0),l.xp6(1),l.Q6J("ngIf",(null==t||null==t.description?null:t.description.it)||(null==t||null==t.description?null:t.description.en)||(null==t||null==t.description?null:t.description.fr)||(null==t||null==t.description?null:t.description.de)||(null==t||null==t.description?null:t.description.es)||(null==t||null==t.description?null:t.description.pr)),l.xp6(1),l.Q6J("ngIf",null==t?null:t.audio),l.xp6(1),l.Q6J("ngIf",null==t?null:t.image_gallery),l.xp6(1),l.Q6J("ngIf",t.related_url),l.xp6(1),l.Q6J("ngIf",l.lcZ(26,18,i.confOPTIONS$)),l.xp6(2),l.Q6J("ngIf",l.lcZ(28,20,i.enableEditingInline$))}}function bf(t,e){if(1&t&&(l.ynx(0),l.YNc(1,xf,29,22,"ng-container",0),l.BQk()),2&t){const t=l.oxw();l.xp6(1),l.Q6J("ngIf",t.track.properties)}}const Cf=["*","*"];let Tf=(()=>{class t{constructor(t,e){this._modalController=t,this._store=e,this.dismiss=new l.vpe,this.poiClick=new l.vpe,this.trackElevationChartHover=new l.vpe,this.confOPTIONS$=this._store.select(Mu.mw),this.enableEditingInline$=this._store.select(Mu.Hv)}set setPoi(t){"number"==typeof t&&(this.poiId=t)}set setTrack(t){null!=t&&(this.track=t,this._initializeFeature())}onLocationHover(t){this.trackElevationChartHover.emit(t)}open(){this._modalController.create({component:dd,cssClass:"modal-gallery-class",componentProps:{gallery:[this.data.featureImage]}}).then(t=>{t.present()})}openGeohub(){const t=this.track&&this.track.properties&&this.track.properties.id;null!=t&&window.open(`https://geohub.webmapp.it/resources/ec-tracks/${t}/edit?viaResource&viaResourceId&viaRelationship`,"_blank").focus()}triggerDismiss(){this.dismiss.emit()}_initializeFeature(){var t;return(0,td.mG)(this,void 0,void 0,function*(){this.track?(null===(t=this.track)||void 0===t?void 0:t.properties)&&(this.data=Object.assign({},this.track.properties)):this.data=void 0})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(s.IN),l.Y36(Lu.yh))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-track-details"]],viewQuery:function(t,e){if(1&t&&l.Gf(Xp,5),2&t){let t;l.iGM(t=l.CRH())&&(e.content=t.first)}},inputs:{setPoi:["poi","setPoi"],setTrack:["track","setTrack"]},outputs:{dismiss:"dismiss",poiClick:"poi-click",trackElevationChartHover:"trackElevationChartHover"},ngContentSelectors:Cf,decls:2,vars:1,consts:[[4,"ngIf"],[1,"webmapp-track-details-toolbar"],["class","webmapp-track-details-header",3,"innerHtml",4,"ngIf"],["slot","end"],[1,"webmapp-track-details-dismiss",3,"click"],["name","close"],["id","webmapp-track-details-content"],["content",""],["class","webmapp-track-title",4,"ngIf"],["class","wm-alert",4,"ngIf"],["id","webmapp-track-details-elevation-chart",3,"feature","hover",4,"ngIf"],["class","webmapp-track-details-from-to",4,"ngIf"],[1,"wm-track-details-title-technical-details"],[1,"webmapp-title"],["id","webmapp-track-details-technical-data",1,"wm-track-details-technical-details-data",3,"feature"],["class","wm-track-details-activities",4,"ngIf"],[3,"gallery",4,"ngIf"],["class","wm-track-details-related-url",4,"ngIf"],["class","wm-track-details-download",4,"ngIf"],["class","wm-track-details-edit-geohub",3,"click",4,"ngIf"],[1,"webmapp-track-details-header",3,"innerHtml"],[1,"webmapp-track-title"],[1,"wm-alert"],["name","warning"],["id","webmapp-track-details-elevation-chart",3,"feature","hover"],[1,"webmapp-track-details-from-to"],["class","webmapp-track-details-from-to-box",4,"ngIf"],[1,"webmapp-track-details-from-to-box"],[1,"wm-track-details-activities"],[1,"webmapp-walkability"],[4,"ngFor","ngForOf"],["class","webmapp-walkability-box",4,"ngIf"],[1,"webmapp-walkability-box"],[1,"icon-outline-MTB"],[1,"webmapp-walkability-label"],[1,"icon-fill-trekking"],[1,"icon-outline-bike"],[1,"icon-outline-running"],[1,"icon-outline-walking"],[1,"icon-outline-nordic-walking"],[1,"webmapp-how-to-get"],[1,"webmapp-hot-to-get-box"],[1,"webmapp-how-to-get-label"],[1,"icon-outline-bike_1"],[1,"icon-outline-bike_2"],[1,"icon-outline-bike_4"],[1,"icon-outline-bike_3"],[1,"wm-track-details-track-related-poi"],[3,"track","poi","poi-click"],[1,"webmapp-title","wm-title-description"],[3,"description"],[3,"audio"],[3,"gallery"],[1,"wm-track-details-related-url"],[3,"relatedUrls"],[1,"wm-track-details-download"],["id","webmapp-track-details-download-urls",1,"wm-track-details-download-urls",3,"feature"],[1,"wm-track-details-edit-geohub",3,"click"]],template:function(t,e){1&t&&(l.F$t(Cf),l.Hsn(0),l.YNc(1,bf,2,1,"ng-container",0)),2&t&&(l.xp6(1),l.Q6J("ngIf",null!=e.track))},directives:[r.O5,s.Gu,s.sr,s.Sm,s.YG,s.gu,md,s.wd,s.Q$,Pp,r.sg,Fp,zp,lt,pt,nt,Yp],pipes:[K.a,r.Ov],styles:["webmapp-track-details::-webkit-scrollbar{display:none}webmapp-track-details{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start;background-color:#fff;font-style:normal;overflow:scroll;-ms-overflow-style:none;scrollbar-width:none}webmapp-track-details .webmapp-title{font-size:var(--wm-font-md);font-weight:700;line-height:22px;letter-spacing:0;text-align:left;margin-bottom:10px}webmapp-track-details .webmapp-track-title:first-letter{text-transform:uppercase}webmapp-track-details .webmapp-walkability{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;align-content:flex-start;align-items:flex-start}webmapp-track-details .webmapp-walkability .webmapp-walkability-box{display:flex;flex-direction:column;justify-content:flex-end;align-items:flex-start;margin:15px 10px 10px 0;padding:10px;height:82px;min-width:80px;left:0;top:932px;border-radius:15px;background:#ff812833}webmapp-track-details .webmapp-walkability .webmapp-walkability-box i{position:static;height:24px;width:27.3333358765px;left:11px;top:947px;border-radius:0;font-size:24px;color:#ff8128;flex:none;order:0;flex-grow:0;margin:8px 0}webmapp-track-details .webmapp-walkability .webmapp-walkability-box .webmapp-walkability-label{font-family:var(--wm-font-family-header);font-size:14px;font-style:normal;font-weight:400;line-height:17px;letter-spacing:0;text-align:left}webmapp-track-details .webmapp-how-to-get{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;align-content:flex-start;align-items:flex-start}webmapp-track-details .webmapp-how-to-get .webmapp-hot-to-get-box{display:flex;flex-direction:column;justify-content:flex-end;align-items:flex-start;padding:12px;margin:0 10px 10px 0;width:96px;height:98px;left:0;top:1220px;background:#d5ecda;border-radius:16px}webmapp-track-details .webmapp-how-to-get .webmapp-hot-to-get-box i{position:static;font-size:32px;left:12px;top:12px;flex:none;order:0;flex-grow:0;margin:8px 0}webmapp-track-details .webmapp-how-to-get .webmapp-hot-to-get-box .webmapp-how-to-get-label{height:34px;width:72px;left:12px;top:52px;font-size:14px;font-style:normal;font-weight:400;line-height:17px;letter-spacing:0;text-align:left}webmapp-track-details .webmapp-pageroute-tabdetail-icon,webmapp-track-details .wm-icn{color:var(--wm-color-primary);padding:0 5px;flex:0 1 auto}webmapp-track-details .webmapp-pageroute-tabdetail-icon path1,webmapp-track-details .webmapp-pageroute-tabdetail-icon path1:before,webmapp-track-details .webmapp-pageroute-tabdetail-icon path2,webmapp-track-details .webmapp-pageroute-tabdetail-icon path2:before,webmapp-track-details .wm-icn path1,webmapp-track-details .wm-icn path1:before,webmapp-track-details .wm-icn path2,webmapp-track-details .wm-icn path2:before{color:var(--wm-color-primary);background:var(--wm-color-primary)}webmapp-track-details .webmapp-track-details-header{font-size:var(--font-md)}webmapp-track-details #webmapp-track-details-content>*{padding-top:20px}webmapp-track-details #webmapp-track-details-content{width:100%;height:calc(100% - 56px);font-family:var(--wm-font-family-content);padding:15px 20px 20px;display:flex;flex-direction:column;flex-wrap:inherit;align-self:flex-start}webmapp-track-details #webmapp-track-details-content #webmapp-track-details-download-urls,webmapp-track-details #webmapp-track-details-content #webmapp-track-details-gallery,webmapp-track-details #webmapp-track-details-content #webmapp-track-details-technical-data{width:100%}webmapp-track-details #webmapp-track-details-content #webmapp-track-details-gallery{height:300px;max-height:30vh;display:block}webmapp-track-details #webmapp-track-details-content .webmapp-track-title{font-weight:700;line-height:22px;letter-spacing:0;text-align:left;color:var(--wm-color-dark);font-size:var(--wm-font-md);font-family:var(--wm-font-family-header)}webmapp-track-details #webmapp-track-details-content .webmapp-track-details-from-to{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:flex-start;margin-bottom:20px}webmapp-track-details #webmapp-track-details-content .webmapp-track-details-from-to .webmapp-track-details-from-to-box{flex:1 1 auto;align-self:stretch}webmapp-track-details #webmapp-track-details-content .webmapp-track-details-from-to .webmapp-track-details-from-to-box>:first-child{font-size:16px;font-weight:700;line-height:20px;letter-spacing:0;text-align:left}webmapp-track-details #webmapp-track-details-content .webmapp-track-activity{color:var(--wm-color-primary);text-transform:uppercase;padding:10px 20px 0;font-weight:700;font-family:var(--wm-font-family-header)}webmapp-track-details #webmapp-track-details-content .webmapp-track-picture{text-align:center;position:relative;width:100%}webmapp-track-details #webmapp-track-details-content .webmapp-track-picture img{width:100%}webmapp-track-details #webmapp-track-details-content .webmapp-track-picture .webmapp-track-picture-zoombutton{position:absolute;width:32px;height:32px;border-radius:16px;background-color:#3336;color:var(--wm-color-light);bottom:5px;right:2px;z-index:100;font-size:xx-large;padding-top:0;padding-left:0;opacity:.5}webmapp-track-details #webmapp-track-details-content .webmapp-track-picture .webmapp-track-picture-zoombutton:hover{opacity:1}webmapp-track-details .wm-alert{order:-1;color:red;display:flex;flex-direction:row}webmapp-track-details .wm-alert ion-icon{font-size:25px;align-self:center}webmapp-track-details .wm-alert ion-label{align-self:center}webmapp-track-details .webmapp-track-technical-data-container{margin-top:15px}webmapp-track-details .wm-track-details-edit-geohub{padding-top:unset!important}"],encapsulation:2,changeDetection:0}),t})();var Sf=i(9316),kf=i(3455);const Ef=function(){function t(t){this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.defaultPrevented=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}(),Pf=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function Mf(t,e){return t>e?1:t<e?-1:0}function If(t,e){for(var i=Array.isArray(e)?e:[e],n=i.length,r=0;r<n;r++)t[t.length]=i[r]}function Lf(t,e){var i=t.length;if(i!==e.length)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Af(){}var Rf="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1,r=arguments.length;n<r;++n){var o=arguments[n];if(null!=o)for(var s in o)o.hasOwnProperty(s)&&(i[s]=o[s])}return i};function Of(t){for(var e in t)delete t[e]}function Ff(t){var e;for(e in t)return!1;return!e}var Df=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Zf=function(t){function e(e){var i=t.call(this)||this;return i.eventTarget_=e,i.pendingRemovals_=null,i.dispatching_=null,i.listeners_=null,i}return Df(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);-1===n.indexOf(e)&&n.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t?new Ef(t):t,i=e.type;e.target||(e.target=this.eventTarget_||this);var n,r=this.listeners_&&this.listeners_[i];if(r){var o=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,s[i]=0),++o[i];for(var a=0,l=r.length;a<l;++a)if(!1===(n="handleEvent"in r[a]?r[a].handleEvent(e):r[a].call(this,e))||e.propagationStopped){n=!1;break}if(--o[i],0===o[i]){var c=s[i];for(delete s[i];c--;)this.removeEventListener(i,Af);delete o[i]}return n}},e.prototype.disposeInternal=function(){this.listeners_&&Of(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var i=this.listeners_&&this.listeners_[t];if(i){var n=i.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=Af,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t]))}},e}(Pf),Nf="change";function jf(t,e,i,n,r){if(n&&n!==t&&(i=i.bind(n)),r){var o=i;i=function(){t.removeEventListener(e,i),o.apply(this,arguments)}}var s={target:t,type:e,listener:i};return t.addEventListener(e,i),s}function Gf(t,e,i,n){return jf(t,e,i,n,!0)}function zf(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),Of(t))}var Vf=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Bf=function(t){function e(){var e=t.call(this)||this;return e.revision_=0,e}return Vf(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(Nf)},e.prototype.getRevision=function(){return this.revision_},e.prototype.on=function(t,e){if(Array.isArray(t)){for(var i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=jf(this,t[r],e);return n}return jf(this,t,e)},e.prototype.once=function(t,e){var i;if(Array.isArray(t)){var n=t.length;i=new Array(n);for(var r=0;r<n;++r)i[r]=Gf(this,t[r],e)}else i=Gf(this,t,e);return e.ol_key=i,i},e.prototype.un=function(t,e){var i=e.ol_key;if(i)!function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;++e)zf(t[e]);else zf(t)}(i);else if(Array.isArray(t))for(var n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)},e}(Zf);function qf(){return function(){throw new Error("Unimplemented abstract method.")}()}var Uf=0,$f=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Yf=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.key=i,r.oldValue=n,r}return $f(e,t),e}(Ef),Xf=function(t){function e(e){var i,n=t.call(this)||this;return(i=n).ol_uid||(i.ol_uid=String(++Uf)),n.values_=null,void 0!==e&&n.setProperties(e),n}return $f(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&Rf({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var i;i=Hf(t),this.dispatchEvent(new Yf(i,t,e)),this.dispatchEvent(new Yf(i="propertychange",t,e))},e.prototype.set=function(t,e,i){var n=this.values_||(this.values_={});if(i)n[t]=e;else{var r=n[t];n[t]=e,r!==e&&this.notify(t,r)}},e.prototype.setProperties=function(t,e){for(var i in t)this.set(i,t[i],e)},e.prototype.applyProperties=function(t){t.values_&&Rf(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var i=this.values_[t];delete this.values_[t],Ff(this.values_)&&(this.values_=null),e||this.notify(t,i)}},e}(Bf),Wf={};function Hf(t){return Wf.hasOwnProperty(t)?Wf[t]:Wf[t]="change:"+t}const Jf=Xf;var Kf=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Qf=function(t){function e(e){var i=this,n="Assertion failed. See https://openlayers.org/en/v"+"6.5.1-module.2".split("-")[0]+"/doc/errors/#"+e+" for details.";return(i=t.call(this,n)||this).code=e,i.name="AssertionError",i.message=n,i}return Kf(e,t),e}(Error);function tg(t,e){if(!t)throw new Qf(e)}var eg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const ig=function(t){function e(e){var i=t.call(this)||this;return i.id_=void 0,i.geometryName_="geometry",i.style_=null,i.styleFunction_=void 0,i.geometryChangeKey_=null,i.addEventListener(Hf(i.geometryName_),i.handleGeometryChanged_),e&&("function"==typeof e.getSimplifiedGeometry?i.setGeometry(e):i.setProperties(e)),i}return eg(e,t),e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var i=this.getGeometry();i&&t.setGeometry(i.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(zf(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=jf(t,Nf,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){var e,i;this.style_=t,this.styleFunction_=t?"function"==typeof(e=t)?e:(Array.isArray(e)?i=e:(tg("function"==typeof e.getZIndex,41),i=[e]),function(){return i}):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeEventListener(Hf(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=t,this.addEventListener(Hf(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(Jf);new Array(6);var ng=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),rg=[1,0,0,1,0,0];const og=function(t){function e(){var e,i,n,r,o,s=t.call(this)||this;return s.extent_=[1/0,1/0,-1/0,-1/0],s.extentRevision_=-1,s.simplifiedGeometryMaxMinSquaredTolerance=0,s.simplifiedGeometryRevision=0,s.simplifyTransformedInternal=(e=function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)},o=!1,function(){var t=Array.prototype.slice.call(arguments);return o&&this===r&&Lf(t,n)||(o=!0,r=this,n=t,i=e.apply(this,arguments)),i}),s}return ng(e,t),e.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},e.prototype.clone=function(){return qf()},e.prototype.closestPointXY=function(t,e,i,n){return qf()},e.prototype.containsXY=function(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e},e.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return qf()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&np(e),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){qf()},e.prototype.scale=function(t,e,i){qf()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return qf()},e.prototype.getType=function(){return qf()},e.prototype.applyTransform=function(t){qf()},e.prototype.intersectsExtent=function(t){return qf()},e.prototype.translate=function(t,e){qf()},e.prototype.transform=function(t,e){var i=dp(t),n=i.getUnits()==Id.TILE_PIXELS?function(t,n,r){var o,s,a,l,c,h,u,d=i.getExtent(),p=i.getWorldExtent(),f=lp(p)/lp(d);return o=rg,s=p[0],a=p[3],l=f,c=-f,0,0,0,h=Math.sin(0),u=Math.cos(0),o[0]=l*u,o[1]=c*h,o[2]=-l*h,o[3]=c*u,o[4]=0*l*u-0*l*h+s,o[5]=0*c*h+0*c*u+a,function(t,e,i,n,r,o){for(var s=o||[],a=0,l=0;l<i;l+=n){var c=t[l],h=t[l+1];s[a++]=r[0]*c+r[2]*h+r[4],s[a++]=r[1]*c+r[3]*h+r[5]}o&&s.length!=a&&(s.length=a)}(t,0,t.length,r,rg,n),gp(i,e)(t,n,r)}:gp(i,e);return this.applyTransform(n),this},e}(Jf),sg="Point",ag="LineString",lg="Polygon",cg="MultiPoint",hg="MultiLineString",ug="MultiPolygon",dg="GeometryCollection";var pg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function fg(t){for(var e=[],i=0,n=t.length;i<n;++i)e.push(t[i].clone());return e}const gg=function(t){function e(e){var i=t.call(this)||this;return i.geometries_=e||null,i.changeEventsKeys_=[],i.listenGeometriesChange_(),i}return pg(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(zf),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(jf(this.geometries_[t],Nf,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){if(n<Qd(this.getExtent(),t,e))return n;for(var r=this.geometries_,o=0,s=r.length;o<s;++o)n=r[o].closestPointXY(t,e,i,n);return n},e.prototype.containsXY=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)if(i[n].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){np(t);for(var e,i,n=this.geometries_,r=0,o=n.length;r<o;++r)e=t,(i=n[r].getExtent())[0]<e[0]&&(e[0]=i[0]),i[2]>e[2]&&(e[2]=i[2]),i[1]<e[1]&&(e[1]=i[1]),i[3]>e[3]&&(e[3]=i[3]);return t},e.prototype.getGeometries=function(){return fg(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var i=[],n=this.geometries_,r=!1,o=0,s=n.length;o<s;++o){var a=n[o],l=a.getSimplifiedGeometry(t);i.push(l),l!==a&&(r=!0)}if(r){var c=new e(null);return c.setGeometriesArray(i),c}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return dg},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)i[n].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,i){var n=i;n||(n=ap(this.getExtent()));for(var r=this.geometries_,o=0,s=r.length;o<s;++o)r[o].scale(t,e,n);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(fg(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var i=this.geometries_,n=0,r=i.length;n<r;++n)i[n].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(og),mg=function(){function t(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0}return t.prototype.getReadOptions=function(t,e){var i;if(e){var n=e.dataProjection?dp(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()===Id.TILE_PIXELS&&(n=dp(n)).setWorldExtent(e.extent),i={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(i)},t.prototype.adaptOptions=function(t){return Rf({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return qf()},t.prototype.readFeature=function(t,e){return qf()},t.prototype.readFeatures=function(t,e){return qf()},t.prototype.readGeometry=function(t,e){return qf()},t.prototype.readProjection=function(t){return qf()},t.prototype.writeFeature=function(t,e){return qf()},t.prototype.writeFeatures=function(t,e){return qf()},t.prototype.writeGeometry=function(t,e){return qf()},t}();function _g(t,e,i){var n,r=i?dp(i.featureProjection):null,o=i?dp(i.dataProjection):null;if(n=r&&o&&!function(t,e){if(t===e)return!0;var i=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||fp(t,e)===cp)&&i}(r,o)?(e?t.clone():t).transform(e?r:o,e?o:r):t,e&&i&&void 0!==i.decimals){var s=Math.pow(10,i.decimals);n===t&&(n=t.clone()),n.applyTransform(function(t){for(var e=0,i=t.length;e<i;++e)t[e]=Math.round(t[e]*s)/s;return t})}return n}var vg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function yg(t){return"string"==typeof t?JSON.parse(t)||null:null!==t?t:null}const wg=function(t){function e(){return t.call(this)||this}return vg(e,t),e.prototype.getType=function(){return"json"},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(yg(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(yg(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return qf()},e.prototype.readFeaturesFromObject=function(t,e){return qf()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(yg(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return qf()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(yg(t))},e.prototype.readProjectionFromObject=function(t){return qf()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return qf()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return qf()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return qf()},e}(mg),xg="XY",bg="XYM",Cg="XYZM";var Tg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function Sg(t){var e;return t==xg?e=2:"XYZ"==t||t==bg?e=3:t==Cg&&(e=4),e}const kg=function(t){function e(){var e=t.call(this)||this;return e.layout=xg,e.stride=2,e.flatCoordinates=null,e}return Tg(e,t),e.prototype.computeExtent=function(t){return rp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return qf()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=Sg(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){qf()},e.prototype.setLayout=function(t,e,i){var n;if(t)n=Sg(t);else{for(var r=0;r<i;++r){if(0===e.length)return this.layout=xg,void(this.stride=2);e=e[0]}t=function(t){var e;return 2==t?e=xg:3==t?e="XYZ":4==t&&(e=Cg),e}(n=e.length)}this.layout=t,this.stride=n},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();!function(t,e,i,n,r,o,s){for(var a=s||[],l=Math.cos(r),c=Math.sin(r),h=o[0],u=o[1],d=0,p=0;p<i;p+=n){var f=t[p]-h,g=t[p+1]-u;a[d++]=h+f*l-g*c,a[d++]=u+f*c+g*l;for(var m=p+2;m<p+n;++m)a[d++]=t[m]}s&&a.length!=d&&(a.length=d)}(i,0,i.length,n,t,e,i),this.changed()}},e.prototype.scale=function(t,e,i){var n=e;void 0===n&&(n=t);var r=i;r||(r=ap(this.getExtent()));var o=this.getFlatCoordinates();if(o){var s=this.getStride();!function(t,e,i,n,r,o,s,a){for(var l=a||[],c=s[0],h=s[1],u=0,d=0;d<i;d+=n){var p=t[d+1]-h;l[u++]=c+r*(t[d]-c),l[u++]=h+o*p;for(var f=d+2;f<d+n;++f)l[u++]=t[f]}a&&l.length!=u&&(l.length=u)}(o,0,o.length,s,t,n,r,o),this.changed()}},e.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var n=this.getStride();!function(t,e,i,n,r,o,s){for(var a=s||[],l=0,c=0;c<i;c+=n){a[l++]=t[c]+r,a[l++]=t[c+1]+o;for(var h=c+2;h<c+n;++h)a[l++]=t[h]}s&&a.length!=l&&(a.length=l)}(i,0,i.length,n,t,e,i),this.changed()}},e}(og);function Eg(t,e,i,n,r,o,s){var a,l=t[e],c=t[e+1],h=t[i]-l,u=t[i+1]-c;if(0===h&&0===u)a=e;else{var d=((r-l)*h+(o-c)*u)/(h*h+u*u);if(d>1)a=i;else{if(d>0){for(var p=0;p<n;++p)s[p]=Fd(t[e+p],t[i+p],d);return void(s.length=n)}a=e}}for(p=0;p<n;++p)s[p]=t[a+p];s.length=n}function Pg(t,e,i,n,r){var o=t[e],s=t[e+1];for(e+=n;e<i;e+=n){var a=t[e],l=t[e+1],c=Od(o,s,a,l);c>r&&(r=c),o=a,s=l}return r}function Mg(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];r=Pg(t,e,a,n,r),e=a}return r}function Ig(t,e,i,n,r,o,s,a,l,c,h){if(e==i)return c;var u,d;if(0===r){if((d=Od(s,a,t[e],t[e+1]))<c){for(u=0;u<n;++u)l[u]=t[e+u];return l.length=n,d}return c}for(var p=h||[NaN,NaN],f=e+n;f<i;)if(Eg(t,f-n,f,n,s,a,p),(d=Od(s,a,p[0],p[1]))<c){for(c=d,u=0;u<n;++u)l[u]=p[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/r|0,1);if(o&&(Eg(t,i-n,e,n,s,a,p),(d=Od(s,a,p[0],p[1]))<c)){for(c=d,u=0;u<n;++u)l[u]=p[u];l.length=n}return c}function Lg(t,e,i,n,r,o,s,a,l,c,h){for(var u=h||[NaN,NaN],d=0,p=i.length;d<p;++d){var f=i[d];c=Ig(t,e,f,n,r,o,s,a,l,c,u),e=f}return c}function Ag(t,e,i,n){for(var r=0,o=i.length;r<o;++r)for(var s=i[r],a=0;a<n;++a)t[e++]=s[a];return e}function Rg(t,e,i,n,r){for(var o=r||[],s=0,a=0,l=i.length;a<l;++a){var c=Ag(t,e,i[a],n);o[s++]=c,e=c}return o.length=s,o}function Og(t,e,i,n,r,o,s){var a=(i-e)/n;if(a<3){for(;e<i;e+=n)o[s++]=t[e],o[s++]=t[e+1];return s}var l=new Array(a);l[0]=1,l[a-1]=1;for(var c=[e,i-n],h=0;c.length>0;){for(var u=c.pop(),d=c.pop(),p=0,f=t[d],g=t[d+1],m=t[u],_=t[u+1],v=d+n;v<u;v+=n){var y=Rd(t[v],t[v+1],f,g,m,_);y>p&&(h=v,p=y)}p>r&&(l[(h-e)/n]=1,d+n<h&&c.push(d,h),h+n<u&&c.push(h,u))}for(v=0;v<a;++v)l[v]&&(o[s++]=t[e+v*n],o[s++]=t[e+v*n+1]);return s}function Fg(t,e){return e*Math.round(t/e)}function Dg(t,e,i,n,r,o,s){if(e==i)return s;var a,l,c=Fg(t[e],r),h=Fg(t[e+1],r);e+=n,o[s++]=c,o[s++]=h;do{if(a=Fg(t[e],r),l=Fg(t[e+1],r),(e+=n)==i)return o[s++]=a,o[s++]=l,s}while(a==c&&l==h);for(;e<i;){var u=Fg(t[e],r),d=Fg(t[e+1],r);if(e+=n,u!=a||d!=l){var p=a-c,f=l-h,g=u-c,m=d-h;p*m==f*g&&(p<0&&g<p||p==g||p>0&&g>p)&&(f<0&&m<f||f==m||f>0&&m>f)?(a=u,l=d):(o[s++]=a,o[s++]=l,c=a,h=l,a=u,l=d)}}return o[s++]=a,o[s++]=l,s}function Zg(t,e,i,n,r,o,s,a){for(var l=0,c=i.length;l<c;++l){var h=i[l];s=Dg(t,e,h,n,r,o,s),a.push(s),e=h}return s}function Ng(t,e,i,n,r){for(var o,s=[t[e],t[e+1]],a=[];e+n<i;e+=n){if(a[0]=t[e+n],a[1]=t[e+n+1],o=r(s,a))return o;s[0]=a[0],s[1]=a[1]}return!1}function jg(t,e,i,n,r){for(var o=void 0!==r?r:[],s=0,a=e;a<i;a+=n)o[s++]=t.slice(a,a+n);return o.length=s,o}function Gg(t,e,i,n,r){for(var o=void 0!==r?r:[],s=0,a=0,l=i.length;a<l;++a){var c=i[a];o[s++]=jg(t,e,c,n,o[s]),e=c}return o.length=s,o}function zg(t,e,i,n,r,o,s){var a,l,c=(i-e)/n;if(1===c)a=e;else if(2===c)a=e,l=r;else if(0!==c){for(var h=t[e],u=t[e+1],d=0,p=[0],f=e+n;f<i;f+=n){var g=t[f],m=t[f+1];d+=Math.sqrt((g-h)*(g-h)+(m-u)*(m-u)),p.push(d),h=g,u=m}var _=r*d,v=function(t,e,i){for(var n,r,o=Mf,s=0,a=t.length,l=!1;s<a;)(r=+o(t[n=s+(a-s>>1)],e))<0?s=n+1:(a=n,l=!r);return l?s:~s}(p,_);v<0?(l=(_-p[-v-2])/(p[-v-1]-p[-v-2]),a=e+(-v-2)*n):a=e+v*n}var y=s>1?s:2,w=o||new Array(y);for(f=0;f<y;++f)w[f]=void 0===a?NaN:void 0===l?t[a+f]:Fd(t[a+f],t[a+n+f],l);return w}function Vg(t,e,i,n,r,o){if(i==e)return null;var s;if(r<t[e+n-1])return o?((s=t.slice(e,e+n))[n-1]=r,s):null;if(t[i-1]<r)return o?((s=t.slice(i-n,i))[n-1]=r,s):null;if(r==t[e+n-1])return t.slice(e,e+n);for(var a=e/n,l=i/n;a<l;){var c=a+l>>1;r<t[(c+1)*n-1]?l=c:a=c+1}var h=t[a*n-1];if(r==h)return t.slice((a-1)*n,(a-1)*n+n);var u=(r-h)/(t[(a+1)*n-1]-h);s=[];for(var d=0;d<n-1;++d)s.push(Fd(t[(a-1)*n+d],t[a*n+d],u));return s.push(r),s}function Bg(t,e,i,n,r){return!function(t,e){var i;return(i=e(function(t){return[t[0],t[1]]}(t)))||(i=e(function(t){return[t[2],t[1]]}(t)))||(i=e(function(t){return[t[2],t[3]]}(t)))?i:(i=e(function(t){return[t[0],t[3]]}(t)))||!1}(r,function(r){return!qg(t,e,i,n,r[0],r[1])})}function qg(t,e,i,n,r,o){for(var s=0,a=t[i-n],l=t[i-n+1];e<i;e+=n){var c=t[e],h=t[e+1];l<=o?h>o&&(c-a)*(o-l)-(r-a)*(h-l)>0&&s++:h<=o&&(c-a)*(o-l)-(r-a)*(h-l)<0&&s--,a=c,l=h}return 0!==s}function Ug(t,e,i,n,r,o){if(0===i.length)return!1;if(!qg(t,e,i[0],n,r,o))return!1;for(var s=1,a=i.length;s<a;++s)if(qg(t,i[s-1],i[s],n,r,o))return!1;return!0}function $g(t,e,i,n,r){var o,s,a=op([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}(r,a)&&((o=r)[0]<=(s=a)[0]&&s[2]<=o[2]&&o[1]<=s[1]&&s[3]<=o[3]||a[0]>=r[0]&&a[2]<=r[2]||a[1]>=r[1]&&a[3]<=r[3]||Ng(t,e,i,n,function(t,e){return function(t,e,i){var n=!1,r=ep(t,e),o=ep(t,i);if(1===r||1===o)n=!0;else{var s=t[0],a=t[1],l=t[2],c=t[3],h=i[0],u=i[1],d=(u-e[1])/(h-e[0]),p=void 0,f=void 0;2&o&&!(2&r)&&(n=(p=h-(u-c)/d)>=s&&p<=l),n||!(4&o)||4&r||(n=(f=u-(h-l)*d)>=a&&f<=c),n||!(8&o)||8&r||(n=(p=h-(u-a)/d)>=s&&p<=l),n||!(16&o)||16&r||(n=(f=u-(h-s)*d)>=a&&f<=c)}return n}(r,t,e)}))}function Yg(t,e,i,n,r){if(!function(t,e,i,n,r){return!!($g(t,e,i,n,r)||qg(t,e,i,n,r[0],r[1])||qg(t,e,i,n,r[0],r[3])||qg(t,e,i,n,r[2],r[1])||qg(t,e,i,n,r[2],r[3]))}(t,e,i[0],n,r))return!1;if(1===i.length)return!0;for(var o=1,s=i.length;o<s;++o)if(Bg(t,i[o-1],i[o],n,r)&&!$g(t,i[o-1],i[o],n,r))return!1;return!0}var Xg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Wg=function(t){function e(e,i){var n=t.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?n.setCoordinates(e,i):n.setFlatCoordinates(i,e),n}return Xg(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?If(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<Qd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ig(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))},e.prototype.forEachSegment=function(t){return Ng(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){return this.layout!=bg&&this.layout!=Cg?null:Vg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,void 0!==e&&e)},e.prototype.getCoordinates=function(){return jg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return zg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return function(t,e,i,n){for(var r=t[0],o=t[1],s=0,a=0+n;a<i;a+=n){var l=t[a],c=t[a+1];s+=Math.sqrt((l-r)*(l-r)+(c-o)*(c-o)),r=l,o=c}return s}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=Og(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,xg)},e.prototype.getType=function(){return ag},e.prototype.intersectsExtent=function(t){return $g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ag(this.flatCoordinates,0,t,this.stride),this.changed()},e}(kg);var Hg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Jg=function(t){function e(e,i,n){var r=t.call(this)||this;if(r.ends_=[],r.maxDelta_=-1,r.maxDeltaRevision_=-1,Array.isArray(e[0]))r.setCoordinates(e,i);else if(void 0!==i&&n)r.setFlatCoordinates(i,e),r.ends_=n;else{for(var o=r.getLayout(),s=e,a=[],l=[],c=0,h=s.length;c<h;++c){var u=s[c];0===c&&(o=u.getLayout()),If(a,u.getFlatCoordinates()),l.push(a.length)}r.setFlatCoordinates(o,a),r.ends_=l}return r}return Hg(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?If(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<Qd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Mg(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Lg(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))},e.prototype.getCoordinateAtM=function(t,e,i){return this.layout!=bg&&this.layout!=Cg||0===this.flatCoordinates.length?null:function(t,e,i,n,r,o,s){if(s)return Vg(t,e,i[i.length-1],n,r,o);var a;if(r<t[n-1])return o?((a=t.slice(0,n))[n-1]=r,a):null;if(t[t.length-1]<r)return o?((a=t.slice(t.length-n))[n-1]=r,a):null;for(var l=0,c=i.length;l<c;++l){var h=i[l];if(e!=h){if(r<t[e+n-1])return null;if(r<=t[h-1])return Vg(t,e,h,n,r,!1);e=h}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,void 0!==e&&e,void 0!==i&&i)},e.prototype.getCoordinates=function(){return Gg(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new Wg(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[],r=0,o=0,s=e.length;o<s;++o){var a=e[o],l=new Wg(t.slice(r,a),i);n.push(l),r=a}return n},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,n=this.ends_,r=this.stride,o=0,s=n.length;o<s;++o){var a=n[o];If(t,zg(e,i,a,r,.5)),i=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=function(t,e,i,n,r,o,s,a){for(var l=0,c=i.length;l<c;++l){var h=i[l];s=Og(t,e,h,n,r,o,s),a.push(s),e=h}return s}(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,n),new e(i,xg,n)},e.prototype.getType=function(){return hg},e.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){if($g(t,e,i[o],n,r))return!0;e=i[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Rg(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(kg);var Kg=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const Qg=function(t){function e(e,i){var n=t.call(this)||this;return n.setCoordinates(e,i),n}return Kg(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){var r=this.flatCoordinates,o=Od(t,e,r[0],r[1]);if(o<n){for(var s=this.stride,a=0;a<s;++a)i[a]=r[a];return i.length=s,o}return n},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return ip(i=(e=this.flatCoordinates)[0],n=e[1],i,n,t);var e,i,n},e.prototype.getType=function(){return sg},e.prototype.intersectsExtent=function(t){return tp(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,i,n){for(var r=0,o=i.length;r<o;++r)t[e++]=i[r];return e}(this.flatCoordinates,0,t),this.changed()},e}(kg);var tm=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const em=function(t){function e(e,i){var n=t.call(this)||this;return i&&!Array.isArray(e[0])?n.setFlatCoordinates(i,e):n.setCoordinates(e,i),n}return tm(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?If(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){if(n<Qd(this.getExtent(),t,e))return n;for(var r=this.flatCoordinates,o=this.stride,s=0,a=r.length;s<a;s+=o){var l=Od(t,e,r[s],r[s+1]);if(l<n){n=l;for(var c=0;c<o;++c)i[c]=r[s+c];i.length=o}}return n},e.prototype.getCoordinates=function(){return jg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new Qg(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,n=[],r=0,o=t.length;r<o;r+=i){var s=new Qg(t.slice(r,r+i),e);n.push(s)}return n},e.prototype.getType=function(){return cg},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,n=0,r=e.length;n<r;n+=i)if(tp(t,e[n],e[n+1]))return!0;return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ag(this.flatCoordinates,0,t,this.stride),this.changed()},e}(kg);function im(t,e,i,n){for(var r=0,o=t[i-n],s=t[i-n+1];e<i;e+=n){var a=t[e],l=t[e+1];r+=s*a-o*l,o=a,s=l}return r/2}function nm(t,e,i,n){for(var r=0,o=0,s=i.length;o<s;++o){var a=i[o];r+=im(t,e,a,n),e=a}return r}var rm=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const om=function(t){function e(e,i){var n=t.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?n.setCoordinates(e,i):n.setFlatCoordinates(i,e),n}return rm(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,n){return n<Qd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ig(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))},e.prototype.getArea=function(){return im(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return jg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=Og(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,xg)},e.prototype.getType=function(){return"LinearRing"},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ag(this.flatCoordinates,0,t,this.stride),this.changed()},e}(kg);function sm(t,e,i,n,r,o,s){for(var a,l,c,h,u,d,p,f=r[o+1],g=[],m=0,_=i.length;m<_;++m){var v=i[m];for(h=t[v-n],d=t[v-n+1],a=e;a<v;a+=n)u=t[a],p=t[a+1],(f<=d&&p<=f||d<=f&&f<=p)&&g.push(c=(f-d)/(p-d)*(u-h)+h),h=u,d=p}var y=NaN,w=-1/0;for(g.sort(Mf),h=g[0],a=1,l=g.length;a<l;++a){u=g[a];var x=Math.abs(u-h);x>w&&Ug(t,e,i,n,c=(h+u)/2,f)&&(y=c,w=x),h=u}return isNaN(y)&&(y=r[o]),s?(s.push(y,f,w),s):[y,f,w]}function am(t,e,i,n){for(;e<i-n;){for(var r=0;r<n;++r){var o=t[e+r];t[e+r]=t[i-n+r],t[i-n+r]=o}e+=n,i-=n}}function lm(t,e,i,n){for(var r=0,o=t[i-n],s=t[i-n+1];e<i;e+=n){var a=t[e],l=t[e+1];r+=(a-o)*(l+s),o=a,s=l}return 0===r?void 0:r>0}function cm(t,e,i,n,r){for(var o=void 0!==r&&r,s=0,a=i.length;s<a;++s){var l=i[s],c=lm(t,e,l,n);if(0===s){if(o&&c||!o&&!c)return!1}else if(o&&!c||!o&&c)return!1;e=l}return!0}function hm(t,e,i,n,r){for(var o=void 0!==r&&r,s=0,a=i.length;s<a;++s){var l=i[s],c=lm(t,e,l,n);(0===s?o&&c||!o&&!c:o&&!c||!o&&c)&&am(t,e,l,n),e=l}return e}function um(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o)e=hm(t,e,i[o],n,r);return e}var dm=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const pm=function(t){function e(e,i,n){var r=t.call(this)||this;return r.ends_=[],r.flatInteriorPointRevision_=-1,r.flatInteriorPoint_=null,r.maxDelta_=-1,r.maxDeltaRevision_=-1,r.orientedRevision_=-1,r.orientedFlatCoordinates_=null,void 0!==i&&n?(r.setFlatCoordinates(i,e),r.ends_=n):r.setCoordinates(e,i),r}return dm(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?If(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,i,n){return n<Qd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Mg(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Lg(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))},e.prototype.containsXY=function(t,e){return Ug(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return nm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?hm(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,Gg(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=ap(this.getExtent());this.flatInteriorPoint_=sm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new Qg(this.getFlatInteriorPoint(),bg)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new om(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[],r=0,o=0,s=i.length;o<s;++o){var a=i[o],l=new om(e.slice(r,a),t);n.push(l),r=a}return n},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;cm(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=hm(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=Zg(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new e(i,xg,n)},e.prototype.getType=function(){return lg},e.prototype.intersectsExtent=function(t){return Yg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Rg(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(kg);var fm=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();const gm=function(t){function e(e,i,n){var r=t.call(this)||this;if(r.endss_=[],r.flatInteriorPointsRevision_=-1,r.flatInteriorPoints_=null,r.maxDelta_=-1,r.maxDeltaRevision_=-1,r.orientedRevision_=-1,r.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){for(var o=r.getLayout(),s=e,a=[],l=[],c=0,h=s.length;c<h;++c){var u=s[c];0===c&&(o=u.getLayout());for(var d=a.length,p=u.getEnds(),f=0,g=p.length;f<g;++f)p[f]+=d;If(a,u.getFlatCoordinates()),l.push(p)}i=o,e=a,n=l}return void 0!==i&&n?(r.setFlatCoordinates(i,e),r.endss_=n):r.setCoordinates(e,i),r}return fm(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;If(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,r=(e=t.getEnds().slice()).length;n<r;++n)e[n]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),n=0;n<t;++n)i[n]=this.endss_[n].slice();var r=new e(this.flatCoordinates.slice(),this.layout,i);return r.applyProperties(this),r},e.prototype.closestPointXY=function(t,e,i,n){return n<Qd(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];r=Mg(t,e,a,n,r),e=a[a.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,r,o,s,a,l,c,h){for(var u=[NaN,NaN],d=0,p=i.length;d<p;++d){var f=i[d];c=Lg(t,e,f,n,r,!0,s,a,l,c,u),e=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,n))},e.prototype.containsXY=function(t,e){return function(t,e,i,n,r,o){if(0===i.length)return!1;for(var s=0,a=i.length;s<a;++s){var l=i[s];if(Ug(t,e,l,n,r,o))return!0;e=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,i,n){for(var r=0,o=0,s=i.length;o<s;++o){var a=i[o];r+=nm(t,e,a,n),e=a[a.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?um(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,function(t,e,i,n,r){for(var o=[],s=0,a=0,l=i.length;a<l;++a){var c=i[a];o[s++]=Gg(t,e,c,n,o[s]),e=c[c.length-1]}return o.length=s,o}(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,i,n){for(var r=[],o=[1/0,1/0,-1/0,-1/0],s=0,a=i.length;s<a;++s){var l=i[s];o=rp(t,e,l[0],n),r.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=l[l.length-1]}return r}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,i,n,r){for(var o=[],s=0,a=i.length;s<a;++s){var l=i[s];o=sm(t,e,l,n,r,2*s,o),e=l[l.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new em(this.getFlatInteriorPoints().slice(),bg)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];if(!cm(t,e,a,n,void 0))return!1;a.length&&(e=a[a.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=um(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=function(t,e,i,n,r,o,s,a){for(var l=0,c=i.length;l<c;++l){var h=i[l],u=[];s=Zg(t,e,h,n,r,o,s,u),a.push(u),e=h[h.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new e(i,xg,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var n=this.endss_[t].slice(),r=n[n.length-1];if(0!==e)for(var o=0,s=n.length;o<s;++o)n[o]-=e;return new pm(this.flatCoordinates.slice(e,r),this.layout,n)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[],r=0,o=0,s=i.length;o<s;++o){var a=i[o].slice(),l=a[a.length-1];if(0!==r)for(var c=0,h=a.length;c<h;++c)a[c]-=r;var u=new pm(e.slice(r,l),t,a);n.push(u),r=l}return n},e.prototype.getType=function(){return ug},e.prototype.intersectsExtent=function(t){return function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o];if(Yg(t,e,a,n,r))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=function(t,e,i,n,r){for(var o=r||[],s=0,a=0,l=i.length;a<l;++a){var c=Rg(t,e,i[a],n,o[s]);o[s++]=c,e=c[c.length-1]}return o.length=s,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var n=i[i.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},e}(kg);var mm=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();function _m(t,e){if(!t)return null;var i;switch(t.type){case sg:i=function(t){return new Qg(t.coordinates)}(t);break;case ag:i=function(t){return new Wg(t.coordinates)}(t);break;case lg:i=function(t){return new pm(t.coordinates)}(t);break;case cg:i=function(t){return new em(t.coordinates)}(t);break;case hg:i=function(t){return new Jg(t.coordinates)}(t);break;case ug:i=function(t){return new gm(t.coordinates)}(t);break;case dg:i=function(t,e){var i=t.geometries.map(function(t){return _m(t,void 0)});return new gg(i)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return _g(i,!1,e)}function vm(t,e){var i,n=(t=_g(t,!0,e)).getType();switch(n){case sg:i=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case ag:i=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case lg:i=function(t,e){var i;return e&&(i=e.rightHanded),{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case cg:i=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case hg:i=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case ug:i=function(t,e){var i;return e&&(i=e.rightHanded),{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case dg:i=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){var i=Rf({},e);return delete i.featureProjection,vm(t,i)})}}(t,e);break;case"Circle":i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return i}const ym=function(t){function e(e){var i=this,n=e||{};return(i=t.call(this)||this).dataProjection=dp(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(i.defaultFeatureProjection=dp(n.featureProjection)),i.geometryName_=n.geometryName,i.extractGeometryName_=n.extractGeometryName,i}return mm(e,t),e.prototype.readFeatureFromObject=function(t,e){var i,n=_m((i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),r=new ig;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(n),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r},e.prototype.readFeaturesFromObject=function(t,e){var i=null;if("FeatureCollection"===t.type){i=[];for(var n=t.features,r=0,o=n.length;r<o;++r)i.push(this.readFeatureFromObject(n[r],e))}else i=[this.readFeatureFromObject(t,e)];return i},e.prototype.readGeometryFromObject=function(t,e){return _m(t,e)},e.prototype.readProjectionFromObject=function(t){var e,i=t.crs;return i?"name"==i.type?e=dp(i.properties.name):"EPSG"===i.type?e=dp("EPSG:"+i.properties.code):tg(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={type:"Feature",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(i.id=n),!t.hasProperties())return i;var r=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=vm(o,e),delete r[t.getGeometryName()]),Ff(r)||(i.properties=r),i},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],n=0,r=t.length;n<r;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}},e.prototype.writeGeometryObject=function(t,e){return vm(t,this.adaptOptions(e))},e}(wg);function wm(t,e,i){return"<"+t+((n=i)&&n.length?" "+n.map(function(t){return t[0]+'="'+t[1]+'"'}).join(" "):"")+">"+e+"</"+t+">";var n}function xm(t){return(null===t?"":t.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function bm(t,e){return function(i){if(!i.properties||!Cm.valid(i.geometry))return"";var n=Cm.any(i.geometry);if(!n)return"";var r="",o="";if(t.simplestyle){var s=function(t){var e="";return t["marker-symbol"]&&(e=e+"ms"+t["marker-symbol"]),t["marker-color"]&&(e=e+"mc"+t["marker-color"].replace("#","")),t["marker-size"]&&(e=e+"ms"+t["marker-size"]),t.stroke&&(e=e+"s"+t.stroke.replace("#","")),t["stroke-width"]&&(e=e+"sw"+t["stroke-width"].toString().replace(".","")),t["stroke-opacity"]&&(e=e+"mo"+t["stroke-opacity"].toString().replace(".","")),t.fill&&(e=e+"f"+t.fill.replace("#","")),t["fill-opacity"]&&(e=e+"fo"+t["fill-opacity"].toString().replace(".","")),e}(i.properties);s&&(Cm.isPoint(i.geometry)&&function(t){return!!(t["marker-size"]||t["marker-symbol"]||t["marker-color"])}(i.properties)?(-1===e.indexOf(s)&&(r=function(t,e){return wm("Style",wm("IconStyle",wm("Icon",wm("href",function(t){var e=t["marker-size"]||"medium",i=t["marker-symbol"]?"-"+t["marker-symbol"]:"",n=(t["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+e.charAt(0)+i+"+"+n+".png"}(t))))+wm("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]]),[["id",e]])}(i.properties,s),e.push(s)),o=wm("styleUrl","#"+s)):(Cm.isPolygon(i.geometry)||Cm.isLine(i.geometry))&&function(t){for(var e in t)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[e])return!0}(i.properties)&&(-1===e.indexOf(s)&&(r=function(t,e){var i=wm("LineStyle",[wm("color",km(t.stroke,t["stroke-opacity"])||"ff555555")+wm("width",void 0===t["stroke-width"]?2:t["stroke-width"])]),n="";return(t.fill||t["fill-opacity"])&&(n=wm("PolyStyle",[wm("color",km(t.fill,t["fill-opacity"])||"88555555")])),wm("Style",i+n,[["id",e]])}(i.properties,s),e.push(s)),o=wm("styleUrl","#"+s)))}return r+wm("Placemark",function(t,e){return t[e.name]?wm("name",xm(t[e.name])):""}(i.properties,t)+function(t,e){return t[e.description]?wm("description",xm(t[e.description])):""}(i.properties,t)+function(t){return wm("ExtendedData",function(t){var e=[];for(var i in t)e.push([i,t[i]]);return e}(t).map(Sm).join(""))}(i.properties)+function(t,e){return t[e.timestamp]?wm("TimeStamp",wm("when",xm(t[e.timestamp]))):""}(i.properties,t)+n+o)}}var Cm={Point:function(t){return wm("Point",wm("coordinates",t.coordinates.join(",")))},LineString:function(t){return wm("LineString",wm("coordinates",Tm(t.coordinates)))},Polygon:function(t){if(!t.coordinates.length)return"";var e=t.coordinates[0],i=t.coordinates.slice(1),n=wm("outerBoundaryIs",wm("LinearRing",wm("coordinates",Tm(e)))),r=i.map(function(t){return wm("innerBoundaryIs",wm("LinearRing",wm("coordinates",Tm(t))))}).join("");return wm("Polygon",n+r)},MultiPoint:function(t){return t.coordinates.length?wm("MultiGeometry",t.coordinates.map(function(t){return Cm.Point({coordinates:t})}).join("")):""},MultiPolygon:function(t){return t.coordinates.length?wm("MultiGeometry",t.coordinates.map(function(t){return Cm.Polygon({coordinates:t})}).join("")):""},MultiLineString:function(t){return t.coordinates.length?wm("MultiGeometry",t.coordinates.map(function(t){return Cm.LineString({coordinates:t})}).join("")):""},GeometryCollection:function(t){return wm("MultiGeometry",t.geometries.map(Cm.any).join(""))},valid:function(t){return t&&t.type&&(t.coordinates||"GeometryCollection"===t.type&&t.geometries&&t.geometries.every(Cm.valid))},any:function(t){return Cm[t.type]?Cm[t.type](t):""},isPoint:function(t){return"Point"===t.type||"MultiPoint"===t.type},isPolygon:function(t){return"Polygon"===t.type||"MultiPolygon"===t.type},isLine:function(t){return"LineString"===t.type||"MultiLineString"===t.type}};function Tm(t){return t.map(function(t){return t.join(",")}).join(" ")}function Sm(t){return wm("Data",wm("value",xm(t[1])),[["name",xm(t[0])]])}function km(t,e){if("string"!=typeof t)return"";if(3===(t=t.replace("#","").toLowerCase()).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==t.length)return"";var i=t[0]+t[1],n=t[2]+t[3],r=t[4]+t[5],o="ff";return"number"==typeof e&&e>=0&&e<=1&&((o=(255*e).toString(16)).indexOf(".")>-1&&(o=o.substr(0,o.indexOf("."))),o.length<2&&(o="0"+o)),o+r+n+i}var Em=i(9696),Pm=i.n(Em);function Mm(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"ion-card",2),l.TgZ(2,"ion-card-header"),l.TgZ(3,"ion-card-title"),l.TgZ(4,"ion-input",3),l.NdJ("ngModelChange",function(e){return l.CHM(t).ngIf.properties.name=e}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(5,"ion-item"),l.TgZ(6,"ion-label"),l._uU(7),l.ALo(8,"wmtrans"),l.qZA(),l.TgZ(9,"ion-input",4),l.NdJ("ngModelChange",function(e){return l.CHM(t).ngIf.properties.name=e}),l.ALo(10,"wmtrans"),l.qZA(),l.qZA(),l._UZ(11,"webmapp-track-elevation-chart",5),l._UZ(12,"webmapp-track-technical-data",5),l._UZ(13,"webmapp-track-download-urls",5),l.TgZ(14,"ion-button",6),l.NdJ("click",function(){return l.CHM(t),l.oxw().saveCustomTrack()}),l._uU(15),l.ALo(16,"wmtrans"),l.qZA(),l.qZA(),l.BQk()}if(2&t){const t=e.ngIf;l.xp6(4),l.Q6J("ngModel",t.properties.name),l.xp6(3),l.hij(" ",l.lcZ(8,8,"nome del percorso"),""),l.xp6(2),l.s9C("placeholder",l.lcZ(10,10,"nome del percorso")),l.Q6J("ngModel",t.properties.name),l.xp6(2),l.Q6J("feature",t),l.xp6(1),l.Q6J("feature",t),l.xp6(1),l.Q6J("feature",t),l.xp6(2),l.Oqu(l.lcZ(16,12,"salva"))}}const Im=function(t){return{selected:t}};function Lm(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-item"),l.TgZ(1,"ion-card",10),l.NdJ("click",function(){const e=l.CHM(t),i=e.$implicit,n=e.index,r=l.oxw(4);return r.centerCustomTrack(i),r.selectedTrackIdx=n}),l.TgZ(2,"ion-card-header"),l.TgZ(3,"ion-card-title"),l._uU(4),l.qZA(),l.qZA(),l.TgZ(5,"ion-card-content"),l.TgZ(6,"ion-item"),l._UZ(7,"webmapp-track-elevation-chart",5),l.qZA(),l.TgZ(8,"ion-item"),l._UZ(9,"webmapp-track-technical-data",5),l.qZA(),l.TgZ(10,"ion-item",11),l.TgZ(11,"ion-list"),l.TgZ(12,"ion-item",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(4).downloadGpx(e)}),l._UZ(13,"ion-icon",13),l.TgZ(14,"ion-label",14),l._uU(15),l.ALo(16,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(17,"ion-item",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(4).downloadKml(e)}),l._UZ(18,"ion-icon",13),l.TgZ(19,"ion-label",14),l._uU(20),l.ALo(21,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(22,"ion-item",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(4).downloadGeojson(e)}),l._UZ(23,"ion-icon",13),l.TgZ(24,"ion-label",14),l._uU(25),l.ALo(26,"wmtrans"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(27,"ion-grid"),l.TgZ(28,"ion-row"),l.TgZ(29,"ion-col"),l.TgZ(30,"ion-button",12),l.NdJ("click",function(){const e=l.CHM(t).$implicit;return l.oxw(4).editCustomTrackName(e)}),l._uU(31),l.ALo(32,"wmtrans"),l.qZA(),l.qZA(),l._UZ(33,"ion-col"),l.TgZ(34,"ion-col"),l.TgZ(35,"ion-button",15),l.NdJ("click",function(){const e=l.CHM(t).index;return l.oxw(4).deleteCustomTrack(e)}),l._uU(36),l.ALo(37,"wmtrans"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&t){const t=e.$implicit,i=e.index,n=l.oxw(4);l.xp6(1),l.Q6J("ngClass",l.VKq(19,Im,i===n.selectedTrackIdx)),l.xp6(3),l.Oqu(t.properties.name),l.xp6(3),l.Q6J("feature",t),l.xp6(2),l.Q6J("feature",t),l.xp6(6),l.hij(" ",l.lcZ(16,9,"trackDetails.downloadUrls.gpx")," "),l.xp6(5),l.hij(" ",l.lcZ(21,11,"trackDetails.downloadUrls.kml")," "),l.xp6(5),l.hij(" ",l.lcZ(26,13,"trackDetails.downloadUrls.geojson")," "),l.xp6(6),l.Oqu(l.lcZ(32,15,"modifica")),l.xp6(5),l.Oqu(l.lcZ(37,17,"elimina"))}}function Am(t,e){if(1&t&&(l.TgZ(0,"ion-list"),l.TgZ(1,"ion-item"),l.TgZ(2,"ion-label"),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA(),l.YNc(5,Lm,38,21,"ion-item",9),l.qZA()),2&t){const t=l.oxw().ngIf;l.xp6(3),l.Oqu(l.lcZ(4,2,"Lista percorsi personali")),l.xp6(2),l.Q6J("ngForOf",t)}}function Rm(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Am,6,4,"ion-list",0),l.BQk()),2&t){const t=e.ngIf;l.oxw();const i=l.MAs(3);l.xp6(1),l.Q6J("ngIf",t.length>0)("ngIfElse",i)}}function Om(t,e){1&t&&(l.TgZ(0,"ion-card"),l.TgZ(1,"ion-card-header"),l.TgZ(2,"ion-card-title"),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(5,"ion-card-content"),l.TgZ(6,"ion-label"),l._uU(7),l.ALo(8,"wmtrans"),l._UZ(9,"br"),l._uU(10),l.ALo(11,"wmtrans"),l.qZA(),l.qZA(),l.qZA()),2&t&&(l.xp6(3),l.Oqu(l.lcZ(4,3,"non hai percorsi")),l.xp6(4),l.hij(" ",l.lcZ(8,5,"al momento non hai nessun percorso salvato."),""),l.xp6(3),l.hij(" ",l.lcZ(11,7,"Clicca sulla mappa per avviare la creazione di un percorso"),""))}function Fm(t,e){if(1&t&&(l.YNc(0,Rm,2,2,"ng-container",7),l.ALo(1,"async"),l.YNc(2,Om,12,9,"ng-template",null,8,l.W1O)),2&t){const t=l.oxw();l.Q6J("ngIf",l.lcZ(1,1,t.savedTracks$))}}let Dm=(()=>{class t{constructor(t){this._http=t,this.reloadEvt=new l.vpe,this.savedTracks$=new rt.X([]),this.track$=new rt.X(null),this.selectedTrackIdx=-1,this._initSavedTracks()}set track(t){this.track$.next(t)}centerCustomTrack(t){const e=new ym({featureProjection:"EPSG:3857"}).readFeature(t.geometry);this.map.getView().fit(e.getGeometry().getExtent(),{duration:500,maxZoom:this.map.getView().getZoom()})}deleteCustomTrack(t){const e=this.savedTracks$.value;e.splice(t,1),this.savedTracks$.next(e),this.saveCustomTrack()}downloadGeojson(t){const e=JSON.stringify(t);this._downloadFile(`${t.properties.name||"noname"}.geojson`,e)}downloadGpx(t){const e=Pm()(t);this._downloadFile(`${t.properties.name||"noname"}.gpx`,e)}downloadKml(t){const e=function(t,e){return'<?xml version="1.0" encoding="UTF-8"?>'+wm("kml",wm("Document",function(t){return void 0!==t.documentName?wm("name",t.documentName):""}(e=e||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"})+function(t){return void 0!==t.documentDescription?wm("description",t.documentDescription):""}(e)+function(t,e){if(!t.type)return"";var i=[];switch(t.type){case"FeatureCollection":return t.features?t.features.map(bm(e,i)).join(""):"";case"Feature":return bm(e,i)(t);default:return bm(e,i)({type:"Feature",geometry:t,properties:{}})}}(t,e)),[["xmlns","http://www.opengis.net/kml/2.2"]])}(t);this._downloadFile(`${t.properties.name||"noname"}.kml`,e)}saveCustomTrack(){const t=this.savedTracks$.value;if(null!=this.track$.value){if(!this.track$.value.properties.name||""===this.track$.value.properties.name.trim())for(;""==this.track$.value.properties.name;)this.track$.value.properties.name=prompt("Per favore, inserisci un nome per il percorso.");this.track$.value.properties.name&&t.push(this.track$.value)}localStorage.setItem("wm-saved-tracks",JSON.stringify(t)),this.savedTracks$.next(t),this.track$.next(null),this.reloadEvt.emit()}_downloadFile(t,e){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}_initSavedTracks(){const t=localStorage.getItem("wm-saved-tracks"),e=JSON.parse(t);null!=e&&this.savedTracks$.next(e)}editCustomTrackName(t){const e=prompt("Inserisci il nuovo nome:",t.properties.name);e&&(t.properties.name=e,this.saveCustomTrack())}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Eu.eN))},t.\u0275cmp=l.Xpm({type:t,selectors:[["wm-draw-track"]],inputs:{track:"track",map:"map"},outputs:{reloadEvt:"reloadEvt"},decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["customTrackList",""],[1,"current-custom-track"],[3,"ngModel","ngModelChange"],["autofocus","",3,"ngModel","placeholder","ngModelChange"],[3,"feature"],["expand","full",3,"click"],[4,"ngIf"],["savedTracksEmpy",""],[4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"downloads"],[3,"click"],["name","download","slot","start"],[1,"webmapp-track-download-urls-item-label"],["color","danger",3,"click"]],template:function(t,e){if(1&t&&(l.YNc(0,Mm,17,14,"ng-container",0),l.ALo(1,"async"),l.YNc(2,Fm,4,3,"ng-template",null,1,l.W1O)),2&t){const t=l.MAs(3);l.Q6J("ngIf",l.lcZ(1,2,e.track$))("ngIfElse",t)}},directives:[r.O5,s.PM,s.Zi,s.Dq,s.pK,s.j9,o.JJ,o.On,s.Ie,s.Q$,Pp,md,Yp,s.YG,s.q_,r.sg,r.mk,s.FN,s.gu,s.jY,s.Nd,s.wI],pipes:[r.Ov,K.a],styles:["wm-draw-track .downloads>ion-list{cursor:pointer}wm-draw-track .edit-button-container{display:flex;align-items:center}wm-draw-track .edit-button-text{margin-left:5px}wm-draw-track .selected{background-color:#ededed}"],encapsulation:2,changeDetection:0}),t})();const Zm=["gallery"];function Nm(t,e){1&t&&(l._UZ(0,"div",16),l.ALo(1,"wmtrans")),2&t&&l.Q6J("innerHTML",l.lcZ(1,1,e.ngIf.name),l.oJD)}function jm(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",17),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).prevEVT.emit()}),l._UZ(1,"i",18),l.qZA()}}function Gm(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"button",19),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).nextEVT.emit()}),l._UZ(1,"i",20),l.qZA()}}function zm(t,e){if(1&t&&l._UZ(0,"wm-gallery",21),2&t){const t=l.oxw(2);l.Q6J("gallery",t.poiProperties.image_gallery)}}function Vm(t,e){if(1&t&&(l.TgZ(0,"div",22),l._UZ(1,"i",23),l.TgZ(2,"a",24),l._uU(3),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.MGl("href","https://www.google.com/maps?daddr=",t.poiProperties.address_link,"&navigate=yes",l.LSH),l.xp6(1),l.hij(" ",t.poiProperties.address," ")}}function Bm(t,e){if(1&t&&(l.TgZ(0,"div",22),l._UZ(1,"i",25),l.TgZ(2,"p"),l.TgZ(3,"a"),l._uU(4),l.ALo(5,"wmtrans"),l.qZA(),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(4),l.AsE(" ",t.poiProperties.ele," ",l.lcZ(5,2,"metri")," ")}}function qm(t,e){if(1&t&&(l.TgZ(0,"div",26),l._UZ(1,"i",27),l.TgZ(2,"p"),l.TgZ(3,"a",28),l._uU(4),l.qZA(),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(3),l.MGl("href","tel:",t.poiProperties.contact_phone,"",l.LSH),l.xp6(1),l.hij(" ",t.poiProperties.contact_phone," ")}}function Um(t,e){if(1&t&&(l.TgZ(0,"div",26),l._UZ(1,"i",29),l.TgZ(2,"a",28),l._uU(3),l.qZA(),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Q6J("href","mailto:"+t.poiProperties.contact_email,l.LSH),l.xp6(1),l.hij(" ",t.poiProperties.contact_email," ")}}function $m(t,e){if(1&t&&(l.TgZ(0,"div",22),l._UZ(1,"i",30),l._UZ(2,"webmapp-related-urls",31),l.qZA()),2&t){const t=l.oxw(2);l.xp6(2),l.Q6J("relatedUrls",t.poiProperties.related_url)}}function Ym(t,e){if(1&t&&(l.TgZ(0,"div",32),l._UZ(1,"ion-icon",33),l.TgZ(2,"a",34),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=e.ngIf;l.xp6(2),l.Q6J("href",t,l.LSH),l.xp6(1),l.hij(" ",l.lcZ(4,2,"Vedi su OpenStreetMap")," ")}}function Xm(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"div",35),l._uU(2),l.ALo(3,"wmtrans"),l.qZA(),l._UZ(4,"webmapp-track-audio",36),l.BQk()),2&t){const t=l.oxw(2);l.xp6(2),l.Oqu(l.lcZ(3,2,"Descrizione Audio")),l.xp6(2),l.Q6J("audio",null==t.poiProperties?null:t.poiProperties.audio)}}function Wm(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-button",37),l.NdJ("click",function(){return l.CHM(t),l.oxw(2).openGeohub()}),l._uU(1," edit geohub"),l.qZA()}}function Hm(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"div",1),l.TgZ(2,"button",2),l.NdJ("click",function(){return l.CHM(t),l.oxw().closeEVT.emit()}),l._UZ(3,"i",3),l.qZA(),l.qZA(),l.YNc(4,Nm,2,3,"div",4),l.TgZ(5,"div",1),l.TgZ(6,"div",5),l.YNc(7,jm,2,0,"button",6),l.TgZ(8,"p",7),l._uU(9),l.ALo(10,"wmtrans"),l.qZA(),l.YNc(11,Gm,2,0,"button",8),l.qZA(),l.qZA(),l.YNc(12,zm,1,1,"wm-gallery",9),l.TgZ(13,"div",10),l.YNc(14,Vm,4,2,"div",11),l.YNc(15,Bm,6,4,"div",11),l.YNc(16,qm,5,2,"div",12),l.YNc(17,Um,4,2,"div",12),l.YNc(18,$m,3,1,"div",11),l.YNc(19,Ym,5,4,"div",13),l.qZA(),l._UZ(20,"div",14),l.ALo(21,"wmtrans"),l.YNc(22,Xm,5,4,"ng-container",0),l.YNc(23,Wm,2,0,"ion-button",15),l.ALo(24,"async"),l.BQk()}if(2&t){const t=l.oxw();l.xp6(4),l.Q6J("ngIf",t.poiProperties.taxonomy&&t.poiProperties.taxonomy.poi_type),l.xp6(3),l.Q6J("ngIf",t.poiProperties.related),l.xp6(2),l.Oqu(l.lcZ(10,14,t.poiProperties.name)),l.xp6(2),l.Q6J("ngIf",t.poiProperties.related),l.xp6(1),l.Q6J("ngIf",null!=t.poiProperties.feature_image||null!=t.poiProperties.image_gallery&&t.poiProperties.image_gallery.length>0),l.xp6(2),l.Q6J("ngIf",t.poiProperties.address),l.xp6(1),l.Q6J("ngIf",t.poiProperties.ele),l.xp6(1),l.Q6J("ngIf",t.poiProperties.contact_phone),l.xp6(1),l.Q6J("ngIf",t.poiProperties.contact_email),l.xp6(1),l.Q6J("ngIf",null!=t.poiProperties.related_url),l.xp6(1),l.Q6J("ngIf",t.poiProperties.osm_url),l.xp6(1),l.Q6J("innerHTML",l.lcZ(21,16,t.poiProperties.description),l.oJD),l.xp6(2),l.Q6J("ngIf",null==t.poiProperties?null:t.poiProperties.audio),l.xp6(1),l.Q6J("ngIf",l.lcZ(24,18,t.enableEditingInline$))}}let Jm=(()=>{class t{constructor(t){this._store=t,this.closeEVT=new l.vpe,this.nextEVT=new l.vpe,this.prevEVT=new l.vpe,this.defaultPhotoPath="/assets/icon/no-photo.svg",this.enableEditingInline$=this._store.select(Mu.Hv),this.poiProperties=null}set setPoi(t){var e;if(null!=t&&null!=t.properties){const n={};try{n.address=null!==(e=t.properties.addr_complete)&&void 0!==e?e:[t.properties.addr_locality,t.properties.addr_street].filter(t=>null!=t).join(", ")}catch(i){n.address=""}try{n.address_link=[t.properties.addr_locality,t.properties.addr_street].filter(t=>null!=t).join("+")}catch(i){n.address_link=""}null!=t.properties.related_url&&(null===t.properties.related_url[""]&&delete t.properties.related_url[""],n.related_url=0===Object.keys(t.properties.related_url).length?null:t.properties.related_url),this.poiProperties=Object.assign(Object.assign({},t.properties),n)}}handleArrowLeft(){this.prevEVT.emit()}handleArrowRight(){this.nextEVT.emit()}handleEscape(){this.closeEVT.emit()}openGeohub(){const t=null!=this.poiProperties&&this.poiProperties.id;null!=t&&window.open(`https://geohub.webmapp.it/resources/ec-pois/${t}/edit?viaResource&viaResourceId&viaRelationship`,"_blank").focus()}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Lu.yh))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-poi-popup"]],viewQuery:function(t,e){if(1&t&&l.Gf(Zm,5),2&t){let t;l.iGM(t=l.CRH())&&(e.slider=t.first)}},hostBindings:function(t,e){1&t&&l.NdJ("keydown.ArrowLeft",function(t){return e.handleArrowLeft(t)},!1,l.evT)("keydown.ArrowRight",function(t){return e.handleArrowRight(t)},!1,l.evT)("keydown.Escape",function(t){return e.handleEscape(t)},!1,l.evT)},inputs:{setPoi:["poi","setPoi"]},outputs:{closeEVT:"closeEVT",nextEVT:"nextEVT",prevEVT:"prevEVT"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"row"],[1,"webmapp-poi-popup-close",3,"click"],[1,"icon-outline-close"],["class","row category",3,"innerHTML",4,"ngIf"],[1,"title"],["class","webmapp-poi-popup-left circle",3,"click",4,"ngIf"],[1,"webmapp-poi-popup-title"],["class","webmapp-poi-popup-right circle",3,"click",4,"ngIf"],["class","row",3,"gallery",4,"ngIf"],[1,"webmapp-poi-popup-btns"],["class","webmapp-poi-popup-btn",4,"ngIf"],["class","webmapp-poi-popup-btn","target","_blank",4,"ngIf"],["target","_blank",4,"ngIf"],[1,"webmapp-poi-popup-text",3,"innerHTML"],["class","edit",3,"click",4,"ngIf"],[1,"row","category",3,"innerHTML"],[1,"webmapp-poi-popup-left","circle",3,"click"],[1,"icon-outline-arrow-left"],[1,"webmapp-poi-popup-right","circle",3,"click"],[1,"icon-outline-arrow-right"],[1,"row",3,"gallery"],[1,"webmapp-poi-popup-btn"],[1,"wm-icn","icon-fill-pin"],["target","_blank",3,"href"],[1,"wm-icn","icon-outline-plus"],["target","_blank",1,"webmapp-poi-popup-btn"],[1,"wm-icn","icon-fill-phone"],[3,"href"],[1,"wm-icn","icon-fill-mail"],[1,"wm-icn","icon-fill-globe"],[3,"relatedUrls"],["target","_blank"],["slot","start",1,"wm-icn","icon-link"],[1,"webmapp-track-download-urls-item-label",3,"href"],[1,"webmapp-title"],[3,"audio"],[1,"edit",3,"click"]],template:function(t,e){1&t&&l.YNc(0,Hm,25,20,"ng-container",0),2&t&&l.Q6J("ngIf",null!=e.poiProperties)},directives:[r.O5,pt,nt,s.gu,lt,s.YG],pipes:[K.a,r.Ov],styles:["webmapp-poi-popup{position:absolute;background-color:#fff;margin-right:10px;right:0;top:0;width:20%;bottom:35px;top:35px;border-radius:15px;box-shadow:10px 10px 5px 0 #0000001a;transition:all .5s;z-index:3;padding:10px;display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch}webmapp-poi-popup .row{order:0;flex:0 1 auto;align-self:auto}webmapp-poi-popup .category{color:var(--wm-color-primary);text-transform:uppercase}webmapp-poi-popup .title{display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:center;width:100%}webmapp-poi-popup .title .webmapp-poi-popup-left,webmapp-poi-popup .title .webmapp-poi-popup-right{order:0;flex:0 1 auto;align-self:auto}webmapp-poi-popup .title .webmapp-poi-popup-left{margin-right:5px}webmapp-poi-popup .title .webmapp-poi-popup-right{margin-left:5px}webmapp-poi-popup .circle{width:33px;height:33px;margin:auto}webmapp-poi-popup .webmapp-poi-popup-close{float:right}webmapp-poi-popup .webmapp-poi-popup-title{font-family:var(--wm-font-family-header);font-size:20px;font-weight:700;line-height:22px;letter-spacing:0;text-align:left;flex:1 1 auto;flex-basis:min-content;margin:0}webmapp-poi-popup .webmapp-poi-popup-text{font-family:var(--wm-font-family-content);display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch;overflow-y:auto;-ms-overflow-style:none;scrollbar-width:none;margin-bottom:10px;margin-top:10px}webmapp-poi-popup .webmapp-poi-popup-text p{margin:unset}webmapp-poi-popup .webmapp-poi-popup-btns{display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch}webmapp-poi-popup .webmapp-poi-popup-btns .webmapp-poi-popup-btn{order:0;flex:0 1 auto;align-self:auto;font-family:var(--wm-font-family-content);display:inline-flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:baseline}webmapp-poi-popup .webmapp-poi-popup-btns .webmapp-poi-popup-btn i{flex:0 1 20px;align-self:auto;font-size:18px}webmapp-poi-popup .webmapp-poi-popup-btns .webmapp-poi-popup-btn .wm-icn{color:var(--wm-color-primary);margin-right:5px;flex:0 1 auto}webmapp-poi-popup .webmapp-poi-popup-close,webmapp-poi-popup .webmapp-poi-popup-left,webmapp-poi-popup .webmapp-poi-popup-right{padding:10px;border-radius:15px;z-index:9999}webmapp-poi-popup .edit{position:absolute;bottom:0;left:0;right:0;padding:3px}"],encapsulation:2,changeDetection:0}),t})();const Km=["filterCmp"];function Qm(t,e){if(1&t&&(l.TgZ(0,"ion-item",15),l.ALo(1,"async"),l._UZ(2,"ion-icon",16),l.TgZ(3,"ion-label",17),l._uU(4),l.ALo(5,"wmtrans"),l.qZA(),l.qZA()),2&t){const t=l.oxw(2).ngIf,e=l.oxw();l.Q6J("href","https://geohub.webmapp.it/track/pdf/"+t+"/?app_id="+l.lcZ(1,2,e.geohubId$)),l.xp6(4),l.hij(" ",l.lcZ(5,4,"apri pdf")," ")}}function t_(t,e){if(1&t&&(l.ynx(0),l.YNc(1,Qm,6,6,"ion-item",14),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",null!=t.print_track_enable&&!0===t.print_track_enable)}}function e_(t,e){if(1&t&&(l.TgZ(0,"webmapp-home",18),l._UZ(1,"wm-lang-selector",19),l.ALo(2,"async"),l.ALo(3,"async"),l.qZA()),2&t){const t=l.oxw().ngIf,e=l.oxw();let i,n;l.Q6J("hidden",t>0),l.xp6(1),l.Q6J("langs",null==(i=l.lcZ(2,3,e.langs$))?null:i.available)("defaultLang",null==(n=l.lcZ(3,5,e.langs$))?null:n.default)}}function i_(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"wm-draw-track",21),l.NdJ("reloadEvt",function(){return l.CHM(t),l.oxw(3).reloadCustomTrack()}),l.ALo(1,"async"),l.qZA()}if(2&t){const t=e.ngIf,i=l.oxw(3);l.Q6J("map",t)("track",l.lcZ(1,2,i.currentCustomTrack$))}}function n_(t,e){if(1&t&&(l.YNc(0,i_,2,4,"wm-draw-track",20),l.ALo(1,"async")),2&t){l.oxw();const t=l.MAs(19);l.Q6J("ngIf",l.lcZ(1,1,t.map$))}}function r_(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"webmapp-poi-popup",22),l.NdJ("closeEVT",function(){return l.CHM(t),l.oxw(2).unselectPOI()})("nextEVT",function(){return l.CHM(t),l.oxw(2).next()})("prevEVT",function(){return l.CHM(t),l.oxw(2).prev()}),l.qZA()}2&t&&l.Q6J("poi",e.ngIf)}function o_(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",23),l.NdJ("click",function(){l.CHM(t),l.oxw();const e=l.MAs(19);return l.oxw().toggleDrawTrackEnabled(),e.wmMapCloseTopRightBtns="my-paths"}),l._uU(1),l.ALo(2,"async"),l.ALo(3,"wmtrans"),l.qZA()}if(2&t){const t=l.oxw(2);l.xp6(1),l.hij(" ",l.lcZ(2,1,t.drawTrackEnable$)?"esci":l.lcZ(3,3,"i miei percorsi")," ")}}function s_(t,e){if(1&t){const t=l.EpF();l.ynx(0),l.TgZ(1,"button",3),l.NdJ("click",function(){return l.CHM(t),l.oxw().toggleMenu()}),l.ALo(2,"async"),l._UZ(3,"ion-icon"),l.ALo(4,"async"),l.qZA(),l.TgZ(5,"div",4),l.ALo(6,"async"),l.TgZ(7,"webmapp-track-details",5),l.NdJ("trackElevationChartHover",function(e){return l.CHM(t),l.oxw().setTrackElevationChartHoverElements(e)})("poi-click",function(e){return l.CHM(t),l.oxw().setCurrentRelatedPoi(e)})("dismiss",function(){return l.CHM(t),l.oxw().toggleDetails()}),l.ALo(8,"async"),l.ALo(9,"async"),l.YNc(10,t_,2,1,"ng-container",0),l.ALo(11,"async"),l.qZA(),l.YNc(12,e_,4,7,"webmapp-home",6),l.ALo(13,"async"),l.YNc(14,n_,2,3,"ng-template",null,7,l.W1O),l.qZA(),l.YNc(16,r_,1,1,"webmapp-poi-popup",8),l.ALo(17,"async"),l.TgZ(18,"wm-map",9,10),l.NdJ("wmMapOverlayEVT$",function(e){return l.CHM(t),l.oxw().setWmMapFeatureCollection(e)})("wmMapFeatureCollectionLayerSelected",function(e){l.CHM(t);const i=l.MAs(19);return l.oxw().selectedLayer(e),i.wmMapCloseTopRightBtnsEVT$.emit("")})("currentCustomTrack",function(e){return l.CHM(t),l.oxw().saveCurrentCustomTrack(e)})("colorSelectedFromLayerEVT",function(e){return l.CHM(t),l.oxw().trackColor$.next(e)})("currentPoiEvt",function(e){return l.CHM(t),l.oxw().setPoi(e)})("trackSelectedFromLayerEVT",function(e){return l.CHM(t),l.oxw().toggleDetails(e)})("related-poi",function(e){return l.CHM(t),l.oxw().setCurrentRelatedPoi(e)})("related-poi-next",function(e){return l.CHM(t),l.oxw().currentPoiNextID$.next(+e)}),l.ALo(20,"async"),l.ALo(21,"async"),l.ALo(22,"async"),l.ALo(23,"async"),l.ALo(24,"async"),l.ALo(25,"async"),l.ALo(26,"async"),l.ALo(27,"async"),l.ALo(28,"async"),l.ALo(29,"async"),l.ALo(30,"async"),l.ALo(31,"async"),l.ALo(32,"async"),l.ALo(33,"async"),l.ALo(34,"async"),l.ALo(35,"async"),l.ALo(36,"async"),l.ALo(37,"async"),l.ALo(38,"async"),l.ALo(39,"async"),l.ALo(40,"async"),l.ALo(41,"async"),l.ALo(42,"async"),l.TgZ(43,"wm-filters",11,12),l.NdJ("filterPoisEvt",function(e){return l.CHM(t),l.oxw().updatePoiFilter(e)})("filterTracksEvt",function(e){return l.CHM(t),l.oxw().updateTrackFilter(e)})("removefilterTracksEvt",function(e){return l.CHM(t),l.oxw().removeTrackFilter(e)})("removefilterPoiEvt",function(e){return l.CHM(t),l.oxw().updatePoiFilter(e)})("resetFiltersEvt",function(){return l.CHM(t),l.oxw().resetFilters()})("click",function(){return l.CHM(t),l.MAs(19).wmMapCloseTopRightBtns="wm-filters"}),l.ALo(45,"async"),l.qZA(),l.YNc(46,o_,4,5,"div",13),l.ALo(47,"async"),l.qZA(),l.BQk()}if(2&t){const t=e.ngIf,i=l.MAs(15),n=l.MAs(19),r=l.oxw();l.xp6(1),l.ekj("webmapp-menubtn-opened",l.lcZ(2,39,r.showMenu$)),l.xp6(2),l.uIk("name",l.lcZ(4,41,r.caretOutLine$)),l.xp6(2),l.ekj("details-container-visible",l.lcZ(6,43,r.showMenu$)),l.xp6(2),l.Q6J("track",l.lcZ(8,45,r.track$))("hidden",t<=0)("poi",l.lcZ(9,47,r.currentPoiIDToMap$)),l.xp6(3),l.Q6J("ngIf",l.lcZ(11,49,r.confOPTIONS$)),l.xp6(2),l.Q6J("ngIf",!1===l.lcZ(13,51,r.drawTrackEnable$))("ngIfElse",i),l.xp6(4),l.Q6J("ngIf",l.lcZ(17,53,r.mergedPoi$)),l.xp6(2),l.Q6J("wmMapConf",l.lcZ(20,55,r.confMap$))("wmMapPadding",l.lcZ(21,57,r.mapPadding$))("wmMapFilters",l.lcZ(22,59,r.apiElasticState$))("wmMapTranslationCallback",r.translationCallback)("wmMapOverlay",l.lcZ(23,61,r.enableOverLay$))("wmMapOverlayUrl","https://geohub.webmapp.it/api/taxonomy/where/geojson/13")("wmMapFeatureCollection",null!=l.lcZ(24,63,r.wmMapFeatureCollectionOverlay$))("wmMapFeatureCollectionOverlay",l.lcZ(25,65,r.wmMapFeatureCollectionOverlay$))("wmMapCustomTrackDrawTrack",l.lcZ(26,67,r.drawTrackEnable$))("wmMapCustomTrackDrawTrackHost",l.lcZ(27,69,r.graphhopperHost$))("reloadCustomTracks",l.lcZ(28,71,r.reloadCustomTracks$))("jidoUpdateTime",l.lcZ(29,73,r.confJIDOUPDATETIME$))("wmMapLayerDataLayerUrls",l.lcZ(30,75,r.dataLayerUrls$))("wmMapLayerLayer",l.lcZ(31,77,r.currentLayer$))("wmMapLayerRefresh",l.lcZ(32,79,r.refreshLayer$))("wmMapLayerDisableLayers",l.lcZ(33,81,r.drawTrackEnable$))("wmMapInputTyped",l.lcZ(34,83,r.apiSearchInputTyped$))("wmMapPoisPoi",l.lcZ(35,85,r.currentPoiIDToMap$))("wmMapPoisPois",l.lcZ(36,87,r.pois$))("wmMapPoisFilters",l.lcZ(37,89,r.poiFilterIdentifiers$))("WmMapPoisUnselectPoi",l.lcZ(38,91,r.resetSelectedPoi$))("wmMapPoisDisableClusterLayer",l.lcZ(39,93,r.drawTrackEnable$))("track",l.lcZ(40,95,r.track$))("wmMapTrackColor",l.lcZ(41,97,r.trackColor$))("trackElevationChartElements",l.lcZ(42,99,r.trackElevationChartHoverElements$)),l.xp6(25),l.Q6J("wmFiltersClose",l.lcZ(45,101,n.wmMapCloseTopRightBtnsEVT$)),l.xp6(3),l.Q6J("ngIf",l.lcZ(47,103,r.enableDrawTrack$))}}function a_(t,e){if(1&t&&(l.ynx(0),l._uU(1),l.ALo(2,"wmtrans"),l.BQk()),2&t){const t=e.ngIf;l.xp6(1),l.AsE("",l.lcZ(2,2,"Punto di partenza"),": ",t,"")}}function l_(t,e){if(1&t&&(l.ynx(0),l._uU(1),l.ALo(2,"wmtrans"),l.BQk()),2&t){const t=l.oxw().ngIf;l.xp6(1),l.AsE("",l.lcZ(2,2,"Punto di arrivo"),": ",t.to,"")}}function c_(t,e){if(1&t&&(l.ynx(0),l.TgZ(1,"ion-card-header"),l.TgZ(2,"ion-card-title"),l._uU(3),l.ALo(4,"wmtrans"),l.qZA(),l.TgZ(5,"ion-card-subtitle"),l.YNc(6,a_,3,4,"ng-container",0),l.YNc(7,l_,3,4,"ng-container",0),l.qZA(),l.qZA(),l.TgZ(8,"ion-card-content"),l._UZ(9,"webmapp-track-technical-data",36),l.qZA(),l.BQk()),2&t){const t=e.ngIf,i=l.oxw().ngIf;l.xp6(3),l.Oqu(l.lcZ(4,4,t.name)),l.xp6(3),l.Q6J("ngIf",t.from),l.xp6(1),l.Q6J("ngIf",t.to),l.xp6(2),l.Q6J("feature",i)}}function h_(t,e){if(1&t&&(l.TgZ(0,"ion-card",35),l.YNc(1,c_,10,6,"ng-container",0),l.qZA()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",t.properties)}}function u_(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"div",31),l.TgZ(1,"wm-map",32,33),l.NdJ("currentCustomTrack",function(e){return l.CHM(t),l.oxw(2).saveCurrentCustomTrack(e)})("trackSelectedFromLayerEVT",function(e){return l.CHM(t),l.oxw(2).toggleDetails(e)})("related-poi-click",function(e){return l.CHM(t),l.oxw(2).setCurrentRelatedPoi(e)}),l.ALo(3,"async"),l.ALo(4,"async"),l.ALo(5,"async"),l.ALo(6,"async"),l.ALo(7,"async"),l.qZA(),l.YNc(8,h_,2,1,"ion-card",34),l.ALo(9,"async"),l.qZA()}if(2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("wmMapConf",l.lcZ(3,7,t.confMap$))("wmMapPadding",l.lcZ(4,9,t.mapPrintPadding$))("wmMapOverlay",l.lcZ(5,11,t.enableOverLay$))("wmMapOverlayUrl","https://geohub.webmapp.it/api/taxonomy/where/geojson/13")("track",l.lcZ(6,13,t.track$))("trackElevationChartElements",l.lcZ(7,15,t.trackElevationChartHoverElements$)),l.xp6(7),l.Q6J("ngIf",l.lcZ(9,17,t.track$))}}function d_(t,e){if(1&t&&(l.TgZ(0,"div"),l._UZ(1,"webmapp-track-description",40),l.ALo(2,"wmtrans"),l._UZ(3,"webmapp-track-poi",41),l.qZA()),2&t){const t=e.ngIf,i=l.oxw().ngIf;l.xp6(1),l.Q6J("description",l.lcZ(2,2,t.description)),l.xp6(2),l.Q6J("track",i)}}function p_(t,e){if(1&t&&(l.TgZ(0,"div",39),l.YNc(1,d_,4,4,"div",0),l.qZA()),2&t){const t=e.ngIf;l.xp6(1),l.Q6J("ngIf",t.properties)}}function f_(t,e){if(1&t&&(l.TgZ(0,"div",37),l.YNc(1,p_,2,1,"div",38),l.ALo(2,"async"),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.Q6J("ngIf",l.lcZ(2,1,t.track$))}}function g_(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-buttons",24),l.TgZ(3,"ion-button",25),l.NdJ("click",function(){return l.CHM(t),l.oxw(),l.MAs(3).dismiss()}),l._uU(4),l.ALo(5,"wmtrans"),l.qZA(),l.qZA(),l.TgZ(6,"ion-title"),l._uU(7),l.ALo(8,"wmtrans"),l.qZA(),l.TgZ(9,"ion-buttons",26),l.TgZ(10,"ion-item"),l.TgZ(11,"ion-label"),l._uU(12),l.ALo(13,"wmtrans"),l.qZA(),l.TgZ(14,"ion-toggle",27),l.NdJ("click",function(){l.CHM(t);const e=l.oxw();return e.mapPrintDetails$.next(!e.mapPrintDetails$.value)}),l.qZA(),l.qZA(),l.TgZ(15,"ion-button",28),l.NdJ("click",function(){return l.CHM(t),l.oxw().printPage()}),l._uU(16),l.ALo(17,"wmtrans"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(18,"ion-content"),l.YNc(19,u_,10,19,"div",29),l.ALo(20,"async"),l.YNc(21,f_,3,3,"div",30),l.ALo(22,"async"),l.qZA()}if(2&t){const t=l.oxw();l.xp6(4),l.Oqu(l.lcZ(5,7,"esci")),l.xp6(3),l.Oqu(l.lcZ(8,9,"anteprima di stampa")),l.xp6(5),l.Oqu(l.lcZ(13,11,"dettagli")),l.xp6(3),l.Q6J("strong",!0),l.xp6(1),l.Oqu(l.lcZ(17,13,"stampa")),l.xp6(3),l.Q6J("ngIf",!1===l.lcZ(20,15,t.mapPrintDetails$)),l.xp6(2),l.Q6J("ngIf",!0===l.lcZ(22,17,t.mapPrintDetails$))}}const m_=[100,100,100,400],__=[{path:"",component:(()=>{class t{constructor(t,e,i,n,r,o){this._route=t,this._router=e,this._geohubService=i,this._cdr=n,this._store=r,this._langService=o,this.trackColor$=new rt.X("#caaf15"),this.apiElasticState$=this._store.select(xt.jf),this.apiGoToHome$=this._store.select(xt.Vp),this.apiSearchInputTyped$=this._store.select(xt.Zk),this.confHOME$=this._store.select(Mu.Gj),this.confJIDOUPDATETIME$=this._store.select(Mu.SH),this.confMap$=this._store.select(Mu.bg).pipe((0,kt.b)(t=>{null!=t&&null!=t.pois&&1==t.pois.apppoisApiLayer&&this._store.dispatch((0,wt.kC)())})),this.confOPTIONS$=this._store.select(Mu.mw),this.currentCustomTrack$=new rt.X(null),this.currentLayer$=this._store.select(xt.b7),this.currentPoi$=new rt.X(null),this.currentPoiID$=new rt.X(-1),this.currentPoiIDFromHome$=this._store.select(Ku),this.currentPoiNextID$=new rt.X(-1),this.currentPoiPrevID$=new rt.X(-1),this.currentRelatedPoi$=new rt.X(null),this.disableLayers$=new rt.X(!1),this.drawTrackEnable$=new rt.X(!1),this.enableDrawTrack$=this._store.select(Mu.bH),this.enableOverLay$=new rt.X(!1),this.geohubId$=this._store.select(Mu.TK),this.goToHomeSub$=bt.w.EMPTY,this.graphhopperHost$=(0,Ct.of)(Qu.N.graphhopperHost),this.langs$=this._store.select(Mu.CU).pipe((0,kt.b)(t=>{t&&t.default&&this._langService.initLang(t.default)})),this.mapPadding$=new rt.X(m_),this.mapPrintDetails$=new rt.X(!1),this.mapPrintPadding$=new rt.X([0,0,0,0]),this.mergedPoi$=(0,Tt.T)(this.currentPoi$.pipe((0,Et.x)(),(0,ot.U)(t=>null==t?null:(this.WmMapTrackRelatedPoisDirective&&(this.WmMapTrackRelatedPoisDirective.setPoi=-1),t))),this.currentRelatedPoi$.pipe((0,Et.x)(),(0,ot.U)(t=>null==t?null:t))).pipe((0,kt.b)(t=>{null!=t&&this._router.navigate([],{relativeTo:this._route,queryParams:{poi:t.properties.id},queryParamsHandling:"merge"})})),this.poiFilterIdentifiers$=this._store.select(xt.qX),this.poiIDs$=new rt.X([]),this.pois$=this._store.select(xt.vb),this.reloadCustomTracks$=new rt.X(null),this.resetSelectedPoi$=new rt.X(!1),this.resizeEVT=new rt.X(!1),this.setCurrentPoiSub$=bt.w.EMPTY,this.showMenu$=new rt.X(!0),this.trackElevationChartHoverElements$=new rt.X(null),this.translationCallback=t=>null==t?"":this._langService.instant(t),this.wmMapFeatureCollectionOverlay$=new rt.X(null),this.refreshLayer$=this._store.select(xt.Ue),window.innerWidth<600&&(this.mapPadding$.next([m_[0],m_[1],m_[2],0]),this.resizeEVT.next(!this.resizeEVT.value)),this.dataLayerUrls$=this.geohubId$.pipe((0,Pt.h)(t=>null!=t),(0,ot.U)(t=>(13==t&&this.enableOverLay$.next(!0),{low:`https://jidotile.webmapp.it/?x={x}&y={y}&z={z}&index=geohub_app_low_${t}`,high:`https://jidotile.webmapp.it/?x={x}&y={y}&z={z}&index=geohub_app_high_${t}`}))),this.setCurrentPoiSub$=this._store.select(xt.Z_).pipe((0,Pt.h)(t=>null!=t),(0,Mt.w)(t=>this._route.queryParams),(0,Pt.h)(t=>null!=t),(0,It.b)(500)).subscribe(t=>{this.setCurrentPoi(t.poi)}),this.trackid$=this._route.queryParams.pipe((0,Pt.h)(t=>null!=t&&null!=t.track),(0,ot.U)(t=>+t.track),(0,Lt.O)(-1)),this.track$=this.trackid$.pipe((0,Et.x)((t,e)=>t===e),(0,Mt.w)(t=>t>-1?(0,St.D)(this._geohubService.getEcTrack(t)):(0,Ct.of)(null)),(0,kt.b)(t=>{if(null!=t){const e=(t.properties.related_pois||[]).map(t=>t.properties.id);this.poiIDs$.next(e)}else this.poiIDs$.next([])}),(0,At.B)()),this.caretOutLine$=this.showMenu$.pipe((0,ot.U)(t=>t?"caret-back-outline":"caret-forward-outline")),this.leftPadding$=this.showMenu$.pipe((0,ot.U)(t=>t?400:0)),this.currentPoiIDToMap$=(0,Tt.T)(this.currentPoiID$,this.currentPoiIDFromHome$).pipe((0,ot.U)(t=>null!=t?t:-1),(0,Et.x)((t,e)=>+t==+e)),this.goToHomeSub$=this.apiGoToHome$.pipe((0,Rt.T)(1)).subscribe(t=>{this.unselectPOI()})}next(){this.WmMapTrackRelatedPoisDirective.poiNext()}ngOnDestroy(){this.goToHomeSub$.unsubscribe(),this.setCurrentPoiSub$.unsubscribe()}prev(){this.WmMapTrackRelatedPoisDirective.poiPrev()}printPage(){window.print();let t=document.getElementById("print-page");t=null}reloadCustomTrack(){var t;this.reloadCustomTracks$.next(null!==(t=!this.reloadCustomTracks$.value)&&void 0!==t&&t)}removeActivityFilter(t){}removeTrackFilter(t){this._store.dispatch((0,wt.oR)({filter:t}))}resetFilters(){this.homeCmp.goToHome()}saveCurrentCustomTrack(t){const e=JSON.parse(JSON.stringify(t));this.currentCustomTrack$.next(e)}selectTrack(t=-1){this.updateUrl(t)}selectedLayer(t){this.homeCmp.setLayer(t),this.wmMapFeatureCollectionOverlay$.next(null)}setCurrentPoi(t){t!==this.currentPoiID$.value&&this.currentPoiID$.next(t),this._cdr.detectChanges()}setCurrentRelatedPoi(t){null!=t&&-1!=t&&(this.currentRelatedPoi$.next(t),this.WmMapTrackRelatedPoisDirective.setPoi=t.id)}setPoi(t){this.currentPoi$.next(t)}setTrackElevationChartHoverElements(t){null!=t&&this.trackElevationChartHoverElements$.next(t)}setWmMapFeatureCollection(t){this.homeCmp.setLayer(null),this.wmMapFeatureCollectionOverlay$.next(t)}toggleDetails(t){null==t&&(t=-1,Bh.priority=0),this.updateUrl(t)}toggleDrawTrackEnabled(){const t=this.drawTrackEnable$.value;this.currentCustomTrack$.next(null),this.drawTrackEnable$.next(!t)}toggleMenu(){this.showMenu$.next(!this.showMenu$.value),this.resizeEVT.next(!this.resizeEVT.value)}unselectPOI(){this.currentPoi$.next(null),this.currentRelatedPoi$.next(null),this.WmMapTrackRelatedPoisDirective.setPoi=-1,this.resetSelectedPoi$.next(!this.resetSelectedPoi$.value),this._router.navigate([],{relativeTo:this._route,queryParams:{poi:void 0},queryParamsHandling:"merge"})}updatePoiFilter(t){this._store.dispatch((0,wt.Dq)({filterIdentifier:t.identifier}))}updateTrackFilter(t){let e=t;this._store.dispatch("slider"===e.type?(0,wt.kp)({filter:e}):(0,wt.oR)({filter:e}))}updateUrl(t){this._router.navigate([],{relativeTo:this._route,queryParams:{track:t||null},queryParamsHandling:"merge"})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(yt.gz),l.Y36(yt.F0),l.Y36(nd),l.Y36(l.sBO),l.Y36(Lu.yh),l.Y36(Xu.C))},t.\u0275cmp=l.Xpm({type:t,selectors:[["webmapp-map-page"]],viewQuery:function(t,e){if(1&t&&(l.Gf(bu,5),l.Gf(Km,5),l.Gf(Yu,5)),2&t){let t;l.iGM(t=l.CRH())&&(e.WmMapTrackRelatedPoisDirective=t.first),l.iGM(t=l.CRH())&&(e.filterCmp=t.first),l.iGM(t=l.CRH())&&(e.homeCmp=t.first)}},features:[l._Bn([Xu.C])],decls:5,vars:3,consts:[[4,"ngIf"],["trigger","open-print-modal","id","print-page",1,"print-modal",3,"willDismiss"],["printModal",""],["type","button","title","menu",1,"webmapp-menubtn",3,"click"],[1,"details-container"],[1,"webmapp-track-details",3,"track","hidden","poi","trackElevationChartHover","poi-click","dismiss"],["class","webmapp-home",3,"hidden",4,"ngIf","ngIfElse"],["customTrack",""],[3,"poi","closeEVT","nextEVT","prevEVT",4,"ngIf"],["wmMapCustomTracks","","wmMapLayer","","wmMapPois","","wmMapTrack","","wmMapTrackRelatedPois","",3,"wmMapConf","wmMapPadding","wmMapFilters","wmMapTranslationCallback","wmMapOverlay","wmMapOverlayUrl","wmMapFeatureCollection","wmMapFeatureCollectionOverlay","wmMapCustomTrackDrawTrack","wmMapCustomTrackDrawTrackHost","reloadCustomTracks","jidoUpdateTime","wmMapLayerDataLayerUrls","wmMapLayerLayer","wmMapLayerRefresh","wmMapLayerDisableLayers","wmMapInputTyped","wmMapPoisPoi","wmMapPoisPois","wmMapPoisFilters","WmMapPoisUnselectPoi","wmMapPoisDisableClusterLayer","track","wmMapTrackColor","trackElevationChartElements","wmMapOverlayEVT$","wmMapFeatureCollectionLayerSelected","currentCustomTrack","colorSelectedFromLayerEVT","currentPoiEvt","trackSelectedFromLayerEVT","related-poi","related-poi-next"],["wmap",""],["top-right","",3,"wmFiltersClose","filterPoisEvt","filterTracksEvt","removefilterTracksEvt","removefilterPoiEvt","resetFiltersEvt","click"],["filterCmp",""],["top-right","","class","top-right-button","expand","full",3,"click",4,"ngIf"],["class","webmapp-track-download-urls-item","target","_blank",3,"href",4,"ngIf"],["target","_blank",1,"webmapp-track-download-urls-item",3,"href"],["slot","start",1,"wm-icn","icon-link"],[1,"webmapp-track-download-urls-item-label"],[1,"webmapp-home",3,"hidden"],[3,"langs","defaultLang"],[3,"map","track","reloadEvt",4,"ngIf"],[3,"map","track","reloadEvt"],[3,"poi","closeEVT","nextEVT","prevEVT"],["top-right","","expand","full",1,"top-right-button",3,"click"],["slot","start"],[3,"click"],["slot","end"],["slot","end",3,"click"],[3,"strong","click"],["class","print-container",4,"ngIf"],["class","print-details-wrapper",4,"ngIf"],[1,"print-container"],["wmMapTarget","ol-stamp","wmMapTrack","","wmMapTrackRelatedPois","",3,"wmMapConf","wmMapPadding","wmMapOverlay","wmMapOverlayUrl","track","trackElevationChartElements","currentCustomTrack","trackSelectedFromLayerEVT","related-poi-click"],["wmapprint",""],["class","print-details",4,"ngIf"],[1,"print-details"],["id","webmapp-track-details-technical-data",3,"feature"],[1,"print-details-wrapper"],["class","print-container-details",4,"ngIf"],[1,"print-container-details"],[3,"description"],[3,"track"]],template:function(t,e){1&t&&(l.YNc(0,s_,48,105,"ng-container",0),l.ALo(1,"async"),l.TgZ(2,"ion-modal",1,2),l.NdJ("willDismiss",function(){return e.mapPrintDetails$.next(!1)}),l.YNc(4,g_,23,19,"ng-template"),l.qZA()),2&t&&l.Q6J("ngIf",l.lcZ(1,1,e.trackid$))},directives:[r.O5,s.ki,s.gu,Tf,Vh,eu,su,xu,Su,bu,ku,Pu,ou,Sf.b,s.Ie,s.Q$,Yu,kf.H,Dm,Jm,s.Gu,s.sr,s.Sm,s.YG,s.wd,s.ho,s.w,s.W2,s.PM,s.Zi,s.Dq,s.tO,s.FN,md,zp,Fp],pipes:[r.Ov,K.a],styles:["webmapp-map-page .top-right-button{cursor:pointer;height:40px;position:relative}webmapp-map-page .layer-button,webmapp-map-page .top-right-button{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:8px 14px;grid-gap:10px;gap:10px;background:#fff!important;box-shadow:0 6px 14px #0003;border-radius:4px}webmapp-map-page .layer-button{width:41px;height:44px;flex:none;order:1;flex-grow:0}webmapp-map-page .layer-content{position:absolute!important;background:#fff!important;max-height:548px;width:209px;right:2%;top:55px;border-radius:4px;padding:15px;box-shadow:0 0 0 0 #0000001a;box-shadow:0 1px 3px 0 #0000001a;box-shadow:0 6px 6px 0 #00000017;box-shadow:0 13px 8px 0 #0000000d;box-shadow:0 23px 9px 0 #00000003;box-shadow:0 36px 10px 0 #0000}webmapp-map-page ion-progress-bar{position:absolute;top:0;z-index:10000;left:0;right:0;width:0}webmapp-map-page .success .progress{background:green}webmapp-map-page wm-map{width:100%;height:100%}webmapp-map-page .details-container::-webkit-scrollbar{display:none}webmapp-map-page .details-container{width:0;overflow:auto;-ms-overflow-style:none;scrollbar-width:none;height:100%;position:absolute;top:0;left:0;transition:width .5s;z-index:2;background:var(--wm-color-light);color:var(--wm-color-dark)}webmapp-map-page .details-container.details-container-visible,webmapp-map-page .details-container webmapp-track-details{width:400px}webmapp-map-page #map-container{width:100%;height:100%}webmapp-map-page .webmapp-menubtn{position:absolute;top:20px;left:0;transition:left .5s;z-index:10000;background:var(--wm-color-light);color:var(--wm-color-primary);width:22px;height:56px}webmapp-map-page .webmapp-menubtn.webmapp-menubtn-opened{left:400px}@media print{body,html{-webkit-print-color-adjust:exact}@page{size:portrait;margin:0}.print-modal,.print-modal *{visibility:visible!important}.break{display:block;page-break-after:always;page-break-before:always;page-break-inside:avoid}.print-modal ion-header,wm-map .map-container .top{display:none}.print-container,.print-modal,wm-map{width:100%;height:100%;--width:100%;--height:100%}webmapp-track-description{page-break-after:always}}.print-modal{--width:100%;--height:100%}@page{.print-modal{size:A4;margin:0}}.print-modal #webmapp-map-attribution-container,.print-modal #webmapp-map-scale-line-container,.print-modal .ol-overlaycontainer-stopevent,.print-modal .top{display:none!important}.print-modal .print-details{position:absolute;bottom:0;left:0;right:0;background-color:#fff;margin:2%}.print-modal .print-details .webmapp-track-technical-data-container{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;align-content:stretch;align-items:stretch}.print-modal .print-details .webmapp-track-technical-data-container .webmapp-track-technical-data-item{order:0;flex:0 1 auto;align-self:auto}.print-modal .print-details .webmapp-track-technical-data-container .webmapp-track-technical-data-item>*{margin:2px}.print-modal .print-details .webmapp-track-technical-data-container hr{display:none}.print-modal .print-details .print-details-wrapper{width:100vw;height:100vh;display:block;max-width:100%;position:relative}.print-modal .print-details .print-details-wrapper>p{line-height:0}.print-modal wm-map{position:absolute;left:0;right:0;top:0;bottom:0;display:block;overflow:hidden;min-height:297mm;width:100%}.print-modal .print-container,.print-modal .print-details-wrapper{width:794px;height:100%;position:absolute;margin:auto;left:0;right:0;background-color:#fff;page-break-after:always}.print-modal .print-details-wrapper{height:auto;page-break-after:always}.print-modal ion-content{--background:gray!important}.print-modal .webmapp-poi-popup-btn,.print-modal .webmapp-track-description-expand-container{display:none}.print-modal #webmapp-track-description-html{padding:0!important}.print-modal #webmapp-track-description-html>p{font-size:12px}.print-modal #webmapp-track-description-container{max-height:100%!important}.print-modal webmapp-track-poi .webmapp-track-poi-list .webmapp-track-poi-item{height:100px;font-size:12px}.print-modal .print-container-details{margin:5px}.print-modal .break{display:block;page-break-after:always;page-break-before:always;page-break-inside:avoid}.print-modal .filter-container{position:relative}.print-modal .draw-track-button{position:absolute;top:0;right:0;margin-top:8px;margin-right:14px}"],encapsulation:2,changeDetection:0}),t})()}];let v_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[yt.Bz.forChild(__)],yt.Bz]}),t})(),y_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,c,ft,s.Pc]]}),t})(),w_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,s.Pc]]}),t})(),x_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,s.Pc,w_]]}),t})(),b_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,x_],x_]}),t})(),C_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[]]}),t})(),T_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[r.ez,o.u5,s.Pc,v_,c,gt,vt,y_,b_,mt,C_,n.L]]}),t})()},6413:(t,e,i)=>{t.exports=i(4450)},9292:(t,e,i)=>{"use strict";var n=i(5637),r=i(1253),o=i(1128),s=i(6737),a=i(7140),l=i(3967),c=i(8124),h=i(231),u=i(8383),d=i(8780),p=i(6856);t.exports=function(t){return new Promise(function(e,i){var f,g=t.data,m=t.headers,_=t.responseType;function v(){t.cancelToken&&t.cancelToken.unsubscribe(f),t.signal&&t.signal.removeEventListener("abort",f)}n.isFormData(g)&&n.isStandardBrowserEnv()&&delete m["Content-Type"];var y=new XMLHttpRequest;if(t.auth){var w=t.auth.username||"",x=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";m.Authorization="Basic "+btoa(w+":"+x)}var b=a(t.baseURL,t.url);function C(){if(y){var n="getAllResponseHeaders"in y?l(y.getAllResponseHeaders()):null;r(function(t){e(t),v()},function(t){i(t),v()},{data:_&&"text"!==_&&"json"!==_?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:n,config:t,request:y}),y=null}}if(y.open(t.method.toUpperCase(),s(b,t.params,t.paramsSerializer),!0),y.timeout=t.timeout,"onloadend"in y?y.onloadend=C:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(C)},y.onabort=function(){y&&(i(new u("Request aborted",u.ECONNABORTED,t,y)),y=null)},y.onerror=function(){i(new u("Network Error",u.ERR_NETWORK,t,y,y)),y=null},y.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(new u(e,(t.transitional||h).clarifyTimeoutError?u.ETIMEDOUT:u.ECONNABORTED,t,y)),y=null},n.isStandardBrowserEnv()){var T=(t.withCredentials||c(b))&&t.xsrfCookieName?o.read(t.xsrfCookieName):void 0;T&&(m[t.xsrfHeaderName]=T)}"setRequestHeader"in y&&n.forEach(m,function(t,e){void 0===g&&"content-type"===e.toLowerCase()?delete m[e]:y.setRequestHeader(e,t)}),n.isUndefined(t.withCredentials)||(y.withCredentials=!!t.withCredentials),_&&"json"!==_&&(y.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&y.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(f=function(t){y&&(i(!t||t&&t.type?new d:t),y.abort(),y=null)},t.cancelToken&&t.cancelToken.subscribe(f),t.signal&&(t.signal.aborted?f():t.signal.addEventListener("abort",f))),g||(g=null);var S=p(b);S&&-1===["http","https","file"].indexOf(S)?i(new u("Unsupported protocol "+S+":",u.ERR_BAD_REQUEST,t)):y.send(g)})}},4450:(t,e,i)=>{"use strict";var n=i(5637),r=i(2755),o=i(1384),s=i(9961),a=function t(e){var i=new o(e),a=r(o.prototype.request,i);return n.extend(a,o.prototype,i),n.extend(a,i),a.create=function(i){return t(s(e,i))},a}(i(836));a.Axios=o,a.CanceledError=i(8780),a.CancelToken=i(9478),a.isCancel=i(17),a.VERSION=i(974).version,a.toFormData=i(1798),a.AxiosError=i(8383),a.Cancel=a.CanceledError,a.all=function(t){return Promise.all(t)},a.spread=i(3950),a.isAxiosError=i(7461),t.exports=a,t.exports.default=a},9478:(t,e,i)=>{"use strict";var n=i(8780);function r(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var i=this;this.promise.then(function(t){if(i._listeners){var e,n=i._listeners.length;for(e=0;e<n;e++)i._listeners[e](t);i._listeners=null}}),this.promise.then=function(t){var e,n=new Promise(function(t){i.subscribe(t),e=t}).then(t);return n.cancel=function(){i.unsubscribe(e)},n},t(function(t){i.reason||(i.reason=new n(t),e(i.reason))})}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},r.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},r.source=function(){var t;return{token:new r(function(e){t=e}),cancel:t}},t.exports=r},8780:(t,e,i)=>{"use strict";var n=i(8383);function r(t){n.call(this,null==t?"canceled":t,n.ERR_CANCELED),this.name="CanceledError"}i(5637).inherits(r,n,{__CANCEL__:!0}),t.exports=r},17:t=>{"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},1384:(t,e,i)=>{"use strict";var n=i(5637),r=i(6737),o=i(7095),s=i(859),a=i(9961),l=i(7140),c=i(4019),h=c.validators;function u(t){this.defaults=t,this.interceptors={request:new o,response:new o}}u.prototype.request=function(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},(e=a(this.defaults,e)).method=e.method?e.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var i=e.transitional;void 0!==i&&c.assertOptions(i,{silentJSONParsing:h.transitional(h.boolean),forcedJSONParsing:h.transitional(h.boolean),clarifyTimeoutError:h.transitional(h.boolean)},!1);var n=[],r=!0;this.interceptors.request.forEach(function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))});var o,l=[];if(this.interceptors.response.forEach(function(t){l.push(t.fulfilled,t.rejected)}),!r){var u=[s,void 0];for(Array.prototype.unshift.apply(u,n),u=u.concat(l),o=Promise.resolve(e);u.length;)o=o.then(u.shift(),u.shift());return o}for(var d=e;n.length;){var p=n.shift(),f=n.shift();try{d=p(d)}catch(g){f(g);break}}try{o=s(d)}catch(g){return Promise.reject(g)}for(;l.length;)o=o.then(l.shift(),l.shift());return o},u.prototype.getUri=function(t){t=a(this.defaults,t);var e=l(t.baseURL,t.url);return r(e,t.params,t.paramsSerializer)},n.forEach(["delete","get","head","options"],function(t){u.prototype[t]=function(e,i){return this.request(a(i||{},{method:t,url:e,data:(i||{}).data}))}}),n.forEach(["post","put","patch"],function(t){function e(e){return function(i,n,r){return this.request(a(r||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}u.prototype[t]=e(),u.prototype[t+"Form"]=e(!0)}),t.exports=u},8383:(t,e,i)=>{"use strict";var n=i(5637);function r(t,e,i,n,r){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}n.inherits(r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var o=r.prototype,s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){s[t]={value:t}}),Object.defineProperties(r,s),Object.defineProperty(o,"isAxiosError",{value:!0}),r.from=function(t,e,i,s,a,l){var c=Object.create(o);return n.toFlatObject(t,c,function(t){return t!==Error.prototype}),r.call(c,t.message,e,i,s,a),c.name=t.name,l&&Object.assign(c,l),c},t.exports=r},7095:(t,e,i)=>{"use strict";var n=i(5637);function r(){this.handlers=[]}r.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},r.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=r},7140:(t,e,i)=>{"use strict";var n=i(5684),r=i(6198);t.exports=function(t,e){return t&&!n(e)?r(t,e):e}},859:(t,e,i)=>{"use strict";var n=i(5637),r=i(1344),o=i(17),s=i(836),a=i(8780);function l(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new a}t.exports=function(t){return l(t),t.headers=t.headers||{},t.data=r.call(t,t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return l(t),e.data=r.call(t,e.data,e.headers,t.transformResponse),e},function(e){return o(e)||(l(t),e&&e.response&&(e.response.data=r.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},9961:(t,e,i)=>{"use strict";var n=i(5637);t.exports=function(t,e){e=e||{};var i={};function r(t,e){return n.isPlainObject(t)&&n.isPlainObject(e)?n.merge(t,e):n.isPlainObject(e)?n.merge({},e):n.isArray(e)?e.slice():e}function o(i){return n.isUndefined(e[i])?n.isUndefined(t[i])?void 0:r(void 0,t[i]):r(t[i],e[i])}function s(t){if(!n.isUndefined(e[t]))return r(void 0,e[t])}function a(i){return n.isUndefined(e[i])?n.isUndefined(t[i])?void 0:r(void 0,t[i]):r(void 0,e[i])}function l(i){return i in e?r(t[i],e[i]):i in t?r(void 0,t[i]):void 0}var c={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:l};return n.forEach(Object.keys(t).concat(Object.keys(e)),function(t){var e=c[t]||o,r=e(t);n.isUndefined(r)&&e!==l||(i[t]=r)}),i}},1253:(t,e,i)=>{"use strict";var n=i(8383);t.exports=function(t,e,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?e(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}},1344:(t,e,i)=>{"use strict";var n=i(5637),r=i(836);t.exports=function(t,e,i){var o=this||r;return n.forEach(i,function(i){t=i.call(o,t,e)}),t}},836:(t,e,i)=>{"use strict";var n=i(5637),r=i(6183),o=i(8383),s=i(231),a=i(1798),l={"Content-Type":"application/x-www-form-urlencoded"};function c(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var h,u={transitional:s,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(h=i(9292)),h),transformRequest:[function(t,e){if(r(e,"Accept"),r(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t))return t;if(n.isArrayBufferView(t))return t.buffer;if(n.isURLSearchParams(t))return c(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString();var i,o=n.isObject(t),s=e&&e["Content-Type"];if((i=n.isFileList(t))||o&&"multipart/form-data"===s){var l=this.env&&this.env.FormData;return a(i?{"files[]":t}:t,l&&new l)}return o||"application/json"===s?(c(e,"application/json"),function(t,e,i){if(n.isString(t))try{return(0,JSON.parse)(t),n.trim(t)}catch(r){if("SyntaxError"!==r.name)throw r}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||u.transitional,i=!(e&&e.silentJSONParsing)&&"json"===this.responseType;if(i||e&&e.forcedJSONParsing&&n.isString(t)&&t.length)try{return JSON.parse(t)}catch(r){if(i){if("SyntaxError"===r.name)throw o.from(r,o.ERR_BAD_RESPONSE,this,null,this.response);throw r}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:i(3122)},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],function(t){u.headers[t]={}}),n.forEach(["post","put","patch"],function(t){u.headers[t]=n.merge(l)}),t.exports=u},231:t=>{"use strict";t.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},974:t=>{t.exports={version:"0.27.2"}},2755:t=>{"use strict";t.exports=function(t,e){return function(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];return t.apply(e,i)}}},6737:(t,e,i)=>{"use strict";var n=i(5637);function r(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var o;if(i)o=i(e);else if(n.isURLSearchParams(e))o=e.toString();else{var s=[];n.forEach(e,function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),s.push(r(e)+"="+r(t))}))}),o=s.join("&")}if(o){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},6198:t=>{"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},1128:(t,e,i)=>{"use strict";var n=i(5637);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,i,r,o,s){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),n.isString(r)&&a.push("path="+r),n.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},5684:t=>{"use strict";t.exports=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}},7461:(t,e,i)=>{"use strict";var n=i(5637);t.exports=function(t){return n.isObject(t)&&!0===t.isAxiosError}},8124:(t,e,i)=>{"use strict";var n=i(5637);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function r(t){var n=t;return e&&(i.setAttribute("href",n),n=i.href),i.setAttribute("href",n),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=r(window.location.href),function(e){var i=n.isString(e)?r(e):e;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}},6183:(t,e,i)=>{"use strict";var n=i(5637);t.exports=function(t,e){n.forEach(t,function(i,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[n])})}},3122:t=>{t.exports=null},3967:(t,e,i)=>{"use strict";var n=i(5637),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,o,s={};return t?(n.forEach(t.split("\n"),function(t){if(o=t.indexOf(":"),e=n.trim(t.substr(0,o)).toLowerCase(),i=n.trim(t.substr(o+1)),e){if(s[e]&&r.indexOf(e)>=0)return;s[e]="set-cookie"===e?(s[e]?s[e]:[]).concat([i]):s[e]?s[e]+", "+i:i}}),s):s}},6856:t=>{"use strict";t.exports=function(t){var e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}},3950:t=>{"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},1798:(t,e,i)=>{"use strict";var n=i(5637);t.exports=function(t,e){e=e||new FormData;var i=[];function r(t){return null===t?"":n.isDate(t)?t.toISOString():n.isArrayBuffer(t)||n.isTypedArray(t)?"function"==typeof Blob?new Blob([t]):Buffer.from(t):t}return function t(o,s){if(n.isPlainObject(o)||n.isArray(o)){if(-1!==i.indexOf(o))throw Error("Circular reference detected in "+s);i.push(o),n.forEach(o,function(i,o){if(!n.isUndefined(i)){var a,l=s?s+"."+o:o;if(i&&!s&&"object"==typeof i)if(n.endsWith(o,"{}"))i=JSON.stringify(i);else if(n.endsWith(o,"[]")&&(a=n.toArray(i)))return void a.forEach(function(t){!n.isUndefined(t)&&e.append(l,r(t))});t(i,l)}}),i.pop()}else e.append(s,r(o))}(t),e}},4019:(t,e,i)=>{"use strict";var n=i(974).version,r=i(8383),o={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){o[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});var s={};o.transitional=function(t,e,i){function o(t,e){return"[Axios v"+n+"] Transitional option '"+t+"'"+e+(i?". "+i:"")}return function(i,n,a){if(!1===t)throw new r(o(n," has been removed"+(e?" in "+e:"")),r.ERR_DEPRECATED);return e&&!s[n]&&(s[n]=!0,console.warn(o(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,n,a)}},t.exports={assertOptions:function(t,e,i){if("object"!=typeof t)throw new r("options must be an object",r.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),o=n.length;o-- >0;){var s=n[o],a=e[s];if(a){var l=t[s],c=void 0===l||a(l,s,t);if(!0!==c)throw new r("option "+s+" must be "+c,r.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new r("Unknown option "+s,r.ERR_BAD_OPTION)}},validators:o}},5637:(t,e,i)=>{"use strict";var n,r=i(2755),o=Object.prototype.toString,s=(n=Object.create(null),function(t){var e=o.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())});function a(t){return t=t.toLowerCase(),function(e){return s(e)===t}}function l(t){return Array.isArray(t)}function c(t){return void 0===t}var h=a("ArrayBuffer");function u(t){return null!==t&&"object"==typeof t}function d(t){if("object"!==s(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}var p=a("Date"),f=a("File"),g=a("Blob"),m=a("FileList");function _(t){return"[object Function]"===o.call(t)}var v=a("URLSearchParams");function y(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),l(t))for(var i=0,n=t.length;i<n;i++)e.call(null,t[i],i,t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.call(null,t[r],r,t)}var w,x=(w="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(t){return w&&t instanceof w});t.exports={isArray:l,isArrayBuffer:h,isBuffer:function(t){return null!==t&&!c(t)&&null!==t.constructor&&!c(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){var e="[object FormData]";return t&&("function"==typeof FormData&&t instanceof FormData||o.call(t)===e||_(t.toString)&&t.toString()===e)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&h(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:u,isPlainObject:d,isUndefined:c,isDate:p,isFile:f,isBlob:g,isFunction:_,isStream:function(t){return u(t)&&_(t.pipe)},isURLSearchParams:v,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:y,merge:function t(){var e={};function i(i,n){e[n]=d(e[n])&&d(i)?t(e[n],i):d(i)?t({},i):l(i)?i.slice():i}for(var n=0,r=arguments.length;n<r;n++)y(arguments[n],i);return e},extend:function(t,e,i){return y(e,function(e,n){t[n]=i&&"function"==typeof e?r(e,i):e}),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t},inherits:function(t,e,i,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,i&&Object.assign(t.prototype,i)},toFlatObject:function(t,e,i){var n,r,o,s={};e=e||{};do{for(r=(n=Object.getOwnPropertyNames(t)).length;r-- >0;)s[o=n[r]]||(e[o]=t[o],s[o]=!0);t=Object.getPrototypeOf(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},kindOf:s,kindOfTest:a,endsWith:function(t,e,i){t=String(t),(void 0===i||i>t.length)&&(i=t.length);var n=t.indexOf(e,i-=e.length);return-1!==n&&n===i},toArray:function(t){if(!t)return null;var e=t.length;if(c(e))return null;for(var i=new Array(e);e-- >0;)i[e]=t[e];return i},isTypedArray:x,isFileList:m}},7827:t=>{let e=function(){};e.prototype.clone=function(t){let e={};for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},e.prototype.decodePath=function(t,e){let i=t.length,n=0,r=[],o=0,s=0,a=0;for(;n<i;){let i,l=0,c=0;do{i=t.charCodeAt(n++)-63,c|=(31&i)<<l,l+=5}while(i>=32);o+=1&c?~(c>>1):c>>1,l=0,c=0;do{i=t.charCodeAt(n++)-63,c|=(31&i)<<l,l+=5}while(i>=32);if(s+=1&c?~(c>>1):c>>1,e){l=0,c=0;do{i=t.charCodeAt(n++)-63,c|=(31&i)<<l,l+=5}while(i>=32);a+=1&c?~(c>>1):c>>1,r.push([1e-5*s,1e-5*o,a/100])}else r.push([1e-5*s,1e-5*o])}return r},e.prototype.extractError=function(t,e){let i;return t&&t.data?(i=t.data,i.hints&&i.hints[0]&&i.hints[0].message?i=i.hints[0].message:i.message&&(i=i.message)):i=t,new Error(i+" - for url "+e)},e.prototype.isArray=function(t){return"[object array]"===Object.prototype.toString.call(t).toLowerCase()},e.prototype.isObject=function(t){return"[object object]"===Object.prototype.toString.call(t).toLowerCase()},e.prototype.isString=function(t){return"string"==typeof t},t.exports=e},774:(t,e,i)=>{let n=i(6413),r=new(i(7827));GraphHopperRouting=function(t,e){this.defaults={profile:"car",debug:!1,locale:"en",points_encoded:!0,instructions:!0,elevation:!0,optimize:"false"},e&&Object.keys(e).forEach(t=>{this.defaults[t]=e[t]}),this.key=t.key,this.host=t.host?t.host:"https://graphhopper.com/api/1",this.endpoint=t.endpoint?t.endpoint:"/route",this.timeout=t.timeout?t.timeout:1e4,this.turn_sign_map=t.turn_sign_map?t.turn_sign_map:{"-6":"leave roundabout","-3":"turn sharp left","-2":"turn left","-1":"turn slight left",0:"continue",1:"turn slight right",2:"turn right",3:"turn sharp right",4:"finish",5:"reached via point",6:"enter roundabout"}},GraphHopperRouting.prototype.doRequest=function(t){Object.keys(this.defaults).forEach(e=>{t[e]||(t[e]=this.defaults[e])});let e=this.host+this.endpoint+"?key="+this.key,i=this;return new Promise((o,s)=>{n.post(e,t,{timeout:i.timeout,headers:{"Content-Type":"application/json"}}).then(i=>{if(200===i.status){if(i.data.paths)for(let e=0;e<i.data.paths.length;e++){let n=i.data.paths[e];if(n.points_encoded){let e=r.decodePath(n.points,t.elevation);n.points={type:"LineString",coordinates:e};let i=r.decodePath(n.snapped_waypoints,t.elevation);n.snapped_waypoints={type:"LineString",coordinates:i}}if(n.instructions)for(let t=0;t<n.instructions.length;t++){let e=n.instructions[t].interval;n.instructions[t].points=n.points.coordinates.slice([e[0],e[1]+1])}}o(i.data)}else s(r.extractError(i,e))}).catch(t=>{s(r.extractError(t.response,e))})})},GraphHopperRouting.prototype.info=function(){let t=this;return new Promise((e,i)=>{let o=t.host+"/info?key="+t.key;n.get(o,{timeout:t.timeout,headers:{"Content-Type":"application/json"}}).then(t=>{200===t.status?e(t.data):i(r.extractError(t,o))}).catch(t=>{console.log(t),i(r.extractError(t.response,o))})})},GraphHopperRouting.prototype.i18n=function(t){let e=t&&t.locale?t.locale:this.defaults.locale,i=this;return new Promise((t,o)=>{let s=i.host+"/i18n/"+e+"?key="+i.key;n.get(s,{timeout:i.timeout,headers:{"Content-Type":"application/json"}}).then(e=>{200===e.status?t(e.data):o(r.extractError(e,s))}).catch(t=>{o(r.extractError(t.response,s))})})},GraphHopperRouting.prototype.getTurnText=function(t){return this.turn_sign_map[t]},t.exports=GraphHopperRouting},8973:(t,e)=>{e.read=function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,h=-7,u=i?r-1:0,d=i?-1:1,p=t[e+u];for(u+=d,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+t[e+u],u+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=256*s+t[e+u],u+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},e.write=function(t,e,i,n,r,o){var s,a,l,c=8*o-r-1,h=(1<<c)-1,u=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=h?(a=0,s=h):s+u>=1?(a=(e*l-1)*Math.pow(2,r),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),s=0));r>=8;t[i+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*g}},3317:t=>{t.exports=function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){return r(e[s][1][t]||t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var o=void 0,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){(function(t){"use strict";var i,n,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var o=0,s=new r(h),a=t.document.createTextNode("");s.observe(a,{characterData:!0}),i=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){h(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(h,0)};else{var l=new t.MessageChannel;l.port1.onmessage=h,i=function(){l.port2.postMessage(0)}}var c=[];function h(){var t,e;n=!0;for(var i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}n=!1}e.exports=function(t){1!==c.push(t)||n||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var n=t(1);function r(){}var o={},s=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==r&&p(this,t)}function h(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function u(t,e,i){n(function(){var n;try{n=e(i)}catch(r){return o.reject(t,r)}n===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,n)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var i=!1;function n(e){i||(i=!0,o.reject(t,e))}function r(e){i||(i=!0,o.resolve(t,e))}var s=f(function(){e(r,n)});"error"===s.status&&n(s.value)}function f(t,e){var i={};try{i.value=t(e),i.status="success"}catch(n){i.status="error",i.value=n}return i}e.exports=c,c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===s)return this;var i=new this.constructor(r);return this.state!==l?u(i,this.state===a?t:e,this.outcome):this.queue.push(new h(i,t,e)),i},h.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){o.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},o.resolve=function(t,e){var i=f(d,e);if("error"===i.status)return o.reject(t,i.value);var n=i.value;if(n)p(t,n);else{t.state=a,t.outcome=e;for(var r=-1,s=t.queue.length;++r<s;)t.queue[r].callFulfilled(e)}return t},o.reject=function(t,e){t.state=s,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:o.resolve(new this(r),t)},c.reject=function(t){var e=new this(r);return o.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var s=new Array(i),a=0,l=-1,c=new this(r);++l<i;)h(t[l],l);return c;function h(t,r){e.resolve(t).then(function(t){s[r]=t,++a!==i||n||(n=!0,o.resolve(c,s))},function(t){n||(n=!0,o.reject(c,t))})}},c.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var n=-1,s=new this(r);++n<e;)this.resolve(t[n]).then(function(t){i||(i=!0,o.resolve(s,t))},function(t){i||(i=!0,o.reject(s,t))});return s}},{1:1}],3:[function(t,e,i){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function o(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var s=Promise;function a(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function l(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function c(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function h(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u="local-forage-detect-blob-support",d=void 0,p={},f=Object.prototype.toString,g="readonly",m="readwrite";function _(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}function v(t){var e=p[t.name],i={};i.promise=new s(function(t,e){i.resolve=t,i.reject=e}),e.deferredOperations.push(i),e.dbReady=e.dbReady?e.dbReady.then(function(){return i.promise}):i.promise}function y(t){var e=p[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function w(t,e){var i=p[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function x(t,e){return new s(function(i,n){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);v(t),t.db.close()}var o=[t.name];e&&o.push(t.version);var s=r.open.apply(r,o);e&&(s.onupgradeneeded=function(e){var i=s.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(u)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),s.onerror=function(t){t.preventDefault(),n(s.error)},s.onsuccess=function(){var e=s.result;e.onversionchange=function(t){t.target.close()},i(e),y(t)}})}function b(t){return x(t,!1)}function C(t){return x(t,!0)}function T(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version>t.db.version;if(t.version<t.db.version&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),n||i){if(i){var r=t.db.version+1;r>t.version&&(t.version=r)}return!0}return!1}function S(t){return o([_(atob(t.data))],{type:t.type})}function k(t){return t&&t.__local_forage_encoded_blob}function E(t){var e=this,i=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return l(i,t,t),i}function P(t,e,i,n){void 0===n&&(n=1);try{var r=t.db.transaction(t.storeName,e);i(null,r)}catch(o){if(n>0&&(!t.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return s.resolve().then(function(){if(!t.db||"NotFoundError"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),C(t)}).then(function(){return function(t){v(t);for(var e=p[t.name],i=e.forages,n=0;n<i.length;n++){var r=i[n];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return t.db=null,b(t).then(function(e){return t.db=e,T(t)?C(t):e}).then(function(n){t.db=e.db=n;for(var r=0;r<i.length;r++)i[r]._dbInfo.db=n}).catch(function(e){throw w(t,e),e})}(t).then(function(){P(t,e,i,n-1)})}).catch(i);i(o)}}var M={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var r=p[i.name];r||(p[i.name]=r={forages:[],db:null,dbReady:null,deferredOperations:[]}),r.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=E);var o=[];function a(){return s.resolve()}for(var l=0;l<r.forages.length;l++){var c=r.forages[l];c!==e&&o.push(c._initReady().catch(a))}var h=r.forages.slice(0);return s.all(o).then(function(){return i.db=r.db,b(i)}).then(function(t){return i.db=t,T(i,e._defaultConfig.version)?C(i):t}).then(function(t){i.db=r.db=t,e._dbInfo=i;for(var n=0;n<h.length;n++){var o=h[n];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version)}})},_support:function(){try{if(!r||!r.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(i){return!1}}(),iterate:function(t,e){var i=this,n=new s(function(e,n){i.ready().then(function(){P(i._dbInfo,g,function(r,o){if(r)return n(r);try{var s=o.objectStore(i._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var i=s.result;if(i){var n=i.value;k(n)&&(n=S(n));var r=t(n,i.key,a++);void 0!==r?e(r):i.continue()}else e()},s.onerror=function(){n(s.error)}}catch(l){n(l)}})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=new s(function(e,n){i.ready().then(function(){P(i._dbInfo,g,function(r,o){if(r)return n(r);try{var s=o.objectStore(i._dbInfo.storeName).get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),k(t)&&(t=S(t)),e(t)},s.onerror=function(){n(s.error)}}catch(a){n(a)}})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){var n=this;t=c(t);var r=new s(function(i,r){var a;n.ready().then(function(){return a=n._dbInfo,"[object Blob]"===f.call(e)?function(t){return"boolean"==typeof d?s.resolve(d):function(t){return new s(function(e){var i=t.transaction(u,m),n=o([""]);i.objectStore(u).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return d=t})}(a.db).then(function(t){return t?e:(i=e,new s(function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)}));var i}):e}).then(function(e){P(n._dbInfo,m,function(o,s){if(o)return r(o);try{var a=s.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);s.oncomplete=function(){void 0===e&&(e=null),i(e)},s.onabort=s.onerror=function(){r(l.error?l.error:l.transaction.error)}}catch(c){r(c)}})}).catch(r)});return a(r,i),r},removeItem:function(t,e){var i=this;t=c(t);var n=new s(function(e,n){i.ready().then(function(){P(i._dbInfo,m,function(r,o){if(r)return n(r);try{var s=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(s.error)},o.onabort=function(){n(s.error?s.error:s.transaction.error)}}catch(a){n(a)}})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){P(e._dbInfo,m,function(n,r){if(n)return i(n);try{var o=r.objectStore(e._dbInfo.storeName).clear();r.oncomplete=function(){t()},r.onabort=r.onerror=function(){i(o.error?o.error:o.transaction.error)}}catch(s){i(s)}})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){P(e._dbInfo,g,function(n,r){if(n)return i(n);try{var o=r.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){i(o.error)}}catch(s){i(s)}})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new s(function(e,n){t<0?e(null):i.ready().then(function(){P(i._dbInfo,g,function(r,o){if(r)return n(r);try{var s=o.objectStore(i._dbInfo.storeName),a=!1,l=s.openKeyCursor();l.onsuccess=function(){var i=l.result;i?0===t||a?e(i.key):(a=!0,i.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(c){n(c)}})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){P(e._dbInfo,g,function(n,r){if(n)return i(n);try{var o=r.objectStore(e._dbInfo.storeName).openKeyCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push(e.key),e.continue()):t(s)},o.onerror=function(){i(o.error)}}catch(a){i(a)}})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=h.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var n,o=this;if(t.name){var l=t.name===i.name&&o._dbInfo.db?s.resolve(o._dbInfo.db):b(t).then(function(e){var i=p[t.name],n=i.forages;i.db=e;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=e;return e});n=l.then(t.storeName?function(e){if(e.objectStoreNames.contains(t.storeName)){var i=e.version+1;v(t);var n=p[t.name],o=n.forages;e.close();for(var a=0;a<o.length;a++){var l=o[a];l._dbInfo.db=null,l._dbInfo.version=i}return new s(function(e,n){var o=r.open(t.name,i);o.onerror=function(t){o.result.close(),n(t)},o.onupgradeneeded=function(){o.result.deleteObjectStore(t.storeName)},o.onsuccess=function(){var t=o.result;t.close(),e(t)}}).then(function(t){n.db=t;for(var e=0;e<o.length;e++){var i=o[e];i._dbInfo.db=t,y(i._dbInfo)}}).catch(function(e){throw(w(t,e)||s.resolve()).catch(function(){}),e})}}:function(e){v(t);var i=p[t.name],n=i.forages;e.close();for(var o=0;o<n.length;o++)n[o]._dbInfo.db=null;return new s(function(e,i){var n=r.deleteDatabase(t.name);n.onerror=function(){var t=n.result;t&&t.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}}).then(function(t){i.db=t;for(var e=0;e<n.length;e++)y(n[e]._dbInfo)}).catch(function(e){throw(w(t,e)||s.resolve()).catch(function(){}),e})})}else n=s.reject("Invalid arguments");return a(n,e),n}},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",R=A.length,O="arbf",F="blob",D="si08",Z="ui08",N="uic8",j="si16",G="si32",z="ur16",V="ui32",B="fl32",q="fl64",U=R+O.length,$=Object.prototype.toString;function Y(t){var e,i,n,r,o,s=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c=new ArrayBuffer(s),h=new Uint8Array(c);for(e=0;e<a;e+=4)i=I.indexOf(t[e]),n=I.indexOf(t[e+1]),r=I.indexOf(t[e+2]),o=I.indexOf(t[e+3]),h[l++]=i<<2|n>>4,h[l++]=(15&n)<<4|r>>2,h[l++]=(3&r)<<6|63&o;return c}function X(t){var e,i=new Uint8Array(t),n="";for(e=0;e<i.length;e+=3)n+=I[i[e]>>2],n+=I[(3&i[e])<<4|i[e+1]>>4],n+=I[(15&i[e+1])<<2|i[e+2]>>6],n+=I[63&i[e+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var W={serialize:function(t,e){var i="";if(t&&(i=$.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===$.call(t.buffer))){var n,r=A;t instanceof ArrayBuffer?(n=t,r+=O):(n=t.buffer,"[object Int8Array]"===i?r+=D:"[object Uint8Array]"===i?r+=Z:"[object Uint8ClampedArray]"===i?r+=N:"[object Int16Array]"===i?r+=j:"[object Uint16Array]"===i?r+=z:"[object Int32Array]"===i?r+=G:"[object Uint32Array]"===i?r+=V:"[object Float32Array]"===i?r+=B:"[object Float64Array]"===i?r+=q:e(new Error("Failed to get type for BinaryArray"))),e(r+X(n))}else if("[object Blob]"===i){var o=new FileReader;o.onload=function(){var i="~~local_forage_type~"+t.type+"~"+X(this.result);e("__lfsc__:blob"+i)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(s){console.error("Couldn't convert value into a JSON string: ",t),e(null,s)}},deserialize:function(t){if(t.substring(0,R)!==A)return JSON.parse(t);var e,i=t.substring(U),n=t.substring(R,U);if(n===F&&L.test(i)){var r=i.match(L);e=r[1],i=i.substring(r[0].length)}var s=Y(i);switch(n){case O:return s;case F:return o([s],{type:e});case D:return new Int8Array(s);case Z:return new Uint8Array(s);case N:return new Uint8ClampedArray(s);case j:return new Int16Array(s);case z:return new Uint16Array(s);case G:return new Int32Array(s);case V:return new Uint32Array(s);case B:return new Float32Array(s);case q:return new Float64Array(s);default:throw new Error("Unkown type: "+n)}},stringToBuffer:Y,bufferToString:X};function H(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function J(t,e,i,n,r,o){t.executeSql(i,n,r,function(t,s){s.code===s.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],function(t,a){a.rows.length?o(t,s):H(t,e,function(){t.executeSql(i,n,r,o)},o)},o):o(t,s)},o)}function K(t,e,i,n){var r=this;t=c(t);var o=new s(function(o,s){r.ready().then(function(){void 0===e&&(e=null);var a=e,l=r._dbInfo;l.serializer.serialize(e,function(e,c){c?s(c):l.db.transaction(function(i){J(i,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],function(){o(a)},function(t,e){s(e)})},function(e){if(e.code===e.QUOTA_ERR){if(n>0)return void o(K.apply(r,[t,a,i,n-1]));s(e)}})})}).catch(s)});return a(o,i),o}function Q(t){return new s(function(e,i){t.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(i,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).name);e({db:t,storeNames:r})},function(t,e){i(e)})},function(t){i(t)})})}var tt={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]="string"!=typeof t[n]?t[n].toString():t[n];var r=new s(function(t,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(r){return n(r)}i.db.transaction(function(r){H(r,i,function(){e._dbInfo=i,t()},function(t,e){n(e)})},n)});return i.serializer=W,r},_support:"function"==typeof openDatabase,iterate:function(t,e){var i=this,n=new s(function(e,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){J(i,r,"SELECT * FROM "+r.storeName,[],function(i,n){for(var o=n.rows,s=o.length,a=0;a<s;a++){var l=o.item(a),c=l.value;if(c&&(c=r.serializer.deserialize(c)),void 0!==(c=t(c,l.key,a+1)))return void e(c)}e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=new s(function(e,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){J(i,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[t],function(t,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=r.serializer.deserialize(n)),e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){return K.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;t=c(t);var n=new s(function(e,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){J(i,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){J(e,n,"DELETE FROM "+n.storeName,[],function(){t()},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){J(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(e,i){var n=i.rows.item(0).c;t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new s(function(e,n){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){J(i,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,i){var n=i.rows.length?i.rows.item(0).key:null;e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new s(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){J(e,n,"SELECT key FROM "+n.storeName,[],function(e,i){for(var n=[],r=0;r<i.rows.length;r++)n.push(i.rows.item(r).key);t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=h.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var n,r=this;return a(n=t.name?new s(function(e){var n;n=t.name===i.name?r._dbInfo.db:openDatabase(t.name,"","",0),e(t.storeName?{db:n,storeNames:[t.storeName]}:Q(n))}).then(function(t){return new s(function(e,i){t.db.transaction(function(n){function r(t){return new s(function(e,i){n.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(t,e){i(e)})})}for(var o=[],a=0,l=t.storeNames.length;a<l;a++)o.push(r(t.storeNames[a]));s.all(o).then(function(){e()}).catch(function(t){i(t)})},function(t){i(t)})})}):s.reject("Invalid arguments"),e),n}};function et(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}var it={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=et(t,this._defaultConfig),!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=e,e.serializer=W,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=i.ready().then(function(){for(var e=i._dbInfo,n=e.keyPrefix,r=n.length,o=localStorage.length,s=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(r),s++)))return c}}});return a(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=i.ready().then(function(){var e=i._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return a(n,e),n},setItem:function(t,e,i){var n=this;t=c(t);var r=n.ready().then(function(){void 0===e&&(e=null);var i=e;return new s(function(r,o){var s=n._dbInfo;s.serializer.serialize(e,function(e,n){if(n)o(n);else try{localStorage.setItem(s.keyPrefix+t,e),r(i)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||o(a),o(a)}})})});return a(r,i),r},removeItem:function(t,e){var i=this;t=c(t);var n=i.ready().then(function(){localStorage.removeItem(i._dbInfo.keyPrefix+t)});return a(n,e),n},clear:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var n=localStorage.key(i);0===n.indexOf(t)&&localStorage.removeItem(n)}});return a(i,t),i},length:function(t){var e=this.keys().then(function(t){return t.length});return a(e,t),e},key:function(t,e){var i=this,n=i.ready().then(function(){var e,n=i._dbInfo;try{e=localStorage.key(t)}catch(r){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e});return a(n,e),n},keys:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo,i=localStorage.length,n=[],r=0;r<i;r++){var o=localStorage.key(r);0===o.indexOf(t.keyPrefix)&&n.push(o.substring(t.keyPrefix.length))}return n});return a(i,t),i},dropInstance:function(t,e){if(e=h.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var n,r=this;return a(n=t.name?new s(function(e){e(t.storeName?et(t,r._defaultConfig):t.name+"/")}).then(function(t){for(var e=localStorage.length-1;e>=0;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}}):s.reject("Invalid arguments"),e),n}},nt=function(t,e){for(var i=t.length,n=0;n<i;){if((r=t[n])===(o=e)||"number"==typeof r&&"number"==typeof o&&isNaN(r)&&isNaN(o))return!0;n++}var r,o;return!1},rt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ot={},st={},at={INDEXEDDB:M,WEBSQL:tt,LOCALSTORAGE:it},lt=[at.INDEXEDDB._driver,at.WEBSQL._driver,at.LOCALSTORAGE._driver],ct=["dropInstance"],ht=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ct),ut={description:"",driver:lt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function dt(t,e){t[e]=function(){var i=arguments;return t.ready().then(function(){return t[e].apply(t,i)})}}function pt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(arguments[0][i]=rt(e[i])?e[i].slice():e[i])}return arguments[0]}var ft=new(function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),at)if(at.hasOwnProperty(i)){var n=at[i],r=n._driver;this[i]=r,ot[r]||this.defineDriver(n)}this._defaultConfig=pt({},ut),this._config=pt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":n(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var n=new s(function(e,i){try{var n=t._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(r);for(var o=ht.concat("_initStorage"),l=0,c=o.length;l<c;l++){var h=o[l];if((!nt(ct,h)||t[h])&&"function"!=typeof t[h])return void i(r)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),i=s.reject(e);return a(i,arguments[arguments.length-1]),i}},i=0,n=ct.length;i<n;i++){var r=ct[i];t[r]||(t[r]=e(r))}}();var u=function(i){ot[n]&&console.info("Redefining LocalForage driver: "+n),ot[n]=t,st[n]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(u,i):u(!!t._support):u(!0)}catch(d){i(d)}});return l(n,e,i),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var n=ot[t]?s.resolve(ot[t]):s.reject(new Error("Driver not found."));return l(n,e,i),n},t.prototype.getSerializer=function(t){var e=s.resolve(W);return l(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return l(i,t,t),i},t.prototype.setDriver=function(t,e,i){var n=this;rt(t)||(t=[t]);var r=this._getSupportedDrivers(t);function o(){n._config.driver=n.driver()}function a(t){return n._extend(t),o(),n._ready=n._initStorage(n._config),n._ready}var c=null!==this._driverSet?this._driverSet.catch(function(){return s.resolve()}):s.resolve();return this._driverSet=c.then(function(){var t=r[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then(function(t){n._driver=t._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var r=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(r).then(a).catch(i)}o();var l=new Error("No available storage method found.");return n._driverSet=s.reject(l),n._driverSet}()}}(r)})}).catch(function(){o();var t=new Error("No available storage method found.");return n._driverSet=s.reject(t),n._driverSet}),l(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!st[t]},t.prototype._extend=function(t){pt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ht.length;t<e;t++)dt(this,ht[t])},t.prototype.createInstance=function(e){return new t(e)},t}());e.exports=ft},{3:3}]},{},[4])(4)},9688:(t,e,i)=>{"use strict";t.exports=r;var n=i(8973);function r(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var o=4294967296,s=1/o,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function l(t){return t.type===r.Bytes?t.readVarint()+t.pos:t.pos+1}function c(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function h(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function u(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function _(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function v(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function y(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}r.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=w(this.buf,this.pos)+w(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=w(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return c(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return c(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return c(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return c(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return c(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return c(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,i){return a.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var o,s,a,l=t[r],c=null,h=l>239?4:l>223?3:l>191?2:1;if(r+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===h?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=h}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==r.Bytes)return t.push(this.readVarint(e));var i=l(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==r.Bytes)return t.push(this.readSVarint());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==r.Bytes)return t.push(this.readBoolean());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==r.Bytes)return t.push(this.readFloat());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==r.Bytes)return t.push(this.readDouble());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed32());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed32());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readFixed64());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==r.Bytes)return t.push(this.readSFixed64());var e=l(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===r.Varint)for(;this.buf[this.pos++]>127;);else if(e===r.Bytes)this.pos=this.readVarint()+this.pos;else if(e===r.Fixed32)this.pos+=4;else{if(e!==r.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&h(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&h(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,r.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,y,e)},writeBytesField:function(t,e){this.writeTag(t,r.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,r.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,r.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,r.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,r.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,r.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,r.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},9657:function(t){t.exports=function(){"use strict";function t(t,n,r,o,s){!function t(i,n,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=n-r+1,c=Math.log(a),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);t(i,n,Math.max(r,Math.floor(n-l*h/a+u)),Math.min(o,Math.floor(n+(a-l)*h/a+u)),s)}var d=i[n],p=r,f=o;for(e(i,r,n),s(i[o],d)>0&&e(i,r,o);p<f;){for(e(i,p,f),p++,f--;s(i[p],d)<0;)p++;for(;s(i[f],d)>0;)f--}0===s(i[r],d)?e(i,r,f):e(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1)}}(t,n,r||0,o||t.length-1,s||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];a(r,t.leaf?n(s):s)}return r}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,i,n,r,o){for(var s=[i,n];s.length;)if(!((n=s.pop())-(i=s.pop())<=r)){var a=i+Math.ceil((n-i)/r/2)*r;t(e,a,i,n,o),s.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!p(t,e))return i;for(var n=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?n(s):s;p(t,a)&&(e.leaf?i.push(s):d(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!p(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var r=e.children[n],o=e.leaf?this.toBBox(r):r;if(p(t,o)){if(e.leaf||d(t,o))return!0;i.push(r)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,o,s=this.data,a=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),s.leaf){var h=r(t,s.children,e);if(-1!==h)return s.children.splice(h,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?n?(i++,s=n.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,n=s,s=s.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var r,s=i-e+1,a=this._maxEntries;if(s<=a)return o(r=f(t.slice(e,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,n-1))),(r=f([])).leaf=!1,r.height=n;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));g(t,e,i,c,this.compareMinX);for(var h=e;h<=i;h+=c){var u=Math.min(h+c-1,i);g(t,h,u,l,this.compareMinY);for(var d=h;d<=u;d+=l){var p=Math.min(d+l-1,u);r.children.push(this._build(t,d,p,n-1))}}return o(r,this.toBBox),r},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=h(l),u=(d=t,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);u<o?(o=u,r=c<r?c:r,s=l):u===o&&c<r&&(r=c,s=l)}e=s||e.children[0]}var d,p;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),a(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var s=this._chooseSplitIndex(i,r,n),a=f(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,r,o,a,l,c,u,d=1/0,p=1/0,f=e;f<=i-e;f++){var g=s(t,0,f,this.toBBox),m=s(t,f,i,this.toBBox),_=(r=g,o=m,a=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),u=Math.min(r.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,u-l)),v=h(g)+h(m);_<d?(d=_,n=f,p=v<p?v:p):_===d&&v<p&&(p=v,n=f)}return n||i-e},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:l,r=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var r=this.toBBox,o=s(t,0,e,r),l=s(t,i-e,i,r),c=u(o)+u(l),h=e;h<i-e;h++){var d=t.children[h];a(o,t.leaf?r(d):d),c+=u(o)}for(var p=i-e-1;p>=e;p--){var f=t.children[p];a(l,t.leaf?r(f):f),c+=u(l)}return c},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)a(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},n}()}}]);